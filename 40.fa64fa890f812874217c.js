(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/sql/WhereClause":1002,"esri/layers/graphics/data/utils":1081,"esri/layers/graphics/data/attributeSupport":1087,"esri/layers/graphics/data/QueryEngine":1094,"esri/layers/graphics/centroid":1106,"esri/layers/graphics/data/spatialQuerySupport":1107,"esri/layers/graphics/data/timeSupport":1112,"esri/layers/graphics/data/FeatureStore":1123,"esri/core/ItemCache":1124,"esri/core/sql/WhereClauseCache":1141,"esri/layers/graphics/data/QueryEngineCapabilities":1142,"esri/layers/graphics/contains":1143,"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":1144,"esri/layers/graphics/data/executeTileQuery":1159,"esri/layers/graphics/data/BoundsStore":1179,"esri/core/sql/AggregateFunctions":1180,"esri/core/sql/StandardizedFunctions":1181,"esri/core/sql/WhereGrammar":1182,"esri/core/sql/sql92grammar":1183,"esri/layers/graphics/data/QueryEngineResult":1184,"esri/layers/graphics/data/AttributesBuilder":1185,"esri/layers/support/PromiseQueue":1186,"esri/geohash/geohashUtils":1207,"esri/views/2d/layers/features/controllers/BaseController":1333,"esri/views/2d/layers/features/support/ClusterStore":1334,"esri/geohash/GeohashTree":1335,"esri/views/2d/layers/features/support/pixelBuffering":1336,"esri/views/2d/layers/features/controllers/OnDemandController":2083,"esri/views/2d/layers/features/controllers/EditsQueue":2084,"esri/views/2d/layers/features/support/DataTile":2085,"esri/views/2d/layers/features/support/DataTileFeaturesIndex":2086,"esri/core/SetPool":2087,"esri/views/2d/layers/features/support/TileUpdateQueue":2088})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[40,5],{1002:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(15),r(99),r(1180),r(1181),r(1182)],void 0===(i=function(e,t,r,n,i,a,s){Object.defineProperty(t,"__esModule",{value:!0});var o=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,u=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,l=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,c=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,h=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function d(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function f(e,t,r,n,i,a,s,o,u){if(void 0===r&&(r="0"),void 0===n&&(n="0"),void 0===i&&(i="0"),void 0===a&&(a="0"),void 0===s&&(s=""),void 0===o&&(o="0"),void 0===u&&(u="0"),"+"===s||"-"===s){var l=d(parseInt(e,10),4)+"-"+d(parseInt(t,10),2)+"-"+d(parseInt(r,10),2),c="";parseFloat(a)<10&&(c="0");var h=d(parseInt(n,10),2)+":"+d(parseInt(i,10),2)+":"+(c+parseFloat(a).toString()),f=""+s+d(parseInt(o,10),2)+":"+d(parseInt(u,10),2);return new Date(l+"T"+h+f)}return new Date(parseInt(e,10),parseInt(t,10)-1,parseInt(r,10),parseInt(n,10),parseInt(i,10),parseFloat(a))}var p=function(){function e(){}return e.makeBool=function(e){return m(e)},e.featureValue=function(e,t,r,n){return C(e,t,r,n)},e.equalsNull=function(e){return null===e},e.applyLike=function(e,t,r){return T(e,t,r)},e.ensureArray=function(e){return _(e)},e.applyIn=function(e,t){return S(e,t)},e.currentDate=function(){var e=new Date;return e.setHours(0,0,0,0),e},e.makeSqlInterval=function(e,t,r){return a.SqlInterval.createFromValueAndQualifer(e,t,r)},e.convertInterval=function(e){return e instanceof a.SqlInterval?e.valueInMilliseconds():e},e.currentTimestamp=function(){return new Date},e.compare=function(e,t,r){return F(e,t,r)},e.calculate=function(e,t,r){return N(e,t,r)},e.makeComparable=function(e){return w(e)},e.evaluateFunction=function(e,t){return a.evaluateFunction(e,t)},e.lookup=function(e,t){var r=t[e];return void 0===r?null:r},e.between=function(e,t){return null==e||null==t[0]||null==t[1]?null:e>=t[0]&&e<=t[1]},e.notbetween=function(e,t){return null==e||null==t[0]||null==t[1]?null:e<t[0]||e>t[1]},e.ternaryNot=function(e){return b(e)},e.ternaryAnd=function(e,t){return I(e,t)},e.ternaryOr=function(e,t){return x(e,t)},e}(),v=function(){function e(e,t){this.fieldsIndex=t,this.datefields={},this.parameters={},this.parseTree=s.WhereGrammar.parse(e);var r=this.extractExpressionInfo(t),n=r.isStandardized,i=r.isAggregate,a=r.referencedFieldNames;this.referencedFieldNames=a,this.isStandardized=n,this.isAggregate=i}return e.create=function(t,r){return new e(t,r)},Object.defineProperty(e.prototype,"fieldNames",{get:function(){return this.referencedFieldNames},enumerable:!0,configurable:!0}),e.prototype.testSet=function(e,r){void 0===r&&(r=t.defaultAttributeAdapter);for(var n={},i=function(t){n[t]=e.map((function(e){return r.getAttribute(e,t)}))},a=0,s=this.fieldNames;a<s.length;a++)i(s[a]);return!!this.evaluateNode(this.parseTree,{attributes:n},t.defaultAttributeAdapter)},e.prototype.calculateValue=function(e,r){void 0===r&&(r=t.defaultAttributeAdapter);var n=this.evaluateNode(this.parseTree,e,r);return n instanceof a.SqlInterval?n.valueInMilliseconds()/864e5:n},e.prototype.calculateValueCompiled=function(e,n){return void 0===n&&(n=t.defaultAttributeAdapter),null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,n,this.datefields):r("csp-restrictions")?this.calculateValue(e,n):(this.compileMe(),this.parseTree._compiledVersion(e,this.parameters,n,this.datefields))},e.prototype.testFeature=function(e,r){return void 0===r&&(r=t.defaultAttributeAdapter),!!this.evaluateNode(this.parseTree,e,r)},e.prototype.testFeatureCompiled=function(e,n){return void 0===n&&(n=t.defaultAttributeAdapter),null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,n,this.datefields):r("csp-restrictions")?this.testFeature(e,n):(this.compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,n,this.datefields))},e.prototype.getFunctions=function(){var e=[];return this.visitAll(this.parseTree,(function(t){"function"===t.type&&e.push(t.name.toLowerCase())})),E(e)},e.prototype.getExpressions=function(){var e=new Map;return this.visitAll(this.parseTree,(function(t){if("function"===t.type){var r=t.name.toLowerCase(),n=t.args.value[0];if("column_ref"===n.type){var i=n.column,a=r+"-"+i;e.has(a)||e.set(a,{aggregateType:r,field:i})}}})),n.valuesOfMap(e)},e.prototype.getVariables=function(){var e=[];return this.visitAll(this.parseTree,(function(t){"param"===t.type&&e.push(t.value.toLowerCase())})),E(e)},e.prototype.compileMe=function(){var e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",e).bind(p)},e.prototype.extractExpressionInfo=function(e){var t=this,r=[],n=!0,s=!0;return this.visitAll(this.parseTree,(function(o){switch(o.type){case"column_ref":var u=e.get(o.column),l=u&&u.name;!u||"date"!==u.type&&"esriFieldTypeDate"!==u.type||(t.datefields[u.name]=1),void 0!==l?(r.push(l),o.column=l):r.push(o.column);break;case"function":var c=o.name,h=o.args.value.length;n&&(n=a.isStandardized(c,h)),s&&(s=i.isAggregate(c,h))}})),{referencedFieldNames:E(r),isStandardized:n,isAggregate:s}},e.prototype.visitAll=function(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(var r=0,n=e.clauses;r<n.length;r++){var i=n[r];this.visitAll(i,t)}"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(var a=0,s=e.value;a<s.length;a++)i=s[a],this.visitAll(i,t);break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}},e.prototype.evaluateNodeToJavaScript=function(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case_expression":var t="";if("simple"===e.format){var r="this.makeComparable("+this.evaluateNodeToJavaScript(e.operand)+")";t="( ";for(var n=0;n<e.clauses.length;n++)t+=" ("+r+" === this.makeComparable("+this.evaluateNodeToJavaScript(e.clauses[n].operand)+")) ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{for(t="( ",n=0;n<e.clauses.length;n++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[n].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t;case"param":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expr_list":for(var i="[",a=0,s=e.value;a<s.length;a++){var o=s[a];"["!==i&&(i+=","),i+=this.evaluateNodeToJavaScript(o)}return i+"]";case"unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary_expr":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")"}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return JSON.stringify(e.value);case"date":return"(new Date("+g(e.value).getTime().toString()+"))";case"timestamp":return"(new Date("+y(e.value).getTime().toString()+"))";case"current_time":return"date"===e.mode?"this.currentDate()":"this.currentTimestamp()";case"column_ref":return"this.featureValue(feature,"+JSON.stringify(e.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+")"}throw new Error("Unsupported sql syntax "+e.type)},e.prototype.evaluateNode=function(e,t,r){switch(e.type){case"interval":var n=this.evaluateNode(e.value,t,r);return a.SqlInterval.createFromValueAndQualifer(n,e.qualifier,e.op);case"case_expression":if("simple"===e.format){for(var s=w(this.evaluateNode(e.operand,t,r)),o=0;o<e.clauses.length;o++)if(s===w(this.evaluateNode(e.clauses[o].operand,t,r)))return this.evaluateNode(e.clauses[o].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}else{for(o=0;o<e.clauses.length;o++)if(m(this.evaluateNode(e.clauses[o].operand,t,r)))return this.evaluateNode(e.clauses[o].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":for(var u=[],l=0,c=e.value;l<c.length;l++){var h=c[l];u.push(this.evaluateNode(h,t,r))}return u;case"unary_expr":return b(this.evaluateNode(e.expr,t,r));case"binary_expr":switch(e.operator){case"AND":return I(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"OR":return x(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t,r);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t,r);case"IN":var d=_(this.evaluateNode(e.right,t,r));return S(this.evaluateNode(e.left,t,r),d);case"NOT IN":return d=_(this.evaluateNode(e.right,t,r)),b(S(this.evaluateNode(e.left,t,r),d));case"BETWEEN":var f=this.evaluateNode(e.left,t,r),p=this.evaluateNode(e.right,t,r);return null==f||null==p[0]||null==p[1]?null:f>=w(p[0])&&f<=w(p[1]);case"NOTBETWEEN":return f=this.evaluateNode(e.left,t,r),p=this.evaluateNode(e.right,t,r),null==f||null==p[0]||null==p[1]?null:f<w(p[0])||f>w(p[1]);case"LIKE":return T(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape);case"NOT LIKE":return b(T(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return F(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"-":case"+":case"*":case"/":return N(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r))}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return e.value;case"date":return g(e.value);case"timestamp":return y(e.value);case"current_time":var v=new Date;return"date"===e.mode&&v.setHours(0,0,0,0),v;case"column_ref":return C(t,e.column,this.datefields,r);case"function":var E=this.evaluateNode(e.args,t,r);return this.isAggregate?i.aggregateFunction(e.name,E):a.evaluateFunction(e.name,E)}throw new Error("Unsupported sql syntax "+e.type)},e}();function y(e){var t=u.exec(e);if(null!==t)return f(t[1],t[2],t[3],t[4],t[5],t[6]);if(null!==(t=l.exec(e)))return f(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9]);if(null!==(t=c.exec(e)))return f(t[1],t[2],t[3],t[4],t[5],"0",t[6],t[7],t[8]);if(null!==(t=h.exec(e)))return f(t[1],t[2],t[3],t[4],t[5]);if(null!==(t=o.exec(e)))return f(t[1],t[2],t[3]);throw new Error("SQL Invalid Timestamp")}function g(e){var t=o.exec(e);if(null===t)throw new Error("SQL Invalid Date");var r=t[1],n=t[2],i=t[3];return new Date(parseInt(r,10),parseInt(n,10)-1,parseInt(i,10))}function m(e){return!0===e}function _(e){return Array.isArray(e)?e:[e]}function b(e){return null!==e?!0!==e:null}function I(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function x(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function S(e,t){if(null==e)return null;for(var r=!1,n=0,i=t;n<i.length;n++){var a=i[n];if(null==a)r=null;else if(e===a){r=!0;break}}return r}function T(e,t,r){if(null==e)return null;for(var n=t,i=r,a="",s=0,o=0;o<n.length;o++){var u=n.charAt(o);switch(s){case 0:u===i?s=1:"-[]/{}()*+?.\\^$|".indexOf(u)>=0?a+="\\"+u:a+="%"===u?".*":"_"===u?".":u;break;case 1:"-[]/{}()*+?.\\^$|".indexOf(u)>=0?a+="\\"+u:a+=u,s=0}}return new RegExp("^"+a+"$").test(e)}function w(e){return e instanceof Date?e.valueOf():e}function F(e,t,r){if(null==t||null==r)return null;var n=w(t),i=w(r);switch(e){case"<>":return n!==i;case"=":return n===i;case">":return n>i;case"<":return n<i;case">=":return n>=i;case"<=":return n<=i}}function E(e){for(var t=[],r={},n=0,i=e;n<i.length;n++){var a=i[n],s=a.toLowerCase();void 0===r[s]&&(t.push(a),r[s]=1)}return t}function N(e,t,r){if(t instanceof a.SqlInterval)if(r instanceof Date)switch(e){case"+":return new Date(t.valueInMilliseconds()+r.getTime());case"-":return t.valueInMilliseconds()-r.getTime();case"*":return t.valueInMilliseconds()*r.getTime();case"/":return t.valueInMilliseconds()/r.getTime()}else if(r instanceof a.SqlInterval)switch(e){case"+":return a.SqlInterval.createFromMilliseconds(t.valueInMilliseconds()+r.valueInMilliseconds());case"-":return a.SqlInterval.createFromMilliseconds(t.valueInMilliseconds()-r.valueInMilliseconds());case"*":return t.valueInMilliseconds()*r.valueInMilliseconds();case"/":return t.valueInMilliseconds()/r.valueInMilliseconds()}else t=t.valueInMilliseconds();else if(r instanceof a.SqlInterval)if(t instanceof Date)switch(e){case"+":return new Date(r.valueInMilliseconds()+t.getTime());case"-":return new Date(t.getTime()-r.valueInMilliseconds());case"*":return t.getTime()*r.valueInMilliseconds();case"/":return t.getTime()/r.valueInMilliseconds()}else r=r.valueInMilliseconds();else if(t instanceof Date&&"number"==typeof r)switch(r=24*r*60*60*1e3,t=t.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}else if(r instanceof Date&&"number"==typeof t)switch(t=24*t*60*60*1e3,r=r.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r}}function C(e,t,r,n){var i=n.getAttribute(e,t);return null!=i&&1===r[t]?new Date(i):i}t.WhereClause=v,t.defaultAttributeAdapter={getAttribute:function(e,t){var r;return((r=e)&&"object"==typeof r.attributes?e.attributes:e)[t]}}}.apply(null,n))||(e.exports=i)},1081:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(9),r(12),r(13),r(4),r(53),r(201),r(19),r(329),r(37),r(1106),r(322),r(196),r(1070),r(1107)],void 0===(i=function(e,t,r,n,i,a,s,o,u,l,c,h,d,f,p,v,y){Object.defineProperty(t,"__esModule",{value:!0});var g=new i.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});t.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var m=new p.default,_=new p.default,b=new p.default,I={esriGeometryPoint:f.convertToPoint,esriGeometryPolyline:f.convertToPolyline,esriGeometryPolygon:f.convertToPolygon,esriGeometryMultipoint:f.convertToMultipoint};function x(e,t,r,n,i){void 0===n&&(n=e.hasZ),void 0===i&&(i=e.hasM);var a=e.hasZ&&n,s=e.hasM&&i;if(r){var o=f.quantizeOptimizedGeometry(b,t,e.hasZ,e.hasM,"esriGeometryPoint",r,n,i);return f.convertToPoint(o,a,s)}return f.convertToPoint(t,a,s)}function S(e,i,s){return n(this,void 0,void 0,(function(){var n,o,h,d,f,p;return r(this,(function(r){switch(r.label){case 0:return e?(n=e.where,e.where=n=n&&n.trim(),(!n||/^1 *= *1$/.test(n)||i&&i===n)&&(e.where=null),e.geometry?[4,T(e)]:[2,e]):[2,null];case 1:return o=r.sent(),e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel&&(h=e.geometry.spatialReference,(o=u.getGeometryExtent(o)).spatialReference=h),e.geometry=o,[4,v.checkProjectionSupport(o.spatialReference,s)];case 2:return r.sent(),[4,c.normalizeCentralMeridian(l.fromJSON(o))];case 3:if(d=r.sent()[0],a.isNone(d))throw t.QUERY_ENGINE_EMPTY_RESULT;return f=d.toJSON(),[4,v.project(f,f.spatialReference,s)];case 4:if(!(p=r.sent()))throw t.QUERY_ENGINE_EMPTY_RESULT;return p.spatialReference=s,e.geometry=p,[2,e]}}))}))}function T(e){return n(this,void 0,void 0,(function(){var t,n,i,a,u,l,c,d,f;return r(this,(function(r){switch(r.label){case 0:return t=e.geometry,n=e.distance,i=e.units,null==n?[2,s.resolve(t)]:(a=t.spatialReference,u=i&&g.fromJSON(i)||o.getUnitString(a),a&&(h.isGeographic(a)||h.isWebMercator(a))?(c=t,[3,3]):[3,1]);case 1:return[4,v.checkProjectionSupport(a,h.WGS84).then((function(){return v.project(t,h.WGS84)}))];case 2:c=r.sent(),r.label=3;case 3:return l=c,[4,y.getGeodesicBufferOperator()];case 4:return d=r.sent(),[2,(f=d(l,n,u))?f.toJSON():null]}}))}))}t.transformCentroid=x,t.getCentroid=function(e,t,r){return"esriGeometryPolygon"===e.geometryType&&t&&(t.centroid||t.geometry)?(t.centroid||(t.centroid=d.getCentroidOptimizedGeometry(new p.default,t.geometry,e.hasZ,e.hasM)),x(e,t.centroid,r)):null},t.getGeometry=function(e,t,r,n,i,a){void 0===i&&(i=e.hasZ),void 0===a&&(a=e.hasM);var s=e.hasZ&&i,o=e.hasM&&a,u=t?"coords"in t?t:t.geometry:null;if(!u)return null;if(r){var l=f.generalizeOptimizedGeometry(_,u,e.hasZ,e.hasM,e.geometryType,r,i,a);return n&&(l=f.quantizeOptimizedGeometry(b,l,s,o,e.geometryType,n)),I[e.geometryType](l,s,o)}return n?(l=f.quantizeOptimizedGeometry(b,u,e.hasZ,e.hasM,e.geometryType,n,i,a),I[e.geometryType](l,s,o)):(f.removeZMValues(m,u,e.hasZ,e.hasM,i,a),I[e.geometryType](m,s,o))},t.normalizeQuery=function(e,t,i){return n(this,void 0,void 0,(function(){var n,a,s,o,u;return r(this,(function(r){if(n=e.outFields,a=e.orderByFields,s=e.groupByFieldsForStatistics,o=e.outStatistics,n)for(u=0;u<n.length;u++)n[u]=n[u].trim();if(a)for(u=0;u<a.length;u++)a[u]=a[u].trim();if(s)for(u=0;u<s.length;u++)s[u]=s[u].trim();if(o)for(u=0;u<o.length;u++)o[u].onStatisticField&&(o[u].onStatisticField=o[u].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),[2,S(e,t,i)]}))}))},t.normalizeFilter=function(e,t,i){return n(this,void 0,void 0,(function(){return r(this,(function(r){return[2,S(e,t,i)]}))}))},t.normalizeQueryLike=S,t.cleanFromGeometryEngine=function(e){return e&&w in e?JSON.parse(JSON.stringify(e,F)):e};var w="_geVersion",F=function(e,t){return e!==w?t:void 0}}.apply(null,n))||(e.exports=i)},1087:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(10),r(65),r(1141)],void 0===(i=function(e,t,r,n,i,a){Object.defineProperty(t,"__esModule",{value:!0});var s=new a.WhereClauseCache(50,500),o="feature-store:unsupported-query",u=i.createSetFromValues(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function l(e,t){return e?s.get(e,t):null}function c(e,t,r,i){void 0===i&&(i=!0);for(var a=[],s=0,u=t;s<u.length;s++){var d=u[s];if("*"!==d&&!e.has(d))if(i){var f=h(d);try{var p=l(f,e);if(!p)throw new n(o,"invalid SQL expression",{where:f});if(!p.isStandardized)throw new n(o,"expression is not standard",{clause:p});c(e,p.fieldNames,"expression contains missing fields")}catch(e){var v=e&&e.details;if(v&&(v.clause||v.where))throw e;v&&v.missingFields?a.push.apply(a,v.missingFields):a.push(d)}}else a.push(d)}if(a.length)throw new n(o,r,{missingFields:a})}function h(e){return e.split(" as ")[0]}t.validateWhere=function(e,t){if(!t)return!0;var r=s.get(t,e);if(!r)throw new n(o,"invalid SQL expression",{where:t});if(!r.isStandardized)throw new n(o,"where clause is not standard",{where:t});return c(e,r.fieldNames,"where clause contains missing fields"),!0},t.validateHaving=function(e,t,r){if(!t)return!0;var i=s.get(t,e);if(!i)throw new n(o,"invalid SQL expression",{having:t});if(!i.isAggregate)throw new n(o,"having does not contain a valid aggregate function",{having:t});var a=i.fieldNames;if(c(e,a,"having contains missing fields"),!i.getExpressions().every((function(t){var n=t.aggregateType,i=t.field,a=e.has(i)&&e.get(i).name;return r.some((function(t){var r=t.onStatisticField,i=t.statisticType;return(e.has(r)&&e.get(r).name)===a&&i.toLowerCase().trim()===n}))})))throw new n(o,"expressions in having should also exist in outStatistics",{having:t});return!0},t.getWhereClause=l,t.validateFields=c,t.getExpressionFromFieldName=h,t.getAliasFromFieldName=function(e){return e.split(" as ")[1]},t.hasInvalidFieldType=function(e,t){var r=t.get(e);return!!r&&!u.has(r.type)}}.apply(null,n))||(e.exports=i)},1094:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(8),r(9),r(10),r(7),r(335),r(4),r(65),r(53),r(332),r(131),r(337),r(19),r(37),r(1087),r(1070),r(1142),r(1184),r(1107),r(1112),r(1081),r(328),r(1186)],void 0===(i=function(e,t,r,n,i,a,s,o,u,l,c,h,d,f,p,v,y,g,m,_,b,I,x,S,T){Object.defineProperty(t,"__esModule",{value:!0});t.Feature=function(e,t,r,n,i){void 0===t&&(t=null),this.attributes=e,this.geometry=r,this.centroid=n,this.filterFlags=i,this.groupId=-1,this.localId=t};var w=new Set,F=new o.MemCacheStorage(2e6),E=0,N=function(){function e(e){var t=this;this.capabilities={query:m.queryCapabilities},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this._changeHandle=this.featureStore.events.on("changed",(function(){return t.clearCache()})),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new o.MemCache(E+++"$$",F)),this.fieldsIndex=new S(e.fields),e.scheduler&&e.task&&(this._frameQueue=new T.default,this._frameTask=e.scheduler.registerTask(e.task,(function(e){return t._update(e)}),(function(){return t._frameQueue.length>0})))}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()},Object.defineProperty(e.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullExtent",{get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:x.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeExtent",{get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=I.getTimeExtent(this.timeInfo,this.featureStore)),this._timeExtent):null},enumerable:!0,configurable:!0}),e.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null},e.prototype.executeQuery=function(e,t){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,r,i,a=this;return n(this,(function(n){switch(n.label){case 0:t=s.clone(e),n.label=1;case 1:return n.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,a.definitionExpression,a.spatialReference)}))];case 2:return t=n.sent(),[4,this._reschedule((function(){return a._checkQuerySupport(t)}))];case 3:return t=n.sent(),[4,this._reschedule((function(){return a._executeGeometryQuery(t)}))];case 4:return r=n.sent(),[4,this._reschedule((function(){return r.executeObjectIdsQuery(t)}))];case 5:return r=n.sent(),[4,this._reschedule((function(){return r.executeTimeQuery(t)}))];case 6:return r=n.sent(),[4,this._reschedule((function(){return r.executeAttributesQuery(t)}))];case 7:return r=n.sent(),[3,9];case 8:if((i=n.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw i;return r=new _.default([],null,this),[3,9];case 9:return[2,r.createQueryResponse(t)]}}))}))},e.prototype.executeQueryForCount=function(e,t){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,r,i,a=this;return n(this,(function(n){switch(n.label){case 0:(t=s.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,n.label=1;case 1:return n.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,a.definitionExpression,a.spatialReference)}))];case 2:return t=n.sent(),[4,this._reschedule((function(){return a._checkQuerySupport(t)}))];case 3:return t=n.sent(),[4,this._reschedule((function(){return a._executeGeometryQuery(t)}))];case 4:return r=n.sent(),[4,this._reschedule((function(){return r.executeObjectIdsQuery(t)}))];case 5:return r=n.sent(),[4,this._reschedule((function(){return r.executeTimeQuery(t)}))];case 6:return r=n.sent(),[4,this._reschedule((function(){return r.executeAttributesQuery(t)}))];case 7:return[2,(r=n.sent()).size];case 8:if((i=n.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw i;return[2,0];case 9:return[2]}}))}))},e.prototype.executeQueryForExtent=function(e,t){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,r,i,a,o,u,l,d,f=this;return n(this,(function(n){switch(n.label){case 0:t=s.clone(e),i=t.outSR,n.label=1;case 1:return n.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,f.definitionExpression,f.spatialReference)}))];case 2:return t=n.sent(),[4,this._reschedule((function(){return f._checkQuerySupport(t)}))];case 3:return(t=n.sent()).returnGeometry=!0,t.returnCentroid=!1,t.outSR=null,[4,this._reschedule((function(){return f._executeGeometryQuery(t)}))];case 4:return r=n.sent(),[4,this._reschedule((function(){return r.executeObjectIdsQuery(t)}))];case 5:return r=n.sent(),[4,this._reschedule((function(){return r.executeTimeQuery(t)}))];case 6:return r=n.sent(),[4,this._reschedule((function(){return r.executeAttributesQuery(t)}))];case 7:return r=n.sent(),(a=r.size)?(h.set(R,h.NEGATIVE_INFINITY),this.featureStore.forEachBounds(r.items,(function(e){return h.expand(R,e)}),C),o={xmin:R[0],ymin:R[1],xmax:R[3],ymax:R[4],spatialReference:x.cleanFromGeometryEngine(this.spatialReference)},this.hasZ&&isFinite(R[2])&&isFinite(R[5])&&(o.zmin=R[2],o.zmax=R[5]),(u=g.project(o,r.spatialReference,i)).spatialReference=x.cleanFromGeometryEngine(i||this.spatialReference),u.xmax-u.xmin==0&&(l=c.getMetersPerUnitForSR(u.spatialReference),u.xmin-=l,u.xmax+=l),u.ymax-u.ymin==0&&(l=c.getMetersPerUnitForSR(u.spatialReference),u.ymin-=l,u.ymax+=l),this.hasZ&&null!=u.zmin&&null!=u.zmax&&u.zmax-u.zmin==0&&(l=c.getMetersPerUnitForSR(u.spatialReference),u.zmin-=l,u.zmax+=l),[2,{count:a,extent:u}]):[2,{count:a,extent:null}];case 8:if((d=n.sent())===x.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw d;case 9:return[2]}}))}))},e.prototype.executeQueryForIds=function(e,t){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){return n(this,(function(r){return[2,this.executeQueryForIdSet(e,t).then((function(e){return l.valuesOfSet(e)}))]}))}))},e.prototype.executeQueryForIdSet=function(e,t){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,r,i,a,o,u=this;return n(this,(function(n){switch(n.label){case 0:(t=s.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,n.label=1;case 1:return n.trys.push([1,9,,10]),[4,this._schedule((function(){return x.normalizeQuery(t,u.definitionExpression,u.spatialReference)}))];case 2:return t=n.sent(),[4,this._reschedule((function(){return u._checkQuerySupport(t)}))];case 3:return t=n.sent(),[4,this._reschedule((function(){return u._executeGeometryQuery(t)}))];case 4:return r=n.sent(),[4,this._reschedule((function(){return r.executeObjectIdsQuery(t)}))];case 5:return r=n.sent(),[4,this._reschedule((function(){return r.executeTimeQuery(t)}))];case 6:return r=n.sent(),[4,this._reschedule((function(){return r.executeAttributesQuery(t)}))];case 7:return r=n.sent(),i=r.items,a=new Set,[4,this._reschedule((function(){for(var e=0,t=i;e<t.length;e++){var n=t[e];a.add(r.featureAdapter.getObjectId(n))}}))];case 8:return n.sent(),[2,a];case 9:if((o=n.sent())===x.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw o;case 10:return[2]}}))}))},e.prototype.executeQueryForLatestObservations=function(e,t){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,r,i,o=this;return n(this,(function(n){switch(n.label){case 0:if(!this.timeInfo||!this.timeInfo.trackIdField)throw new a("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});t=s.clone(e),n.label=1;case 1:return n.trys.push([1,9,,10]),[4,this._schedule((function(){return x.normalizeQuery(t,o.definitionExpression,o.spatialReference)}))];case 2:return t=n.sent(),[4,this._reschedule((function(){return o._checkQuerySupport(t)}))];case 3:return t=n.sent(),[4,this._reschedule((function(){return o._executeGeometryQuery(t)}))];case 4:return r=n.sent(),[4,this._reschedule((function(){return r.executeObjectIdsQuery(t)}))];case 5:return r=n.sent(),[4,this._reschedule((function(){return r.executeTimeQuery(t)}))];case 6:return r=n.sent(),[4,this._reschedule((function(){return r.executeAttributesQuery(t)}))];case 7:return r=n.sent(),[4,this._reschedule((function(){return r.filterLatest()}))];case 8:return r=n.sent(),[3,10];case 9:if((i=n.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw i;return r=new _.default([],null,this),[3,10];case 10:return[2,r.createQueryResponse(t)]}}))}))},e.prototype._schedule=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){return this._frameQueue?[2,this._frameQueue.push(e)]:[2,e()]}))}))},e.prototype._reschedule=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){return this._frameQueue?[2,this._frameQueue.unshift(e)]:[2,e()]}))}))},e.prototype._update=function(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null},e.prototype._getAll=function(){if(!this._allItems){var e=[];this.featureStore.forEach((function(t){return e.push(t)})),this._allItems=new _.default(e,null,this)}return this._allItems},e.prototype._executeGeometryQuery=function(e){return i(this,void 0,void 0,(function(){var t,r,a,s,o,u,l,c,h,d,f,p,y,g,m,I,x,S,T,w=this;return n(this,(function(F){switch(F.label){case 0:if(t=e.geometry,r=e.outSR,a=e.spatialRel,s=v.isValid(r)&&!v.equals(this.spatialReference,r),(o=this._geometryQueryCache?s?JSON.stringify({geometry:t,spatialRelationship:a,outSpatialReference:r}):JSON.stringify({geometry:t,spatialRelationship:a}):null)&&void 0!==(u=this._geometryQueryCache.get(o)))return[2,u];if(l=function(t){return i(w,void 0,void 0,(function(){var i;return n(this,(function(n){switch(n.label){case 0:return s&&(e.returnGeometry||e.returnCentroid)?[4,t.project(r)]:[3,2];case 1:return i=n.sent(),o&&this._geometryQueryCache.put(o,i,i.size||1),[2,i];case 2:return o&&this._geometryQueryCache.put(o,t,t.size||1),[2,t]}}))}))},!t)return[2,l(this._getAll())];if(c=this.featureAdapter,"esriSpatialRelDisjoint"!==a)return[3,3];if(!(h=this._searchFeatures(this._getQueryBBoxes(t))).length)return[2,l(this._getAll())];for(p=new Set,y=0,g=h;y<g.length;y++)m=g[y],p.add(c.getObjectId(m));return[4,this._reschedule((function(){var e=0;d=new Array(p.size),w.featureStore.forEach((function(t){return d[e++]=t})),f=p}))];case 1:return F.sent(),[4,this._reschedule((function(){return i(w,void 0,void 0,(function(){var e,r,i;return n(this,(function(n){switch(n.label){case 0:return[4,b.getSpatialQueryOperator(a,t,this)];case 1:return e=n.sent(),r=function(t){return!f.has(c.getObjectId(t))||e(c.getGeometry(t))},i=_.default.bind,[4,this._runSpatialFilter(d,r)];case 2:return[2,new(i.apply(_.default,[void 0,n.sent(),t,this]))]}}))}))}))];case 2:return x=F.sent(),[2,l(x)];case 3:return(I=this._searchFeatures(this._getQueryBBoxes(t))).length?this._canExecuteSoloPass(t,e)?[2,l(new _.default(I,t,this))]:[4,b.getSpatialQueryOperator(a,t,this)]:(x=new _.default([],t,this),o&&this._geometryQueryCache.put(o,x,x.size||1),[2,x]);case 4:return S=F.sent(),[4,this._runSpatialFilter(I,(function(e){return S(c.getGeometry(e))}))];case 5:return T=F.sent(),[2,l(new _.default(T,t,this))]}}))}))},e.prototype._runSpatialFilter=function(e,t){return i(this,void 0,void 0,(function(){var r,a,s,o=this;return n(this,(function(u){return t?this._budget?(r=0,a=new Array,s=function(){return i(o,void 0,void 0,(function(){var i;return n(this,(function(n){switch(n.label){case 0:return r<e.length?(i=e[r],t(i)&&a.push(i),this._budget.done?[4,this._reschedule((function(){return s()}))]:[3,2]):[3,3];case 1:n.sent(),n.label=2;case 2:return++r,[3,0];case 3:return[2]}}))}))},[2,this._reschedule((function(){return s()})).then((function(){return a}))]):[2,e.filter((function(e){return t(e)}))]:[2,e]}))}))},e.prototype._canExecuteSoloPass=function(e,t){var r=this.geometryType,n=t.spatialRel;return b.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===n||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===n||"esriSpatialRelContains"===n||"esriSpatialRelWithin"===n))},e.prototype._getQueryBBoxes=function(e){if(b.canQueryWithRBush(e)){if(p.isExtent(e))return[d.fromValues(e.xmin,e.ymin,e.xmax,e.ymax)];if(p.isPolygon(e))return e.rings.map((function(e){return d.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[f.getBoundsXY(d.create(),e)]},e.prototype._searchFeatures=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this.featureStore.forEachInBounds(n,(function(e){w.add(e)}))}var i=new Array(w.size),a=0;return w.forEach((function(e){return i[a++]=e})),w.clear(),i},e.prototype._checkQuerySupport=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new a("feature-store:unsupported-query","Unsupported query options",{query:e});return[2,u.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),b.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),g.checkProjectionSupport(this.spatialReference,e.outSR)]).then((function(){return e}))]}))}))},e.prototype._checkAttributesQuerySupport=function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues;if(r&&r.length>0){var i=r.map((function(e){var t=e.toLowerCase();return t.indexOf(" asc")>-1?t.split(" asc")[0]:t.indexOf(" desc")>-1?t.split(" desc")[0]:e}));y.validateFields(this.fieldsIndex,i,"orderByFields contains missing fields")}if(t&&t.length>0)y.validateFields(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new a("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});y.validateWhere(this.fieldsIndex,e.where)},e.prototype._checkStatisticsQuerySupport=function(e){return i(this,void 0,void 0,(function(){var t,r,i,s,o,u,l,c,h,d,f;return n(this,(function(n){if(t=e.outStatistics,r=e.groupByFieldsForStatistics,i=e.having,s=r&&r.length,o=t&&t.length,i){if(!s||!o)throw new a("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});y.validateHaving(this.fieldsIndex,i,t)}if(o){if(t.some((function(e){return"exceedslimit"===e.statisticType})))return[2];for(u=t.map((function(e){return e.onStatisticField})),y.validateFields(this.fieldsIndex,u,"onStatisticFields contains missing fields"),s&&y.validateFields(this.fieldsIndex,r,"groupByFieldsForStatistics contains missing fields"),l=0,c=t;l<c.length;l++)if(h=c[l],d=h.onStatisticField,f=h.statisticType,(!s||"count"!==f)&&d&&y.hasInvalidFieldType(d,this.fieldsIndex))throw new a("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:h,query:e})}return[2]}))}))},e}();t.default=N;var C=h.create(),R=h.create()}.apply(null,n))||(e.exports=i)},1106:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){return e?t?4:3:t?3:2}function n(e,t,n,i,a,s){for(var o=r(a,s),u=n,l=n+o,c=0,h=0,d=0,f=0,p=0,v=0,y=i-1;v<y;v++,u+=o,l+=o){var g=t[u],m=t[u+1],_=t[u+2],b=t[l],I=t[l+1],x=t[l+2],S=g*I-b*m;f+=S,c+=(g+b)*S,h+=(m+I)*S,a&&(d+=(_+x)*(S=g*x-b*_),p+=S),g<e[0]&&(e[0]=g),g>e[1]&&(e[1]=g),m<e[2]&&(e[2]=m),m>e[3]&&(e[3]=m),a&&(_<e[4]&&(e[4]=_),_>e[5]&&(e[5]=_))}if(f>0&&(f*=-1),p>0&&(p*=-1),!f)return null;var T=[c,h,.5*f];return a&&(T[3]=d,T[4]=.5*p),T}function i(e,t,n,i,l){for(var c=r(i,l),h=t,d=t+c,f=0,p=0,v=0,y=0,g=0,m=n-1;g<m;g++,h+=c,d+=c){var _,b=e[h],I=e[h+1],x=e[h+2],S=e[d],T=e[d+1],w=e[d+2],F=i?s(b,I,x,S,T,w):a(b,I,S,T);F&&(f+=F,i?(p+=F*(_=u(b,I,x,S,T,w))[0],v+=F*_[1],y+=F*_[2]):(p+=F*(_=o(b,I,S,T))[0],v+=F*_[1]))}return f>0?i?[p/f,v/f,y/f]:[p/f,v/f]:n>0?i?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function a(e,t,r,n){var i=r-e,a=n-t;return Math.sqrt(i*i+a*a)}function s(e,t,r,n,i,a){var s=n-e,o=i-t,u=a-r;return Math.sqrt(s*s+o*o+u*u)}function o(e,t,r,n){return[e+.5*(r-e),t+.5*(n-t)]}function u(e,t,r,n,i,a){return[e+.5*(n-e),t+.5*(i-t),r+.5*(a-r)]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCentroidOptimizedGeometry=function(e,t,a,s){if(!t||!t.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);for(var o=e.coords,u=[],l=a?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],c=t.lengths,h=t.coords,d=r(a,s),f=0,p=0,v=c;p<v.length;p++){var y=v[p],g=n(l,h,f,y,a,s);g&&u.push(g),f+=y*d}if(u.sort((function(e,t){var r=e[2]-t[2];return 0===r&&a&&(r=e[4]-t[4]),r})),u.length){var m=6*u[0][2];o[0]=u[0][0]/m,o[1]=u[0][1]/m,a&&(m=6*u[0][4],o[2]=0!==m?u[0][3]/m:0),(o[0]<l[0]||o[0]>l[1]||o[1]<l[2]||o[1]>l[3]||a&&(o[2]<l[4]||o[2]>l[5]))&&(o.length=0)}if(!o.length){var _=t.lengths[0]?i(h,0,c[0],a,s):null;if(!_)return null;o[0]=_[0],o[1]=_[1],a&&_.length>2&&(o[2]=_[2])}return e},t.lineCentroid=i}.apply(null,n))||(e.exports=i)},1107:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(9),r(10),r(4),r(103),r(207),r(19),r(37),r(1143),r(322),r(196),r(1070),r(1081)],void 0===(i=function(e,t,n,i,a,s,o,u,l,c,h,d,f,p,v){Object.defineProperty(t,"__esModule",{value:!0});var y={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},g={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},m={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},_={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function b(){return s.create((function(e){return r.e(7).then(function(){var t=[r(1091)];e.apply(null,t)}.bind(this)).catch(r.oe)}))}t.importGeometryEngine=b,t.getGeodesicBufferOperator=function(){return b().then((function(e){return e.geodesicBuffer}))},t.getSpatialQueryOperator=function(e,t,r){if(l.isPolygon(t)&&"esriGeometryPoint"===r.geometryType&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var n=d.convertFromPolygon(new f.default,t,!1,!1);return s.resolve((function(e){return h.polygonContainsPoint(n,!1,!1,e)}))}if(l.isPolygon(t)&&"esriGeometryMultipoint"===r.geometryType){var i=d.convertFromPolygon(new f.default,t,!1,!1);if("esriSpatialRelContains"===e)return s.resolve((function(e){return h.polygonContainsMultipoint(i,!1,!1,e,r.hasZ,r.hasM)}))}if(l.isExtent(t)&&"esriGeometryPoint"===r.geometryType&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return s.resolve((function(e){return o.extentContainsPoint(t,v.getGeometry(r,e))}));if(l.isExtent(t)&&"esriGeometryMultipoint"===r.geometryType&&"esriSpatialRelContains"===e)return s.resolve((function(e){return o.extentContainsMultipoint(t,v.getGeometry(r,e))}));if(l.isExtent(t)&&"esriSpatialRelIntersects"===e){var a=u.getExtentIntersector(r.geometryType);return s.resolve((function(e){return a(t,v.getGeometry(r,e))}))}return b().then((function(n){var i=n[y[e]].bind(null,t);return function(e){return i(v.getGeometry(r,e))}}))},t.checkSpatialQuerySupport=function(e,t,r){return i(this,void 0,void 0,(function(){var i,s;return n(this,(function(n){if(i=e.spatialRel,!(s=e.geometry))return[2];if(!0!==g[i])throw new a("feature-store:unsupported-query","Unsupported query spatial relationship",{query:e});if(!c.isValid(s.spatialReference)||!c.isValid(r))return[2];if(!function(e){return!0===m[l.getJsonType(e)]}(s))throw new a("feature-store:unsupported-query","Unsupported query geometry type",{query:e});if(!function(e){return!0===_[e]}(t))throw new a("feature-store:unsupported-query","Unsupported layer geometry type",{query:e});return e.outSR?[2,p.checkProjectionSupport(e.geometry&&e.geometry.spatialReference,e.outSR)]:[2]}))}))},t.canQueryWithRBush=function(e){if(l.isExtent(e))return!0;if(l.isPolygon(e)){for(var t=0,r=e.rings;t<r.length;t++){var n=r[t];if(5!==n.length)return!1;if(n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1}return!0}return!1}}.apply(null,n))||(e.exports=i)},1112:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getTimeExtent=function(e,t){if(!e)return null;var r=t.featureAdapter,n=e.startTimeField,i=e.endTimeField,a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;if(n&&i)t.forEach((function(e){var t=r.getAttribute(e,n),o=r.getAttribute(e,i);null==t||isNaN(t)||(a=Math.min(a,t)),null==o||isNaN(o)||(s=Math.max(s,o))}));else{var o=n||i;t.forEach((function(e){var t=r.getAttribute(e,o);null==t||isNaN(t)||(a=Math.min(a,t),s=Math.max(s,t))}))}return{start:a,end:s}},t.getTimeOperator=function(e,t,r){if(!t||!e)return null;var n=e.startTimeField,i=e.endTimeField;if(!n&&!i)return null;var a=t.start,s=t.end;return null==a&&null==s?null:n&&i?function(e,t,r,n,i){if(null!=n&&null!=i&&n===i){var a=n;return function(n){return a>=e.getAttribute(n,t)&&a<=e.getAttribute(n,r)}}return null!=n&&null!=i?function(a){return s=n,o=i,u=e.getAttribute(a,t),l=e.getAttribute(a,r),!(u>o||l<s);var s,o,u,l}:null!=n?function(t){return!(e.getAttribute(t,r)<n)}:null!=i?function(r){return!(e.getAttribute(r,t)>i)}:void 0}(r,n,i,a,s):function(e,t,r,n){return null!=r&&null!=n&&r===n?function(n){return e.getAttribute(n,t)===r}:null!=r&&null!=n?function(i){return e.getAttribute(i,t)>=r&&e.getAttribute(i,t)<=n}:null!=r?function(n){return e.getAttribute(n,t)>=r}:null!=n?function(r){return e.getAttribute(r,t)<=n}:void 0}(r,n||i,a,s)}}.apply(null,n))||(e.exports=i)},1123:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(9),r(1),r(0),r(10),r(52),r(6),r(13),r(332),r(131),r(37),r(322),r(1179),r(1159),r(1144)],void 0===(i=function(e,t,r,n,i,a,s,o,u,l,c,h,d,f,p,v,y){Object.defineProperty(t,"__esModule",{value:!0});var g=u.getLogger("esri.layers.graphics.data.FeatureStore"),m=function(){function e(e){this.geometryInfo=e,this._boundsStore=new p.BoundsStore,this._featuresById=new Map,this._markedIds=new Set,this.events=new o,this.featureAdapter=y.optimizedFeatureQueryEngineAdapter}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this.geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this.geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this.geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){var e=this;if(!this.numFeatures)return null;var t=h.create(h.NEGATIVE_INFINITY);return this._featuresById.forEach((function(r){var n=e._boundsStore.get(r.objectId);n&&(t[0]=Math.min(n[0],t[0]),t[1]=Math.min(n[1],t[1]),t[2]=Math.max(n[2],t[2]),t[3]=Math.max(n[3],t[3]))})),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeStatistics",{get:function(){var e=0;return this._featuresById.forEach((function(t){t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._add(e),this._emitChanged()},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this._add(n)}this._emitChanged()},e.prototype.clear=function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()},e.prototype.removeById=function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null},e.prototype.removeManyById=function(e){this._boundsStore.invalidateIndex();for(var t=0,r=e;t<r.length;t++){var n=r[t],i=this._featuresById.get(n);i&&this._remove(i)}this._emitChanged()},e.prototype.forEachBounds=function(e,t,r){for(var n=0,i=e;n<i.length;n++){var a=i[n],s=this._boundsStore.get(a.objectId);s&&t(c.fromRect(r,s))}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach((function(t){return e(t)}))},e.prototype.forEachInBounds=function(e,t){var r=this;this._boundsStore.forEachInBounds(e,(function(e){t(r._featuresById.get(e))}))},e.prototype.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()},e.prototype.sweep=function(){var e=this,t=!1;this._featuresById.forEach((function(r,n){e._markedIds.has(n)||(t=!0,e._remove(r))})),this._markedIds.clear(),t&&this._emitChanged()},e.prototype.executeTileQuery=function(e,t,i){return n(this,void 0,void 0,(function(){var n,a,s,o,u,l,c,f,p,y,g,m,_,b;return r(this,(function(r){return n=i.returnGeometry,a=i.returnCentroid,s=i.returnOutline,o=i.pixelBuffer,u=new Set,l=[],c=o*e.resolution,f=h.pad(e.bounds,c,h.create()),v.createTileFeatures(l,u,this.geometryInfo,this,f,n,a,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}),("esriGeometryPoint"===this.geometryType||a)&&(p=d.getInfo(t))&&(y=p.valid,g=y[0],m=y[1],f[0]<g&&(_=h.fromValues(m-c,f[1],m,f[3]),v.createTileFeatures(l,u,this.geometryInfo,this,_,n,a,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[m,e.bounds[3]]})),f[2]>m&&(b=h.fromValues(g,f[1],g+c,f[3]),v.createTileFeatures(l,u,this.geometryInfo,this,b,n,a,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[g-m+e.bounds[0],e.bounds[3]]}))),l.sort((function(e,t){return e.localId-t.localId})),[2,{features:l,objectIds:u}]}))}))},e.prototype._emitChanged=function(){this.events.emit("changed",void 0)},e.prototype._add=function(e){if(e){var t=e.objectId;if(null!=t){var r,n=this._featuresById.get(t);if(this._markedIds.add(t),n?(e.localId=n.localId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):l.isSome(this.onFeatureAdd)&&this.onFeatureAdd(e),!e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=f.getBoundsOptimizedGeometry(r||h.create(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(t,r),this._featuresById.set(t,e)}else g.error(new s("featurestore:invalid-feature","feature id is missing",{feature:e}))}},e.prototype._remove=function(e){return l.isSome(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e},e}();t.default=m}.apply(null,n))||(e.exports=i)},1124:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(335)],void 0===(i=function(e,t,r){return function(){function e(e,t){this._storage=new r.MemCacheStorage,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}return e.prototype.put=function(e,t){this._storage.put(e,t,1,1)},e.prototype.pop=function(e){return this._storage.pop(e)},e.prototype.get=function(e){return this._storage.get(e)},e.prototype.clear=function(){this._storage.clearAll()},e.prototype.destroy=function(){this._storage.clearAll()},e}()}.apply(null,n))||(e.exports=i)},1141:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1124),r(1002)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this._cache=new r(e),this._invalidCache=new r(t)}return e.prototype.get=function(e,t){var r=t.uid+":"+e,i=this._cache.get(r);if(i)return i;if(void 0!==this._invalidCache.get(r))return null;try{var a=n.WhereClause.create(e,t);return this._cache.put(r,a),a}catch(e){return this._invalidCache.put(r,null),null}},e}();t.WhereClauseCache=i}.apply(null,n))||(e.exports=i)},1142:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!1,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}.apply(null,n))||(e.exports=i)},1143:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){return e?t?4:3:t?3:2}function n(e,t,n,a,s){if(!e)return!1;for(var o=r(t,n),u=e.coords,l=!1,c=0,h=0,d=e.lengths;h<d.length;h++){var f=d[h];l=i(l,u,o,c,f,a,s),c+=f*o}return l}function i(e,t,r,n,i,a,s){for(var o=e,u=n,l=n,c=n+i*r;l<c;l+=r){(u=l+r)===c&&(u=n);var h=t[l],d=t[l+1],f=t[u],p=t[u+1];(d<s&&p>=s||p<s&&d>=s)&&h+(s-d)/(p-d)*(f-h)<a&&(o=!o)}return o}Object.defineProperty(t,"__esModule",{value:!0}),t.polygonContainsPoint=function(e,t,r,i){return n(e,t,r,i.coords[0],i.coords[1])},t.polygonContainsMultipoint=function(e,t,i,a,s,o){var u=r(s,o),l=a.coords,c=a.lengths;if(!c)return!1;for(var h=0,d=0;h<c.length;h++,d+=u)if(!n(e,t,i,l[d],l[d+1]))return!1;return!0},t.polygonContainsCoords=n}.apply(null,n))||(e.exports=i)},1144:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1106),r(205),r(196)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.optimizedFeatureQueryEngineAdapter={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new n.default(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=r.getCentroidOptimizedGeometry(new i.default,e.geometry,t.hasZ,t.hasM)),e.centroid}},t.default=t.optimizedFeatureQueryEngineAdapter}.apply(null,n))||(e.exports=i)},1159:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(8),r(9),r(131),r(322),r(196),r(1094),r(1081)],void 0===(i=function(e,t,r,n,i,a,s,o,u,l){Object.defineProperty(t,"__esModule",{value:!0});var c=new o.default,h={esriGeometryPoint:s.convertToPoint,esriGeometryPolyline:s.convertToPolyline,esriGeometryPolygon:s.convertToPolygon,esriGeometryMultipoint:s.convertToMultipoint};t.executeTileQueryForIds=function(e,t,r){var n=r.pixelBuffer*t.resolution,i=a.pad(t.bounds,n,a.create()),s=[];return e.featureStore.forEachInBounds(i,(function(t){return s.push(e.featureAdapter.getObjectId(t))})),s},t.createTileFeatures=function(e,t,r,n,i,a,s,o,p){var v=h[r.geometryType],y=d[r.geometryType],g="esriGeometryPolygon"===r.geometryType&&!o,m=r.hasZ?r.hasM?4:3:r.hasM?3:2;s&&!a?n.forEachInBounds(i,(function(n){return function(e,t,r,n,i){if(!t.has(r.objectId)){var a=l.getCentroid(n,r,i),s=r.attributes;a&&(t.add(r.objectId),e.push(new u.Feature(s,r.localId,null,a)))}}(e,t,n,r,p)})):a&&!s?n.forEachInBounds(i,(function(r){return function(e,t,r,n,i,a,s,o){if(!t.has(r.objectId)){var l=r.attributes,h=n(f(c,r.geometry,i,a,o,s),!1,!1);h&&(t.add(r.objectId),e.push(new u.Feature(l,r.localId,h,null)))}}(e,t,r,v,m,y,p,g)})):n.forEachInBounds(i,(function(n){return function(e,t,r,n,i,a,s,o,h){if(!t.has(r.objectId)){var d=l.getCentroid(n,r,i),p=r.attributes,v=a(f(c,r.geometry,s,o,h,i),!1,!1);v&&d&&(t.add(r.objectId),e.push(new u.Feature(p,r.localId,v,d)))}}(e,t,n,r,p,v,m,y,g)}))};var d={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0};function f(e,t,r,n,i,a){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;var o,u,l,c,h=t.coords,d=t.lengths;if(!d.length)return e.coords[0]=s.quantizeX(a,h[0]),e.coords[1]=s.quantizeY(a,h[1]),e.coords.length=r,e;for(var f=0,p=0,v=p,y=0,g=d;y<g.length;y++){var m=g[y];if(!(m<n)){p=v,l=o=s.quantizeX(a,h[f]),c=u=s.quantizeY(a,h[f+1]),e.coords[p]=l,e.coords[p+1]=c,f+=r;var _=(l=s.quantizeX(a,h[f]))-o,b=(c=s.quantizeY(a,h[f+1]))-u,I=b/_;p+=2,e.coords[p]=_,e.coords[p+1]=b,o=l,u=c,f+=r;for(var x=2;x<m;x++){if(l=s.quantizeX(a,h[f]),c=s.quantizeY(a,h[f+1]),l!==o||c!==u){var S=l-o,T=c-u,w=T/S;I!==w&&(isFinite(I)||isFinite(w))||!(i||(b>=0&&T>=0||b<=0&&T<=0)&&(_>=0&&S>=0||_<=0&&S<=0))?(_=S,b=T,p+=2):(_+=S,b+=T),e.coords[p]=_,e.coords[p+1]=b,I=w,o=l,u=c}f+=r}var F=(p+2-v)/2;F>=n&&(e.lengths.push(F),v=p+2)}}return e.coords.length>v&&(e.coords.length=v),e.coords.length?e:null}t.quantizeOptimizedGeometryForDisplay=f}.apply(null,n))||(e.exports=i)},1179:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(15),r(1076),r(38)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i={minX:0,minY:0,maxX:0,maxY:0},a=function(){function e(){var e=this;this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=n(9,r("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(e._indexInvalid){var t=new Array(e._idByBounds.size),r=0;e._idByBounds.forEach((function(e,n){t[r++]=n})),e._indexInvalid=!1,e._index.clear(),e._index.load(t)}else e._boundsToLoad.length&&(e._index.load(e._boundsToLoad.filter((function(t){return e._idByBounds.has(t)}))),e._boundsToLoad.length=0)}}return e.prototype.clear=function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()},e.prototype.delete=function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))},e.prototype.forEachInBounds=function(e,t){this._loadIndex();for(var r=0,n=function(e,t){return i.minX=t[0],i.minY=t[1],i.maxX=t[2],i.maxY=t[3],e.search(i)}(this._index,e);r<n.length;r++){var a=n[r];t(this._idByBounds.get(a))}},e.prototype.get=function(e){return this._boundsById.get(e)},e.prototype.has=function(e){return this._boundsById.has(e)},e.prototype.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)},e.prototype.set=function(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))},e}();t.BoundsStore=a}.apply(null,n))||(e.exports=i)},1180:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.aggregateFunction=function(e,t){var n=r[e.toLowerCase()];if(null==n)throw new Error("Function Not Recognised");if(t.length<n.minParams||t.length>n.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return n.evaluate(t)},t.isAggregate=function(e,t){var n=r[e.toLowerCase()];return null!=n&&t>=n.minParams&&t<=n.maxParams};var r={min:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.min.apply(Math,e[0])}},max:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.max.apply(Math,e[0])}},avg:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:n(e[0])}},sum:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}(e[0])}},stddev:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sqrt(i(e[0]))}},count:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].length}},var:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:i(e[0])}}};function n(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function i(e){for(var t=n(e),r=e.length,i=0,a=0,s=e;a<s.length;a++){var o=s[a];i+=Math.pow(o-t,2)}return r>1?i/(r-1):0}}.apply(null,n))||(e.exports=i)},1181:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(46)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0}return e.fixDefaults=function(e){if(null!==e.precision||null!==e.secondary)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")},e.createFromMilliseconds=function(t){var r=new e;return r.second=t/1e3,r},e.createFromValueAndQualifer=function(t,r,n){var i=new e;if(i.op="-"===n?"-":"+","interval-period"===r.type){e.fixDefaults(r);var a=new RegExp("^[0-9]{1,}$");if("year"===r.period||"month"===r.period)throw new Error("Year-Month Intervals not supported");if(!a.test(t))throw new Error("Illegal Interval");i[r.period]=parseFloat(t)}else{if(e.fixDefaults(r.start),e.fixDefaults(r.end),"year"===r.start.period||"month"===r.start.period)throw new Error("Year-Month Intervals not supported");if("year"===r.end.period||"month"===r.end.period)throw new Error("Year-Month Intervals not supported");switch(r.start.period){case"day":switch(r.end.period){case"hour":if(!new RegExp("^[0-9]{1,} [0-9]{1,}$").test(t))throw new Error("Illegal Interval");i[r.start.period]=parseFloat(t.split(" ")[0]),i[r.end.period]=parseFloat(t.split(" ")[1]);break;case"minute":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$").test(t))throw new Error("Illegal Interval");i[r.start.period]=parseFloat(t.split(" ")[0]);var s=t.split(" ")[1].split(":");i.hour=parseFloat(s[0]),i.minute=parseFloat(s[1]);break;case"second":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");i[r.start.period]=parseFloat(t.split(" ")[0]),s=t.split(" ")[1].split(":"),i.hour=parseFloat(s[0]),i.minute=parseFloat(s[1]),i.second=parseFloat(s[2]);break;default:throw"Invalid Interval."}break;case"hour":switch(r.end.period){case"minute":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}$").test(t))throw new Error("Illegal Interval");i.hour=parseFloat(t.split(":")[0]),i.minute=parseFloat(t.split(":")[1]);break;case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");s=t.split(":"),i.hour=parseFloat(s[0]),i.minute=parseFloat(s[1]),i.second=parseFloat(s[2]);break;default:throw"Invalid Interval."}break;case"minute":switch(r.end.period){case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");s=t.split(":"),i.minute=parseFloat(s[0]),i.second=parseFloat(s[1]);break;default:throw"Invalid Interval."}break;default:throw"Invalid Interval."}}return i},e.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)},e}();t.SqlInterval=n,t.evaluateFunction=function(e,t){var r=i[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isStandardized=function(e,t){var r=i[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var i={extract:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];if(null==r)return null;if(r instanceof Date)switch(t.toUpperCase()){case"SECOND":return r.getSeconds();case"MINUTE":return r.getMinutes();case"HOUR":return r.getHours();case"DAY":return r.getDate();case"MONTH":return r.getMonth()+1;case"YEAR":return r.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(e){if(2===e.length){var t=e[0],r=e[1];return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){t=e[0],r=e[1];var n=e[2];return null==t||null==r||null==n?null:n<=0?"":t.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];return null==t||null==r?null:r.indexOf(t)+1}},trim:{minParams:2,maxParams:3,evaluate:function(e){var t=3===e.length,n=t?e[1]:" ",i=t?e[2]:e[1];if(null==n||null==i)return null;var a="("+r.escapeRegExpString(n)+")";switch(e[0]){case"BOTH":return i.replace(new RegExp("^"+a+"*|"+a+"*$","g"),"");case"LEADING":return i.replace(new RegExp("^"+a+"*","g"),"");case"TRAILING":return i.replace(new RegExp(a+"*$","g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.abs(e[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.ceil(e[0])}},floor:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.floor(e[0])}},log:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])}},log10:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sin(e[0])}},cos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.cos(e[0])}},tan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.tan(e[0])}},asin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.asin(e[0])}},acos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.acos(e[0])}},atan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.atan(e[0])}},sign:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0]>0?1:e[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])}},mod:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:e[0]%e[1]}},round:{minParams:1,maxParams:2,evaluate:function(e){var t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:function(e){return null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(e){return"string"==typeof e[0]||e[0]instanceof String?e[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(e){for(var t="",r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toUpperCase()}}}}.apply(null,n))||(e.exports=i)},1182:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1183)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.parse=function(e){return r.parse(e)},e}();t.WhereGrammar=n}.apply(null,n))||(e.exports=i)},1183:function(e,t,r){var n;void 0===(n=function(){"use strict";function e(t,r,n,i){this.message=t,this.expected=r,this.found=n,this.location=i,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}return"Expected "+function(e){var t,n,i,a=new Array(e.length);for(t=0;t<e.length;t++)a[t]=(i=e[t],r[i.type](i));if(a.sort(),a.length>0){for(t=1,n=1;t<a.length;t++)a[t-1]!==a[t]&&(a[n]=a[t],n++);a.length=n}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var n,i={},a={start:ze},s=ze,o=function(e,t){return Zt(e,t)},u=qe("!",!1),l=qe("=",!1),c=qe(">=",!1),h=qe(">",!1),d=qe("<=",!1),f=qe("<>",!1),p=qe("<",!1),v=qe("!=",!1),y=function(e){return e[0]+" "+e[2]},g=qe("+",!1),m=qe("-",!1),_=qe("*",!1),b=qe("/",!1),I=function(e,t){return e+t.join("")},x=/^[A-Za-z_\x80-\uFFFF]/,S=Be([["A","Z"],["a","z"],"_",["",""]],!1,!1),T=/^[A-Za-z0-9_]/,w=Be([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),F=/^[A-Za-z0-9_.\x80-\uFFFF]/,E=Be([["A","Z"],["a","z"],["0","9"],"_",".",["",""]],!1,!1),N=qe("@",!1),C=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},R=function(e,t){return{type:"interval-period",period:"second",precision:e,secondary:t}},M=function(e){return parseFloat(e)},A=qe("'",!1),P=qe("N'",!1),O=qe("''",!1),j=/^[^']/,G=Be(["'"],!0,!1),Q=function(e,t){return{type:"when_clause",operand:e,value:t}},L=qe(".",!1),q=/^[0-9]/,B=Be([["0","9"]],!1,!1),k=/^[eE]/,D=Be(["e","E"],!1,!1),V=/^[+\-]/,z=Be(["+","-"],!1,!1),Y=qe("NULL",!0),U=qe("TRUE",!0),J=qe("FALSE",!0),H=qe("IN",!0),Z=qe("IS",!0),W=qe("LIKE",!0),X=qe("ESCAPE",!0),$=qe("NOT",!0),K=qe("AND",!0),ee=qe("OR",!0),te=qe("BETWEEN",!0),re=qe("FROM",!0),ne=qe("FOR",!0),ie=qe("SUBSTRING",!0),ae=qe("EXTRACT",!0),se=qe("TRIM",!0),oe=qe("POSITION",!0),ue=qe("TIMESTAMP",!0),le=qe("DATE",!0),ce=qe("LEADING",!0),he=qe("TRAILING",!0),de=qe("BOTH",!0),fe=qe("TO",!0),pe=qe("INTERVAL",!0),ve=qe("YEAR",!0),ye=qe("MONTH",!0),ge=qe("DAY",!0),me=qe("HOUR",!0),_e=qe("MINUTE",!0),be=qe("SECOND",!0),Ie=qe("CASE",!0),xe=qe("END",!0),Se=qe("WHEN",!0),Te=qe("THEN",!0),we=qe("ELSE",!0),Fe=qe(",",!1),Ee=qe("(",!1),Ne=qe(")",!1),Ce=/^[ \t\n\r]/,Re=Be([" ","\t","\n","\r"],!1,!1),Me=qe("`",!1),Ae=/^[^`]/,Pe=Be(["`"],!0,!1),Oe=0,je=[{line:1,column:1}],Ge=0,Qe=[],Le=0;if("startRule"in r){if(!(r.startRule in a))throw new Error("Can't start parsing from rule \""+r.startRule+'".');s=a[r.startRule]}function qe(e,t){return{type:"literal",text:e,ignoreCase:t}}function Be(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function ke(e){var r,n=je[e];if(n)return n;for(r=e-1;!je[r];)r--;for(n={line:(n=je[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return je[e]=n,n}function De(e,t){var r=ke(e),n=ke(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function Ve(e){Oe<Ge||(Oe>Ge&&(Ge=Oe,Qe=[]),Qe.push(e))}function ze(){var e,t;return e=Oe,Ut()!==i&&(t=Ue())!==i&&Ut()!==i?e=t:(Oe=e,e=i),e}function Ye(){var e,t,r,n,a,s,o,u;if(e=Oe,(t=Ue())!==i){for(r=[],n=Oe,(a=Ut())!==i&&(s=Vt())!==i&&(o=Ut())!==i&&(u=Ue())!==i?n=a=[a,s,o,u]:(Oe=n,n=i);n!==i;)r.push(n),n=Oe,(a=Ut())!==i&&(s=Vt())!==i&&(o=Ut())!==i&&(u=Ue())!==i?n=a=[a,s,o,u]:(Oe=n,n=i);r!==i?e=t=function(e,t){var r={type:"expr_list"},n=function(e,t,r){return function(e,t){for(var r=[e],n=0;n<t.length;n++)r.push(t[n][3]);return r}(e,t)}(e,t);return r.value=n,r}(t,r):(Oe=e,e=i)}else Oe=e,e=i;return e}function Ue(){var e,t,r,n,a,s,u,l;if(e=Oe,(t=Je())!==i){for(r=[],n=Oe,(a=Ut())!==i&&(s=Nt())!==i&&(u=Ut())!==i&&(l=Je())!==i?n=a=[a,s,u,l]:(Oe=n,n=i);n!==i;)r.push(n),n=Oe,(a=Ut())!==i&&(s=Nt())!==i&&(u=Ut())!==i&&(l=Je())!==i?n=a=[a,s,u,l]:(Oe=n,n=i);r!==i?e=t=o(t,r):(Oe=e,e=i)}else Oe=e,e=i;return e}function Je(){var e,t,r,n,a,s,u,l;if(e=Oe,(t=He())!==i){for(r=[],n=Oe,(a=Ut())!==i&&(s=Et())!==i&&(u=Ut())!==i&&(l=He())!==i?n=a=[a,s,u,l]:(Oe=n,n=i);n!==i;)r.push(n),n=Oe,(a=Ut())!==i&&(s=Et())!==i&&(u=Ut())!==i&&(l=He())!==i?n=a=[a,s,u,l]:(Oe=n,n=i);r!==i?e=t=o(t,r):(Oe=e,e=i)}else Oe=e,e=i;return e}function He(){var e,r,n,a,s;return e=Oe,(r=Ft())===i&&(r=Oe,33===t.charCodeAt(Oe)?(n="!",Oe++):(n=i,0===Le&&Ve(u)),n!==i?(a=Oe,Le++,61===t.charCodeAt(Oe)?(s="=",Oe++):(s=i,0===Le&&Ve(l)),Le--,s===i?a=void 0:(Oe=a,a=i),a!==i?r=n=[n,a]:(Oe=r,r=i)):(Oe=r,r=i)),r!==i&&(n=Ut())!==i&&(a=He())!==i?e=r={type:"unary_expr",operator:"NOT",expr:a}:(Oe=e,e=i),e===i&&(e=function(){var e,r,n;return e=Oe,(r=$e())!==i&&Ut()!==i?((n=function(){var e;return(e=function(){var e,t,r,n,a,s;if(Oe,e=[],t=Oe,(r=Ut())!==i&&(n=Ze())!==i&&(a=Ut())!==i&&(s=$e())!==i?t=r=[r,n,a,s]:(Oe=t,t=i),t!==i)for(;t!==i;)e.push(t),t=Oe,(r=Ut())!==i&&(n=Ze())!==i&&(a=Ut())!==i&&(s=$e())!==i?t=r=[r,n,a,s]:(Oe=t,t=i);else e=i;return e!==i&&(e={type:"arithmetic",tail:e}),e}())===i&&(e=function(){var e,t,r,n;return e=Oe,(t=Xe())!==i&&Ut()!==i&&(r=zt())!==i&&Ut()!==i&&(n=Ye())!==i&&Ut()!==i&&Yt()!==i?e=t={op:t,right:n}:(Oe=e,e=i),e===i&&(e=Oe,(t=Xe())!==i&&Ut()!==i&&(r=zt())!==i&&Ut()!==i&&(n=Yt())!==i?e=t=function(e){return{op:e,right:{type:"expr_list",value:[]}}}(t):(Oe=e,e=i),e===i&&(e=Oe,(t=Xe())!==i&&Ut()!==i&&(r=ot())!==i?e=t=function(e,t){return{op:e,right:t}}(t,r):(Oe=e,e=i))),e}())===i&&(e=function(){var e,t,r,n,a,s;return e=Oe,(t=Ft())!==i&&Ut()!==i&&(r=Ct())!==i&&Ut()!==i&&(n=$e())!==i&&Ut()!==i&&(a=Et())!==i&&Ut()!==i&&(s=$e())!==i?e=t={op:"NOT"+r,right:{type:"expr_list",value:[n,s]}}:(Oe=e,e=i),e===i&&(e=Oe,(t=Ct())!==i&&Ut()!==i&&(r=$e())!==i&&Ut()!==i&&(n=Et())!==i&&Ut()!==i&&(a=$e())!==i?e=t=function(e,t,r){return{op:e,right:{type:"expr_list",value:[t,r]}}}(t,r,a):(Oe=e,e=i)),e}())===i&&(e=function(){var e,t,r,n;return e=Oe,(t=Tt())!==i&&Ut()!==i&&(r=Ft())!==i&&Ut()!==i&&(n=$e())!==i?e=t={op:t+"NOT",right:n}:(Oe=e,e=i),e===i&&(e=Oe,(t=Tt())!==i&&Ut()!==i&&(r=$e())!==i?e=t=function(e,t){return{op:e,right:t}}(t,r):(Oe=e,e=i)),e}())===i&&(e=function(){var e,r,n,a;return e=Oe,(r=We())!==i&&Ut()!==i&&(n=ft())!==i&&Ut()!==i&&function(){var e,r,n,a;return e=Oe,"escape"===t.substr(Oe,6).toLowerCase()?(r=t.substr(Oe,6),Oe+=6):(r=i,0===Le&&Ve(X)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="ESCAPE":(Oe=e,e=i)):(Oe=e,e=i),e}()!==i&&Ut()!==i&&(a=pt())!==i?e=r={op:r,right:n,escape:a.value}:(Oe=e,e=i),e===i&&(e=Oe,(r=We())!==i&&Ut()!==i&&(n=ft())!==i?e=r=function(e,t){return{op:e,right:t,escape:""}}(r,n):(Oe=e,e=i)),e}()),e}())===i&&(n=null),n!==i?e=r=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?Zt(e,t.tail):Ht(t.op,e,t.right,t.escape)}(r,n):(Oe=e,e=i)):(Oe=e,e=i),e}()),e}function Ze(){var e;return">="===t.substr(Oe,2)?(e=">=",Oe+=2):(e=i,0===Le&&Ve(c)),e===i&&(62===t.charCodeAt(Oe)?(e=">",Oe++):(e=i,0===Le&&Ve(h)),e===i&&("<="===t.substr(Oe,2)?(e="<=",Oe+=2):(e=i,0===Le&&Ve(d)),e===i&&("<>"===t.substr(Oe,2)?(e="<>",Oe+=2):(e=i,0===Le&&Ve(f)),e===i&&(60===t.charCodeAt(Oe)?(e="<",Oe++):(e=i,0===Le&&Ve(p)),e===i&&(61===t.charCodeAt(Oe)?(e="=",Oe++):(e=i,0===Le&&Ve(l)),e===i&&("!="===t.substr(Oe,2)?(e="!=",Oe+=2):(e=i,0===Le&&Ve(v)))))))),e}function We(){var e,t,r,n,a;return e=Oe,t=Oe,(r=Ft())!==i&&(n=Ut())!==i&&(a=wt())!==i?t=r=[r,n,a]:(Oe=t,t=i),t!==i&&(t=y(t)),(e=t)===i&&(e=wt()),e}function Xe(){var e,t,r,n,a;return e=Oe,t=Oe,(r=Ft())!==i&&(n=Ut())!==i&&(a=St())!==i?t=r=[r,n,a]:(Oe=t,t=i),t!==i&&(t=y(t)),(e=t)===i&&(e=St()),e}function $e(){var e,t,r,n,a,s,u,l;if(e=Oe,(t=et())!==i){for(r=[],n=Oe,(a=Ut())!==i&&(s=Ke())!==i&&(u=Ut())!==i&&(l=et())!==i?n=a=[a,s,u,l]:(Oe=n,n=i);n!==i;)r.push(n),n=Oe,(a=Ut())!==i&&(s=Ke())!==i&&(u=Ut())!==i&&(l=et())!==i?n=a=[a,s,u,l]:(Oe=n,n=i);r!==i?e=t=o(t,r):(Oe=e,e=i)}else Oe=e,e=i;return e}function Ke(){var e;return 43===t.charCodeAt(Oe)?(e="+",Oe++):(e=i,0===Le&&Ve(g)),e===i&&(45===t.charCodeAt(Oe)?(e="-",Oe++):(e=i,0===Le&&Ve(m))),e}function et(){var e,t,r,n,a,s,o,u;if(e=Oe,(t=rt())!==i){for(r=[],n=Oe,(a=Ut())!==i&&(s=tt())!==i&&(o=Ut())!==i&&(u=rt())!==i?n=a=[a,s,o,u]:(Oe=n,n=i);n!==i;)r.push(n),n=Oe,(a=Ut())!==i&&(s=tt())!==i&&(o=Ut())!==i&&(u=rt())!==i?n=a=[a,s,o,u]:(Oe=n,n=i);r!==i?e=t=Zt(t,r):(Oe=e,e=i)}else Oe=e,e=i;return e}function tt(){var e;return 42===t.charCodeAt(Oe)?(e="*",Oe++):(e=i,0===Le&&Ve(_)),e===i&&(47===t.charCodeAt(Oe)?(e="/",Oe++):(e=i,0===Le&&Ve(b))),e}function rt(){var e,r,n;return(e=function(){var e;return(e=pt())===i&&(e=function(){var e,t,r,n;return e=Oe,(t=function(){var e,t,r,n;return e=Oe,(t=mt())!==i&&(r=_t())!==i&&(n=bt())!==i?e=t=parseFloat(t+r+n):(Oe=e,e=i),e===i&&(e=Oe,(t=mt())!==i&&(r=_t())!==i?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Oe=e,e=i),e===i&&(e=Oe,(t=mt())!==i&&(r=bt())!==i?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Oe=e,e=i),e===i&&(e=Oe,(t=mt())!==i&&(t=function(e){return parseFloat(e)}(t)),e=t))),e}())!==i?(r=Oe,Le++,n=it(),Le--,n===i?r=void 0:(Oe=r,r=i),r!==i?e=t={type:"number",value:t}:(Oe=e,e=i)):(Oe=e,e=i),e}())===i&&(e=function(){var e,r;return e=Oe,(r=function(){var e,r,n,a;return e=Oe,"true"===t.substr(Oe,4).toLowerCase()?(r=t.substr(Oe,4),Oe+=4):(r=i,0===Le&&Ve(U)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r=[r,n]:(Oe=e,e=i)):(Oe=e,e=i),e}())!==i&&(r={type:"bool",value:!0}),(e=r)===i&&(e=Oe,(r=function(){var e,r,n,a;return e=Oe,"false"===t.substr(Oe,5).toLowerCase()?(r=t.substr(Oe,5),Oe+=5):(r=i,0===Le&&Ve(J)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r=[r,n]:(Oe=e,e=i)):(Oe=e,e=i),e}())!==i&&(r={type:"bool",value:!1}),e=r),e}())===i&&(e=function(){var e;return Oe,(e=function(){var e,r,n,a;return e=Oe,"null"===t.substr(Oe,4).toLowerCase()?(r=t.substr(Oe,4),Oe+=4):(r=i,0===Le&&Ve(Y)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r=[r,n]:(Oe=e,e=i)):(Oe=e,e=i),e}())!==i&&(e={type:"null",value:null}),e}())===i&&(e=function(){var e,r;return e=Oe,function(){var e,r,n,a;return e=Oe,"date"===t.substr(Oe,4).toLowerCase()?(r=t.substr(Oe,4),Oe+=4):(r=i,0===Le&&Ve(le)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="DATE":(Oe=e,e=i)):(Oe=e,e=i),e}()!==i&&Ut()!==i&&(r=ft())!==i?e={type:"date",value:r.value}:(Oe=e,e=i),e}())===i&&(e=function(){var e,r;return e=Oe,function(){var e,r,n,a;return e=Oe,"timestamp"===t.substr(Oe,9).toLowerCase()?(r=t.substr(Oe,9),Oe+=9):(r=i,0===Le&&Ve(ue)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="TIMESTAMP":(Oe=e,e=i)):(Oe=e,e=i),e}()!==i&&Ut()!==i&&(r=ft())!==i?e={type:"timestamp",value:r.value}:(Oe=e,e=i),e}())===i&&(e=function(){var e,r,n,a;return e=Oe,At()!==i&&Ut()!==i?(45===t.charCodeAt(Oe)?(r="-",Oe++):(r=i,0===Le&&Ve(m)),r===i&&(43===t.charCodeAt(Oe)?(r="+",Oe++):(r=i,0===Le&&Ve(g))),r!==i&&Ut()!==i&&(n=ft())!==i&&Ut()!==i&&(a=lt())!==i?e={type:"interval",value:n,qualifier:a,op:r}:(Oe=e,e=i)):(Oe=e,e=i),e===i&&(e=Oe,At()!==i&&Ut()!==i&&(r=ft())!==i&&Ut()!==i&&(n=lt())!==i?e=function(e,t){return{type:"interval",value:e,qualifier:t,op:""}}(r,n):(Oe=e,e=i)),e}()),e}())===i&&(e=function(){var e,r,n;return e=Oe,function(){var e,r,n,a;return e=Oe,"extract"===t.substr(Oe,7).toLowerCase()?(r=t.substr(Oe,7),Oe+=7):(r=i,0===Le&&Ve(ae)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="EXTRACT":(Oe=e,e=i)):(Oe=e,e=i),e}()!==i&&Ut()!==i&&zt()!==i&&Ut()!==i&&(r=function(){var e;return(e=Pt())===i&&(e=Ot())===i&&(e=jt())===i&&(e=Gt())===i&&(e=Qt())===i&&(e=Lt()),e}())!==i&&Ut()!==i&&Rt()!==i&&Ut()!==i&&(n=Ue())!==i&&Ut()!==i&&Yt()!==i?e={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:r},n]}}:(Oe=e,e=i),e}())===i&&(e=function(){var e,r,n,a,s,o,u,l,c,h,d;return e=Oe,function(){var e,r,n,a;return e=Oe,"substring"===t.substr(Oe,9).toLowerCase()?(r=t.substr(Oe,9),Oe+=9):(r=i,0===Le&&Ve(ie)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="SUBSTRING":(Oe=e,e=i)):(Oe=e,e=i),e}()!==i&&Ut()!==i&&zt()!==i&&Ut()!==i&&(r=Ue())!==i&&Ut()!==i&&Rt()!==i&&Ut()!==i&&(n=Ue())!==i&&Ut()!==i?(a=Oe,(s=function(){var e,r,n,a;return e=Oe,"for"===t.substr(Oe,3).toLowerCase()?(r=t.substr(Oe,3),Oe+=3):(r=i,0===Le&&Ve(ne)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="FOR":(Oe=e,e=i)):(Oe=e,e=i),e}())!==i&&(o=Ut())!==i&&(u=Ue())!==i&&(l=Ut())!==i?a=s=[s,o,u,l]:(Oe=a,a=i),a===i&&(a=null),a!==i&&(s=Yt())!==i?(c=r,h=n,e={type:"function",name:"substring",args:{type:"expr_list",value:(d=a)?[c,h,d[2]]:[c,h]}}):(Oe=e,e=i)):(Oe=e,e=i),e}())===i&&(e=function(){var e,t,r,n,a;return e=Oe,Mt()!==i&&Ut()!==i&&zt()!==i&&Ut()!==i?((t=ut())===i&&(t=null),t!==i&&Ut()!==i&&(r=Ue())!==i&&Ut()!==i&&Rt()!==i&&Ut()!==i&&(n=Ue())!==i&&Ut()!==i&&Yt()!==i?e={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==(a=t)?"BOTH":a},r,n]}}:(Oe=e,e=i)):(Oe=e,e=i),e===i&&(e=Oe,Mt()!==i&&Ut()!==i&&zt()!==i&&Ut()!==i?((t=ut())===i&&(t=null),t!==i&&Ut()!==i&&(r=Ue())!==i&&Ut()!==i&&Yt()!==i?e=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}}(t,r):(Oe=e,e=i)):(Oe=e,e=i)),e}())===i&&(e=function(){var e,r,n;return e=Oe,function(){var e,r,n,a;return e=Oe,"position"===t.substr(Oe,8).toLowerCase()?(r=t.substr(Oe,8),Oe+=8):(r=i,0===Le&&Ve(oe)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="POSITION":(Oe=e,e=i)):(Oe=e,e=i),e}()!==i&&Ut()!==i&&zt()!==i&&Ut()!==i&&(r=Ue())!==i&&Ut()!==i&&St()!==i&&Ut()!==i&&(n=Ue())!==i&&Ut()!==i&&Yt()!==i?e={type:"function",name:"position",args:{type:"expr_list",value:[r,n]}}:(Oe=e,e=i),e}())===i&&(e=function(){var e,r,n;return e=Oe,(r=function(){var e,r,n,a;if(e=Oe,(r=nt())!==i&&(r=r),(e=r)===i)if(e=Oe,96===t.charCodeAt(Oe)?(r="`",Oe++):(r=i,0===Le&&Ve(Me)),r!==i){if(n=[],Ae.test(t.charAt(Oe))?(a=t.charAt(Oe),Oe++):(a=i,0===Le&&Ve(Pe)),a!==i)for(;a!==i;)n.push(a),Ae.test(t.charAt(Oe))?(a=t.charAt(Oe),Oe++):(a=i,0===Le&&Ve(Pe));else n=i;n!==i?(96===t.charCodeAt(Oe)?(a="`",Oe++):(a=i,0===Le&&Ve(Me)),a!==i?e=r=n.join(""):(Oe=e,e=i)):(Oe=e,e=i)}else Oe=e,e=i;return e}())!==i&&Ut()!==i&&zt()!==i&&Ut()!==i?((n=Ye())===i&&(n=null),n!==i&&Ut()!==i&&Yt()!==i?e=r={type:"function",name:r,args:n||{type:"expr_list",value:[]}}:(Oe=e,e=i)):(Oe=e,e=i),e}())===i&&(e=function(){var e;return(e=function(){var e,t,r,n,a;if(e=Oe,qt()!==i)if(Ut()!==i)if((t=Ue())!==i)if(Ut()!==i){for(r=[],n=yt();n!==i;)r.push(n),n=yt();r!==i&&(n=Ut())!==i&&(a=Bt())!==i?e={type:"case_expression",format:"simple",operand:t,clauses:r,else:null}:(Oe=e,e=i)}else Oe=e,e=i;else Oe=e,e=i;else Oe=e,e=i;else Oe=e,e=i;if(e===i)if(e=Oe,qt()!==i)if(Ut()!==i)if((t=Ue())!==i)if(Ut()!==i){for(r=[],n=yt();n!==i;)r.push(n),n=yt();r!==i&&(n=Ut())!==i&&(a=gt())!==i&&Ut()!==i&&Bt()!==i?e=function(e,t,r){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:r.value}}(t,r,a):(Oe=e,e=i)}else Oe=e,e=i;else Oe=e,e=i;else Oe=e,e=i;else Oe=e,e=i;return e}())===i&&(e=function(){var e,t,r,n;if(e=Oe,qt()!==i)if(Ut()!==i){for(t=[],r=vt();r!==i;)t.push(r),r=vt();t!==i&&(r=Ut())!==i&&(n=Bt())!==i?e={type:"case_expression",format:"searched",clauses:t,else:null}:(Oe=e,e=i)}else Oe=e,e=i;else Oe=e,e=i;if(e===i)if(e=Oe,qt()!==i)if(Ut()!==i){for(t=[],r=vt();r!==i;)t.push(r),r=vt();t!==i&&(r=Ut())!==i&&(n=gt())!==i&&Ut()!==i&&Bt()!==i?e=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}}(t,n):(Oe=e,e=i)}else Oe=e,e=i;else Oe=e,e=i;return e}()),e}())===i&&(e=function(){var e,t;return Oe,(e=function(){var e;return Oe,(e=function(){var e,t,r,n;if(e=Oe,(t=it())!==i){for(r=[],n=st();n!==i;)r.push(n),n=st();r!==i?e=t=I(t,r):(Oe=e,e=i)}else Oe=e,e=i;return e}())!==i&&(e=e),e}())!==i&&(e=/^CURRENT_DATE$/i.test(t=e)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(t)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:t}),e}())===i&&(e=ot())===i&&(e=Oe,zt()!==i&&Ut()!==i&&(r=Ue())!==i&&Ut()!==i&&Yt()!==i?((n=r).paren=!0,e=n):(Oe=e,e=i)),e}function nt(){var e,t,r,n;if(e=Oe,(t=it())!==i){for(r=[],n=at();n!==i;)r.push(n),n=at();r!==i?e=t=I(t,r):(Oe=e,e=i)}else Oe=e,e=i;return e}function it(){var e;return x.test(t.charAt(Oe))?(e=t.charAt(Oe),Oe++):(e=i,0===Le&&Ve(S)),e}function at(){var e;return T.test(t.charAt(Oe))?(e=t.charAt(Oe),Oe++):(e=i,0===Le&&Ve(w)),e}function st(){var e;return F.test(t.charAt(Oe))?(e=t.charAt(Oe),Oe++):(e=i,0===Le&&Ve(E)),e}function ot(){var e,r,n;return Oe,e=Oe,64===t.charCodeAt(Oe)?(r="@",Oe++):(r=i,0===Le&&Ve(N)),r!==i&&(n=nt())!==i?e=r=[r,n]:(Oe=e,e=i),e!==i&&(e={type:"param",value:e[1]}),e}function ut(){var e;return(e=function(){var e,r,n,a;return e=Oe,"leading"===t.substr(Oe,7).toLowerCase()?(r=t.substr(Oe,7),Oe+=7):(r=i,0===Le&&Ve(ce)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="LEADING":(Oe=e,e=i)):(Oe=e,e=i),e}())===i&&(e=function(){var e,r,n,a;return e=Oe,"trailing"===t.substr(Oe,8).toLowerCase()?(r=t.substr(Oe,8),Oe+=8):(r=i,0===Le&&Ve(he)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="TRAILING":(Oe=e,e=i)):(Oe=e,e=i),e}())===i&&(e=function(){var e,r,n,a;return e=Oe,"both"===t.substr(Oe,4).toLowerCase()?(r=t.substr(Oe,4),Oe+=4):(r=i,0===Le&&Ve(de)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="BOTH":(Oe=e,e=i)):(Oe=e,e=i),e}()),e}function lt(){var e,r,n;return e=Oe,(r=function(){var e,t,r,n;return e=Oe,(t=ct())!==i&&Ut()!==i&&zt()!==i&&Ut()!==i&&(r=dt())!==i&&Ut()!==i&&Yt()!==i?(n=r,e=t={type:"interval-period",period:t.value,precision:n,secondary:null}):(Oe=e,e=i),e===i&&(e=Oe,(t=ct())!==i&&(t=C(t)),e=t),e}())!==i&&Ut()!==i&&function(){var e,r,n,a;return e=Oe,"to"===t.substr(Oe,2).toLowerCase()?(r=t.substr(Oe,2),Oe+=2):(r=i,0===Le&&Ve(fe)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="TO":(Oe=e,e=i)):(Oe=e,e=i),e}()!==i&&Ut()!==i&&(n=function(){var e,t,r,n;return e=Oe,(t=ct())!==i&&(t={type:"interval-period",period:t.value,precision:null,secondary:null}),(e=t)===i&&(e=Oe,(t=Lt())!==i&&Ut()!==i&&zt()!==i&&Ut()!==i&&(r=dt())!==i&&Ut()!==i&&Vt()!==i&&Ut()!==i&&(n=ht())!==i&&Ut()!==i&&Yt()!==i?e=t=R(r,n):(Oe=e,e=i),e===i&&(e=Oe,(t=Lt())!==i&&Ut()!==i&&zt()!==i&&Ut()!==i&&(r=dt())!==i&&Ut()!==i&&Yt()!==i?e=t={type:"interval-period",period:"second",precision:r,secondary:null}:(Oe=e,e=i),e===i&&(e=Oe,(t=Lt())!==i&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t))),e}())!==i?e=r={type:"interval-qualifier",start:r,end:n}:(Oe=e,e=i),e===i&&(e=function(){var e,t,r,n,a;return e=Oe,(t=ct())!==i&&Ut()!==i&&zt()!==i&&Ut()!==i&&(r=ht())!==i&&Ut()!==i&&Yt()!==i?(a=r,e=t={type:"interval-period",period:t.value,precision:a,secondary:null}):(Oe=e,e=i),e===i&&(e=Oe,(t=ct())!==i&&(t=C(t)),(e=t)===i&&(e=Oe,(t=Lt())!==i&&Ut()!==i&&zt()!==i&&Ut()!==i&&(r=dt())!==i&&Ut()!==i&&Vt()!==i&&Ut()!==i&&(n=ht())!==i&&Ut()!==i&&Yt()!==i?e=t=R(r,n):(Oe=e,e=i),e===i&&(e=Oe,(t=Lt())!==i&&Ut()!==i&&zt()!==i&&Ut()!==i&&(r=ht())!==i&&Ut()!==i&&Yt()!==i?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(r):(Oe=e,e=i),e===i&&(e=Oe,(t=Lt())!==i&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t)))),e}()),e}function ct(){var e,t;return e=Oe,(t=jt())!==i&&(t={type:"string",value:"day"}),(e=t)===i&&(e=Oe,(t=Gt())!==i&&(t={type:"string",value:"hour"}),(e=t)===i&&(e=Oe,(t=Qt())!==i&&(t={type:"string",value:"minute"}),(e=t)===i&&(e=Oe,(t=Ot())!==i&&(t={type:"string",value:"month"}),(e=t)===i&&(e=Oe,(t=Pt())!==i&&(t={type:"string",value:"year"}),e=t)))),e}function ht(){var e;return Oe,(e=It())!==i&&(e=M(e)),e}function dt(){var e;return Oe,(e=It())!==i&&(e=M(e)),e}function ft(){var e;return(e=pt())===i&&(e=ot()),e}function pt(){var e,r,n,a,s;if(e=Oe,39===t.charCodeAt(Oe)?(r="'",Oe++):(r=i,0===Le&&Ve(A)),r===i&&("N'"===t.substr(Oe,2)?(r="N'",Oe+=2):(r=i,0===Le&&Ve(P))),r!==i){for(n=[],a=Oe,"''"===t.substr(Oe,2)?(s="''",Oe+=2):(s=i,0===Le&&Ve(O)),s!==i&&(s="'"),(a=s)===i&&(j.test(t.charAt(Oe))?(a=t.charAt(Oe),Oe++):(a=i,0===Le&&Ve(G)));a!==i;)n.push(a),a=Oe,"''"===t.substr(Oe,2)?(s="''",Oe+=2):(s=i,0===Le&&Ve(O)),s!==i&&(s="'"),(a=s)===i&&(j.test(t.charAt(Oe))?(a=t.charAt(Oe),Oe++):(a=i,0===Le&&Ve(G)));n!==i?(39===t.charCodeAt(Oe)?(a="'",Oe++):(a=i,0===Le&&Ve(A)),a!==i?e=r={type:"string",value:n.join("")}:(Oe=e,e=i)):(Oe=e,e=i)}else Oe=e,e=i;return e}function vt(){var e,t,r;return e=Oe,kt()!==i&&Ut()!==i&&(t=Ue())!==i&&Ut()!==i&&Dt()!==i&&Ut()!==i&&(r=Ue())!==i?e=Q(t,r):(Oe=e,e=i),e}function yt(){var e,t,r;return e=Oe,kt()!==i&&Ut()!==i&&(t=Ue())!==i&&Ut()!==i&&Dt()!==i&&Ut()!==i&&(r=Ue())!==i?e=Q(t,r):(Oe=e,e=i),e}function gt(){var e,r;return e=Oe,function(){var e,r,n,a;return e=Oe,"else"===t.substr(Oe,4).toLowerCase()?(r=t.substr(Oe,4),Oe+=4):(r=i,0===Le&&Ve(we)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="ELSE":(Oe=e,e=i)):(Oe=e,e=i),e}()!==i&&Ut()!==i&&(r=Ue())!==i?e={type:"else_clause",value:r}:(Oe=e,e=i),e}function mt(){var e,r,n,a;return(e=It())===i&&(e=Oe,45===t.charCodeAt(Oe)?(r="-",Oe++):(r=i,0===Le&&Ve(m)),r===i&&(43===t.charCodeAt(Oe)?(r="+",Oe++):(r=i,0===Le&&Ve(g))),r!==i&&(n=It())!==i?(a=n,e=r=r[0]+a):(Oe=e,e=i)),e}function _t(){var e,r,n,a;return e=Oe,46===t.charCodeAt(Oe)?(r=".",Oe++):(r=i,0===Le&&Ve(L)),r!==i?((n=It())===i&&(n=null),n!==i?e=r="."+(null!=(a=n)?a:""):(Oe=e,e=i)):(Oe=e,e=i),e}function bt(){var e,r,n;return e=Oe,(r=function(){var e,r,n,a;return e=Oe,k.test(t.charAt(Oe))?(r=t.charAt(Oe),Oe++):(r=i,0===Le&&Ve(D)),r!==i?(V.test(t.charAt(Oe))?(n=t.charAt(Oe),Oe++):(n=i,0===Le&&Ve(z)),n===i&&(n=null),n!==i?e=r="e"+(null===(a=n)?"":a):(Oe=e,e=i)):(Oe=e,e=i),e}())!==i&&(n=It())!==i?e=r+=n:(Oe=e,e=i),e}function It(){var e,t;if(Oe,e=[],(t=xt())!==i)for(;t!==i;)e.push(t),t=xt();else e=i;return e!==i&&(e=e.join("")),e}function xt(){var e;return q.test(t.charAt(Oe))?(e=t.charAt(Oe),Oe++):(e=i,0===Le&&Ve(B)),e}function St(){var e,r,n,a;return e=Oe,"in"===t.substr(Oe,2).toLowerCase()?(r=t.substr(Oe,2),Oe+=2):(r=i,0===Le&&Ve(H)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="IN":(Oe=e,e=i)):(Oe=e,e=i),e}function Tt(){var e,r,n,a;return e=Oe,"is"===t.substr(Oe,2).toLowerCase()?(r=t.substr(Oe,2),Oe+=2):(r=i,0===Le&&Ve(Z)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="IS":(Oe=e,e=i)):(Oe=e,e=i),e}function wt(){var e,r,n,a;return e=Oe,"like"===t.substr(Oe,4).toLowerCase()?(r=t.substr(Oe,4),Oe+=4):(r=i,0===Le&&Ve(W)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="LIKE":(Oe=e,e=i)):(Oe=e,e=i),e}function Ft(){var e,r,n,a;return e=Oe,"not"===t.substr(Oe,3).toLowerCase()?(r=t.substr(Oe,3),Oe+=3):(r=i,0===Le&&Ve($)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="NOT":(Oe=e,e=i)):(Oe=e,e=i),e}function Et(){var e,r,n,a;return e=Oe,"and"===t.substr(Oe,3).toLowerCase()?(r=t.substr(Oe,3),Oe+=3):(r=i,0===Le&&Ve(K)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="AND":(Oe=e,e=i)):(Oe=e,e=i),e}function Nt(){var e,r,n,a;return e=Oe,"or"===t.substr(Oe,2).toLowerCase()?(r=t.substr(Oe,2),Oe+=2):(r=i,0===Le&&Ve(ee)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="OR":(Oe=e,e=i)):(Oe=e,e=i),e}function Ct(){var e,r,n,a;return e=Oe,"between"===t.substr(Oe,7).toLowerCase()?(r=t.substr(Oe,7),Oe+=7):(r=i,0===Le&&Ve(te)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="BETWEEN":(Oe=e,e=i)):(Oe=e,e=i),e}function Rt(){var e,r,n,a;return e=Oe,"from"===t.substr(Oe,4).toLowerCase()?(r=t.substr(Oe,4),Oe+=4):(r=i,0===Le&&Ve(re)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="FROM":(Oe=e,e=i)):(Oe=e,e=i),e}function Mt(){var e,r,n,a;return e=Oe,"trim"===t.substr(Oe,4).toLowerCase()?(r=t.substr(Oe,4),Oe+=4):(r=i,0===Le&&Ve(se)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="TRIM":(Oe=e,e=i)):(Oe=e,e=i),e}function At(){var e,r,n,a;return e=Oe,"interval"===t.substr(Oe,8).toLowerCase()?(r=t.substr(Oe,8),Oe+=8):(r=i,0===Le&&Ve(pe)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="INTERVAL":(Oe=e,e=i)):(Oe=e,e=i),e}function Pt(){var e,r,n,a;return e=Oe,"year"===t.substr(Oe,4).toLowerCase()?(r=t.substr(Oe,4),Oe+=4):(r=i,0===Le&&Ve(ve)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="YEAR":(Oe=e,e=i)):(Oe=e,e=i),e}function Ot(){var e,r,n,a;return e=Oe,"month"===t.substr(Oe,5).toLowerCase()?(r=t.substr(Oe,5),Oe+=5):(r=i,0===Le&&Ve(ye)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="MONTH":(Oe=e,e=i)):(Oe=e,e=i),e}function jt(){var e,r,n,a;return e=Oe,"day"===t.substr(Oe,3).toLowerCase()?(r=t.substr(Oe,3),Oe+=3):(r=i,0===Le&&Ve(ge)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="DAY":(Oe=e,e=i)):(Oe=e,e=i),e}function Gt(){var e,r,n,a;return e=Oe,"hour"===t.substr(Oe,4).toLowerCase()?(r=t.substr(Oe,4),Oe+=4):(r=i,0===Le&&Ve(me)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="HOUR":(Oe=e,e=i)):(Oe=e,e=i),e}function Qt(){var e,r,n,a;return e=Oe,"minute"===t.substr(Oe,6).toLowerCase()?(r=t.substr(Oe,6),Oe+=6):(r=i,0===Le&&Ve(_e)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="MINUTE":(Oe=e,e=i)):(Oe=e,e=i),e}function Lt(){var e,r,n,a;return e=Oe,"second"===t.substr(Oe,6).toLowerCase()?(r=t.substr(Oe,6),Oe+=6):(r=i,0===Le&&Ve(be)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="SECOND":(Oe=e,e=i)):(Oe=e,e=i),e}function qt(){var e,r,n,a;return e=Oe,"case"===t.substr(Oe,4).toLowerCase()?(r=t.substr(Oe,4),Oe+=4):(r=i,0===Le&&Ve(Ie)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="CASE":(Oe=e,e=i)):(Oe=e,e=i),e}function Bt(){var e,r,n,a;return e=Oe,"end"===t.substr(Oe,3).toLowerCase()?(r=t.substr(Oe,3),Oe+=3):(r=i,0===Le&&Ve(xe)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="END":(Oe=e,e=i)):(Oe=e,e=i),e}function kt(){var e,r,n,a;return e=Oe,"when"===t.substr(Oe,4).toLowerCase()?(r=t.substr(Oe,4),Oe+=4):(r=i,0===Le&&Ve(Se)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="WHEN":(Oe=e,e=i)):(Oe=e,e=i),e}function Dt(){var e,r,n,a;return e=Oe,"then"===t.substr(Oe,4).toLowerCase()?(r=t.substr(Oe,4),Oe+=4):(r=i,0===Le&&Ve(Te)),r!==i?(n=Oe,Le++,a=at(),Le--,a===i?n=void 0:(Oe=n,n=i),n!==i?e=r="THEN":(Oe=e,e=i)):(Oe=e,e=i),e}function Vt(){var e;return 44===t.charCodeAt(Oe)?(e=",",Oe++):(e=i,0===Le&&Ve(Fe)),e}function zt(){var e;return 40===t.charCodeAt(Oe)?(e="(",Oe++):(e=i,0===Le&&Ve(Ee)),e}function Yt(){var e;return 41===t.charCodeAt(Oe)?(e=")",Oe++):(e=i,0===Le&&Ve(Ne)),e}function Ut(){var e,t;for(e=[],t=Jt();t!==i;)e.push(t),t=Jt();return e}function Jt(){var e;return Ce.test(t.charAt(Oe))?(e=t.charAt(Oe),Oe++):(e=i,0===Le&&Ve(Re)),e}function Ht(e,t,r,n){var i={type:"binary_expr",operator:e,left:t,right:r};return void 0!==n&&(i.escape=n),i}function Zt(e,t){for(var r=e,n=0;n<t.length;n++)r=Ht(t[n][1],r,t[n][3]);return r}if((n=s())!==i&&Oe===t.length)return n;throw n!==i&&Oe<t.length&&Ve({type:"end"}),function(t,r,n){return new e(e.buildMessage(t,r),t,r,n)}(Qe,Ge<t.length?t.charAt(Ge):null,Ge<t.length?De(Ge,Ge+1):De(Ge,Ge))}}}.apply(null,[]))||(e.exports=n)},1184:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(8),r(9),r(99),r(13),r(4),r(65),r(137),r(37),r(322),r(1185),r(1087),r(1070),r(1112),r(1081)],void 0===(i=function(e,t,r,n,i,a,s,o,u,l,c,h,d,f,p,v,y){Object.defineProperty(t,"__esModule",{value:!0});var g=function(){function e(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter}return Object.defineProperty(e.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),e.prototype.createQueryResponse=function(e){var t;return t=e.outStatistics?e.outStatistics.some((function(e){return"exceedslimit"===e.statisticType}))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(c.isValid(e.outSR)&&!c.equals(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=y.cleanFromGeometryEngine(r({spatialReference:e.outSR},p.project(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=y.cleanFromGeometryEngine(r({spatialReference:e.outSR},this.queryGeometry))),t},e.prototype.executeAttributesQuery=function(t){var r=f.getWhereClause(t.where,this.fieldsIndex);if(!r)return o.resolve(this);if(r.isStandardized){for(var n=0,i=[],a=0,s=this.items;a<s.length;a++){var u=s[a];r.testFeature(u,this.featureAdapter)&&(i[n++]=u)}var l=new e(i,this.queryGeometry,this);return l.definitionExpression=t.where,o.resolve(l)}return o.reject(new TypeError("Where clause is not standardized"))},e.prototype.executeObjectIdsQuery=function(t){if(!t.objectIds||!t.objectIds.length)return o.resolve(this);var r=u.createSetFromValues(t.objectIds),n=this.featureAdapter.getObjectId;return o.resolve(new e(this.items.filter((function(e){return r.has(n(e))})),this.queryGeometry,this))},e.prototype.executeTimeQuery=function(t){var r=v.getTimeOperator(this.timeInfo,t.timeExtent,this.featureAdapter);if(!s.isSome(r))return o.resolve(this);var n=this.items.filter(r);return o.resolve(new e(n,this.queryGeometry,this))},e.prototype.filterLatest=function(){for(var t=this.timeInfo,r=t.trackIdField,n=t.startTimeField,i=t.endTimeField||n,s=new Map,u=this.featureAdapter.getAttribute,l=0,c=this.items;l<c.length;l++){var h=c[l],d=u(h,r),f=u(h,i),p=s.get(d);(!p||f>u(p,i))&&s.set(d,h)}var v=a.valuesOfMap(s);return o.resolve(new e(v,this.queryGeometry,this))},e.prototype.project=function(t){return i(this,void 0,void 0,(function(){var r,i=this;return n(this,(function(n){switch(n.label){case 0:return!t||c.equals(this.spatialReference,t)?[2,this]:(r=this.featureAdapter,[4,p.projectMany(this.items.map((function(e){return y.getGeometry(i,r.getGeometry(e))})),this.spatialReference,t)]);case 1:return[2,new e(n.sent().map((function(e,t){return r.cloneWithGeometry(i.items[t],h.convertFromGeometry(e,i.hasZ,i.hasM))})),this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:t,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}}))}))},e.prototype._createFeatureQueryResponse=function(e){var t=this,r=this.items,n=this,i=n.geometryType,a=n.hasM,s=n.hasZ,o=n.objectIdField,u=n.spatialReference,c=e.outFields,h=e.outSR,d=e.quantizationParameters,f=e.resultRecordCount,p=e.resultOffset,v=e.returnZ,g=e.returnM,m=!1;if(null!=f&&null!=p){var _=p+f;m=r.length>_,r=r.slice(p,Math.min(r.length,_))}var b=c&&(c.indexOf("*")>-1?this.fieldsIndex.fields.slice():c.map((function(e){return t.fieldsIndex.get(e)})));return{exceededTransferLimit:m,features:this._createFeatures(e,r),fields:b,geometryType:i,hasM:a&&g,hasZ:s&&v,objectIdFieldName:o,spatialReference:y.cleanFromGeometryEngine(h||u),transform:d&&l.toQuantizationTransform(d)||null}},e.prototype._createFeatures=function(e,t){var r=new d.default(e,this.featureAdapter,this.fieldsIndex),n=this.hasM,i=this.hasZ,a=e.orderByFields,s=e.quantizationParameters,o=e.returnGeometry,u=e.returnCentroid,c=e.maxAllowableOffset,h=e.returnZ,f=void 0!==h&&h,p=e.returnM,v=i&&f,g=n&&void 0!==p&&p,m=[],_=0;if(t.length&&a&&a.length){var b=a[0].split(" "),I=b[0],x=this.fieldsIndex.get(I),S=b[1]&&"desc"===b[1].toLowerCase();t.sort((function(e,t){var n=r.getFieldValue(e,I,x),i=r.getFieldValue(t,I,x);if("number"==typeof n&&"number"==typeof i)return S?i-n:n-i;if("string"==typeof n&&"string"==typeof i){var a=n.toUpperCase(),s=i.toUpperCase();return(S?a>s:a<s)?-1:(S?a<s:a>s)?1:0}}))}if(o||u){var T=l.toQuantizationTransform(s);if(o&&!u)for(var w=0,F=t;w<F.length;w++)P=F[w],m[_++]={attributes:r.getAttributes(P),geometry:y.getGeometry(this,this.featureAdapter.getGeometry(P),c,T,v,g)};else if(!o&&u)for(var E=0,N=t;E<N.length;E++)P=N[E],m[_++]={attributes:r.getAttributes(P),centroid:y.transformCentroid(this,this.featureAdapter.getCentroid(P,this),T)};else for(var C=0,R=t;C<R.length;C++)P=R[C],m[_++]={attributes:r.getAttributes(P),centroid:y.transformCentroid(this,this.featureAdapter.getCentroid(P,this),T),geometry:y.getGeometry(this,this.featureAdapter.getGeometry(P),c,T,v,g)}}else for(var M=0,A=t;M<A.length;M++){var P=A[M],O=r.getAttributes(P);O&&(m[_++]={attributes:O})}return m},e.prototype._createExceedsLimitQueryResponse=function(e){for(var t=!1,r=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=0,s=e.outStatistics;a<s.length;a++){var o=s[a];if("exceedslimit"===o.statisticType){r=null!=o.maxPointCount?o.maxPointCount:Number.POSITIVE_INFINITY,n=null!=o.maxRecordCount?o.maxRecordCount:Number.POSITIVE_INFINITY,i=null!=o.maxVertexCount?o.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>n)t=!0;else{var u=this.hasZ?this.hasM?4:3:this.hasM?3:2,l=this.featureAdapter;t=this.items.reduce((function(e,t){var r=l.getGeometry(t);return e+(r&&r.coords.length||0)}),0)/u>i}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}},e.prototype._createStatisticsQueryResponse=function(e){for(var t=new d.default(e,this.featureAdapter,this.fieldsIndex),r=e.outStatistics,n=[],i=[],a=e.groupByFieldsForStatistics,s=e.having,o=a&&a.length,u=o&&a[0],l=this.fieldsIndex.get(u),c=!l,h={},f={},p={},v={attributes:{}},y=0,g=r;y<g.length;y++){var m=g[y],_=m.outStatisticFieldName,b=m.statisticType,I="exceedslimit"!==b?m.onStatisticField:void 0,x=this.fieldsIndex.get(I),S=o&&(I===u||c)&&"count"===b;if(o){h[I]||(h[I]=this._calculateUniqueValues(t,u,l));var T=h[I];for(var w in T){var F=T[w],E=F.count,N=F.data,C=F.items;if(!s||t.validateItems(C,s)){var R=f[N]||{attributes:{}},M=null;M=S?E:(A=this._calculateStatistics(C,t,I,x))[P="var"===b?"variance":b],R.attributes[_]=M,R.attributes[c?"EXPR_1":u]=N,f[N]=R}}}else{p[I]||(p[I]=this._calculateStatistics(this.items,t,I,x));var A=p[I],P="var"===b?"variance":b;v.attributes[_]=A[P]}i.push({name:_,alias:_,type:"esriFieldTypeDouble"})}if(o)for(var O in f)n.push(f[O]);else n.push(v);return{fields:i,features:n}},e.prototype._calculateStatistics=function(e,t,r,n){for(var i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,s=null,o=null,u=null,l=null,c=[],h=0,d=0;d<e.length;d++){var f=e[d];"string"==typeof(g=t.getFieldValue(f,r,n))?h++:null==g||isNaN(g)||(s+=g,i=Math.min(i,g),a=Math.max(a,g),c.push(g),h++)}if(h){o=s/h;for(var p=0,v=0,y=c;v<y.length;v++){var g=y[v];p+=Math.pow(g-o,2)}l=h>1?p/(h-1):0,u=Math.sqrt(l)}else i=null,a=null;return{avg:o,count:h,max:a,min:i,stddev:u,sum:s,variance:l}},e.prototype._calculateUniqueValues=function(e,t,r){for(var n={},i=0,a=this.items;i<a.length;i++){var s=a[i],o=e.getFieldValue(s,t,r);(null==o||"string"==typeof o&&""===o.trim())&&(o=null),null==n[o]?n[o]={count:1,data:o,items:[s]}:(n[o].count++,n[o].items.push(s))}return n},e}();t.default=g}.apply(null,n))||(e.exports=i)},1185:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(13),r(1087)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;var i=e.outFields;if(i&&-1===i.indexOf("*")){this.outFields=i;for(var a=0,s=0,o=i;s<o.length;s++){var u=o[s],l=n.getExpressionFromFieldName(u),c=this.fieldsIndex.get(l),h=c?null:n.getWhereClause(l,r),d=c?c.name:n.getAliasFromFieldName(u)||"FIELD_EXP_"+a++;this._fieldDataCache.set(u,{alias:d,clause:h})}}}return e.prototype.getAttributes=function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)},e.prototype.getFieldValue=function(e,t,r){var i=r?r.name:t,a=null;return this._fieldDataCache.has(i)?a=this._fieldDataCache.get(i).clause:r||(a=n.getWhereClause(t,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:a})),r?this.featureAdapter.getAttribute(e,i):a.calculateValue(e,this.featureAdapter)},e.prototype.validateItem=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:n.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)},e.prototype.validateItems=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:n.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)},e.prototype._processAttributesForOutFields=function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);for(var r={},n=0,i=t;n<i.length;n++){var a=i[n],s=this._fieldDataCache.get(a),o=s.alias,u=s.clause;r[o]=u?u.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,o)}return r},e.prototype._processAttributesForDistinctValues=function(e){if(r.isNone(e)||!this.returnDistinctValues)return e;var t=this.outFields,n=[];if(t)for(var i=0,a=t;i<a.length;i++){var s=a[i],o=this._fieldDataCache.get(s).alias;n.push(e[o])}else for(var o in e)n.push(e[o]);var u=(t||["*"]).join(",")+"="+n.join(","),l=this._returnDistinctMap.get(u)||0;return this._returnDistinctMap.set(u,++l),l>1?null:e},e}();t.default=i}.apply(null,n))||(e.exports=i)},1186:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(4)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._tasks=new Array}return Object.defineProperty(e.prototype,"length",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0}),e.prototype.push=function(e){var t=this;return r.create((function(r,n){return t._tasks.push(new i(r,n,e))}))},e.prototype.unshift=function(e){var t=this;return r.create((function(r,n){return t._tasks.unshift(new i(r,n,e))}))},e.prototype.process=function(){if(0===this._tasks.length)return!1;var e=this._tasks.shift();try{var t=e.callback();t&&"then"in t&&"function"==typeof t.then?t.then(e.resolve,e.reject):e.resolve(t)}catch(t){e.reject(t)}return!0},e.prototype.cancelAll=function(){for(var e=r.createAbortError(),t=0,n=this._tasks;t<n.length;t++)n[t].reject(e);this._tasks.length=0},e}();t.default=n;var i=function(e,t,r){this.resolve=e,this.reject=t,this.callback=r}}.apply(null,n))||(e.exports=i)},1207:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Float64Array(2),n=new Float64Array(2);function i(e){return e<=57?e-48:e<=104?e-88:e<=107?e-89:e<=110?e-90:e-91}function a(e){return"0123456789bcdefghjkmnpqrstuvwxyz"[e]}function s(e){return(e[0]+e[1])/2}function o(e,t,r){return e[0]=t,e[1]=r,e}function u(e,t){var r=s(e),n=t,i=!t;e[0]=i*e[0]+n*r,e[1]=i*r+n*e[1]}function l(e,t){var r=t>s(e);return u(e,r),r}function c(e,t){for(var a=o(r,-90,90),l=o(n,-180,180),c=0;c<t.length;c++){var h=i(t.charCodeAt(c));c%2==0?(u(l,!!(16&h)),u(l,!!(4&h)),u(l,!!(1&h)),u(a,!!(8&h)),u(a,!!(2&h))):(u(a,!!(16&h)),u(a,!!(4&h)),u(a,!!(1&h)),u(l,!!(8&h)),u(l,!!(2&h)))}return e[0]=s(a),e[1]=s(l),e}function h(e,t,i){for(var s="",u=o(r,-90,90),c=o(n,-180,180),h=0;h<i;h++){var d=0;h%2?(d|=l(u,e)<<4,d|=l(c,t)<<3,d|=l(u,e)<<2,d|=l(c,t)<<1,d|=l(u,e)<<0):(d|=l(c,t)<<4,d|=l(u,e)<<3,d|=l(c,t)<<2,d|=l(u,e)<<1,d|=l(c,t)<<0),s+=a(d)}return s}function d(e){var t=Math.floor(5*e/2);return 180/Math.pow(2,t)}function f(e){var t=Math.ceil(5*e/2);return 360/Math.pow(2,t)}function p(e,t){return t?1&e|(4&e)>>1|(16&e)>>2:(2&e)>>1|(8&e)>>2}function v(e,t){return t?(2&e)>>1|(8&e)>>2:1&e|(4&e)>>1|(16&e)>>2}function y(e,t,r){var n=!((e.length-1)%2),s=e.substring(0,e.length-1),o=i(e.charCodeAt(e.length-1)),u=0,l=0,c=0,h=0;n?(u=8,l=4,c=1&o|(4&o)>>1|(16&o)>>2,h=(2&o)>>1|(8&o)>>2):(u=4,l=8,h=1&o|(4&o)>>1|(16&o)>>2,c=(2&o)>>1|(8&o)>>2);var d=c+t,f=h+r,p=Math.floor(d/u),v=Math.floor(f/l),g=a(function(e,t,r){return r?1&e|(1&t)<<1|(2&e)<<1|(2&t)<<2|(4&e)<<2:1&t|(1&e)<<1|(2&t)<<1|(2&e)<<2|(4&t)<<2}(d-p*u,f-v*l,n));return e.length>1&&(p||v)?y(s,p,v)+g:s+g}t.decodeBase32Char=i,t.encodeBase32Char=a,t.decodeGeohash=c,t.convertGeohash32ToXY=function(e,t){for(var r=0,n=0,a=30,s=30,o=0;o<t.length;o++){var u=i(t.charCodeAt(o)),l=o%2==0;r|=p(u,l)<<(a-=l?3:2),n|=v(u,l)<<(s-=l?2:3)}return{geohashX:r,geohashY:n}},t.decodeGeohashXY=function(e,t){for(var r=-90,n=90,i=-180,a=180,s=0;s<t;s++){for(var o=Math.ceil((s+1)/2),u=Math.floor((s+1)/2),l=1-s%2,c=30-(3*o+2*u),h=30-(2*o+3*u),d=3*l+2*(1-l),f=2*l+3*(1-l),p=3*l+7*(1-l)<<h,v=(7*l+3*(1-l)<<c&e.geohashX)>>c,y=(p&e.geohashY)>>h,g=d-1;g>=0;g--){var m=(i+a)/2,_=v&1<<g?1:0;i=(1-_)*i+_*m,a=(1-_)*m+_*a}for(g=f-1;g>=0;g--){var b=(r+n)/2,I=y&1<<g?1:0;r=(1-I)*r+I*b,n=(1-I)*b+I*n}}return[i,r,a,n]},t.setGeohashXY=function(e,t,r,n){n%2&&(n+=1);for(var i=0,a=0,s=-90,o=90,u=-180,l=180,c=0;c<n/2;c++){for(var h=0;h<5;h++){var d=(u+l)/2,f=r>d?1:0;i|=f<<29-(h+5*c),u=(1-f)*u+f*d,l=(1-f)*d+f*l}for(h=0;h<5;h++){var p=(s+o)/2,v=t>p?1:0;a|=v<<29-(h+5*c),s=(1-v)*s+v*p,o=(1-v)*p+v*o}}e.geohashX=i,e.geohashY=a},t.encodeGeohash=h,t.latDistPerGeohash=d,t.lonDistPerGeohash=f,t.unpackXBits=p,t.unpackYBits=v,t.getRelativeGeohash=y,t.getIntersectingGeohashes=function(e,t,r,n,i){for(var a=Math.abs(r-e),s=Math.abs(n-t),o=d(i),u=f(i),l=Math.ceil(s/u),c=Math.ceil(a/o),p=h(e,t,i),v=new Array,g=0;g<l;g++)for(var m=0;m<c;m++)v.push(y(p,g,m));return v},t.forEachIntersectingGeohash=function(e,t,r,n,i,a){for(var s=Math.abs(r-e),o=Math.abs(n-t),u=d(i),l=f(i),p=Math.ceil(o/l),v=Math.ceil(s/u),g=h(e,t,i),m=0;m<p;m++)for(var _=0;_<v;_++){var b=y(g,m,_),I=c([0,0],b),x=I[0],S=I[1],T=x-u/2,w=S-l/2,F=x+u/2,E=S+l/2,N=u*l,C=Math.max(e,T),R=Math.max(t,w),M=Math.min(r,F)-C,A=Math.min(n,E)-R;a(b,Math.abs(M*A)/N)}}}.apply(null,n))||(e.exports=i)},1333:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(8),r(9),r(1),r(5),r(10),r(132),r(15),r(6),r(13),r(4),r(2),r(1087),r(1094),r(328),r(136),r(101),r(320),r(1133),r(1334),r(1336)],void 0===(i=function(e,t,r,n,i,a,s,o,u,l,c,h,d,f,p,v,y,g,m,_,b,I,x){Object.defineProperty(t,"__esModule",{value:!0});var S=c.getLogger("esri.views.2d.layers.features.controllers.BaseController"),T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._availableFields=[],t._pixelBuffer=0,t.config=null,t.filters=new Array(_.definitions.MAX_FILTERS),t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t}return a(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._initAttributeStore()},t.prototype.startup=function(){return i(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this._initAttributeStore(),[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 1:return e.sent(),[4,d.all([this.attributeStore.updateFilters(this),this.updatePixelBuffer()])];case 2:return e.sent(),[2]}}))}))},t.prototype.destroy=function(){this.attributeStore&&this.attributeStore.destroy()},Object.defineProperty(t.prototype,"arcadeInfo",{get:function(){return{geometryType:this.service.geometryType,fields:this.service.fields,spatialReference:this.spatialReference}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureReduction",{get:function(){return this.config.featureReduction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new y(this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryInfo",{get:function(){return{geometryType:this.service.geometryType,hasZ:!1,hasM:!1}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnCentroid",{get:function(){return this._get("returnCentroid")||function(e,t,r){if("esriGeometryPolygon"===t&&e.labelingInfo)return!0;if("esriGeometryPolygon"!==t)return!1;function n(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t||"web-style"===t||"cim"===t}switch(r.type){case"simple":return n(r.symbol);case"unique-value":return n(r.defaultSymbol)||r.uniqueValueInfos.some((function(e){return n(e.symbol)}));case"class-breaks":return n(r.defaultSymbol)||r.classBreakInfos.some((function(e){return n(e.symbol)}));case"dot-density":return!1;default:return!0}}(this.config,this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnOutline",{get:function(){return function(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return"backgroundFillSymbol"in e&&null!=e.backgroundFillSymbol&&"outline"in e.backgroundFillSymbol&&null!=e.backgroundFillSymbol.outline||t.some((function(e){return"outline"in e&&null!=e.outline}))}(t)}}(this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){return{returnCentroid:this.returnCentroid,returnGeometry:!0,outFields:this.availableFields,definitionExpression:this.config.definitionExpression,gdbVersion:this.config.gdbVersion,historicMoment:this.config.historicMoment}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?g.fromJSON(this.config.renderer):(S.error("mapview-controller","Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this,t=this.config.availableFields.filter((function(t){return-1===e._availableFields.indexOf(t)}));return this._availableFields=this._availableFields.concat(t),this._availableFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewParams",{get:function(){return{viewingMode:"",scale:this.viewState&&this.viewState.scale||1}},enumerable:!0,configurable:!0}),t.prototype.getObjectId=function(e){return this.attributeStore.getFeatureId(e)},t.prototype.getAggregate=function(e){return null},t.prototype.getAggregateValueRanges=function(){return{}},t.prototype.getLocalId=function(e){return this.attributeStore.getLocalId(e)},t.prototype.mapValidLocalIds=function(e){var t=this;return e.map((function(e){return t.attributeStore.getLocalId(e)})).filter((function(e){return null!=e}))},t.prototype.setViewState=function(e){this._set("viewState",e)},t.prototype.updatePixelBuffer=function(){return i(this,void 0,void 0,(function(){var e;return n(this,(function(t){switch(t.label){case 0:return[4,x.computePxBuffer(this.renderer,this.service.geometryType)];case 1:return e=t.sent(),this._pixelBuffer=Math.max(this._pixelBuffer,e),[2]}}))}))},t.prototype.setHighlight=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){return[2,this.attributeStore.setHighlight(e)]}))}))},t.prototype.validateConfig=function(e){for(var t=0,r=e.filters;t<r.length;t++){var n=r[t];if(h.isSome(n)&&n.where)try{p.validateWhere(this.fieldsIndex,n.where)}catch(e){throw new o("mapview-bad-filter",e.message,{filter:n,missingFields:e.details})}}},t.prototype.onFeatureAdd=function(e){e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype.onFeatureRemove=function(e){!e.localId&&l("esri-2d-debug"),this.attributeStore.freeLocalId(e.objectId)},t.prototype.enableEvent=function(e){},t.prototype._initAttributeStore=function(){var e=this;this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new b.default({type:"remote",initialize:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",t,{signal:r})},update:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",t,{signal:r})},render:function(){return e.remoteClient.invoke("tileRenderer.featuresView.requestRender")}})},t.prototype._createQueryEngine=function(e){return new v.default({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:e,timeInfo:this.service.timeInfo})},t.prototype._createTempQueryEngine=function(e){return void 0===e&&(e=this._createFeatureStore()),this._createQueryEngine(e)},t.prototype._createFeatureStore=function(){var e={geometryType:this.service.geometryType,hasM:!1,hasZ:!1};return new I.ClusterStore(e,this.spatialReference,this.attributeStore,this.featureReduction)},t.prototype._createDefaultQuery=function(e){var t=new m,r=e.outFields,n=this.config,i=n.gdbVersion,a=n.historicMoment,s=n.definitionExpression;return r=r.length/this.service.fields.length>=.75?["*"]:r,t.gdbVersion=i,t.historicMoment=null!=a?new Date(a):null,t.num=e.num,t.outFields=r,t.outSpatialReference=this.spatialReference,t.returnGeometry=e.returnGeometry,t.returnCentroid=e.returnCentroid,t.start=e.resultOffset,t.where=s||"1=1",t},t.prototype.hasGeometryFilter=function(){return this.filters.some((function(e){return h.isSome(e)&&!!e.geometry}))},r([f.property({readOnly:!0,dependsOn:["config","service","spatialReference"]})],t.prototype,"arcadeInfo",null),r([f.property()],t.prototype,"config",void 0),r([f.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"featureReduction",null),r([f.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"fieldsIndex",null),r([f.property()],t.prototype,"filters",void 0),r([f.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"geometryInfo",null),r([f.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"returnCentroid",null),r([f.property({readOnly:!0,dependsOn:["service","config"]})],t.prototype,"returnOutline",null),r([f.property({readOnly:!0,dependsOn:["config","availableFields"]})],t.prototype,"queryInfo",null),r([f.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),r([f.property()],t.prototype,"processor",void 0),r([f.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"availableFields",null),r([f.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r([f.property({constructOnly:!0})],t.prototype,"service",void 0),r([f.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r([f.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r([f.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r([f.property({readOnly:!0})],t.prototype,"viewState",void 0),r([f.property({readOnly:!0,dependsOn:["viewState"]})],t.prototype,"viewParams",null),r([f.subclass("esri.views.2d.layers.features.controllers.BaseController")],t)}(f.declared(u.HandleOwner));t.default=T}.apply(null,n))||(e.exports=i)},1334:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(17),r(5),r(8),r(9),r(18),r(15),r(13),r(4),r(21),r(1335),r(1207),r(37),r(35),r(205),r(196),r(1123),r(1070),r(1094),r(1081),r(67),r(345),r(1066)],void 0===(i=function(e,t,r,n,i,a,s,o,u,l,c,h,d,f,p,v,y,g,m,_,b,I,x,S){Object.defineProperty(t,"__esModule",{value:!0});var T=function(e){return u.andThen(e,(function(e){return"cluster"!==e.type?null:n({},e,{clusterRadius:c.pt2px(e.clusterRadius/2)})}))};function w(e,t,r){return a(this,void 0,void 0,(function(){var n,a,s,o;return i(this,(function(i){for(n=[],a=0,s=e;a<s.length;a++)o=s[a],n.push(F(o,t,r));return[2,l.all(n)]}))}))}function F(e,t,r){return a(this,void 0,void 0,(function(){var n,a,s;return i(this,(function(i){switch(i.label){case 0:return"onStatisticValueExpression"in e.outStatistic?(a=(n=e).outStatistic.onStatisticValueExpression,s=n,[4,I.createRendererExpression(a,t,r)]):[3,2];case 1:return s.expression=i.sent(),[2,n];case 2:return[2,e]}}))}))}var E=function(e){function t(t,r,n,i,a){var s=this,o=new y.default([],[r,n]);return(s=e.call(this,o,i,null,t)||this).invalid=!1,s.canDelete=!1,s.geohashBoundsInfo=a,s}return r(t,e),Object.defineProperty(t.prototype,"count",{get:function(){return this.attributes.cluster_count},enumerable:!0,configurable:!0}),t.create=function(e,r,n,i,a,s,o){var u=new t(r,n,i,s,o);return u.localId=e.createLocalId(u.objectId,!0),u.tileLevel=a,u},t.prototype.update=function(e,t,r,n,i){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=n,this.geohashBoundsInfo=i,this.referenceId=null,this.invalid=!1,this},t.prototype.toJSON=function(){return{objectId:this.objectId,referenceId:this.referenceId,attributes:n({},this.attributes,{clusterId:this.objectId}),geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}},t}(v.default),N=function(e){function t(t,r,n,i){var a=e.call(this,t)||this;return a._deferredDeletionQueue=[],a._invalidated=!1,a._aggregateFieldsHash=null,a._geohashLevel=0,a._aggregateValueRanges={},a._aggregateValueRangesChanged=!1,a._aggregateFields=[],a._hasAggregateValueExpression=!1,a._hasViewExpression=!1,a._$view={scale:0,viewingMode:"none"},a._clusters=new Map,a._tiles=new Map,a._spatialReference=r,a._attributeStore=n,a._featureReduction=T(i),a._projectionSupportCheck=m.checkProjectionSupport(r,s.SpatialReference.WGS84),a}return r(t,e),t.prototype.setScale=function(e){var t=e!==this._$view.scale&&this._hasViewExpression,r=this._featureReduction;this._$view.scale=e,u.isSome(r)&&t&&(this._tree=new h.GeohashTree(this._aggregateFields),this._unindexFeatures(),this._reindexFeatures(!0))},t.prototype.update=function(e,t,r){return a(this,void 0,void 0,(function(){var n,a,s,o,l,c,d,f,p,v,y,g=this;return i(this,(function(i){switch(i.label){case 0:return n=this._featureReduction,a=u.andThen(t.featureReduction,T),s=t.aggregateFields.reduce((function(e,t){return e+JSON.stringify(t)}),""),o=null===n&&t.featureReduction,l=s!==this._aggregateFieldsHash,c=o||l,l?(d=this,[4,w(t.aggregateFields,this._spatialReference,r)]):[3,2];case 1:for(d._aggregateFields=i.sent(),this._hasViewExpression=!1,f=0,p=this._aggregateFields;f<p.length;f++)"onStatisticValueExpression"in(v=p[f]).outStatistic&&(y=v,this._hasAggregateValueExpression=!0,this._hasViewExpression=this._hasViewExpression||y.expression.referencesScale());i.label=2;case 2:return[4,this._projectionSupportCheck];case 3:return i.sent(),this._featureReduction=a,this._aggregateFieldsHash=s,this._aggregateValueRanges={},this._invalidated=!0,u.isNone(a)?(this._tree=null,[2]):(u.isSome(n)&&n.clusterRadius!==a.clusterRadius&&this._clusters.forEach((function(e){return e.canDelete=!0})),c&&(this._tree=new h.GeohashTree(t.aggregateFields),this._unindexFeatures()),(c||e)&&this._reindexFeatures(l),this._handleClusterUpdates(),this._tiles.forEach((function(e){return g._getClustersForTile(e,0,a.clusterRadius,null,!1)})),[2])}}))}))},t.prototype._ensureAggregateFields=function(e){if(this._hasAggregateValueExpression)for(var t=this._$view,r=0,n=this._aggregateFields;r<n.length;r++){var i=n[r];if("onStatisticValueExpression"in i.outStatistic){var a=i,s=a.expression,o=a.outStatistic.onStatisticField;e.attributes[o]=x.callWithOptimizedFeature(s,e,{$view:t},this.geometryInfo)}}},t.prototype._unindexFeatures=function(){this._featuresById.forEach((function(e){e.geohashIndexed=!1}))},t.prototype._reindexFeatures=function(e){var t=this;this._featuresById.forEach((function(r){r.geohashX||r.geohashY||t._setGeohash(r),e&&t._ensureAggregateFields(r),t._attributeStore.isVisible(r)?t._insertIntoIndex(r):t._removeFromIndex(r)}))},t.prototype.onTileUpdate=function(e){var t=this,r=e.added,n=e.removed;if(r.length){var i=Math.max.apply(Math,r.map((function(e){return e.level})));this._setGeohashLevel(i),r.forEach((function(e){return t._tiles.set(e.key.id,e)}))}if(!u.isNone(this._featureReduction)){var a=this._featureReduction.clusterRadius;n.forEach((function(e){t._tiles.delete(e.key.id),t._markTileClustersForDeletion(e,a)}))}},t.prototype.sweepClusters=function(){var e=this;this._clusters.forEach((function(t,r){t.canDelete&&(e._attributeStore.freeLocalId(t.objectId),e._clusters.delete(r))}));for(var t=0,r=this._deferredDeletionQueue;t<r.length;t++){var n=r[t];this._attributeStore.addLocalId(n)}this._deferredDeletionQueue=[]},t.prototype.executeTileQuery=function(t,r,n){return a(this,void 0,void 0,(function(){var a,s,o;return i(this,(function(i){switch(i.label){case 0:return u.isNone(this._featureReduction)?[2,e.prototype.executeTileQuery.call(this,t,r,n)]:[4,this._projectionSupportCheck];case 1:return i.sent(),this._handleClusterUpdates(),a=this._featureReduction.clusterRadius,s=this._getTransforms(t,r),o=this._getClustersForTile(t,n.pixelBuffer,a,s),this._aggregateValueRangesChanged&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),[2,o]}}))}))},t.prototype.getAggregate=function(e){var t=null;return this._clusters.forEach((function(r){r.localId===e&&(t=r.toJSON())})),t},t.prototype.getAggregateValueRanges=function(){return this._aggregateValueRanges},t.prototype._getClustersForTile=function(e,t,r,i,a){var l=this;void 0===a&&(a=!0),t=Math.max(t,50);for(var c=2*r,h=new Set,d=this._getGeohashLevel(e.key.level),f=Math.pow(2,e.key.level)*Math.ceil(S.TILE_SIZE/c),v=Math.ceil(t/c)+2,y=Math.ceil(S.TILE_SIZE/c)+2*v,g=e.key,I=g.row,x=g.col*S.TILE_SIZE,T=I*S.TILE_SIZE,w=Math.floor(x/c)-v,F=Math.floor(T/c)-v,E=w+y,N=F+y,C=new Array,R=e.tileInfoView.getLODInfoAt(e.key.level),M=w;M<=E;M++)for(var A=function(t){var r,c,v=M;R.wrap&&(v=M<0?M+f:M%f);var y=R.wrap&&M<0,g=R.wrap&&M%f!==M,I=P._lookupCluster(R,e.key.level,v,t,d);if(u.isSome(I)){var x=u.andThen(i,(function(e){return y?e.left:g?e.right:e.tile}));if(a&&u.isNone(x))return"continue";if(!I.count)return"continue";if(a&&1===I.count){var S=I.geohashBoundsInfo,T=S.xLL,w=S.yLL,F=S.xTR,E=S.yTR,N=S.level,A=u.expect(P._tree).findSingleOccupancyNode(T,w,F,E,N),O=u.unwrap(A).getLngLatBounds(),j={x:O[0],y:O[1]},G={x:O[2],y:O[3]},Q=0,L=0,q=0,B=0;if(P._spatialReference.isWebMercator)Q=(r=p.lngLatToXY(j.x,j.y))[0],L=r[1],q=(c=p.lngLatToXY(G.x,G.y))[0],B=c[1];else{var k=m.project(j,s.SpatialReference.WGS84,P._spatialReference),D=m.project(G,s.SpatialReference.WGS84,P._spatialReference);if(!k||!D)return o("esri-2d-debug"),"continue";Q=k.x,L=k.y,q=D.x,B=D.y}var V=[Q,L,q,B],z=null;if(P.forEachInBounds(V,(function(e){l._attributeStore.isVisible(e)&&(z&&o("esri-2d-debug"),z=e)})),!z)return o("esri-2d-debug"),"continue";var Y=b.getGeometry(P.geometryInfo,z.geometry,0,u.expect(x)),U=n({},z.attributes,I.attributes);I.referenceId=z.localId,h.add(I.objectId),C.push(new _.Feature(U,I.localId,Y))}else a&&(h.add(I.objectId),Y=b.getGeometry(P.geometryInfo,I.geometry,0,u.expect(x)),C.push(new _.Feature(I.attributes,I.localId,Y)))}},P=this,O=F;O<=N;O++)A(O);return{features:C,objectIds:h}},t.prototype._getGeohashLevel=function(e){return Math.min(Math.ceil(e/2+2),12)},t.prototype._setGeohashLevel=function(e){var t=this,r=this._geohashLevel,n=this._getGeohashLevel(e),i=2*(Math.floor(n/2)+1)-1,a=this._tree;this._geohashLevel=i,u.isNone(a)||(i>r?this._featuresById.forEach((function(e){e.geohashIndexed&&(a.insert(e,t._geohashLevel,r+1),e.geohashIndexed=!0)})):i<r&&a.dropLevels(this._geohashLevel))},t.prototype._insertIntoIndex=function(e){e.geohashIndexed||(this._invalidated=!0,e.geohashIndexed=!0,u.expect(this._tree).insert(e,this._geohashLevel))},t.prototype._removeFromIndex=function(e){e.geohashIndexed&&(this._invalidated=!0,u.expect(this._tree).remove(e,this._geohashLevel),e.geohashIndexed=!1)},t.prototype._handleClusterUpdates=function(){var e=this;this._invalidated&&this._clusters.size&&this._clusters.forEach((function(t){u.isSome(t)&&(t.invalid=t.invalid||e._invalidated)})),this._invalidated=!1},t.prototype._getTransforms=function(e,t){var r={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},i=f.getInfo(t);if(!i)return{tile:r,left:null,right:null};var a=i.valid,s=a[0],o=a[1];return{tile:r,left:n({},r,{translate:[o,e.bounds[3]]}),right:n({},r,{translate:[s-o+e.bounds[0],e.bounds[3]]})}},t.prototype._getClusterId=function(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r},t.prototype._markForDeletion=function(e,t,r){var n=this._getClusterId(e,t,r);if(this._clusters.has(n)){var i=this._clusters.get(n);u.isSome(i)?i.canDelete=!0:this._clusters.delete(n)}},t.prototype._getClusterBounds=function(e,t,r){if(u.isNone(this._featureReduction))return null;var n=this._featureReduction.clusterRadius,i=2*n,a=r%2?t*i:t*i+n,s=r*i,o=a/S.TILE_SIZE,l=s/S.TILE_SIZE,c=(a+i)/S.TILE_SIZE,h=(s-i)/S.TILE_SIZE;return[e.getXForColumn(o),e.getYForRow(l),e.getXForColumn(c),e.getYForRow(h)]},t.prototype._lookupCluster=function(e,t,r,i,a){var o,l;if(u.isNone(this._featureReduction)||u.isNone(this._tree))return null;var c=this._getClusterId(t,r,i),h=this._clusters.get(c);if(h&&u.isSome(h)&&!h.invalid&&!h.canDelete)return h;var f=this._getClusterBounds(e,r,i),v=f[0],y=f[1],g=f[2],_=f[3],b={x:v,y:y},I={x:g,y:_},x=0,S=0,T=0,w=0;if(this._spatialReference.isWebMercator)x=(o=p.xyToLngLat(b.x,b.y))[0],S=o[1],T=(l=p.xyToLngLat(I.x,I.y))[0],w=l[1];else{var F=m.project(b,this._spatialReference,s.SpatialReference.WGS84),N=m.project(I,this._spatialReference,s.SpatialReference.WGS84);if(!F||!N)return null;x=F.x,S=F.y,T=N.x,w=N.y}var C={geohashX:0,geohashY:0},R={geohashX:0,geohashY:0};d.setGeohashXY(C,S,x,a),d.setGeohashXY(R,w,T,a);var M=C.geohashX,A=C.geohashY,P=R.geohashX,O=R.geohashY,j={xLL:M,yLL:A,xTR:P,yTR:O,level:a},G=this._tree.getRegionStatistics(M,A,P,O,a),Q=G.count,L=G.xTotal,q=G.yTotal,B=Q?L/Q:0,k=Q?q/Q:0;if(u.isSome(h)&&h.canDelete){var D=this._attributeStore.removeLocalId(h.objectId);this._deferredDeletionQueue.push(D)}var V=u.isSome(h)&&!h.canDelete&&h.invalid,z=n({cluster_count:Q},G.attributes),Y=this._attributeStore,U=V?h.update(B,k,t,z,j):E.create(Y,c,B,k,t,z,j);return 0===Q&&(U.geometry.coords[0]=(v+g)/2,U.geometry.coords[1]=(y+_)/2),this._attributeStore.setAttributeData(U.localId,U,this.geometryInfo,null),this._clusters.set(c,U),this._updateAggregateValueRangeForCluster(U,U.tileLevel),U},t.prototype._updateAggregateValueRangeForCluster=function(e,t){var r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},n=r.minValue,i=r.maxValue;r.minValue=Math.min(n,e.count),r.maxValue=Math.max(i,e.count),this._aggregateValueRanges[t]=r,n===r.minValue&&i===r.maxValue||(this._aggregateValueRangesChanged=!0)},t.prototype._markTileClustersForDeletion=function(e,t){for(var r=2*t,n=Math.ceil(S.TILE_SIZE/r),i=e.key,a=i.row,s=i.col*S.TILE_SIZE,o=a*S.TILE_SIZE,u=Math.floor(s/r),l=Math.floor(o/r),c=u;c<u+n;c++)for(var h=l;h<l+n;h++)this._markForDeletion(e.key.level,c,h)},t.prototype._setGeohash=function(e){var t=e.geometry;if(t&&t.coords.length){var r={x:t.coords[0],y:t.coords[1]},n=m.project(r,this._spatialReference,s.SpatialReference.WGS84);n?d.setGeohashXY(e,n.y,n.x,12):o("esri-2d-debug")}},t.prototype._add=function(t){var r=this._featuresById.get(t.objectId);e.prototype._add.call(this,t),this._ensureAggregateFields(t),u.isSome(this._featureReduction)&&u.isSome(this._tree)&&(r?(t.geohashIndexed=r.geohashIndexed,t.geohashX=r.geohashX,t.geohashY=r.geohashY):this._setGeohash(t),!t.geohashIndexed&&this._attributeStore.isVisible(t)&&this._insertIntoIndex(t))},t.prototype._remove=function(t){return u.isSome(this._featureReduction)&&u.isSome(this._tree)&&this._removeFromIndex(t),e.prototype._remove.call(this,t)},t}(g.default);t.ClusterStore=N}.apply(null,n))||(e.exports=i)},1335:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1213),r(13),r(1207)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this._pool=new r.default(8024),this._nodes=0,this._root=new s(0,0,0),this._fields=e}return e.prototype._acquire=function(e,t,r){var i=this._pool.dequeue();return this._nodes++,n.isSome(i)?i.realloc(e,t,r):new s(e,t,r)},e.prototype._release=function(e){this._nodes--,this._pool.enqueue(e)},Object.defineProperty(e.prototype,"count",{get:function(){return this._root.count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"poolSize",{get:function(){return this._pool.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){var e=0;return this._forEachNode((function(t){return e=Math.max(e,t.depth)})),e},enumerable:!0,configurable:!0}),e.prototype.dropLevels=function(e){var t=this;this._forEachNode((function(r){if(r.depth>=e)for(var n=0;n<r.children.length;n++){var i=r.children[n];r.children[n]=null,i&&t._release(i)}}))},e.prototype.insert=function(e,t,r){void 0===r&&(r=0);for(var n=this._root,i=0,a=0,s=0;null!==n;){if(n.depth>=r&&(n.count+=1,n.xTotal+=e.geometry.coords[0],n.yTotal+=e.geometry.coords[1],n.xGeohashTotal+=e.geohashX,n.yGeohashTotal+=e.geohashY,this._updateStatistics(e,n,1)),i>=t)return;var o=Math.ceil((i+1)/2),u=Math.floor((i+1)/2),l=1-i%2,c=30-(3*o+2*u),h=30-(2*o+3*u),d=7*l+3*(1-l)<<c,f=3*l+7*(1-l)<<h,p=8*l+4*(1-l),v=(e.geohashX&d)>>c,y=(e.geohashY&f)>>h,g=v+y*p;a=a<<3*l+2*(1-l)|v,s=s<<2*l+3*(1-l)|y,null==n.children[g]&&(n.children[g]=this._acquire(a,s,i+1)),i+=1,n=n.children[g]}},e.prototype.remove=function(e,t){for(var r=this._root,n=0;null!==r;){if(r.count-=1,r.xTotal-=e.geometry.coords[0],r.yTotal-=e.geometry.coords[1],r.xGeohashTotal-=e.geohashX,r.yGeohashTotal-=e.geohashY,this._updateStatistics(e,r,-1),n>=t)return;var i=Math.ceil((n+1)/2),a=Math.floor((n+1)/2),s=1-n%2,o=30-(3*i+2*a),u=30-(2*i+3*a),l=7*s+3*(1-s)<<o,c=3*s+7*(1-s)<<u,h=8*s+4*(1-s),d=((e.geohashX&l)>>o)+((e.geohashY&c)>>u)*h,f=r.children[d];1===f.count&&(this._release(f),r.children[d]=null),n+=1,r=f}},e.prototype.find=function(e,t,r){return this._root.find(e,t,r,0,0,0)},e.prototype.findSingleOccupancyNode=function(e,t,r,n,i){for(var a=this._root;null!==a;){var s=a.depth,o=a.xNode,u=a.yNode,l=1-s%2,c=a.xGeohashTotal/a.count,h=a.yGeohashTotal/a.count;if(1===a.count&&e<c&&c<=r&&t<h&&h<=n)return a;if(s>=i)a=a.next;else{for(var d=Math.ceil((s+1)/2),f=Math.floor((s+1)/2),p=30-(3*d+2*f),v=30-(2*d+3*f),y=~((1<<p)-1),g=~((1<<v)-1),m=(e&y)>>p,_=(t&g)>>v,b=(r&y)>>p,I=(n&g)>>v,x=o<<3*l+2*(1-l),S=u<<2*l+3*(1-l),T=x+8*l+4*(1-l),w=S+4*l+8*(1-l),F=Math.max(x,m),E=Math.max(S,_),N=Math.min(T,b),C=Math.min(w,I),R=null,M=null,A=E;A<=C;A++)for(var P=F;P<=N;P++){var O=P-x+(A-S)*(8*l+4*(1-l)),j=a.children[O];j&&(R||((R=j).next=a.next),M&&(M.next=j),M=j,j.next=a.next)}a=R||a.next}}return null},e.prototype.getRegionStatistics=function(e,t,r,n,i){for(var a=this._root,s=0,o=0,u=0,l={};null!==a;){var c=a.depth,h=a.xNode,d=a.yNode;if(c>=i){var f=a.xGeohashTotal/a.count,p=a.yGeohashTotal/a.count;e<f&&f<=r&&t<p&&p<=n&&(s+=a.count,o+=a.xTotal,u+=a.yTotal,this._aggregateStatistics(l,a.statistics)),a=a.next}else{for(var v=Math.ceil((c+1)/2),y=Math.floor((c+1)/2),g=1-c%2,m=30-(3*v+2*y),_=30-(2*v+3*y),b=~((1<<m)-1),I=~((1<<_)-1),x=(e&b)>>m,S=(t&I)>>_,T=(r&b)>>m,w=(n&I)>>_,F=h<<3*g+2*(1-g),E=d<<2*g+3*(1-g),N=F+8*g+4*(1-g),C=E+4*g+8*(1-g),R=Math.max(F,x),M=Math.max(E,S),A=Math.min(N,T),P=Math.min(C,w),O=null,j=null,G=M;G<=P;G++)for(var Q=R;Q<=A;Q++){var L=Q-F+(G-E)*(8*g+4*(1-g)),q=a.children[L];if(q){if(G!==M&&G!==P&&Q!==R&&Q!==A){f=q.xGeohashTotal/q.count,p=q.yGeohashTotal/q.count,e<f&&f<=r&&t<p&&p<=n&&(s+=q.count,o+=q.xTotal,u+=q.yTotal,this._aggregateStatistics(l,q.statistics));continue}O||((O=q).next=a.next),j&&(j.next=q),j=q,q.next=a.next}}a=O||a.next}}return{count:s,attributes:this._normalizeStatistics(l,s),xTotal:o,yTotal:u}},e.prototype._forEachNode=function(e){for(var t=this._root;null!==t;){var r=this._linkChildren(t)||t.next;e(t),t=r}},e.prototype._linkChildren=function(e){for(var t=null,r=null,n=0;n<=e.children.length;n++){var i=e.children[n];i&&(t||((t=i).next=e.next),r&&(r.next=i),r=i,i.next=e.next)}return t},e.prototype._updateStatistics=function(e,t,r){for(var n=0,i=this._fields;n<i.length;n++){var a=i[n],s=a.name,o=a.outStatistic.onStatisticField,u=e.attributes[o];switch(a.outStatistic.statisticType){case"norm":t.statistics[s]||(t.statistics[s]={});var l=a.outStatistic.onStatisticNormalizationField,c=e.attributes[l],h=t.statistics[s].onStatisticField||0,d=t.statistics[s].onStatisticNormalizationField||0;null==u||isNaN(u)||null==c||0===c||isNaN(c)||(t.statistics[s].onStatisticField=h+r*u,t.statistics[s].onStatisticNormalizationField=d+r*c);break;case"avg":t.statistics[s]||(t.statistics[s]={value:0,nanCount:0});var f=t.statistics[s].value,p=t.statistics[s].nanCount;null==u||isNaN(u)?t.statistics[s].nanCount=p+r:t.statistics[s].value=f+r*u;break;case"avg_angle":t.statistics[s]||(t.statistics[s]={x:0,y:0,nanCount:0});var v=t.statistics[s].x,y=t.statistics[s].y,g=(p=t.statistics[s].nanCount,Math.PI/180);null==u||isNaN(u)?t.statistics[s].nanCount=p+r:(t.statistics[s].x=v+r*Math.cos(u*g),t.statistics[s].y=y+r*Math.sin(u*g));break;case"mode":t.statistics[s]||(t.statistics[s]={}),f=t.statistics[s][u]||0,t.statistics[s][u]=f+r}}},e.prototype._aggregateStatistics=function(e,t){for(var r=0,n=this._fields;r<n.length;r++){var i=n[r],a=i.name;switch(i.outStatistic.statisticType){case"avg":case"avg_angle":case"mode":case"norm":for(var s in e[a]||(e[a]={}),t[a]){var o=e[a][s]||0;e[a][s]=o+t[a][s]}}}},e.prototype._normalizeStatistics=function(e,t){for(var r={},n=0,i=this._fields;n<i.length;n++){var a=i[n],s=a.name;switch(a.outStatistic.statisticType){case"norm":var o=e[s];if(t&&null==o.onStatisticNormalizationField)break;if(t&&o.onStatisticNormalizationField){r[s]=o.onStatisticField/o.onStatisticNormalizationField;break}r[s]=0;break;case"avg":if(!t)break;var u=e[s],l=u.value;if(!(t-(c=u.nanCount)))break;r[s]=l/(t-c);break;case"avg_angle":if(!t)break;var c,h=e[s],d=h.x,f=h.y;if(!(t-(c=h.nanCount)))break;var p=d/(t-c),v=f/(t-c),y=180/Math.PI,g=Math.atan2(v,p)*y;r[s]=g;break;case"mode":var m=e[s],_=0,b=null;for(var I in m){var x=m[I];x>_&&(_=x,b=I)}r[s]="null"===b?null:b}}return r},e}();t.GeohashTree=a;var s=function(){function e(e,t,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(var n=0;n<this.children.length;n++)this.children[n]=null;this.xNode=e,this.yNode=t,this.depth=r}return e.prototype.realloc=function(e,t,r){for(var n=0;n<this.children.length;n++)this.children[n]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this},e.prototype.getLngLatBounds=function(){var e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),n=30-(3*t+2*r),a=30-(2*t+3*r),s=this.xNode<<n,o=this.yNode<<a;return i.decodeGeohashXY({geohashX:s,geohashY:o},this.depth)},e.prototype.find=function(e,t,r,n,i,a){if(n>=r)return this;var s=1-n%2,o=3*s+2*(1-s),u=2*s+3*(1-s),l=30-i-o,c=30-a-u,h=((e&7*s+3*(1-s)<<l)>>l)+((t&3*s+7*(1-s)<<c)>>c)*(8*s+4*(1-s)),d=this.children[h];return null==d?null:d.find(e,t,r,n+1,i+o,a+u)},e}()}.apply(null,n))||(e.exports=i)},1336:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(9),r(5),r(4),r(21),r(220),r(320),r(1066),r(1079)],void 0===(i=function(e,t,r,n,i,a,s,o,u,l,c){Object.defineProperty(t,"__esModule",{value:!0});var h={"simple-marker":1,"picture-marker":1,text:1,"simple-line":1,"simple-fill":1,"picture-fill":1,cim:1,"web-style":1};t.computePxBuffer=function(e,t){return n(this,void 0,void 0,(function(){var n,i,o,u,l,c,h;return r(this,(function(r){switch(r.label){case 0:if("heatmap"===e.type)return[2,Math.round(3*e.blurRadius)];if("dot-density"===e.type)return[2,0];if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?[2,100]:[2,50];for(n=e.getSymbols(),i=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map((function(e){return e.size})).reduce(_,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((function(e){return e.size})).reduce(_,0):"real-world-size"===r.transformationType?30:void 0}(e),o=[],u=0,l=n;u<l.length;u++)c=l[u],o.push(g(c,i));return[4,a.all(o)];case 1:return h=r.sent(),[2,s.pt2px(h.reduce(_,0))]}}))}))};var d=[0,0,0,0];function f(e,t){return null==e?t:e}function p(e,t){return null==e.outline?t:f(e.outline.width,t)}var v={sdf:!0,code:99,metrics:l.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new o.default(0,0,24,24),page:0,textureBinding:2};function y(e,t){return n(this,void 0,void 0,(function(){var n,a,s,o,l,h,g,_,b,I,x,S;return r(this,(function(r){switch(r.label){case 0:return"simple-marker"===e.type?(n=Math.max(f(e.size,12),t),[2,m(e)+.707*n]):"picture-marker"===e.type?(a=Math.max(f(e.height,12),t),s=f(e.width,12)*(a/f(e.height,12)),o=s/2,l=a/2,[2,m(e)+Math.sqrt(o*o+l*l)]):"text"===e.type?(h=function(e){var t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[v]};for(var r=[],n=0;n<t;n++)r.push(i({},v,{code:e.text.charCodeAt(n)}));return{glyphMosaicItems:r}}(e),c.getTextSymbolSize(d,e,h),g=Math.abs(d[0]),_=Math.abs(d[1]),b=d[2],I=d[3],[2,Math.max(g,_)+Math.max(b,I)]):"simple-line"===e.type?[2,Math.max(f(e.width,.75),t)/2]:"simple-fill"===e.type||"picture-fill"===e.type?[2,Math.max(p(e,0),t)/2]:"cim"===e.type?(x=u.CIMSymbolHelper.getEnvelope(e.data))?[2,Math.sqrt(x.width*x.width+x.height*x.height)]:[2,0]:"web-style"!==e.type?[3,2]:(S=y,[4,e.fetchCIMSymbol()]);case 1:return[2,S.apply(void 0,[r.sent(),t])];case 2:return[2,0]}}))}))}function g(e,t){return n(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:return function(e){return e.type in h}(e)?(i=(n=Math).min,[4,y(e,t)]):[2,0];case 1:return[2,i.apply(n,[r.sent(),75])]}}))}))}function m(e){var t=f(e.xoffset,0),r=f(e.yoffset,0);return Math.sqrt(t*t+r*r)}function _(e,t){return Math.max(e,t)}}.apply(null,n))||(e.exports=i)},2083:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(0),r(5),r(8),r(9),r(104),r(10),r(15),r(6),r(81),r(4),r(16),r(106),r(2),r(36),r(19),r(322),r(355),r(206),r(320),r(1333),r(2084),r(2085),r(2086),r(1086),r(2088),r(348)],void 0===(i=function(e,t,r,n,i,a,s,o,u,l,c,h,d,f,p,v,y,g,m,_,b,I,x,S,T,w,F,E,N){Object.defineProperty(t,"__esModule",{value:!0});var C=c.getLogger("esri.views.2d.layers.features.controllers.OnDemandController"),R=l("esri-featurelayer-webgl"),M=l("esri-mobile"),A={maxDrillLevel:R&&"object"==typeof R&&null!=R.maxDrillLevel?R.maxDrillLevel:M?1:4,maxRecordCountFactor:R&&"object"==typeof R&&null!=R.maxRecordCountFactor?R.maxRecordCountFactor:M?1:3,enablePBFQuery:!R||"object"!=typeof R||null==R.enablePBFQuery||R.enablePBFQuery},P=new Set,O=[],j=function(){function e(e,t){this.objectIdField=t,this.client=p.openWithPorts(e)}return e.prototype.destroy=function(){this.client.close(),this.client=null},e.prototype.executeQuery=function(e,t){return s(this,void 0,void 0,(function(){var r;return a(this,(function(n){switch(n.label){case 0:return[4,this.client.invoke("queryFeatures",e.toJSON(),t)];case 1:return r=n.sent(),[2,m.convertFromFeatureSet(r,this.objectIdField)]}}))}))},e}(),G=function(){function e(e,t){this.source=e,this.sourceSpatialReference=t}return e.prototype.destroy=function(){},e.prototype.executeQuery=function(e,t){return s(this,void 0,void 0,(function(){return a(this,(function(r){switch(r.label){case 0:return[4,_.executeQueryPBF(this.source,e,{type:"optimized",sourceSpatialReference:this.sourceSpatialReference},t)];case 1:return[2,r.sent().data]}}))}))},e}(),Q=function(){function e(e,t,r){this.source=e,this.objectIdField=t,this.sourceSpatialReference=r}return e.prototype.destroy=function(){},e.prototype.executeQuery=function(e,t){return s(this,void 0,void 0,(function(){var r;return a(this,(function(n){switch(n.label){case 0:return[4,_.executeQuery(this.source,e,this.sourceSpatialReference,t)];case 1:return r=n.sent().data,[2,m.convertFromFeatureSet(r,this.objectIdField)]}}))}))},e}(),L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="on-demand",t._queryInfoHash=null,t._dataTileIndex=new w.default,t._editsQueue=new S.EditsQueue({processEdits:t._processEdits.bind(t)}),t._featuresInFlight=new Map,t.service=null,t}return r(t,e),t.prototype.initialize=function(){var e=this,t=this._createFeatureStore();t.onFeatureAdd=this.onFeatureAdd.bind(this),t.onFeatureRemove=this.onFeatureRemove.bind(this),this._set("featureStore",t),this._dataTileIndex.featureStore=this.featureStore,this._dataTileIndex.forEach((function(e){return e.done=!1})),this._fetchQueue=new N({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(t,r){return s(e,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return[4,this._fetchTile(t,this.queryInfo,r)];case 1:return e=n.sent(),this._handleResponse(t,e),[2,e]}}))}))}}),this._patchQueue=new N({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(t,r){return e._fetchTile(t.dataTile,t.queryInfo,r)}}),this._updateQueue=new E.default({tileInfoView:this.tileStore.tileScheme,process:function(t,r,n){return e._updateTile(t,r,n)}});var r=this.service,n=r.capabilities,i=r.source,o=r.objectIdField,u=r.spatialReference;Array.isArray(i)?this.sourceAdapter=new j(i,o):A.enablePBFQuery&&n.query.supportsFormatPBF?this.sourceAdapter=new G(i,u):this.sourceAdapter=new Q(i,o,u),this.handles.add([this.watch("updating",(function(t){return!t&&e.onIdle()}))]),this.featureStore.events.on("valueRangesChanged",(function(t){e.remoteClient.invoke("emitEvent",{name:"valueRangesChanged",event:{valueRanges:t.valueRanges}})}))},t.prototype.destroy=function(){this._fetchQueue.clear(),this._patchQueue.clear(),this._updateQueue.clear(),this._editsQueue.destroy(),this.queryEngine.destroy(),this.sourceAdapter.destroy()},Object.defineProperty(t.prototype,"queryEngine",{get:function(){return this._createQueryEngine(this.featureStore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.viewState||this._fetchQueue.updating||this._patchQueue.updating||this._updateQueue.updating||this._editsQueue.updating},enumerable:!0,configurable:!0}),t.prototype.update=function(e,t){return s(this,void 0,void 0,(function(){var r,n,i,s,o,u,l=this;return a(this,(function(a){switch(a.label){case 0:return this.validateConfig(e),r=JSON.stringify(this.config.filters),n=this.renderer.getAttributeHash(),i=e.availableFields.filter((function(e){return-1===l.availableFields.indexOf(e)})),s=this.config.definitionExpression,this._set("config",e),s!==this.config.definitionExpression&&this._set("queryEngine",this._createQueryEngine(this.featureStore)),[4,this.updatePixelBuffer()];case 1:return a.sent(),o=r!==JSON.stringify(e.filters),u=n!==this.renderer.getAttributeHash(),t?u?[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]:[3,3]:[3,6];case 2:a.sent(),a.label=3;case 3:return[4,this.attributeStore.updateFilters(this)];case 4:return a.sent(),[4,this.featureStore.update(o,e,this.service.fields)];case 5:return a.sent(),this.refresh(),[2];case 6:return i.length?[4,this._handleAttributeChange(i)]:[3,8];case 7:a.sent(),a.label=8;case 8:return"heatmap"===this.renderer.type?[2]:u?[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]:[3,10];case 9:a.sent(),this.featureStore.forEach((function(e){return l.attributeStore.setAttributeData(e.localId,e,l.geometryInfo,l.viewParams)})),a.label=10;case 10:return[4,this.attributeStore.updateFilters(this)];case 11:return a.sent(),[4,this.featureStore.update(o,e,this.service.fields)];case 12:return a.sent(),[4,this.attributeStore.sendUpdates()];case 13:return a.sent(),[2]}}))}))},t.prototype.invalidate=function(){return s(this,void 0,void 0,(function(){var e,t,r;return a(this,(function(n){for(e=0,t=this.tileStore.tiles;e<t.length;e++)r=t[e],this._updateQueue.push(r.id,Date.now());return[2]}))}))},t.prototype.onIdle=function(){this.featureStore.sweepClusters()},t.prototype.onEdits=function(e){var t=this;return this._fetchQueue.pause(),this._fetchQueue.reset(),this._editsQueue.push(e).then((function(){t._editsQueue.updating||t._fetchQueue.resume()}))},t.prototype.queryFeatures=function(e){return this.queryEngine.executeQuery(e)},t.prototype.queryFeatureCount=function(e){return this.queryEngine.executeQueryForCount(e)},t.prototype.queryObjectIds=function(e){return this.queryEngine.executeQueryForIds(e)},t.prototype.queryExtent=function(e){return this.queryEngine.executeQueryForExtent(e)},t.prototype.queryStatistics=function(){return s(this,void 0,void 0,(function(){var e,t,r,n=this;return a(this,(function(o){switch(o.label){case 0:return e=0,t=0,r=0,[4,d.all(this.tileStore.tiles.map((function(i){return s(n,void 0,void 0,(function(){var n,s,o,u,l,c,d,f,p,v,y;return a(this,(function(a){switch(a.label){case 0:return n=this.queryInfo,s=n.returnCentroid,o=n.returnGeometry,u=this._pixelBuffer,l={pixelBuffer:u,returnGeometry:o,returnCentroid:s,returnOutline:this.returnOutline},c=h(),[4,this.featureStore.executeTileQuery(i,this.spatialReference,l)];case 1:for(d=a.sent().features,f=h(),r+=f-c,e+=d.length,p=0,v=d;p<v.length;p++)(y=v[p]).geometry&&(g.isPolygon(y.geometry)?t+=y.geometry.rings.reduce((function(e,t){return e+t.length}),0):g.isPolyline(y.geometry)&&(t+=y.geometry.paths.reduce((function(e,t){return e+t.length}),0)));return[2]}}))}))})))];case 1:return o.sent(),[2,i({},this.featureStore.storeStatistics,{displayedFeatureCount:e,displayedVertexCount:t,displayPreProcessTime:r})]}}))}))},t.prototype.refresh=function(){return s(this,void 0,void 0,(function(){var e=this;return a(this,(function(t){switch(t.label){case 0:return this._queryInfoHash=Math.random().toString(),this._dataTileIndex.clear(),this._fetchQueue.pause(),this._updateQueue.pause(),this._editsQueue.clear(),this._fetchQueue.clear(),this._updateQueue.clear(),[4,f.whenFalseOnce(this._fetchQueue,"updating")];case 1:return t.sent(),[4,f.whenFalseOnce(this._updateQueue,"updating")];case 2:return t.sent(),this.featureStore.startMarkingUsedFeatures(),this._manageTiles(this.tileStore.tiles),this._fetchQueue.resume(),[4,f.whenFalseOnce(this._fetchQueue,"updating")];case 3:return t.sent(),this.featureStore.sweep(),this.featureStore.forEach((function(t){return e.attributeStore.setAttributeData(t.localId,t,e.geometryInfo,e.viewParams)})),this.attributeStore.sendUpdates(),this._updateQueue.resume(),[2]}}))}))},t.prototype.setViewState=function(e){var t=this,r=this.viewState&&this.viewState.scale;this.inherited(arguments),this._fetchQueue.state=e,this._updateQueue.state=e,r!==this.viewState.scale&&this.attributeStore.hasScaleExpr&&(this.featureStore.forEach((function(e){return t.attributeStore.setAttributeData(e.localId,e,t.geometryInfo,t.viewParams)})),this.attributeStore.sendUpdates()),this.featureStore.setScale(this.viewState.scale)},t.prototype.getAggregate=function(e){return this.featureStore.getAggregate(e)},t.prototype.getAggregateValueRanges=function(){return this.featureStore.getAggregateValueRanges()},t.prototype.onTileUpdate=function(e){this._manageTiles(e.added,e.removed),this.featureStore.onTileUpdate(e)},t.prototype.onFeatureAdd=function(e){if(this._featuresInFlight.has(e.objectId)){var t=this._featuresInFlight.get(e.objectId).attributes;e.attributes=i({},t,e.attributes),this._featuresInFlight.delete(e.objectId)}e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype._handleAttributeChange=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this._fetchChangedFields(e)];case 1:return t.sent(),[2]}}))}))},t.prototype._fetchChangedTileFields=function(e,t){return s(this,void 0,void 0,(function(){var r;return a(this,(function(n){return(r=this._dataTileIndex.get(e.id))?[2,this._fetchChangedTileFieldsDrill(r,t)]:[2]}))}))},t.prototype._fetchChangedTileFieldsDrill=function(e,t,r){return void 0===r&&(r=0),s(this,void 0,void 0,(function(){var n,s,o,u,l,c,h,f,p,v,y=this;return a(this,(function(a){switch(a.label){case 0:return n=i({},this.queryInfo,{returnGeometry:!1,returnCentroid:!1,outFields:t.concat([this.service.objectIdField])}),e.returnExceeded=e.returnExceeded||r>=A.maxDrillLevel,s=e.key,o={key:s,dataTile:e,queryInfo:n},[4,this._patchQueue.push(o)];case 1:return(u=a.sent()).exceededTransferLimit&&r<A.maxDrillLevel?(l=e.tile.createChildTiles(),c=l.map((function(t){var r=new T.default;return r.tile=t,r.displayTile=e.displayTile,r})),[4,d.all(c.map((function(e){return y._fetchChangedTileFieldsDrill(e,t,r+1)})))]):[3,3];case 2:return a.sent(),[2];case 3:for(h=0,f=u.features;h<f.length;h++)p=f[h],this.featureStore.has(p.objectId)?(v=this.featureStore.getFeature(p.objectId)).attributes=i({},v.attributes,p.attributes):this._featuresInFlight.set(p.objectId,p);return[2]}}))}))},t.prototype._fetchChangedTileFieldsPaged=function(e,t,r){return void 0===r&&(r=0),s(this,void 0,void 0,(function(){var n,s,o,u,l,c,h,d,f,p,v;return a(this,(function(a){switch(a.label){case 0:return n=this.service.capabilities.query.supportsMaxRecordCountFactor,s=this.service.tileMaxRecordCount,o=s*(n?1:A.maxRecordCountFactor),u=i({},this.queryInfo,{returnGeometry:!1,returnCentroid:!1,outFields:t.concat([this.service.objectIdField]),resultOffset:r*o,num:o}),e.returnExceeded=!0,l=e.key,c={key:l,dataTile:e,queryInfo:u},[4,this._patchQueue.push(c)];case 1:for(h=a.sent(),d=0,f=h.features;d<f.length;d++)p=f[d],this.featureStore.has(p.objectId)?(v=this.featureStore.getFeature(p.objectId)).attributes=i({},v.attributes,p.attributes):this._featuresInFlight.set(p.objectId,p);return h.exceededTransferLimit?[2,this._fetchChangedTileFieldsPaged(e,t,r+1)]:[2]}}))}))},t.prototype._fetchChangedFields=function(e){return s(this,void 0,void 0,(function(){var t,r,n=this;return a(this,(function(i){switch(i.label){case 0:return t=this.tileStore.tiles,r=t.map((function(t){return n._fetchChangedTileFields(t,e)})),[4,d.all(r)];case 1:return i.sent(),[2]}}))}))},t.prototype._manageTiles=function(e,t){void 0===t&&(t=null);for(var r=this._dataTileIndex,n=this._fetchQueue,i=this._updateQueue,a="esriGeometryPoint"===this.service.geometryType,s=function(e){var t=r.get(e.id);t?(t.displayTile=e,a?r.forEach((function(r){F.isChildOf(r,t)&&(r.displayTile=e)})):t.done=!1):((t=new T.default).tile=e.clone(),t.displayTile=e,r.add(t)),o._processDataTile(t)},o=this,u=0,l=e;u<l.length;u++)s(d=l[u]);if(t)for(var c=0,h=t;c<h.length;c++){var d=h[c];P.add(d),i.abort(d.id)}r.forEach((function(e){P.has(e.displayTile)&&O.push(e)}));for(var f=0,p=O;f<p.length;f++){var v=p[f];n.abort(v.id),r.delete(v)}O.length=0,P.clear()},t.prototype._processDataTile=function(e){var t=this,r=e.displayTile,n=e.key,i=this._dataTileIndex,a=this._fetchQueue,s=n.id,o=this._queryInfoHash,l=n.level-r.key.level>=A.maxDrillLevel;if(i.add(e),e.done||a.has(s)){if(e.queryInfoHash!==o||e.returnExceeded!==l)if(e.done)e.done=!1;else{if(!a.isOngoing(s))return e.queryInfoHash=o,void(e.returnExceeded=l);a.abort(s)}}else e.queryInfoHash=o,e.returnExceeded=l;e.done?this._invalidateTile(e.displayTile):a.has(s)||a.push(e).catch((function(r){d.isAbortError(r)||C.error(new u("featurelayer-controller:tile-error","Encountered an error when handling tile response",r)),e.done=!0,t._invalidateTile(e.displayTile)}))},t.prototype._handleResponse=function(e,t){if(e.done=!0,m.hydrateOptimizedFeatureSet(t),t.exceededTransferLimit)if(e.returnExceeded)this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);else{for(var r=e.tile.createChildTiles(),n=0,i=r;n<i.length;n++){var a=i[n],s=new T.default;s.tile=a,s.displayTile=e.displayTile,this._processDataTile(s)}o.release(r)}else this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);this._invalidateTile(e.tile)},t.prototype._deleteChildrenDataTiles=function(e){this._dataTileIndex.forEach((function(t){F.isChildOf(t,e)&&O.push(t)}));for(var t=0,r=O;t<r.length;t++){var n=r[t];this._fetchQueue.abort(n.id),this._dataTileIndex.delete(n)}O.length=0},t.prototype._createQuery=function(e,t,r,n,i,a){var s=this.service.geometryType,o=this._createDefaultQuery(n);return o.maxRecordCountFactor=i,o.returnExceededLimitFeatures=a,o.resultType="tile",o.geometry=e,this.service.capabilities.query.supportsQuantization?(o.quantizationParameters=new b.default({mode:"view",originPosition:"upper-left",tolerance:r,extent:t}),"esriGeometryPolyline"===s&&(o.maxAllowableOffset=r)):"esriGeometryPolyline"!==s&&"esriGeometryPolygon"!==s||(o.maxAllowableOffset=r),o},t.prototype._fetchTile=function(e,t,r){return s(this,void 0,void 0,(function(){var n,i,s,o,u,l,c,h,d,f,p;return a(this,(function(a){switch(a.label){case 0:return n=new y({xmin:e.bounds[0],ymin:e.bounds[1],xmax:e.bounds[2],ymax:e.bounds[3],spatialReference:this.spatialReference}),i=this.service.geometryType,s="esriGeometryPoint"===i?e.tile:e.displayTile,o=s.extent,u=s.resolution,l=e.returnExceeded,c=this._createQuery(n,o,u,t,A.maxRecordCountFactor,l),[4,this.sourceAdapter.executeQuery(c,r)];case 1:if((h=a.sent()).transform&&"esriGeometryPolygon"===i)for(d=0,f=h.features;d<f.length;d++)(p=f[d]).geometry=m.removeCollinearVectices(p.geometry,p.geometry,i,!1,!1);return[2,h]}}))}))},t.prototype._invalidateTile=function(e){for(var t=this._pixelBuffer,r=this._updateQueue,n=0,i=this.tileStore.intersections(e,t);n<i.length;n++){var a=i[n].tile;r.push(a.id,a.updateTimestamp)}},t.prototype._updateTile=function(e,t,r){return s(this,void 0,void 0,(function(){var n,i,s,o,u,l,c,h,f,p,v,y,g=this;return a(this,(function(a){switch(a.label){case 0:return n=this.tileStore.get(e),i=this.queryInfo,s=i.returnCentroid,o=i.returnGeometry,u=this._pixelBuffer,l={pixelBuffer:u,returnGeometry:o,returnCentroid:s,returnOutline:this.returnOutline},[4,this.featureStore.executeTileQuery(n,this.spatialReference,l)];case 1:return c=a.sent(),h=c.features,f=c.objectIds,[4,this.attributeStore.sendUpdates()];case 2:return a.sent(),p={geometryType:this.service.geometryType,features:h,fields:this.service.fields,objectIdFieldName:this.service.objectIdField,transform:n.transform},v=[],y=!0,this._dataTileIndex.forEach((function(e){n.id!==e.id&&F.isChildOf(e,n)&&y&&!e.done&&(y=!1)})),y&&n&&n.objectIds.forEach((function(e){if(!f.has(e)){var t=g.attributeStore.getLocalId(e);v.push(t)}})),f.forEach((function(e){n.objectIds.add(e)})),n.updateTimestamp=t,[2,this.processor.onTileData(n,{clear:!0,addOrUpdate:p.features,remove:v,transformParams:I.Utils.getTransformParams(p)},r).catch((function(e){d.isAbortError(e)||C.error("update-tile",e)}))]}}))}))},t.prototype._processEdits=function(e,t,r){return s(this,void 0,void 0,(function(){var n,o,u,l,c,h=this;return a(this,(function(f){switch(f.label){case 0:return n=this._createTempQueryEngine(),o=this._createObjectIdsQuery(e),e.length?[4,this.sourceAdapter.executeQuery(o)]:[3,2];case 1:u=f.sent(),m.hydrateOptimizedFeatureSet(u),this._dataTileIndex.addOrUpdateFeatures(u.features),n.featureStore.addMany(u.features),f.label=2;case 2:return l=t.concat(e).map((function(e){return h.attributeStore.getLocalId(e)})),this._dataTileIndex.deleteFeaturesById(t),this.attributeStore.sendUpdates(),c=i({},this.queryInfo,{pixelBuffer:this._pixelBuffer,returnOutline:this.returnOutline}),this.tileStore.tiles.map((function(e){return s(h,void 0,void 0,(function(){var t,i;return a(this,(function(a){switch(a.label){case 0:return[4,n.featureStore.executeTileQuery(e,this.spatialReference,c)];case 1:return t=a.sent().features,i={transform:e.transform,hasZ:!1,hasM:!1},[2,this.processor.onTileData(e,{addOrUpdate:t,remove:l,transformParams:i},r).catch((function(e){d.isAbortError(e)||C.error("update-tile",e)}))]}}))}))})),n.destroy(),[2]}}))}))},t.prototype._createObjectIdsQuery=function(e){var t=this._createDefaultQuery(this.queryInfo);return t.objectIds=e,t},n([v.property()],t.prototype,"_fetchQueue",void 0),n([v.property()],t.prototype,"_patchQueue",void 0),n([v.property()],t.prototype,"_updateQueue",void 0),n([v.property()],t.prototype,"_editsQueue",void 0),n([v.property({readOnly:!0})],t.prototype,"featureStore",void 0),n([v.property({constructOnly:!0})],t.prototype,"service",void 0),n([v.property()],t.prototype,"sourceAdapter",void 0),n([v.property({readOnly:!0,dependsOn:["featureStore","service"]})],t.prototype,"queryEngine",null),n([v.property({dependsOn:["viewState","_fetchQueue.updating","_updateQueue.updating","_patchQueue.updating","_editsQueue.updating"]})],t.prototype,"updating",null),n([v.subclass("esri.views.2d.layers.features.controllers.OnDemandController")],t)}(v.declared(x.default));t.default=L}.apply(null,n))||(e.exports=i)},2084:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(8),r(9),r(1),r(11),r(4),r(2),r(38)],void 0===(i=function(e,t,r,n,i,a,s,o,u){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t){var r=e.call(this,t)||this;return r._queue=[],r._onGoingRequest=null,r._abortController=o.createAbortController(),r}return a(t,e),t.prototype.destroy=function(){this.clear()},Object.defineProperty(t.prototype,"updating",{get:function(){return!this.destroyed&&(this._queue.length>0||null!=this._onGoingRequest)},enumerable:!0,configurable:!0}),t.prototype.clear=function(){if(this.destroyed)throw new Error("instance is already destroyed");for(var e=this._queue.pop();e;)e.resolver.reject(o.createAbortError()),e=this._queue.pop();this._queue.length=0,this._abortController.abort(),this._abortController=o.createAbortController()},t.prototype.push=function(e){return i(this,void 0,void 0,(function(){var t,r=this;return n(this,(function(n){if(this.destroyed)throw new Error("instance is already destroyed");return t=o.createResolver(),this._queue.push({event:e,resolver:t}),this.notifyChange("updating"),Promise.resolve().then((function(){r._processNext()})),[2,t.promise]}))}))},t.prototype._processNext=function(){return i(this,void 0,void 0,(function(){var e,t,r,i,a,s,o,u,l,c,h,d,f,p,v,y,g,m,_,b,I,x,S=this;return n(this,(function(n){switch(n.label){case 0:if(this._onGoingRequest)return[2];for(e=[],t=new Set,r=new Set,i=new Set,a=this._queue.shift();a;){for(s=a.event,o=s.addedFeatures,u=s.deletedFeatures,l=s.updatedFeatures,c=a.resolver,e.push(c),h=0,d=o;h<d.length;h++)f=d[h],b=f.objectId,f.error||(t.add(b),r.add(b),i.delete(b));for(p=0,v=l;p<v.length;p++)y=v[p],b=y.objectId,y.error||(r.add(b),i.delete(b));for(g=0,m=u;g<m.length;g++)_=m[g],b=_.objectId,_.error||(t.has(b)?t.delete(b):i.add(b),r.delete(b));a=this._queue.shift()}return r.size||i.size?(I=[],x=[],r.size&&r.forEach((function(e){I.push(e)})),i.size&&i.forEach((function(e){x.push(e)})),this._onGoingRequest=Promise.resolve().then((function(){return S.processEdits(I,x,{signal:S._abortController.signal})})).catch((function(){})),this.notifyChange("updating"),[4,this._onGoingRequest]):(this.notifyChange("updating"),e.forEach((function(e){return e()})),[2]);case 1:return n.sent(),this._onGoingRequest=null,this.notifyChange("updating"),e.forEach((function(e){return e()})),this._queue.length>0&&this._processNext(),[2]}}))}))},r([u.property({constructOnly:!0})],t.prototype,"processEdits",void 0),r([u.property({readOnly:!0})],t.prototype,"updating",null),r([u.subclass("esri.views.2d.layers.features.controllers.EditsQueue")],t)}(u.declared(s));t.EditsQueue=l}.apply(null,n))||(e.exports=i)},2085:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.displayTile=null,this.tile=null,this.done=!1,this.queryInfoHash=null,this.returnExceeded=!1}return Object.defineProperty(e.prototype,"key",{get:function(){return this.tile.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.tile.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bounds",{get:function(){return this.tile.bounds},enumerable:!0,configurable:!0}),e}();t.default=r}.apply(null,n))||(e.exports=i)},2086:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2087),r(1123),r(1086)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var a=[],s=new Set,o=function(){function e(){this._tileById=new Map,this._tilesToFeatures=new Map,this._featureToTiles=new Map}return e.prototype.destroy=function(){this.clear()},e.prototype.add=function(e){var t=this;if(!this.has(e.id)){var n=e;this._tileById.set(n.id,n),this._tilesToFeatures.set(n,r.default.acquire()),this._tilesToFeatures.forEach((function(e,r){n!==r&&(i.isParentOf(n,r)?e.forEach((function(e){t._link(n,e)})):i.isChildOf(n,r)&&t.featureStore.forEachInBounds(n.bounds,(function(r){e.has(r.objectId)&&t._link(n,r.objectId)})))}))}},e.prototype.clear=function(){this._tilesToFeatures.forEach((function(e){return r.default.release(e)})),this._tilesToFeatures.clear(),this._featureToTiles.forEach((function(e){return r.default.release(e)})),this._featureToTiles.clear(),this._tileById.clear()},e.prototype.delete=function(e){var t=this,r=this.get(e.id);a.length=0,this._tilesToFeatures.get(r).forEach((function(e){var n=t._featureToTiles.get(e);n.has(r)&&1===n.size?a.push(e):t._unlink(r,e)}));for(var n=0,i=a;n<i.length;n++){var s=i[n];this._unlink(r,s)}this.featureStore.removeManyById(a),this._tilesToFeatures.delete(r),this._tileById.delete(r.id),a.length=0},e.prototype.forEach=function(e,t){return this._tileById.forEach(e,t)},e.prototype.get=function(e){return this._tileById.get(e)},e.prototype.has=function(e){return this._tileById.has(e)},e.prototype.setTileFeatures=function(e,t){var n=this,i=this.get(e.id);this._tilesToFeatures.has(i)||(this._tileById.set(i.id,i),this._tilesToFeatures.set(i,r.default.acquire()));for(var o=0,u=t;o<u.length;o++){var l=u[o];s.add(l.objectId)}a.length=0,this._tilesToFeatures.get(i).forEach((function(e){if(!s.has(e)){var t=n._featureToTiles.get(e);t.has(i)&&1===t.size?a.push(e):n._unlink(i,e)}}));for(var c=0,h=a;c<h.length;c++){var d=h[c];this._unlink(i,d)}this.featureStore.removeManyById(a),this.featureStore.addMany(t),s.forEach((function(e){n._link(i,e)})),s.clear(),a.length=0},e.prototype.addOrUpdateFeatures=function(e){for(var t=this,r=new Set,i=new n.default({geometryType:this.featureStore.geometryType,hasM:this.featureStore.hasM,hasZ:this.featureStore.hasZ}),a=0,s=this.deleteFeaturesById(e.map((function(e){return e.objectId})));a<s.length;a++){var o=s[a];r.add(o)}i.addMany(e),this._tileById.forEach((function(e){i.forEachInBounds(e.bounds,(function(n){t._link(e,n.objectId),r.add(e)}))})),this.featureStore.addMany(e);var u=[];return r.forEach((function(e){return u.push(e)})),u},e.prototype.deleteFeaturesById=function(e){for(var t=this,n=new Set,i=function(e){var i=a._featureToTiles.get(e);i&&(i.forEach((function(r){n.add(r),t._tilesToFeatures.get(r).delete(e)})),r.default.release(i),a._featureToTiles.delete(e))},a=this,s=0,o=e;s<o.length;s++)i(o[s]);this.featureStore.removeManyById(e);var u=[];return n.forEach((function(e){return u.push(e)})),u},e.prototype._link=function(e,t){this._featureToTiles.get(t)||this._featureToTiles.set(t,r.default.acquire()),this._featureToTiles.get(t).add(e),this._tilesToFeatures.get(e).add(t)},e.prototype._unlink=function(e,t){this._featureToTiles.get(t).delete(e),this._tilesToFeatures.get(e).delete(t),0===this._featureToTiles.get(t).size&&(r.default.release(this._featureToTiles.get(t)),this._featureToTiles.delete(t))},e}();t.default=o}.apply(null,n))||(e.exports=i)},2087:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._pool=[],this._set=new Set}return e.prototype.acquire=function(){if(0===this._pool.length)return new Set;var e=this._pool.pop();return this._set.delete(e),e},e.prototype.release=function(e){e&&!this._set.has(e)&&(e.clear(),this._pool.length<5e4&&(this._pool.push(e),this._set.add(e)))},e.acquire=function(){return n.acquire()},e.release=function(e){return n.release(e)},e}();t.default=r;var n=new r}.apply(null,n))||(e.exports=i)},2088:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(0),r(8),r(9),r(11),r(4),r(39),r(2),r(78),r(369)],void 0===(i=function(e,t,r,n,i,a,s,o,u,l,c,h){Object.defineProperty(t,"__esModule",{value:!0});var d=[0,0],f=function(e){function t(t){var r=e.call(this,t)||this;return r._queue=new Map,r._isPaused=!1,r._scheduledNextHandle=null,r._timestamp=Date.now(),r.tileInfoView=null,r._next=r._next.bind(r),r._finalize=r._finalize.bind(r),r}return r(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this._queue.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._queue.size>0||null!=this._onGoingTile},enumerable:!0,configurable:!0}),t.prototype.abort=function(e){this._onGoingTile&&this._onGoingTile.tileId===e&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._queue.delete(e),this._scheduleNext(),this.notifyChange("updating")},t.prototype.clear=function(){this._queue.clear(),this._onGoingTile&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._cancelNext(),this.notifyChange("updating")},t.prototype.has=function(e){return this._queue.has(e)},t.prototype.isOngoing=function(e){return this._onGoingTile&&this._onGoingTile.tileId===e},t.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},t.prototype.push=function(e,t){if(!this._queue.has(e)){var r=o.createAbortController();this._queue.set(e,{tileId:e,key:h.TileKey.pool.acquire(e),timestamp:t||this._timestamp,abortController:r}),this._scheduleNext(),this.notifyChange("updating")}},t.prototype.refresh=function(){this._timestamp=Date.now(),this.reset()},t.prototype.reset=function(){var e=this._onGoingTile;if(e){var t=e.tileId;this.push(t,this._timestamp)}this.notifyChange("updating")},t.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext()),this.notifyChange("updating")},t.prototype._finalize=function(){this._onGoingTile=null,this.notifyChange("updating"),this._scheduleNext()},t.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},t.prototype._scheduleNext=function(){this._isPaused||this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingTile||(this._scheduledNextHandle=u.schedule(this._next))},t.prototype._next=function(){return a(this,void 0,void 0,(function(){var e,t,r,n,a;return i(this,(function(i){switch(i.label){case 0:if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingTile)return this._scheduledNextHandle=null,[2];if(this._scheduledNextHandle=null,e=this._peek(),t=e.abortController.signal,r=e.tileId,n=e.key,h.TileKey.pool.release(n),this._queue.delete(r),this._onGoingTile=e,a=this.process(r,this._timestamp,{signal:t}),this.notifyChange("updating"),!function(e){return e&&"function"==typeof e.then}(a))return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,a];case 2:case 3:return i.sent(),[3,4];case 4:return this._finalize(),[2]}}))}))},t.prototype._peek=function(){var e=this;if(!this.state)throw new Error("state not set");var t=this.tileInfoView,r=this.state.center,n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=null;return this._queue.forEach((function(s){t.getTileCoords(d,s.key);var o=e._timestamp-s.timestamp;if(isNaN(o))(u=c.vec2.distance(d,r))<i&&(i=u,a=s);else if(o===n){var u;(u=c.vec2.distance(d,r))<i&&(i=u,a=s)}else o>n&&(n=o,i=Number.POSITIVE_INFINITY,a=s)})),a},n([l.property({readOnly:!0})],t.prototype,"length",null),n([l.property({constructOnly:!0})],t.prototype,"process",void 0),n([l.property()],t.prototype,"state",void 0),n([l.property({constructOnly:!0})],t.prototype,"tileInfoView",void 0),n([l.property({readOnly:!0})],t.prototype,"updating",null),n([l.subclass("esri.views.2d.layers.features.support.TileUpdateQueue")],t)}(l.declared(s));t.default=f}.apply(null,n))||(e.exports=i)}}]);