(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/support/TilemapCache":1092,"esri/geometry/projection":1100,"esri/layers/support/Tilemap":1118,"esri/geometry/pe":1119,"esri/geometry/support/GeographicTransformation":1120,"esri/geometry/support/GeographicTransformationStep":1121,"esri/layers/support/RasterFunction":1164,"esri/layers/support/rasterFunctions/rasterProjectionHelper":1197,"esri/layers/support/DimensionalDefinition":1235,"esri/layers/support/imageryRendererUtils":1236,"esri/layers/TileImageryLayer":1241,"esri/layers/support/RasterStorageInfo":1242,"esri/layers/support/rasterDatasets/BaseRaster":1243,"esri/layers/support/rasterDatasets/RawBlockCache":1308,"esri/layers/support/RasterJobHandler":1313,"esri/layers/support/rasterDatasets/RasterFactory":1992,"esri/layers/support/rasterDatasets/CloudRaster":1994,"esri/layers/support/rasterDatasets/DBFParser":1995,"esri/layers/support/rasterDatasets/ImageServerRaster":1996,"esri/layers/support/rasterDatasets/MRFRaster":1997,"esri/layers/support/rasterDatasets/xmlUtilities":1998,"esri/layers/support/rasterDatasets/TIFFRaster":1999})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{1092:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(1),r(0),r(8),r(9),r(31),r(11),r(10),r(22),r(6),r(344),r(138),r(4),r(39),r(23),r(16),r(2),r(1118)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,h,d,m,y,_,v,g){Object.defineProperty(t,"__esModule",{value:!0}),t.TILEMAP_SIZE_EXP=5;var x=c.getLogger("esri.layers.support.TilemapCache"),b=function(e){function l(t){var r=e.call(this,t)||this;return r._handles=new p,r._pendingTilemapRequests={},r._availableLevels={},r.levels=5,r.cacheByteSize=2097152,r.request=s,r._prefetchingEnabled=!0,r}var c;return n(l,e),c=l,l.prototype.initialize=function(){var e=this;this._tilemapCache=new f(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(function(){return e._initializeTilemapDefinition()})),_.init(this,"layer.tileInfo.lods",(function(t){return e._initializeAvailableLevels(t)}),!0)]),this._initializeTilemapDefinition()},l.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},l.prototype.castLevels=function(e){return e<=2?(x.error("Minimum levels for Tilemap is 3, but got ",e),3):e},Object.defineProperty(l.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0}),l.prototype.fetchTilemap=function(e,t,n,i){var o=this;if(!this._availableLevels[e])return d.reject(new u("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"));var a=this._tmpTilemapDefinition,s=this._tilemapFromCache(e,t,n,a);if(s)return d.resolve(s);var l=i&&i.signal;return i=r({},i,{signal:null}),d.create((function(e,t){d.onAbort(l,(function(){return t(d.createAbortError())}));var r=g.tilemapDefinitionId(a),n=o._pendingTilemapRequests[r];if(!n){n=g.Tilemap.fromDefinition(a,i).then((function(e){return o._tilemapCache.put(r,e,e.byteSize),e}));var s=function(){return delete o._pendingTilemapRequests[r]};o._pendingTilemapRequests[r]=n,n.then(s,s)}n.then(e,t)}))},l.prototype.getAvailability=function(e,t,r){if(!this._availableLevels[e])return"unavailable";var n=this._tilemapFromCache(e,t,r,this._tmpTilemapDefinition);return n?n.getAvailability(t,r):"unknown"},l.prototype.getAvailabilityUpsample=function(e,t,r,n){n.level=e,n.row=t,n.col=r;var i=this.layer.tileInfo;for(i.updateTileInfo(n);;){var o=this.getAvailability(n.level,n.row,n.col);if("unavailable"!==o)return o;if(!i.upsampleTile(n))return"unavailable"}},l.prototype.fetchAvailability=function(e,t,r,n){return this._availableLevels[e]?this.fetchTilemap(e,t,r,n).catch((function(e){return e})).then((function(n){if(n instanceof g.Tilemap){var i=n.getAvailability(t,r);return"unavailable"===i?d.reject(new u("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:r})):i}if(d.isAbortError(n))throw n;return"unknown"})):d.reject(new u("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"))},l.prototype.fetchAvailabilityUpsample=function(e,t,r,n,i){var o=this;n.level=e,n.row=t,n.col=r;var a=this.layer.tileInfo;a.updateTileInfo(n);var s=this.fetchAvailability(e,t,r,i).catch((function(e){if(d.isAbortError(e))throw e;if(a.upsampleTile(n))return o.fetchAvailabilityUpsample(n.level,n.row,n.col,n);throw e}));return this._fetchAvailabilityUpsamplePrefetch(n.id,e,t,r,i,s),s},l.prototype._fetchAvailabilityUpsamplePrefetch=function(e,t,n,i,s,l){return a(this,void 0,void 0,(function(){var a,u,p,f,h,y,_,v,g,x;return o(this,(function(o){switch(o.label){case 0:if(!this._prefetchingEnabled)return[2];if(a="prefetch-"+e,this._handles.has(a))return[2];u=d.createAbortController(),l.then((function(){return u.abort()}),(function(){return u.abort()})),p=!1,f={remove:function(){p||(p=!0,u.abort())}},this._handles.add(f,a),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,m.waitTicks(10,u.signal)];case 2:case 3:return o.sent(),[3,4];case 4:if(p||(p=!0,this._handles.remove(a)),d.isAborted(u))return[2];for(h={id:e,level:t,row:n,col:i},y=r({},s,{signal:u.signal}),_=this.layer.tileInfo,v=function(e){var t=g.fetchAvailability(h.level,h.row,h.col,y);c._prefetches.push(t);var r=function(){c._prefetches.removeUnordered(t)};t.then(r,r)},g=this,x=0;c._prefetches.length<c._maxPrefetch&&_.upsampleTile(h);++x)v();return[2]}}))}))},l.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?y.objectToQuery(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}},l.prototype._tilemapFromCache=function(e,t,r,n){var i=this._getTilemapDefinition(e,t,r,n),o=g.tilemapDefinitionId(i);return this._tilemapCache.get(o)},l.prototype._getTilemapDefinition=function(e,r,n,i){i.level=e;var o=e>t.TILEMAP_SIZE_EXP;return i.row=o?r-r%this.size:r,i.col=o?n-n%this.size:n,i},l.prototype._initializeAvailableLevels=function(e){var t=this;this._availableLevels={},e&&e.forEach((function(e){return t._availableLevels[e.level]=!0}))},Object.defineProperty(l.prototype,"test",{get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,r,n){return!!e._tilemapFromCache(t,r,n,e._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0}),l._maxPrefetch=4,l._prefetches=new h({initialSize:c._maxPrefetch}),i([v.property({constructOnly:!0,type:Number})],l.prototype,"levels",void 0),i([v.cast("levels")],l.prototype,"castLevels",null),i([v.property({readOnly:!0,dependsOn:["levels"],type:Number})],l.prototype,"size",null),i([v.property({constructOnly:!0,type:Number})],l.prototype,"cacheByteSize",void 0),i([v.property({constructOnly:!0})],l.prototype,"layer",void 0),i([v.property({constructOnly:!0})],l.prototype,"request",void 0),c=i([v.subclass("esri.layers.support.TilemapCache")],l)}(v.declared(l));t.TilemapCache=b}.apply(null,n))||(e.exports=i)},1100:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(4),r(1119),r(24),r(1120)],void 0===(i=function(e,t,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=null;t.isLoaded=function(){return!!s&&i.isLoaded()},t.isSupported=function(){return i.isSupported()};var l=null;t.load=function(){return l||(l=n.create((function(e,t){var n=i.load();r.e(7).then((function(){var o=[r(1091)];(function(r){s=r,n.then((function(){s._enableProjection(i),e()}),(function(e){t(e)}))}).apply(null,o)})).catch(r.oe)})))},t.project=function(e,t,r){return void 0===r&&(r=null),e instanceof Array?0===e.length?[]:p(e,e[0].spatialReference,t,r):p([e],e.spatialReference,t,r)[0]};var u={};function p(e,t,r,n,i){if(void 0===n&&(n=null),void 0===i&&(i=!1),null===n){var l=a.cacheKey(t,r);void 0!==u[l]?n=u[l]:(null===(n=c(t,r,null))&&(n=new a),u[l]=n)}return s._project(e,t,r instanceof o||!1===i?r:new o(r),n,i)}function c(e,t,r){void 0===r&&(r=null);var n=s._getTransformation(e,t,r);return null!==n?a.fromGE(n):null}t.projectMany=p,t.getTransformation=c,t.getTransformations=function(e,t,r){void 0===r&&(r=null);var n=s._getTransformationBySuitability(e,t,r);if(null!==n){for(var i=[],o=0,l=n;o<l.length;o++){var u=l[o];i.push(a.fromGE(u))}return i}return[]}}.apply(null,n))||(e.exports=i)},1118:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(31),r(25),r(10),r(7)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}return e.prototype.getAvailability=function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var r=(e-this.location.top)*this.location.width+(t-this.location.left),n=r%8,i=r>>3,o=this._tileAvailabilityBitSet;return i<0||i>o.length?"unknown":o[i]&1<<n?"available":"unavailable"},e.prototype._updateFromData=function(e){for(var t=this.location.width,r=this.location.height,n=!0,i=!0,o=Math.ceil(t*r/8),a=new Uint8Array(o),s=0,l=0;l<e.length;l++){var u=l%8;e[l]?(i=!1,a[s]|=1<<u):n=!1,7===u&&++s}i?this._allAvailability="unavailable":n?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=a,this.byteSize+=a.length)},e.fromDefinition=function(t,a){var s=t.service.request||n,u=t.row,p=t.col,c=t.width,f=t.height,h={query:{f:"json"}};return a=a?r({},h,a):h,s(l(t),a).then((function(e){return e.data})).catch((function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:u,left:p,width:c,height:f},valid:!0,data:i.constant(c*f,0)};throw e})).then((function(t){if(t.location&&(t.location.top!==u||t.location.left!==p||t.location.width!==c||t.location.height!==f))throw new o("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:u,left:p,width:c,height:f}});return e.fromJSON(t)}))},e.fromJSON=function(t){e.validateJSON(t);var r=new e;return r.location=Object.freeze(a.clone(t.location)),r._updateFromData(t.data),Object.freeze(r)},e.validateJSON=function(e){if(!e||!e.location)throw new o("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new o("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new o("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new o("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new o("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")},e}();function l(e){var t;if("vector-tile"===e.service.type)t=e.service.url+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height;else{var r=e.service.tileServers;t=(r&&r.length?r[e.row%r.length]:e.service.url)+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height}var n=e.service.query;return n&&(t=t+"?"+n),t}t.Tilemap=s,t.tilemapDefinitionId=function(e){return e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height},t.tilemapDefinitionUrl=l,t.default=s}.apply(null,n))||(e.exports=i)},1119:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(17),r(15),r(4)],void 0===(i=function(e,t,n,i,o){var a,s,l,u,p,c;function f(e){function r(e,t,r){e[t]=r(e[t])}t._pe=e,s.init(),l.init(),u.init(),p.init(),c.init(),t.PeGCSExtent=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n(r,e),r.prototype.destroy=function(){t._pe.destroy(this)},r}(t._pe.PeGCSExtent);for(var i=0,o=[t._pe.PeDatum,t._pe.PeGeogcs,t._pe.PeGeogtran,t._pe.PeObject,t._pe.PeParameter,t._pe.PePrimem,t._pe.PeProjcs,t._pe.PeSpheroid,t._pe.PeUnit];i<o.length;i++)r(o[i].prototype,"getName",(function(e){return function(){return e.call(this,new Array(s.PE_NAME_MAX))}}));for(var a=0,f=[t._pe.PeGeogtran,t._pe.PeProjcs];a<f.length;a++)r(f[a].prototype,"getParameters",(function(e){return function(){for(var r=new Array(s.PE_PARM_MAX),n=e.call(this),i=0;i<r.length;i++){var o=t._pe.getValue(n,"*");r[i]=o?t._pe.wrapPointer(o,t._pe.PeParameter):null,n+=Int32Array.BYTES_PER_ELEMENT}return r}}));r(t._pe.PeHorizon.prototype,"getCoord",(function(e){return function(){var t=this.getSize();if(!t)return null;var r=[];return y(r,t,e.call(this)),r}})),r(t._pe.PeGTlistExtendedEntry.prototype,"getEntries",(function(e){var r=t._pe._pe_getPeGTlistExtendedGTsSize();return function(){var n=null,i=e.call(this);if(!t._pe.compare(i,t._pe.NULL)){n=[i];var o=this.getSteps();if(o>1)for(var a=t._pe.getPointer(i),s=1;s<o;s++)n.push(t._pe.wrapPointer(a+r*s,t._pe.PeGTlistExtendedGTs))}return n}}));var h=t._pe._pe_getPeHorizonSize(),d=function(e){return function(){var r=this._cache;if(r||(r=new Map,this._cache=r),r.has(e))return r.get(e);var n=null,i=e.call(this);if(!t._pe.compare(i,t._pe.NULL)){n=[i];var o=i.getNump();if(o>1)for(var a=t._pe.getPointer(i),s=1;s<o;s++)n.push(t._pe.wrapPointer(a+h*s,t._pe.PeHorizon))}return r.set(e,n),n}};r(t._pe.PeProjcs.prototype,"horizonGcsGenerate",d),r(t._pe.PeProjcs.prototype,"horizonPcsGenerate",d),t._pe.PeObject.prototype.toString=function(e){void 0===e&&(e=s.PE_STR_OPTS_NONE),t._pe.ensureCache.prepare();var r=t._pe.getPointer(this),n=t._pe.ensureInt8(new Array(s.PE_BUFFER_MAX));return t._pe.UTF8ToString(t._pe._pe_object_to_string_ext(r,e,n))}}function h(e){if(e){var r=t._pe.getClass(e);if(r){var n=t._pe.getCache(r);if(n){var i=t._pe.getPointer(e);i&&delete n[i]}}}}function d(e,r){for(var n=[],i=new Array(r),o=0;o<e;o++)n.push(t._pe.ensureInt8(i));return n}function m(e){var t;return Array.isArray(e[0])?(t=[],e.forEach((function(e){t.push(e[0],e[1])}))):t=e,t}function y(e,r,n,i){if(void 0===i&&(i=!1),i)for(var o=0;o<2*r;o++)e[o]=t._pe.getValue(n+o*Float64Array.BYTES_PER_ELEMENT,"double");else{var a=0===e.length;for(o=0;o<r;o++)a&&(e[o]=new Array(2)),e[o][0]=t._pe.getValue(n,"double"),e[o][1]=t._pe.getValue(n+Float64Array.BYTES_PER_ELEMENT,"double"),n+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(t,"__esModule",{value:!0}),t._pe=null,t.isLoaded=function(){return!!t._pe},t.isSupported=function(){return!!i("esri-wasm")},t.load=function(){return a||(a=o.create((function(t,n){Promise.all([r.e(36),r.e(71)]).then((function(){var i=[r(1200)];(function(r){r({locateFile:function(t){return e.toUrl("./support/"+t)},onAbort:function(e){n(new Error(e))}}).then((function(e){f(e),t()}))}).apply(null,i)})).catch(r.oe)})))},function(e){function r(e,r,n){t._pe.ensureCache.prepare();var i=m(n),o=n===i,a=t._pe.ensureFloat64(i),s=t._pe._pe_geog_to_proj(t._pe.getPointer(e),r,a);return s&&y(n,r,a,o),s}function n(e,t,r){return i(e,t,r,0)}function i(e,r,n,i){t._pe.ensureCache.prepare();var o=m(n),a=n===o,s=t._pe.ensureFloat64(o),l=t._pe._pe_proj_to_geog_center(t._pe.getPointer(e),r,s,i);return l&&y(n,r,s,a),l}e.geogToProj=r,e.projGeog=function(e,t,i,o){switch(o){case s.PE_TRANSFORM_P_TO_G:return n(e,t,i);case s.PE_TRANSFORM_G_TO_P:return r(e,t,i)}return 0},e.projToGeog=n,e.projToGeogCenter=i}(t.PeCSTransformations||(t.PeCSTransformations={})),function(e){e.init=function(){e.PE_BUFFER_MAX=t._pe.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=t._pe.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=t._pe.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=t._pe.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=t._pe.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=t._pe.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=t._pe.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=t._pe.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=t._pe.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=t._pe.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=t._pe.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=t._pe.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=t._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=t._pe.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=t._pe.PeDefs.prototype.PE_TYPE_UNIT,e.PE_STR_OPTS_NONE=t._pe.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=t._pe.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=t._pe.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=t._pe.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=t._pe.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=t._pe.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=t._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=t._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=t._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=t._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=t._pe.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=t._pe.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=t._pe.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=t._pe.PeDefs.prototype.PE_HORIZON_DELTA}}(s=t.PeDefs||(t.PeDefs={})),function(e){var r={},n={};function i(e,n){var i=null,a=r[e];if(a||(a={},r[e]=a),a.hasOwnProperty(String(n)))i=a[n];else{var s=t._pe.PeFactory.prototype.factoryByType(e,n);t._pe.compare(s,t._pe.NULL)||(i=s,a[n]=i)}return o(i)}function o(e){if(e){var r=e.getType();switch(r){case s.PE_TYPE_GEOGCS:e=t._pe.castObject(e,t._pe.PeGeogcs);break;case s.PE_TYPE_PROJCS:e=t._pe.castObject(e,t._pe.PeProjcs);break;case s.PE_TYPE_GEOGTRAN:e=t._pe.castObject(e,t._pe.PeGeogtran);break;default:r&s.PE_TYPE_UNIT&&(e=t._pe.castObject(e,t._pe.PeUnit))}}return e}e.initialize=function(){t._pe.PeFactory.prototype.initialize(null)},e.coordsys=function(e){return i(s.PE_TYPE_COORDSYS,e)},e.factoryByType=i,e.fromString=function(e,r){var i=null,a=n[e];if(a||(a={},n[e]=a),a.hasOwnProperty(r))i=a[r];else{var s=t._pe.PeFactory.prototype.fromString(e,r);t._pe.compare(s,t._pe.NULL)||(i=s,a[r]=i)}return o(i)},e.geogcs=function(e){return i(s.PE_TYPE_GEOGCS,e)},e.geogtran=function(e){return i(s.PE_TYPE_GEOGTRAN,e)},e.getCode=function(e){return t._pe.PeFactory.prototype.getCode(e)},e.projcs=function(e){return i(s.PE_TYPE_PROJCS,e)},e.unit=function(e){return i(s.PE_TYPE_UNIT,e)}}(t.PeFactory||(t.PeFactory={})),t.PeGCSExtent=null,function(e){var r;e.init=function(){e.PE_GTLIST_OPTS_COMMON=t._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,r=t._pe._pe_getPeGTlistExtendedEntrySize()},e.getGTlist=function(e,n,i,o,a,s){var l=null,u=new t._pe.PeInteger(s);try{var p=t._pe.PeGTlistExtended.prototype.getGTlist(e,n,i,o,a,u);if((s=u.val)&&(l=[p],s>1))for(var c=t._pe.getPointer(p),f=1;f<s;f++)l.push(t._pe.wrapPointer(c+r*f,t._pe.PeGTlistExtendedEntry))}finally{t._pe.destroy(u)}return l}}(l=t.PeGTlistExtended||(t.PeGTlistExtended={})),function(e){e.destroy=function(e){if(e&&e.length){for(var r=0,n=e;r<n.length;r++){var i=n[r];h(i),i.getEntries().forEach((function(e){h(e);var t=e.getGeogtran();h(t),t.getParameters().forEach(h),[t.getGeogcs1(),t.getGeogcs2()].forEach((function(e){h(e);var t=e.getDatum();h(t),h(t.getSpheroid()),h(e.getPrimem()),h(e.getUnit())}))}))}t._pe.PeGTlistExtendedEntry.prototype.Delete(e[0])}}}(t.PeGTlistExtendedEntry||(t.PeGTlistExtendedEntry={})),function(e){e.geogToGeog=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=m(n),s=n===a,l=t._pe.ensureFloat64(a),u=0;i&&(u=t._pe.ensureFloat64(i));var p=t._pe._pe_geog_to_geog(t._pe.getPointer(e),r,l,u,o);return p&&y(n,r,l,s),p}}(t.PeGTTransformations||(t.PeGTTransformations={})),function(e){function r(e,r,n,i,o,a){var l,u;switch(t._pe.ensureCache.prepare(),e){case"dd":l=t._pe._pe_geog_to_dd,u=s.PE_DD_MAX;break;case"ddm":l=t._pe._pe_geog_to_ddm,u=s.PE_DDM_MAX;break;case"dms":l=t._pe._pe_geog_to_dms,u=s.PE_DMS_MAX}var p=0;r&&(p=t._pe.getPointer(r));var c=m(i),f=t._pe.ensureFloat64(c),h=d(n,u),y=l(p,n,f,o,t._pe.ensureInt32(h));if(y)for(var _=0;_<n;_++)a[_]=t._pe.UTF8ToString(h[_]);return y}function n(e,r,n,i,o){var a;switch(t._pe.ensureCache.prepare(),e){case"dd":a=t._pe._pe_dd_to_geog;break;case"ddm":a=t._pe._pe_ddm_to_geog;break;case"dms":a=t._pe._pe_dms_to_geog}var s=0;r&&(s=t._pe.getPointer(r));var l=i.map((function(e){return t._pe.ensureString(e)})),u=t._pe.ensureInt32(l),p=t._pe.ensureFloat64(new Array(2*n)),c=a(s,n,u,p);return c&&y(o,n,p),c}e.geog_to_dms=function(e,t,n,i,o){return r("dms",e,t,n,i,o)},e.dms_to_geog=function(e,t,r,i){return n("dms",e,t,r,i)},e.geog_to_ddm=function(e,t,n,i,o){return r("ddm",e,t,n,i,o)},e.ddm_to_geog=function(e,t,r,i){return n("ddm",e,t,r,i)},e.geog_to_dd=function(e,t,n,i,o){return r("dd",e,t,n,i,o)},e.dd_to_geog=function(e,t,r,i){return n("dd",e,t,r,i)}}(t.PeNotationDms||(t.PeNotationDms={})),function(e){e.init=function(){e.PE_MGRS_STYLE_NEW=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=t._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=t._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},e.geog_to_mgrs_extended=function(e,r,n,i,o,a,l){t._pe.ensureCache.prepare();var u=0;e&&(u=t._pe.getPointer(e));var p=m(n),c=t._pe.ensureFloat64(p),f=d(r,s.PE_MGRS_MAX),h=t._pe.ensureInt32(f),y=t._pe._pe_geog_to_mgrs_extended(u,r,c,i,o,a,h);if(y)for(var _=0;_<r;_++)l[_]=t._pe.UTF8ToString(f[_]);return y},e.mgrs_to_geog_extended=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=0;e&&(a=t._pe.getPointer(e));var s=n.map((function(e){return t._pe.ensureString(e)})),l=t._pe.ensureInt32(s),u=t._pe.ensureFloat64(new Array(2*r)),p=t._pe._pe_mgrs_to_geog_extended(a,r,l,i,u);return p&&y(o,r,u),p}}(u=t.PeNotationMgrs||(t.PeNotationMgrs={})),function(e){e.geog_to_usng=function(e,r,n,i,o,a,l){t._pe.ensureCache.prepare();var u=0;e&&(u=t._pe.getPointer(e));var p=m(n),c=t._pe.ensureFloat64(p),f=d(r,s.PE_MGRS_MAX),h=t._pe.ensureInt32(f),y=t._pe._pe_geog_to_usng(u,r,c,i,o,a,h);if(y)for(var _=0;_<r;_++)l[_]=t._pe.UTF8ToString(f[_]);return y},e.usng_to_geog=function(e,r,n,i){t._pe.ensureCache.prepare();var o=0;e&&(o=t._pe.getPointer(e));var a=n.map((function(e){return t._pe.ensureString(e)})),s=t._pe.ensureInt32(a),l=t._pe.ensureFloat64(new Array(2*r)),u=t._pe._pe_usng_to_geog(o,r,s,l);return u&&y(i,r,l),u}}(t.PeNotationUsng||(t.PeNotationUsng={})),function(e){e.init=function(){e.PE_UTM_OPTS_NONE=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS},e.geog_to_utm=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=0;e&&(a=t._pe.getPointer(e));var l=m(n),u=t._pe.ensureFloat64(l),p=d(r,s.PE_UTM_MAX),c=t._pe.ensureInt32(p),f=t._pe._pe_geog_to_utm(a,r,u,i,c);if(f)for(var h=0;h<r;h++)o[h]=t._pe.UTF8ToString(p[h]);return f},e.utm_to_geog=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=0;e&&(a=t._pe.getPointer(e));var s=n.map((function(e){return t._pe.ensureString(e)})),l=t._pe.ensureInt32(s),u=t._pe.ensureFloat64(new Array(2*r)),p=t._pe._pe_utm_to_geog(a,r,l,i,u);return p&&y(o,r,u),p}}(p=t.PeNotationUtm||(t.PeNotationUtm={})),function(e){var r=new Map;e.init=function(){e.PE_PCSINFO_OPTION_NONE=t._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=t._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=t._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=t._pe.PePCSInfo.prototype.PE_POLE_POINT},e.generate=function(n,i){var o,a;return void 0===i&&(i=e.PE_PCSINFO_OPTION_DOMAIN),r.has(n)&&(a=r.get(n))[i]&&(o=a[i]),o||(o=t._pe.PePCSInfo.prototype.generate(n,i),a||(a=[],r.set(n,a)),a[i]=o),o}}(c=t.PePCSInfo||(t.PePCSInfo={})),function(e){e.version_string=function(){return t._pe.PeVersion.prototype.version_string()}}(t.PeVersion||(t.PeVersion={})),t._init=f}.apply(null,n))||(e.exports=i)},1120:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1121)],void 0===(i=function(e,t,r){return function(){function e(e){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(var t=0,n=e.steps;t<n.length;t++){var i=n[t];i instanceof r?this.steps.push(i):this.steps.push(new r({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}}return e.cacheKey=function(e,t){return[void 0!==e.wkid&&null!==e.wkid?e.wkid.toString():"-1",void 0!==e.wkt&&null!==e.wkt?e.wkt.toString():"",void 0!==t.wkid&&null!==t.wkid?t.wkid.toString():"-1",void 0!==t.wkt&&null!==t.wkt?t.wkt.toString():""].join(",")},e.fromGE=function(t){for(var n=new e,i="",o=0,a=t.steps;o<a.length;o++){var s=a[o],l=r.fromGE(s);n.steps.push(l),i+=l.uid.toString()+","}return n._cached_projection={},n._gtlistentry=null,n._chain=i,n},e.prototype.getInverse=function(){var t=new e;t.steps=[];for(var r=this.steps.length-1;r>=0;r--){var n=this.steps[r];t.steps.push(n.getInverse())}return t},e.prototype.getGTListEntry=function(){for(var e="",t=0,r=this.steps;t<r.length;t++)e+=r[t].uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=e),this._gtlistentry},e.prototype.assignCachedGe=function(t,r,n){this._cached_projection[e.cacheKey(t,r)]=n},e.prototype.getCachedGeTransformation=function(t,r){for(var n="",i=0,o=this.steps;i<o.length;i++)n+=o[i].uid.toString()+",";n!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=n);var a=this._cached_projection[e.cacheKey(t,r)];return void 0===a?null:a},e}()}.apply(null,n))||(e.exports=i)},1121:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r=0;return function(){function e(e){void 0===e&&(e=null),this.uid=r++,e?(this._wkt=void 0!==e.wkt?e.wkt:null,this._wkid=void 0!==e.wkid?e.wkid:-1,this._isInverse=void 0!==e.isInverse&&!0===e.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}return e.fromGE=function(t){var r=new e;return r._wkt=t.wkt,r._wkid=t.wkid,r._isInverse=t.isInverse,r},Object.defineProperty(e.prototype,"wkt",{get:function(){return this._wkt},set:function(e){this._wkt=e,this.uid=r++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wkid",{get:function(){return this._wkid},set:function(e){this._wkid=e,this.uid=r++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInverse",{get:function(){return this._isInverse},set:function(e){this._isInverse=e,this.uid=r++},enumerable:!0,configurable:!0}),e.prototype.getInverse=function(){var t=new e;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t},e}()}.apply(null,n))||(e.exports=i)},1164:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(0),r(3),r(7),r(65),r(2)],void 0===(i=function(e,t,r,n,i,o,a,s){var l,u=a.createSetFromValues(["Raster","Raster2","DEM","FillRaster"]),p=a.createSetFromValues(["Rasters"]),c=function(e){return e&&e.rasterFunction?h.fromJSON(e):e},f=function(e){return e&&e instanceof h?e.toJSON():e};!function(e){e[e.MOSAIC=0]="MOSAIC",e[e.GROUP=1]="GROUP",e[e.ITEM=2]="ITEM"}(l||(l={}));var h=function(e){function t(t){var r=e.call(this,t)||this;return r.functionArguments=null,r.functionName=null,r.outputPixelType="unknown",r.variableName=null,r.description=null,r.functionDefinition=null,r.thumbnail=null,r}var i;return r(t,e),i=t,t.prototype.readFunctionArguments=function(e,t){return function(e){if(null==e)return null;for(var t={},r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];u.has(i)?t[i]=c(e[i]):p.has(i)&&Array.isArray(e[i])?t[i]=e[i].map(c):t[i]=e[i]}return t}(t.arguments||t.rasterFunctionArguments)},t.prototype.writeFunctionArguments=function(e,t,r){for(var n={},i=0,o=Object.keys(e);i<o.length;i++){var a=o[i];u.has(a)?n[a]=f(e[a]):p.has(a)&&Array.isArray(e[a])?n[a]=e[a].map(f):n[a]=f(e[a])}this.functionDefinition?t.arguments=n:t[r]=n},t.prototype.readFunctionName=function(e,t){var r=t.rasterFunctionInfos;return t.name||(r&&r.length&&"None"!==r[0].name?r[0].name:t.rasterFunction)},t.prototype.writeFunctionName=function(e,t,r){this.functionDefinition?t.name=e:t[r]=e},t.prototype.readFunctionType=function(e){return l[e]},t.prototype.writeFunctionType=function(e,t,r){t[r]=l[e]},t.prototype.clone=function(){return new i({functionName:this.functionName,functionArguments:o.clone(this.functionArguments),outputPixelType:this.outputPixelType,variableName:this.variableName,name:this.functionName,description:this.description,functionType:this.functionType,functionDefinition:this.functionDefinition,thumbnail:this.thumbnail})},n([s.property({json:{type:Object,write:{target:"rasterFunctionArguments"}}})],t.prototype,"functionArguments",void 0),n([s.reader("functionArguments",["rasterFunctionArguments","arguments"])],t.prototype,"readFunctionArguments",null),n([s.writer("functionArguments")],t.prototype,"writeFunctionArguments",null),n([s.property({json:{type:String,write:{target:"rasterFunction"}}})],t.prototype,"functionName",void 0),n([s.reader("functionName",["rasterFunction","rasterFunctionInfos","name"])],t.prototype,"readFunctionName",null),n([s.writer("functionName")],t.prototype,"writeFunctionName",null),n([s.enumeration.serializable()({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1}),s.property({json:{default:"unknown"}})],t.prototype,"outputPixelType",void 0),n([s.property({type:String,json:{read:!0,write:!0}})],t.prototype,"variableName",void 0),n([s.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"description",void 0),n([s.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"functionType",void 0),n([s.reader("functionType")],t.prototype,"readFunctionType",null),n([s.writer("functionType")],t.prototype,"writeFunctionType",null),n([s.property({type:Object,json:{read:{source:"function"},write:{target:"function"},origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"functionDefinition",void 0),n([s.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"thumbnail",void 0),i=n([s.subclass("esri.layers.support.RasterFunction")],t)}(s.declared(i.JSONSupport));return h}.apply(null,n))||(e.exports=i)},1197:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(0),r(8),r(9),r(5),r(18),r(10),r(1100),r(37),r(35)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c){Object.defineProperty(t,"__esModule",{value:!0});var f=function(e,t){var r=(e.isWGS84||e.isWebMercator)&&(t.isWGS84||t.isWebMercator);return!(e.equals(t)||r)};t.defaultGridSpacing=32,t.load=function(){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return u.isLoaded()||!u.isSupported()?[2,null]:[4,u.load()];case 1:return e.sent(),[2]}}))}))},t.projectResolution=function(e,t,r,n){if(void 0===n&&(n=null),e.spatialReference.equals(t))return e;var i=f(e.spatialReference,t);if(i&&!u.isLoaded())throw new l("rasterprojectionhelper-projectResolution","projection engine is not loaded");var o=r.center,a=new s.Extent({xmin:o.x-e.x/2,xmax:o.x+e.x/2,ymin:o.y-e.y/2,ymax:o.y+e.y/2,spatialReference:e.spatialReference}),p=i?u.project(a,t,n):c.project(a,t);return null==p?null:new s.Point(p.xmax-p.xmin,p.ymax-p.ymin,t)},t.projectPoint=function(e,t,r){if(void 0===r&&(r=null),e.spatialReference.equals(t))return e;var n=f(e.spatialReference,t);if(n&&!u.isLoaded())throw new l("rasterprojectionhelper-projectResolution","projection engine is not loaded");return n?u.project(e,t,r):c.project(e,t)},t.projectExtent=function(e,t,r){if(void 0===r&&(r=null),e.spatialReference.equals(t))return e;var n=f(e.spatialReference,t);if(n&&!u.isLoaded())throw new l("rasterprojectionhelper-projectExtent","projection engine is not loaded");return n?u.project(e,t,r):c.project(e,t)},t.getProjectionOffsetGrid=function(e,r,n,i,o,a){void 0===i&&(i=null),void 0===o&&(o=!1),void 0===a&&(a=[t.defaultGridSpacing,t.defaultGridSpacing]);var h=r.spatialReference.equals(e.spatialReference),d=f(e.spatialReference,r.spatialReference);if(d&&!u.isLoaded())throw new l("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(e&&r&&n))return null;for(var m,y,_,v=e.xmin,g=e.ymin,x=e.xmax,b=e.ymax,w=e.spatialReference,P=r.spatialReference,T=p.getInfo(w),S=T&&T.valid[0],I=T&&T.valid[1],E={x:a[0]*n.x,y:a[1]*n.y},R={cols:Math.ceil((x-v)/E.x-.1)+1,rows:Math.ceil((b-g)/E.y-.1)+1},O=E.x,M=E.y,N=[],A=!1,C=0;C<R.cols;C++){for(var k=[],D=0;D<R.rows;D++)m=new s.Point({x:v+O*C,y:b-M*D,spatialReference:w}),y=h?m:d?u.project(m,P,i):c.project(m,P),k.push(y),C>0&&o&&y&&_[D]&&T&&y.x<_[D].x&&(y.x+=I-S),y?(N.push((y.x-r.xmin)/(r.xmax-r.xmin)),N.push((r.ymax-y.y)/(r.ymax-r.ymin))):(N.push(NaN),N.push(NaN),A=!0);_=k}var F=function(e,t){var r=(e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4,n=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4;return[Math.abs(r-e[2*t.rows+2]),Math.abs(n-e[2*t.rows+3])]}(N,R),j=new Float32Array((R.cols-1)*(R.rows-1)*2*6),L=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),z=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(C=0;C<R.cols-1;C++){for(D=0;D<R.rows-1;D++){for(var B=C*R.rows*2+2*D,G=N[B],U=N[B+1],H=N[B+2],J=N[B+3],q=N[B+=2*R.rows],V=N[B+1],Y=N[B+2],W=N[B+3],X=0,Z=12*(D*(R.cols-1)+C),K=0;K<3;K++)j[Z++]=L[X++]*G+L[X++]*H+L[X++]*Y;for(X=0,K=0;K<3;K++)j[Z++]=L[X++]*U+L[X++]*J+L[X++]*W;for(X=0,K=0;K<3;K++)j[Z++]=z[X++]*G+z[X++]*q+z[X++]*Y;for(X=0,K=0;K<3;K++)j[Z++]=z[X++]*U+z[X++]*V+z[X++]*W}if(A)for(var Q=0;Q<j.length;Q++)isNaN(j[Q])&&(j[Q]=-1)}return{offsets:N,error:F,coefficients:j,spacing:a,size:[R.cols-1,R.rows-1]}},t.snapPyramid=function(e,t,r){var n=Math.log(e.x/t.pixelSize.x)/Math.LN2,i=Math.log(e.y/t.pixelSize.y)/Math.LN2,o=t.storageInfo.maximumPyramidLevel||0,a="down"===r?Math.floor(Math.min(n,i)):"up"===r?Math.ceil(Math.max(n,i)):Math.round((n+i)/2),l=!1;a<0?a=0:a>o&&(l=a>o+3,a=o);var u=Math.pow(2,a);return{pyramidLevel:a,pyramidResolution:new s.Point({x:u*t.pixelSize.x,y:u*t.pixelSize.y,spatialReference:t.spatialReference}),excessiveReading:l}}}.apply(null,n))||(e.exports=i)},1235:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(0),r(3),r(7),r(2),r(14)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.variableName=null,r.dimensionName=null,r.values=[],r.isSlice=!1,r}var i;return r(t,e),i=t,t.prototype.clone=function(){return new i({variableName:this.variableName,dimensionName:this.dimensionName,values:o.clone(this.values),isSlice:this.isSlice})},n([a.property({type:String,json:{write:!0}})],t.prototype,"variableName",void 0),n([a.property({type:String,json:{write:!0}})],t.prototype,"dimensionName",void 0),n([a.property({type:s.types.array(s.types.oneOf([s.types.native(Number),s.types.array(s.types.native(Number))])),json:{write:!0}})],t.prototype,"values",void 0),n([a.property({type:Boolean,json:{write:!0}})],t.prototype,"isSlice",void 0),i=n([a.subclass("esri.layers.support.DimensionalDefinition")],t)}(a.declared(i.JSONSupport))}.apply(null,n))||(e.exports=i)},1236:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1190),r(25),r(7),r(1164),r(1227),r(1286)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},u={type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]};t.isSupportedRendererType=function(e){var t=e.type;return"raster-stretch"===t||"unique-value"===t||"class-breaks"===t},t.combineRenderingRules=function(e,t){if(!e||!t)return i.clone(e||t);var r=i.clone(e);return"none"!==t.functionName.toLowerCase()&&((function e(t){var r=t.Raster;return r&&"esri.layers.support.RasterFunction"===r.declaredClass?e(r.functionArguments):t}(r.functionArguments)).Raster=t),r},t.convertRendererToRenderingRule=function(e,t){switch(t=t||{},e.type){case"raster-stretch":return function(e,t){var r=new o;r.functionName="Stretch";var n=p[s.stretchTypeJSONDict.toJSON(e.stretchType)],i={StretchType:n,Statistics:e.statistics,DRA:e.dynamicRangeAdjustment,UseGamma:e.useGamma,Gamma:e.gamma,ComputeGamma:e.computeGamma};if(null!=e.outputMin&&(i.Min=e.outputMin),null!=e.outputMax&&(i.Max=e.outputMax),n===p.standardDeviation?(i.NumberOfStandardDeviations=e.numberOfStandardDeviations,r.outputPixelType="u8"):n===p.percentClip?(i.MinPercent=e.minPercent,i.MaxPercent=e.maxPercent,r.outputPixelType="u8"):n===p.minMax?r.outputPixelType="u8":n===p.sigmoid&&(i.SigmoidStrengthLevel=e.sigmoidStrengthLevel),r.functionArguments=i,r.variableName="Raster",e.colorRamp){var l=e.colorRamp,u=new o,c=a.getColorRampName(l);return c?u.functionArguments={colorRamp:c}:!t.convertColorRampToColormap||"algorithmic"!==l.type&&"multipart"!==l.type?u.functionArguments={colorRamp:e.colorRamp.toJSON()}:u.functionArguments={Colormap:a.convertColorRampToColormap(l,256)},u.variableName="Raster",u.functionName="Colormap",u.functionArguments.Raster=r,u}return r}(e,t);case"class-breaks":return function(e,t){var r=[],n=[],i=[],a=[],s=t.pixelType,l=t.rasterAttributeTable,u=l&&l.features,p=f(l);if(u&&Array.isArray(u)&&e.classBreakInfos){e.classBreakInfos.forEach((function(t,r){var n,i=t.symbol.color;i.a&&u.forEach((function(o){((n=o.attributes[e.field])>=t.minValue&&n<t.maxValue||r===e.classBreakInfos.length-1&&n>=t.minValue)&&a.push([o.attributes[p],i.r,i.g,i.b])}))}));var h=s?c(a,s):a,d=new o;return d.functionName="Colormap",d.functionArguments={},d.functionArguments.Colormap=h,d.variableName="Raster",d}e.classBreakInfos.forEach((function(e,t){var o=e.symbol&&e.symbol.color;o.a?(0===t?r.push(e.minValue,e.maxValue+1e-6):r.push(e.minValue+1e-6,e.maxValue+1e-6),n.push(t),a.push([t,o.r,o.g,o.b])):i.push(e.minValue,e.maxValue)}));var m=s?c(a,s):a,y=new o;y.functionName="Remap",y.functionArguments={InputRanges:r,OutputValues:n,NoDataRanges:i},y.variableName="Raster";var _=new o;return _.functionName="Colormap",_.functionArguments={Colormap:m,Raster:y},_}(e,t);case"unique-value":return function(e,t){var r=[],n=t.pixelType,i=t.rasterAttributeTable,a=i&&i.features,s=f(i),l=!1;if(e.uniqueValueInfos&&e.uniqueValueInfos.forEach((function(t){var n=t.symbol.color;n.a&&(e.field!==s&&a?a&&a.forEach((function(i){String(i.attributes[e.field])===String(t.value)&&r.push([i.attributes[s],n.r,n.g,n.b])})):isNaN(t.value)?l=!0:r.push([t.value,n.r,n.g,n.b]))})),l)return null;var u=n&&r.length>0?c(r,n):r,p=new o;return p.functionName="Colormap",p.functionArguments={},p.functionArguments.Colormap=u,p.variableName="Raster",p}(e,t);case"raster-colormap":return function(e,t){var r=e.extractColormap();if(r&&0!==r.length){var n=t.pixelType,i=n?c(r,n):r,a=new o;return a.functionName="Colormap",a.functionArguments={},a.functionArguments.Colormap=i,a}}(e,t)}},t.createDefaultRenderer=function(e,t){if(e){var n,i=e.attributeTable,o=e.dataType,a=e.bandCount,s=e.pixelType,l=e.colormap,p=e.statistics,c=e.histograms;if(t&&t.length>0&&(p=p?t.map((function(e){return p[e]})):null,c=c?t.map((function(e){return c[e]})):null),1===a&&l&&l.length>0)n=r.RasterColormapRenderer.createFromColormap(l);else if(1===a&&i){var f=i.fields.filter((function(e){return"red"===e.name.toLowerCase()}))[0],h=i.fields.filter((function(e){return"green"===e.name.toLowerCase()}))[0],d=i.fields.filter((function(e){return"blue"===e.name.toLowerCase()}))[0],m=i.fields.filter((function(e){return"value"===e.name}))[0],y=i.fields.filter((function(e){return"classname"===e.name.toLowerCase()}))[0];y||(y=i.fields.filter((function(e){return"string"===e.type}))[0])||(y=m),f&&h&&d&&y&&(n=r.UniqueValueRenderer.fromJSON({field1:y.name,uniqueValueInfos:i.features.map((function(e){return{value:e.attributes[y.name],label:e.attributes[y.name],symbol:{color:[e.attributes[f.name],e.attributes[h.name],e.attributes[d.name],255],type:"esriSFS",style:"esriSFSSolid"}}}))}))}if(!n){var _=void 0,v=!1,g=void 0,x=void 0,b=void 0;"u8"===s&&"processed"===o?(_="min-max",p=p||[{min:0,max:255},{min:0,max:255},{min:0,max:255}]):"u8"===s||"elevation"===o?(_="min-max",v=!p):"scientific"===o?(_="min-max",v=!p,g=u):c&&c.length>0?(_="percent-clip",b=x=.25):p?_="min-max":(_="percent-clip",v=!0),n=r.RasterStretchRenderer.fromJSON({stretchType:_,dra:v,colorRamp:g,min:0,max:255,statistics:v?null:p,histograms:v?null:c,maxPercent:x,minPercent:b})}return n}},t.getDefaultBandCombination=function(e){var t=e.bandCount;if(1===t)return null;if(2===t)return[0];var r,n,i,o,a,s=e.keyProperties&&e.keyProperties.BandProperties;if(s&&s.length===t){for(var l=0;l<s.length;l++)s[l].BandName&&"red"===s[l].BandName.toLowerCase()&&(n=l),s[l].BandName&&"green"===s[l].BandName.toLowerCase()&&(i=l),s[l].BandName&&"blue"===s[l].BandName.toLowerCase()&&(o=l),s[l].BandName&&"nearinfrared"===s[l].BandName.toLowerCase()&&(a=l);void 0!==n&&void 0!==i&&void 0!==o?r=[n,i,o]:void 0!==n&&void 0!==i&&void 0!==a&&(r=[a,n,i])}return!r&&t>3&&(r=[0,1,2]),r};var p={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9};function c(e,t){var r=l[String(t).toLowerCase()];return r&&e.push([Math.floor(r[0]-1),0,0,0],[Math.ceil(r[1]+1),0,0,0]),e}function f(e){if(e){var t=e.fields,r=t&&n.find(t,(function(e){return e&&e.name&&"value"===e.name.toLowerCase()}));return r&&r.name}}}.apply(null,n))||(e.exports=i)},1241:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(1),r(0),r(8),r(9),r(18),r(66),r(1190),r(10),r(13),r(323),r(4),r(2),r(14),r(97),r(327),r(325),r(331),r(198),r(197),r(1235),r(79),r(1236),r(1313),r(324),r(1992),r(1285),r(340)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,h,d,m,y,_,v,g,x,b,w,P,T,S,I,E,R,O){return function(e){function t(t,r){var n=e.call(this,t)||this;return n._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},n._symbolizer=null,n.bandIds=null,n.fullExtent=null,n.interpolation="nearest",n.isReference=null,n.listMode="show",n.raster=null,n.rasterInfo=null,n.spatialReference=null,n.tileInfo=null,n.title=null,n.type="imagery-tile",n.url=null,n.operationalLayerType="ArcGISTiledImageServiceLayer",n.popupEnabled=!0,n.popupTemplate=null,n}return n(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?r({url:e},t):e},t.prototype.load=function(e){var t=this,r=c.isSome(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},e).then((function(){return t._openRaster(r)}),(function(){return t._openRaster(r)}))),h.resolve(this)},Object.defineProperty(t.prototype,"multidimensionalDefinition",{set:function(e){this.raster&&(this._sliceId=this.raster.getSliceIndex(e)),this._set("multidimensionalDefinition",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return[new P({name:"Raster.PixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{set:function(e){this._set("renderer",e),this.updateRenderer()},enumerable:!0,configurable:!0}),t.prototype.readRenderer=function(e,t,r){var n=t&&t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.renderer,i=u.read(n,r)||void 0;if(null!=i)return i},t.prototype.createPopupTemplate=function(e){return O.createPopupTemplate(this,e)},t.prototype.updateRenderer=function(){return a(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return this.loaded?JSON.stringify(this._cachedRendererJson)===JSON.stringify(this.renderer)?[2]:(e=this._rasterJobHandler.instance)?(this._symbolizer.renderer=this.renderer,this._symbolizer.bind(),[4,e.updateSymbolizer(this._symbolizer)]):[2]:[2];case 1:return t.sent(),this._cachedRendererJson=this.renderer.toJSON(),[2]}}))}))},t.prototype.applyRenderer=function(e,t){return a(this,void 0,void 0,(function(){var r,n,i;return o(this,(function(o){switch(o.label){case 0:return e&&e.pixels&&e.pixels.length>0?(r=t&&this.renderer&&"raster-stretch"===this.renderer.type,this.updateRenderer(),(i=this._rasterJobHandler.instance)?r?[4,i.stretch({pixelBlock:e,stretchParams:t})]:[3,2]:[3,5]):[2,null];case 1:return n=o.sent(),[3,4];case 2:return[4,i.symbolize(e)];case 3:n=o.sent(),o.label=4;case 4:return[3,6];case 5:n=r?this._symbolizer.simpleStretch(e,t):this._symbolizer.symbolize(e),o.label=6;case 6:return[2,n]}}))}))},t.prototype.fetchTile=function(e,t,n,i){return void 0===i&&(i={}),a(this,void 0,void 0,(function(){var a;return o(this,(function(o){switch(o.label){case 0:return[4,this._initJobHandler()];case 1:return o.sent(),this.multidimensionalDefinition&&(a=this._sliceId,i=r({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:a},i)),[2,this.raster.fetchTile(e,t,n,i)]}}))}))},t.prototype.fetchPixels=function(e,t,n,i){return a(this,void 0,void 0,(function(){var a;return o(this,(function(o){switch(o.label){case 0:return[4,this._initJobHandler()];case 1:return o.sent(),this.multidimensionalDefinition&&(a=this._sliceId,i=r({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:a},i)),[2,this.raster.fetchPixels(e,t,n,i)]}}))}))},t.prototype.identify=function(e,t){return void 0===t&&(t={}),this.raster.identify(e,t)},t.prototype.increaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount++},t.prototype.decreaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()},t.prototype._initJobHandler=function(){var e=this;if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;var t=new S;return this._rasterJobHandler.connectionPromise=t.initialize().then((function(){e._rasterJobHandler.instance=t,e.raster.rasterJobHandler=t,e.renderer&&e.updateRenderer()})).catch((function(){return null})),this._rasterJobHandler.connectionPromise},t.prototype._shutdownJobHandler=function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null},t.prototype._openRaster=function(e){return a(this,void 0,void 0,(function(){var t,r,n,i,a,s,l,u,c,f,h;return o(this,(function(o){switch(o.label){case 0:return[4,E.open(this.raster||{url:this.url,signal:e})];case 1:if(t=o.sent(),this.url||(this.url=t.url),this.raster=t,!(r=t.rasterInfo))throw new p("tile-imagery-layer:load","cannot load resources on "+this.url);if(n=r.spatialReference,i=r.pixelSize,a=r.storageInfo,!(s=a.tileInfo)){for(l=[],u=a.maximumPyramidLevel||0,c=Math.max(i.x,i.y),f=1/.0254*96*c,h=0;h<=u;h++)l.push({level:u-h,resolution:c,scale:f}),c*=2,f*=2;s=new I({origin:a.origin,size:[a.blockWidth,a.blockHeight],spatialReference:n,lods:l}),a.tileInfo=s}return null==this.title&&(this.title=this.raster.datasetName),r.multidimensionalInfo&&(this._configDefaultSlice(),this._sliceId=this.raster.getSliceIndex(this.multidimensionalDefinition)),this._configDefaultRenderer(),[2,t]}}))}))},t.prototype._configDefaultSlice=function(){var e=this.raster.rasterInfo.multidimensionalInfo.variables[0],t=[];e.dimensions.forEach((function(r){t.push(new w({variableName:e.name,dimensionName:r.name,values:r.values[0],isSlice:!0}))})),this.multidimensionalDefinition=t},t.prototype._configDefaultRenderer=function(){var e=this.raster.rasterInfo,t=e.pixelType;this.bandIds||(this.bandIds=T.getDefaultBandCombination(e)),this.renderer||(this.renderer=T.createDefaultRenderer(e,this.bandIds)),"u8"===t&&this.renderer&&"stretchType"in this.renderer&&"min-max"===this.renderer.stretchType&&this.renderer.dynamicRangeAdjustment&&(this.renderer.dynamicRangeAdjustment=!1,this.renderer.statistics=this.renderer.statistics||[[0,255],[0,255],[0,255]]),this._symbolizer?(this._symbolizer.renderer=this.renderer,this._symbolizer.rasterInfo=e):this._symbolizer=new R({renderer:this.renderer,rasterInfo:e}),this._symbolizer.bind()||(this._symbolizer=null)},i([d.property()],t.prototype,"_cachedRendererJson",void 0),i([d.property()],t.prototype,"_sliceId",void 0),i([d.property()],t.prototype,"_rasterJobHandler",void 0),i([d.property()],t.prototype,"_symbolizer",void 0),i([d.property({type:[m.Integer],json:{write:!0}})],t.prototype,"bandIds",void 0),i([d.property({type:s.Extent}),d.aliasOf("rasterInfo.extent")],t.prototype,"fullExtent",void 0),i([d.property({type:String,json:{write:!0}})],t.prototype,"interpolation",void 0),i([d.property({type:Boolean,json:{read:!1}})],t.prototype,"isReference",void 0),i([d.property({type:["show","hide"]})],t.prototype,"listMode",void 0),i([d.property({type:[w]})],t.prototype,"multidimensionalDefinition",null),i([d.property()],t.prototype,"raster",void 0),i([d.property({readOnly:!0}),d.aliasOf("raster.rasterInfo")],t.prototype,"rasterInfo",void 0),i([d.property({type:s.SpatialReference}),d.aliasOf("rasterInfo.spatialReference")],t.prototype,"spatialReference",void 0),i([d.property({type:I,dependsOn:["rasterInfo"]}),d.aliasOf("rasterInfo.storageInfo.tileInfo")],t.prototype,"tileInfo",void 0),i([d.property()],t.prototype,"title",void 0),i([d.property({readOnly:!0,json:{read:!1}})],t.prototype,"type",void 0),i([d.property(b.url)],t.prototype,"url",void 0),i([d.property({type:["ArcGISTiledImageServiceLayer"]})],t.prototype,"operationalLayerType",void 0),i([d.property(b.popupEnabled)],t.prototype,"popupEnabled",void 0),i([d.property({type:l,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],t.prototype,"popupTemplate",void 0),i([d.property({readOnly:!0,dependsOn:["title"]})],t.prototype,"defaultPopupTemplate",null),i([d.property({readOnly:!0,type:[P]})],t.prototype,"fields",null),i([d.property({types:u.rasterRendererTypes,json:{read:{source:"layerDefinition.drawingInfo.renderer"},write:{target:"layerDefinition.drawingInfo.renderer"}}})],t.prototype,"renderer",null),i([d.reader("renderer")],t.prototype,"readRenderer",null),i([d.subclass("esri.layers.TileImageryLayer")],t)}(d.declared(x.ScaleRangeLayer(g.RefreshableLayer(_.OperationalLayer(v.PortalLayer(f.MultiOriginJSONMixin(y)))))))}.apply(null,n))||(e.exports=i)},1242:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(1),r(0),r(3),r(2),r(44)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockWidth=void 0,t.blockHeight=void 0,t.compression=null,t.origin=null,t.firstPyramidLevel=null,t.maximumPyramidLevel=null,t.pyramidScalingFactor=2,t.pyramidBlockWidth=null,t.pyramidBlockHeight=null,t.tileInfo=null,t.blockBoundary=null,t}return n(t,e),i([a.property({type:Number,json:{write:!0}})],t.prototype,"blockWidth",void 0),i([a.property({type:Number,json:{write:!0}})],t.prototype,"blockHeight",void 0),i([a.property({type:String,json:{write:!0}})],t.prototype,"compression",void 0),i([a.property({type:s,json:{write:!0}})],t.prototype,"origin",void 0),i([a.property({type:Number,json:{write:!0}})],t.prototype,"firstPyramidLevel",void 0),i([a.property({type:Number,json:{write:!0}})],t.prototype,"maximumPyramidLevel",void 0),i([a.property()],t.prototype,"pyramidScalingFactor",void 0),i([a.property({type:Number,json:{write:!0}})],t.prototype,"pyramidBlockWidth",void 0),i([a.property({type:Number,json:{write:!0}})],t.prototype,"pyramidBlockHeight",void 0),i([a.property({json:{write:!0}})],t.prototype,"tileInfo",void 0),i([a.property()],t.prototype,"blockBoundary",void 0),i([a.subclass("esri.layers.support.RasterStorageInfo")],t)}(a.declared(o.JSONSupport))}.apply(null,n))||(e.exports=i)},1243:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(0),r(8),r(9),r(5),r(18),r(31),r(10),r(3),r(13),r(98),r(4),r(23),r(2),r(197),r(324),r(1308),r(1284),r(1130),r(1197)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,h,d,m,y,_,v,g,x,b){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rasterJobHandler=null,t.datasetName=null,t.datasetFormat=null,t.rasterInfo=null,t.ioConfig={bandIds:null,sampling:"closest"},t}return r(t,e),t.prototype.init=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return e=b.load(),this.addResolvingPromise(e),[4,this.when()];case 1:return t.sent(),[2]}}))}))},t.prototype.normalizeCtorArgs=function(e){return e&&e.ioConfig&&(e=a({},e,{ioConfig:a({resolution:null,bandIds:null,sampling:"closest",tileInfo:_.create()},e.ioConfig)})),e},Object.defineProperty(t.prototype,"url",{set:function(e){var t=d.urlToObject(e);this._set("url",t.path)},enumerable:!0,configurable:!0}),t.prototype.open=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(e){throw new u("BaseRaster:open-not-implemented","open() is not implemented")}))}))},t.prototype.fetchTile=function(e,t,r,n){return void 0===n&&(n={}),o(this,void 0,void 0,(function(){var o,a,l,u;return i(this,(function(i){return o=n.tileInfo,a=o.lodAt(e),l=new s.Point({x:a.resolution,y:a.resolution,spatialReference:o.spatialReference}),u=this._getTileExtent(l,t,r,o),[2,this.fetchPixels(u,o.size[0],o.size[1],n)]}))}))},t.prototype.identify=function(e,t){return void 0===t&&(t={}),o(this,void 0,void 0,(function(){var r,n,o,a,s,l,u,p,c,f,h,d,m,y,_;return i(this,(function(i){switch(i.label){case 0:return r=this.rasterInfo,n=r.spatialReference,o=r.extent,a=t.datumTransformation,s=b.projectPoint(e,n,a),o.intersects(s)?(l=0,t.srcResolution?(u=b.snapPyramid(t.srcResolution,this.rasterInfo,this.ioConfig.sampling),l=u.pyramidLevel,[3,3]):[3,1]):[2,{location:s,value:null}];case 1:return[4,this.computeBestPyramidLevelForLocation(e,t)];case 2:if(null==(l=i.sent()))return[2,{location:s,value:null}];i.label=3;case 3:return null===(p=this.identifyPixelLocation(s,l,null))?[2,{location:s,value:null}]:(c=p.row,f=p.col,h=p.rowOffset,d=p.colOffset,[4,this.fetchRawTile(l,c,f,t)]);case 4:return(m=i.sent()).pixels&&m.pixels.length>0?(y=h*this.rasterInfo.storageInfo.blockHeight+d,_=!m.mask||m.mask[y]?m.pixels.map((function(e){return e[y]})):null,[2,{location:s,value:_,pyramidLevel:l}]):[2,{location:s,value:null}]}}))}))},t.prototype.fetchPixels=function(e,t,r,n){return void 0===n&&(n={}),o(this,void 0,void 0,(function(){var o,a,l,u,p,c,f,h,d,m,y,_,v,g,w,P,T,S,I,E,R,O;return i(this,(function(i){switch(i.label){case 0:return o=e.clone().normalize(),e=o[0],a=this.rasterInfo.spatialReference,l=!e.spatialReference.equals(a),u=n.datumTransformation,p=new s.Point({x:(e.xmax-e.xmin)/t,y:(e.ymax-e.ymin)/r,spatialReference:e.spatialReference}),(c=n.srcResolution||(l?b.projectResolution(p,a,e,u):p))?(f=b.snapPyramid(c,this.rasterInfo,this.ioConfig.sampling),h=f.pyramidLevel,d=f.pyramidResolution,f.excessiveReading?[2,null]:(m=this.rasterInfo.storageInfo,y=l?b.projectExtent(e,a,u):e,_={x:Math.floor((y.xmin-m.origin.x)/d.x+.1),y:Math.floor((m.origin.y-y.ymax)/d.y+.1)},v=Math.ceil((y.xmax-y.xmin)/d.x-.1),g=Math.ceil((y.ymax-y.ymin)/d.y-.1),v/t>8||g/r>8?[2,null]:[4,this.fetchRawPixels(h,_,{width:v,height:g},n)])):[2,null];case 1:return(w=i.sent())?(P=h>0?m.pyramidBlockWidth:m.blockWidth,T=h>0?m.pyramidBlockHeight:m.blockHeight,l||1!==w.pixelBlocks.length||P!==t||T!==r||c.x!==p.x||c.y!==p.y?(S=b.getProjectionOffsetGrid(e,w.extent,p,u),E=!n.requestRawData,R={rows:S.spacing[0],cols:S.spacing[1]},this.rasterJobHandler?[4,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:w.pixelBlocks,srcMosaicSize:w.mosaicSize,destDimension:E?{width:t,height:r}:null,coefs:E?S.coefficients:null,sampleSpacing:E?R:null},n)]:[3,3]):[2,{extent:e,srcExtent:y,pixelBlock:w.pixelBlocks[0],transformGrid:null}]):[2,null];case 2:return I=i.sent(),[3,4];case 3:O=x.mosaic(w.pixelBlocks,w.mosaicSize),I=E?x.approximateTransform(O,{width:t,height:r},S.coefficients,R):O,i.label=4;case 4:return[2,{srcExtent:y,pixelBlock:I,transformGrid:S,extent:e}]}}))}))},t.prototype.fetchRawPixels=function(e,t,r,n){return o(this,void 0,void 0,(function(){var o,a,l,u,p,f,d,m,y,_,g,x,b,w,P,T,S,I,E,R,O,M,N,A,C,k,D,F;return i(this,(function(i){switch(i.label){case 0:if(o=this.rasterInfo.storageInfo,a=o.origin,l=o.blockBoundary,u=e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,p=e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight,f=Math.floor(t.x/u),d=Math.floor(t.y/p),m=Math.floor((t.x+r.width-1)/u),y=Math.floor((t.y+r.height-1)/p),_=this.rasterInfo,g=_.pixelSize,x=_.spatialReference,!(b=l[e]))return[2,null];if(w=b.minRow,P=b.minCol,T=b.maxCol,S=b.maxRow,y<w||m<P||d>S||f>T)return[2,null];for(I=[],E=this.url,R=n.registryId,N=d;N<=y;N++)for(A=f;A<=m;A++)N>=w&&A>=P&&S>=N&&T>=A?(O=e+"/"+N+"/"+A,M=v.getBlock(E,R,O),c.isSome(M)||(M=this.fetchRawTile(e,N,A,n),v.putBlock(E,R,O,M)),I.push(M)):I.push(null);return 0===I.length?[2,null]:[4,h.all(I)];case 1:return C=i.sent(),k={height:(y-d+1)*u,width:(m-f+1)*p},D=g.x*Math.pow(2,e),F=g.y*Math.pow(2,e),[2,{extent:new s.Extent({xmin:a.x+f*u*D,xmax:a.x+(m+1)*u*D,ymin:a.y-(y+1)*p*F,ymax:a.y-d*p*F,spatialReference:x}),pixelBlocks:C,mosaicSize:k}]}}))}))},t.prototype.fetchRawTile=function(e,t,r,n){return o(this,void 0,void 0,(function(){return i(this,(function(e){throw new u("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")}))}))},t.prototype.decodePixelBlock=function(e,t){return this.rasterJobHandler?this.rasterJobHandler.decode({data:e,options:t}):g.decode(e,t)},t.prototype.request=function(e,t){return o(this,void 0,void 0,(function(){var r,n,o,s,u,p;return i(this,(function(i){switch(i.label){case 0:r=this.ioConfig.customFetchParameters,n=e.url,o=e.range,s=e.query,u=e.responseType,null==e.retryCount&&this.ioConfig.retryCount&&(e.retryCount=this.ioConfig.retryCount),p=o?{Range:"bytes="+o.from+"-"+o.to}:null,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,l(n,{query:a({},s,r),headers:p,responseType:u,signal:t})];case 2:return[2,i.sent().data];case 3:return i.sent(),e.retryCount>0?(e.retryCount--,[2,this.request(e,t)]):[2,null];case 4:return[2]}}))}))},t.prototype.getSliceIndex=function(e){var t=this.rasterInfo.multidimensionalInfo;if(!t||0===e.length)return null;for(var r=0,n=e[0].variableName,i=function(i){var o=t.variables[i],a=o.dimensions;if(o.name!==n)return r+=a.map((function(e){return e.values.length})).reduce((function(e,t){return e+t})),"break";for(var s=a.map((function(e){return e.values.length})),l=a.length,u=function(t){var n=e.filter((function(e){return e.dimensionName===a[t].name}))[0];if(null==n)return{value:null};var i=Array.isArray(n.values[0])?n.values[0][0]:n.values[0],o=a[t].values.indexOf(i);if(-1===o)return{value:null};s.shift(),r+=t===l-1?o:o*s.reduce((function(e,t){return e+t}))},p=0;p<l;p++){var c=u(p);if("object"==typeof c)return c}},o=0;o<t.variables.length;o++){var a=i(o);if("object"==typeof a)return a.value;if("break"===a)break}return r},t.prototype.computeBestPyramidLevelForLocation=function(e,t){return void 0===t&&(t={}),o(this,void 0,void 0,(function(){return i(this,(function(e){return[2,0]}))}))},t.prototype.identifyPixelLocation=function(e,t,r){var n=this.rasterInfo,i=n.spatialReference,o=n.pixelSize,a=n.extent,s=this.rasterInfo.storageInfo,l=s.blockWidth,u=s.blockHeight,p=s.maximumPyramidLevel,c=s.pyramidScalingFactor,f=s.origin,h=s.blockBoundary,d=b.projectPoint(e,i,r);if(!a.intersects(d))return null;if(t<0||t>p)return null;var m=Math.pow(c,t),y=m*o.x,_=m*o.y,v=h[t],g=Math.max(v.minRow,Math.min(v.maxRow,(f.y-d.y)/_/u)),x=Math.max(v.minCol,Math.min(v.maxCol,(d.x-f.x)/y/l)),w=Math.min(u-1,Math.floor((g-Math.floor(g))*u)),P=Math.min(l-1,Math.floor((x-Math.floor(x))*l));return{pyramidLevel:t,row:Math.floor(g),col:Math.floor(x),rowOffset:w,colOffset:P,srcLocation:d}},t.prototype._getTileExtent=function(e,t,r,n){var i=n.origin,o=n.spatialReference,a=n.size[0],l=n.size[1],u=i.x+r*a*e.x,p=u+a*e.x,c=i.y-t*l*e.y,f=c-l*e.y;return new s.Extent({xmin:u,xmax:p,ymin:f,ymax:c,spatialReference:o})},n([m.property(y.url)],t.prototype,"url",null),n([m.property({type:String,json:{write:!0}})],t.prototype,"datasetName",void 0),n([m.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),n([m.property()],t.prototype,"rasterInfo",void 0),n([m.property()],t.prototype,"ioConfig",void 0),n([m.subclass("esri.layers.support.rasterDatasets.BaseRaster")],t)}(m.declared(f.EsriPromiseMixin(p.JSONSupport)))}.apply(null,n))||(e.exports=i)},1308:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(18),r(1197)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=new Map;t.register=function(e,t){var r={extent:null,rasterInfo:t,cache:new Map};if(i.has(e)){var n=i.get(e);return n.push(r),n.length-1}return i.set(e,[r]),0},t.unregister=function(e,t){i.has(e)&&(i.get(e)[t]=null)},t.deleteRaster=function(e){i.delete(e)},t.getBlock=function(e,t,r){if(!i.has(e))return null;var n=i.get(e);if(null==n[t]){for(var o=0;o<n.length;o++)if(n[o].cache.has(r))return n[o].cache.get(r);return null}var a=n[t].cache;if(a.has(r))return a.get(r);for(o=0;o<n.length;o++)if(o!==t&&n[o]&&n[o].cache.has(r)){var s=n[o].cache.get(r);return a.set(r,s),s}return null},t.putBlock=function(e,t,r,n){if(!i.has(e))return null;var o=i.get(e);if(null==o[t])return null;o[t].cache.set(r,n)},t.update=function(e,t,o,a,s,l,u){void 0===u&&(u=null);var p=function(e,t){if(!i.has(e))return null;var r=i.get(e);return null==r[t]?null:r[t]}(e,t),c=p.extent,f=p.cache,h=p.rasterInfo,d=o.clone().normalize();if(o=d[0],!c||c.xmin!==o.xmin||c.xmax!==o.xmax||c.ymin!==o.ymin||c.ymax!==o.ymax){var m=h.spatialReference,y=n.projectExtent(o,m,u),_=new r.Point({x:a,y:a,spatialReference:o.spatialReference});if(null!==s||(s=n.projectResolution(_,m,o,u))){var v=n.snapPyramid(s,h,l||"closest"),g=v.pyramidLevel,x=v.pyramidResolution;if(!v.excessiveReading){for(var b=Math.floor((y.xmin-h.storageInfo.origin.x)/x.x),w=Math.floor((h.storageInfo.origin.y-y.ymax)/x.y),P=Math.ceil((y.xmax-y.xmin)/x.x-.1),T=Math.ceil((y.ymax-y.ymin)/x.y-.1),S=g>0?h.storageInfo.pyramidBlockWidth:h.storageInfo.blockWidth,I=g>0?h.storageInfo.pyramidBlockHeight:h.storageInfo.blockHeight,E=Math.floor(b/S),R=Math.floor(w/I),O=Math.floor((b+P-1)/S),M=Math.floor((w+T-1)/I),N=new Set,A=R-1;A<=M+1;A++)for(var C=E-1;C<=O+1;C++)N.add(g+"/"+A+"/"+C);f.forEach((function(e,t){N.has(t)||f.delete(t)})),p.extent={xmin:o.xmin,ymin:o.ymin,xmax:o.xmax,ymax:o.ymax}}}}}}.apply(null,n))||(e.exports=i)},1313:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(9),r(5),r(10),r(4),r(106),r(1110)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(){function e(){this._workerThread=null,this._destroyed=!1}return e.prototype.initialize=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,s.open("RasterWorker")];case 1:return e=t.sent(),this._destroyed?e.close():this._workerThread=e,[2]}}))}))},e.prototype.destroy=function(){this._destroyed=!0,this._workerThread&&(this._workerThread.close(),this._workerThread=null)},e.prototype.decode=function(e,t){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new o("raster-jobhandler:no-connection","no available worker connection");return[4,this._workerThread.invoke("decode",e,t)];case 1:return[2,(n=r.sent())?new l(n):null]}}))}))},e.prototype.symbolize=function(e,t){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new o("raster-jobhandler:no-connection","no available worker connection");return[4,this._workerThread.invoke("symbolize",e.toJSON(),t)];case 1:return[2,(n=r.sent())?new l(n):null]}}))}))},e.prototype.updateSymbolizer=function(e,t){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new o("raster-jobhandler:no-connection","no available worker connection");return n=e&&e.renderer&&"raster-stretch"===e.renderer.type&&e.renderer.histograms,[4,a.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:e.toJSON(),histograms:n},t))];case 1:return r.sent(),[2]}}))}))},e.prototype.stretch=function(e,t){return n(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new o("raster-jobhandler:no-connection","no available worker connection");return e&&e.pixelBlock?(n={srcPixelBlock:e.pixelBlock.toJSON(),stretchParams:e.stretchParams},[4,this._workerThread.invoke("stretch",n,t)]):[2,null];case 1:return[2,(i=r.sent())?new l(i):null]}}))}))},e.prototype.mosaicAndTransform=function(e,t){return n(this,void 0,void 0,(function(){var n,a;return r(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new o("raster-jobhandler:no-connection","no available worker connection");return e&&e.srcPixelBlocks&&e.srcPixelBlocks.length>0?(n=i({},e,{srcPixelBlocks:e.srcPixelBlocks.map((function(e){return e?e.toJSON():null}))}),[4,this._workerThread.invoke("mosaicAndTransform",n,t)]):[2,null];case 1:return[2,(a=r.sent())?new l(a):null]}}))}))},e}()}.apply(null,n))||(e.exports=i)},1992:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(9),r(1993),r(10),r(1994),r(1996),r(1997),r(1999)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u){var p=new Map;return p.set("CRF",{desc:"Cloud Raster Format",constructor:a}),p.set("MRF",{desc:"Meta Raster Format",constructor:l}),p.set("TIFF",{desc:"GeoTIFF",constructor:u}),p.set("RasterTileServer",{desc:"Raster Tile Server",constructor:s}),function(){function e(){}return Object.defineProperty(e,"supportedFormats",{get:function(){for(var e=p.keys(),t=new i.default,r=e.next();!r.done;)t.add(r.value),r=e.next();return t},enumerable:!0,configurable:!0}),e.open=function(e){return n(this,void 0,void 0,(function(){var t,n,i,a,s,l,u,c,f,h;return r(this,(function(r){switch(r.label){case 0:return t=e.url,n=e.ioConfig,null==(i=e.datasetFormat)&&t.lastIndexOf(".")&&(i=t.slice(t.lastIndexOf(".")+1).toUpperCase()),"OVR"===i||"TIF"===i?i="TIFF":t.toLowerCase().indexOf("/imageserver")>-1&&(i="RasterTileServer"),a={resolution:null,bandIds:null,sampling:null},s={url:t,datasetFormat:i,ioConfig:n||a},this.supportedFormats.has(i)?(l=p.get(i).constructor,[4,(u=new l(s)).open({signal:e.signal})]):[3,2];case 1:return r.sent(),[2,u];case 2:if(i)throw new o("rasterfactory:open","not a supported format "+i);return c=Array.from(p.keys()),f=0,[2,(h=function(){return(i=c[f++])?(l=p.get(i).constructor,(u=new l(s)).open({signal:e.signal}).then((function(){return u})).catch((function(){return h()}))):null})()]}}))}))},e.register=function(e,t,r){p.has(e.toUpperCase())||p.set(e.toUpperCase(),{desc:t,constructor:r})},e}()}.apply(null,n))||(e.exports=i)},1993:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(30),o=r(51),a=r(219),s=r(58);r(113),t.Set=o.default.Set,s.default("es6-set")||(t.Set=((n=function(){function e(e){if(this._setData=[],this[Symbol.toStringTag]="Set",e)if(a.isArrayLike(e))for(var t=0;t<e.length;t++)this.add(e[t]);else try{for(var r=i.__values(e),n=r.next();!n.done;n=r.next()){var o=n.value;this.add(o)}}catch(e){s={error:e}}finally{try{n&&!n.done&&(l=r.return)&&l.call(r)}finally{if(s)throw s.error}}var s,l}return e.prototype.add=function(e){return this.has(e)||this._setData.push(e),this},e.prototype.clear=function(){this._setData.length=0},e.prototype.delete=function(e){var t=this._setData.indexOf(e);return-1!==t&&(this._setData.splice(t,1),!0)},e.prototype.entries=function(){return new a.ShimIterator(this._setData.map((function(e){return[e,e]})))},e.prototype.forEach=function(e,t){for(var r=this.values(),n=r.next();!n.done;)e.call(t,n.value,n.value,this),n=r.next()},e.prototype.has=function(e){return this._setData.indexOf(e)>-1},e.prototype.keys=function(){return new a.ShimIterator(this._setData)},Object.defineProperty(e.prototype,"size",{get:function(){return this._setData.length},enumerable:!0,configurable:!0}),e.prototype.values=function(){return new a.ShimIterator(this._setData)},e.prototype[Symbol.iterator]=function(){return new a.ShimIterator(this._setData)},e}())[Symbol.species]=n,n)),t.default=t.Set},1994:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(0),r(9),r(1),r(18),r(10),r(13),r(4),r(2),r(1161),r(1242),r(324),r(1243),r(1995),r(100)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,h,d,m,y){var _=new Map;return _.set("int16","esriFieldTypeSmallInteger"),_.set("int32","esriFieldTypeInteger"),_.set("int64","esriFieldTypeInteger"),_.set("float32","esriFieldTypeSingle"),_.set("float64","esriFieldTypeDouble"),_.set("text","esriFieldTypeString"),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.storageInfo=null,t}return o(t,e),t.prototype.open=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,u;return r(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),t=e?l.unwrap(e.signal):null,[4,this.request({url:this.url+"/conf.json",responseType:"json"},t)];case 2:if(n=r.sent(),!this._validateHeader(n))throw new s("cloudraster:open","Invalid or unsupported conf.json.");return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),i=this._parseHeader(n),o=i.storageInfo,"thematic"!==(a=i.rasterInfo).dataType?[3,4]:[4,this._fetchAuxiliaryInformation()];case 3:u=r.sent(),a.attributeTable=u,r.label=4;case 4:return this._set("storageInfo",o),this._set("rasterInfo",a),this.ioConfig.retryCount=this.ioConfig.retryCount||0,[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,o){return void 0===o&&(o={}),i(this,void 0,void 0,(function(){var i,a,s,l,u,p,c;return r(this,(function(r){switch(r.label){case 0:return(i=this.rasterInfo.storageInfo.maximumPyramidLevel-e)<0?[2,null]:(a=this._buildCacheFilePath(i,t,n,o.multidimensionalDefinition),s=this._getIndexRecordFromBundle(t,n),[4,this.request({url:a,range:{from:0,to:this.storageInfo.headerSize-1},responseType:"array-buffer"},o.signal)]);case 1:return(l=r.sent())?(u=new Uint8Array(l),0===(p=this._getTileEndAndContentType(u,s)).recordSize?[2,null]:[4,this.request({url:a,range:{from:p.position,to:p.position+p.recordSize},responseType:"array-buffer"},o.signal)]):[2,null];case 2:return(c=r.sent())?[2,this.decodePixelBlock(c,{width:this.rasterInfo.storageInfo.tileInfo.size[0],height:this.rasterInfo.storageInfo.tileInfo.size[1],planes:null,pixelType:null})]:[2,null]}}))}))},t.prototype._validateHeader=function(e){return e&&"RasterInfo"===e.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some((function(t){return!e[t]}))},t.prototype._parseHeader=function(e){var t,r,n,i,o=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][e.pixelType],s=e.bandCount,l=e.histograms,u=e.colormap,p=e.blockWidth,d=e.blockHeight,m=e.firstPyramidLevel,y=e.maximumPyramidLevel,_=e.statistics&&e.statistics.map((function(e){return{min:e.min,max:e.max,avg:e.mean,stddev:e.standardDeviation,median:e.median,mode:e.mode}})),v=new a.SpatialReference(e.extent.spatialReference||e.geodataXform.spatialReference),g=new a.Extent({xmin:e.extent.xmin,ymin:e.extent.ymin,xmax:e.extent.xmax,ymax:e.extent.ymax,spatialReference:v}),x=new a.Point({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:v}),b=e.properties,w=e.format.toLowerCase().replace("cache/",""),P=new a.Point(e.origin.x,e.origin.y,v);if(u&&u.colors)for(t=[],r=0;r<u.colors.length;r++)n=u.colors[r],i=u.values?u.values[r]:r,t.push([i,255&n,n<<16>>>24,n<<8>>>24,n>>>24]);var T=e.LODInfos,S=[];for(r=0;r<T.levels.length;r++)S.push({level:T.levels[r],resolution:T.resolutions[r],scale:96/.0254*T.resolutions[r]});var I=new h({dpi:96,lods:S,format:w,origin:P,size:[p,d],spatialReference:v}),E={recordSize:8,packetSize:e.packetSize,headerSize:e.packetSize*e.packetSize*8+64},R=Math.round((g.xmax-g.xmin)/x.x),O=Math.round((g.ymax-g.ymin)/x.y),M=[{maxCol:Math.ceil(R/p)-1,maxRow:Math.ceil(O/d)-1,minCol:0,minRow:0}],N=2;if(y>0)for(r=0;r<y;r++)M.push({maxCol:Math.ceil(R/N/p)-1,maxRow:Math.ceil(O/N/d)-1,minCol:0,minRow:0}),N*=2;var A=e.mdInfo;return{storageInfo:E,rasterInfo:new c({width:R,height:O,pixelType:o,bandCount:s,extent:g,spatialReference:v,pixelSize:x,keyProperties:b,statistics:_,histograms:l,multidimensionalInfo:A,colormap:t,storageInfo:new f({blockWidth:p,blockHeight:d,pyramidBlockWidth:p,pyramidBlockHeight:d,origin:P,tileInfo:I,firstPyramidLevel:m,maximumPyramidLevel:y,blockBoundary:M})})}},t.prototype._fetchAuxiliaryInformation=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,s,l,p;return r(this,(function(r){switch(r.label){case 0:return t=this.request({url:this.url+"/conf.vat.json",responseType:"json"},e).then((function(e){return e})).catch((function(){return null})),n=this.request({url:this.url+"/conf.vat.dbf",responseType:"array-buffer"},e).then((function(e){return e})).catch((function(){return null})),[4,u.all([t,n])];case 1:return(i=r.sent())[0]&&(a=i[0].fields,s=i[0].values,a&&s&&(a=a.map((function(e){return{type:"OID"===e.name?"esriFieldTypeOID":_.get(e.type),name:e.name,alias:e.alias||e.name}})),l=s.map((function(e){return{attributes:e}})),a&&s&&(o={fields:a,features:l}))),!o&&i[1]&&(p=m.parse(i[1]),o=p.recordSet),[2,y.fromJSON(o)]}}))}))},t.prototype._buildCacheFilePath=function(e,t,r,n){var i=this.storageInfo.packetSize,o=Math.floor(t/i)*i,a=Math.floor(r/i)*i,s="R"+this._toHexString4(o)+"C"+this._toHexString4(a),l="L";l+=e>=10?e.toString():"0"+e.toString();var u=n&&n[0];if(!u)return this.url+"/_alllayers/"+l+"/"+s+".bundle";for(var p=this.rasterInfo.multidimensionalInfo.variables.filter((function(e){return e.name===u.variableName}))[0].dimensions[0].values.indexOf(u.values[0]).toString(16),c=4-p.length,f=0;f<c;f++)p="0"+p;return p="S"+p,this.url+"/_alllayers/"+u.variableName+"/"+p+"/"+l+"/"+s+".bundle"},t.prototype._getIndexRecordFromBundle=function(e,t){var r=this.storageInfo.packetSize,n=r*(e%r)+t%r;if(n<0)throw"Invalid level / row / col";return 20+n*this.storageInfo.recordSize+44},t.prototype._getTileEndAndContentType=function(e,t){var r,n=e.subarray(t,t+8),i=0;for(r=0;r<5;r++)i|=(255&n[r])<<8*r;var o=0xffffffffff&i;for(i=0,r=5;r<8;r++)i|=(255&n[r])<<8*(r-5);return{position:o,recordSize:0xffffffffff&i}},t.prototype._toHexString4=function(e){var t=e.toString(16);if(4!==t.length)for(var r=4-t.length;r-- >0;)t="0"+t;return t},n([p.property({readOnly:!0})],t.prototype,"storageInfo",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),n([p.subclass("esri.layers.support.rasterDatasets.CloudRaster")],t)}(p.declared(d))}.apply(null,n))||(e.exports=i)},1995:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1407)],void 0===(i=function(e,t,r){return function(){function e(){}return Object.defineProperty(e,"supportedVersions",{get:function(){return[5]},enumerable:!0,configurable:!0}),e.parse=function(e){var t=new DataView(e),n=3&t.getUint8(0);if(3!==n)return{header:{version:n},recordSet:null};var i,o=t.getUint32(4,!0),a=t.getUint16(8,!0),s=t.getUint16(10,!0),l={version:n,recordCount:o,headerByteCount:a,recordByteCount:s},u=32,p=[],c=[];if(3===n){for(;13!==t.getUint8(u);)i=String.fromCharCode(t.getUint8(u+11)).trim(),p.push({name:r.bytesToUTF8(new Uint8Array(e,u,11)),type:i,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(i)],length:t.getUint8(u+16)}),u+=32;if(u+=1,p.length>0)for(var f=function(){var n=[];32===t.getUint8(u)?(u+=1,p.forEach((function(t){if("C"===t.type)n.push(r.bytesToUTF8(new Uint8Array(e,u,t.length)).trim());else if("N"===t.type)n.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim(),10));else if("F"===t.type)n.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim()));else if("D"===t.type){var i=String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim();n.push(new Date(parseInt(i.substring(0,4),10),parseInt(i.substring(4,6),10)-1,parseInt(i.substring(6,8),10)))}u+=t.length})),c.push(n)):u+=s};c.length<o&&e.byteLength-u>s;)f()}var h=function(e){var t=e.fields,r=e.records,n=t.some((function(e){return"oid"===e.name.toLowerCase()}))?"OBJECTID":"OID",i=[{name:n,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map((function(e){return{name:e.name,type:"esriFieldType"+e.typeName,alias:e.name}}))),o=i.map((function(e){return e.name})),a=[],s=0,l=0;return r.forEach((function(e){var t={};for(t[n]=s++,l=1;l<o.length;l++)t[o[l]]=e[l-1];a.push({attributes:t})})),{displayFieldName:"",fields:i,features:a}}({fields:p,records:c});return{header:l,fields:p,records:c,recordSet:h}},e}()}.apply(null,n))||(e.exports=i)},1996:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(0),r(9),r(1),r(5),r(18),r(31),r(10),r(13),r(4),r(23),r(2),r(1161),r(1242),r(324),r(1092),r(1243),r(1130),r(100)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,h,d,m,y,_,v,g,x){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._levelOffset=0,t._slices=null,t._tilemapCache=null,t.sourceJSON=null,t}return o(t,e),t.prototype.open=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,s,c,h,d,v,g,x,b,w,P,T,S,I,E,R,O,M,N,A,C;return r(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),t=e&&e.signal,this.sourceJSON?(i={data:this.sourceJSON},[3,4]):[3,2];case 2:return[4,l(this.url,{responseType:"json",query:{f:"json"},signal:t})];case 3:i=r.sent(),r.label=4;case 4:if((n=i).ssl&&(this.url=this.url.replace(/^http:/i,"https:")),o=n.data,this.sourceJSON=o,a=["jpg","jpeg","png","png8","png24","png32","mixed"],this.tileType=o.cacheType,null===this.tileType&&(a.indexOf(o.tileInfo.format.toLowerCase())>-1?this.tileType="Map":"lerc"===o.tileInfo.format.toLowerCase()?this.tileType="Elevation":this.tileType="Raster"),!o||!o.tileInfo)throw new u("imageserverraster:open","cannot initialize tiled image service");return this.datasetName=o.name,[4,this._fetchRasterInfo({signal:t})];case 5:if(s=r.sent(),!p.isSome(s))throw new u("image-server-raster:open","cannot initialize image service");if(c=y.fromJSON(o.tileInfo),h=s.extent,d=s.pixelSize,v=.5/s.width*d.x,g=void 0,x=void 0,b=c.lodAt(Math.max.apply(null,c.lods.map((function(e){return e.level})))),0!==o.maxScale&&("Raster"===this.tileType?(g=c.lods.filter((function(e){return e.resolution===d.x}))[0])||(g=c.lods.filter((function(e){return e.resolution>d.x})).sort((function(e,t){return e.resolution>t.resolution?1:-1}))[0]):(g=c.lods.filter((function(e){return Math.abs(e.scale-o.maxScale)<v}))[0])||(g=c.lods.filter((function(e){return e.scale>o.maxScale})).sort((function(e,t){return e.scale>t.scale?1:-1}))[0]),d.x=d.y=g.resolution,s.width=Math.ceil((h.xmax-h.xmin)/d.x-.1),s.height=Math.ceil((h.ymax-h.ymin)/d.y-.1)),g||(g=b),w=c.lodAt(Math.min.apply(null,c.lods.map((function(e){return e.level})))),0!==o.minScale&&"Raster"!==this.tileType&&(x=c.lods.filter((function(e){return Math.abs(e.scale-o.minScale)<v}))[0],this._levelOffset=x.level-w.level),x||(x=w),P=Math.max(d.x,d.y),(Math.abs(d.x-d.y)>v||!c.lods.some((function(e){return Math.abs(e.resolution-P)<v})))&&(d.x=d.y=g.resolution,s.width=Math.ceil((h.xmax-h.xmin)/d.x-.1),s.height=Math.ceil((h.ymax-h.ymin)/d.y-.1)),T=g.level-x.level,S=c.size,I=S[0],E=S[1],R=c.origin,O=d.x,M=d.y,N=[{minCol:Math.floor((h.xmin-R.x+.1*O)/I/O),maxCol:Math.floor((h.xmax-R.x-.1*O)/I/O),minRow:Math.floor((R.y-h.ymax+.1*M)/E/M),maxRow:Math.floor((R.y-h.ymin-.1*M)/E/M)}],T>0)for(A=0;A<T;A++)O*=2,M*=2,N.push({minCol:Math.floor((h.xmin-R.x+.1*O)/I/O),maxCol:Math.floor((h.xmax-R.x-.1*O)/I/O),minRow:Math.floor((R.y-h.ymax+.1*M)/E/O),maxRow:Math.floor((R.y-h.ymin-.1*M)/E/O)});return s.storageInfo=new m({blockWidth:c.size[0],blockHeight:c.size[1],pyramidBlockWidth:c.size[0],pyramidBlockHeight:c.size[1],compression:c.format,origin:c.origin,firstPyramidLevel:1,maximumPyramidLevel:T,tileInfo:c,blockBoundary:N}),this._set("rasterInfo",s),o.capabilities.toLowerCase().indexOf("tilemap")>-1&&(C={tileInfo:s.storageInfo.tileInfo,parsedUrl:f.urlToObject(this.url),url:this.url,tileServers:[],type:"tile"},this._tilemapCache=new _.TilemapCache({layer:C})),[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,o){return void 0===o&&(o={}),i(this,void 0,void 0,(function(){var i,a,s,l,u,p,c,f,h,d,m,y,_,v,x,b,w,P,T,S,I,E;return r(this,(function(r){switch(r.label){case 0:return i=this.rasterInfo,a=i.storageInfo,s=i.extent,l=i.pixelSize,u=a.maximumPyramidLevel-e+this._levelOffset,p=this.url+"/tile/"+u+"/"+t+"/"+n,c=this._slices?{sliceId:o.sliceId||0}:null,[4,this.request({url:p,query:c,responseType:"array-buffer"},o.signal)];case 1:return(f=r.sent())?[4,this.decodePixelBlock(f,{width:a.tileInfo.size[0],height:a.tileInfo.size[1],planes:null,pixelType:null,isPoint:"Elevation"===this.tileType})]:[2,null];case 2:return h=r.sent(),d=a.blockBoundary[e],"jpg"!==a.compression||n>d.minCol&&n<d.maxCol&&t>d.minRow&&t<d.maxRow||(m=a.origin,y=a.blockWidth,_=a.blockHeight,v=Math.pow(2,e),x=Math.round((s.xmin-m.x)/(l.x*v))%y,b=Math.round((s.xmax-m.x)/(l.x*v))%y,w=Math.round((m.y-s.ymax)/(l.x*v))%_,P=Math.round((m.y-s.ymin)/(l.x*v))%_,T=n===d.minCol?x:0,S=t===d.minRow?w:0,I=n===d.maxCol?b:y,E=t===d.maxRow?P:_,g.setValidBoundary(h,{x:T,y:S},{width:I-T,height:E-S})),[2,h]}}))}))},t.prototype.getSliceIndex=function(e){for(var t=e,r=0;r<this._slices.length;r++){var n=this._slices[r].multidimensionalDefinition;if(n.length===t.length&&!n.some((function(e){var r=t.filter((function(t){return e.variableName===t.variableName&&t.dimensionName===e.dimensionName}))[0];return r?(Array.isArray(e.values[0])?e.values[0][0]:e.values[0])!==(Array.isArray(r.values[0])?r.values[0][0]:r.values[0]):null})))return r}return null},t.prototype.computeBestPyramidLevelForLocation=function(e,t){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){var n,i,o,a,s;return r(this,(function(r){switch(r.label){case 0:if(!this._tilemapCache)return[2,0];if(null===(n=this.identifyPixelLocation(e,0,t.datumTransformation)))return[2,null];i=0,o=this.rasterInfo.storageInfo.maximumPyramidLevel,a=o-i+this._levelOffset,s=n.srcLocation,r.label=1;case 1:if(!(a>=0))return[3,6];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._tilemapCache.fetchAvailability(a,n.row,n.col,t)];case 3:return"available"===r.sent()?[3,6]:[3,5];case 4:return r.sent(),[3,5];case 5:return a--,i++,null===(n=this.identifyPixelLocation(s,i,t.datumTransformation))?[2,null]:[3,1];case 6:return-1===a||null==n?[2,null]:[2,i]}}))}))},t.prototype._fetchRasterInfo=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,u,p,f,h,m,y,_,v=this;return r(this,(function(r){return t=this.sourceJSON,n=Math.ceil((t.extent.xmax-t.extent.xmin)/t.pixelSizeX-.1),i=Math.ceil((t.extent.ymax-t.extent.ymin)/t.pixelSizeY-.1),o=s.SpatialReference.fromJSON(t.spatialReference||t.extent.spatialReference),"Map"===this.tileType?[2,new d({width:n,height:i,bandCount:3,extent:s.Extent.fromJSON(t.extent),spatialReference:o,pixelSize:new s.Point({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:o}),pixelType:"u8",statistics:null})]:(a=e.slice,u=e.signal,p=!!t.hasRasterAttributeTable&&l(this.url+"/rasterAttributeTable",{query:{slice:a,f:"json"},signal:u}).then((function(e){return x.fromJSON(e.data)})).catch((function(){return null})),f=!!t.hasColormap&&l(this.url+"/colormap",{query:{slice:a,f:"json"},signal:u}).then((function(e){return e.data&&e.data.colormap})),h=!!t.hasHistograms&&l(this.url+"/histograms",{query:{slice:a,f:"json"},signal:u}).then((function(e){return e.data&&e.data.histograms})),m=l(this.url+"/keyProperties",{query:{f:"json"},signal:u}).then((function(e){return e.data})).catch((function(){})),y=!!t.hasMultidimensions&&l(this.url+"/multidimensionalInfo",{query:{f:"json"},signal:u}).then((function(e){return e.data&&e.data.multidimensionalInfo})),_=!!t.hasMultidimensions&&l(this.url+"/slices",{query:{f:"json"},signal:u}).then((function(e){return e.data&&e.data.slices})).catch((function(){})),[2,c.all([p,f,h,m,y,_]).then((function(e){var r=null;if(t.minValues&&t.minValues.length===t.bandCount){r=[];for(var a=0;a<t.minValues.length;a++)r.push({min:t.minValues[a],max:t.maxValues[a],avg:t.meanValues[a],stddev:t.stdvValues[a]})}return v._slices=e[5]||null,new d({width:n,height:i,bandCount:t.bandCount,extent:s.Extent.fromJSON(t.extent),spatialReference:o,pixelSize:new s.Point({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:o}),pixelType:t.pixelType.toLowerCase(),statistics:r,attributeTable:e[0]||null,colormap:e[1]||null,histograms:e[2]||null,keyProperties:e[3]||null,multidimensionalInfo:e[4]||null})}))])}))}))},n([h.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),n([h.property()],t.prototype,"sourceJSON",void 0),n([h.property()],t.prototype,"tileType",void 0),n([h.subclass("esri.layers.support.rasterDatasets.ImageServerRaster")],t)}(h.declared(v))}.apply(null,n))||(e.exports=i)},1997:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(0),r(9),r(1),r(18),r(10),r(13),r(4),r(2),r(1110),r(1161),r(1242),r(1243),r(1998)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,h,d,m){var y,_,v=(y=new ArrayBuffer(4),_=new Uint8Array(y),new Uint32Array(y)[0]=1,1===_[0]),g=new Map;g.set("Int8","s8"),g.set("UInt8","u8"),g.set("Int16","s16"),g.set("UInt16","u16"),g.set("Int32","s32"),g.set("UInt32","u32"),g.set("Float32","f32"),g.set("Float64","f32"),g.set("Double64","f32");var x=new Map;return x.set("lerc",".lrc"),x.set("none",".til"),x.set("deflate",".pzp"),x.set("jpeg",".jzp"),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._files=null,t._storageIndex=null,t}return o(t,e),t.prototype.open=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,s,u,p,c,f,h,d,m,y,_,v,g,x,b,w,P;return r(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),t=e?l.unwrap(e.signal):null,[4,this.request({url:this.url,responseType:"xml"},t)];case 2:return n=r.sent(),i=this._parseHeader(n),o=i.rasterInfo,a=i.files,this._set("rasterInfo",o),this._files=a,[4,this.request({url:a.index,responseType:"array-buffer"},t)];case 3:for(s=r.sent(),this._storageIndex=this._parseIndex(s),u=0,p=-1,h=this.rasterInfo.storageInfo,d=h.blockWidth,m=h.blockHeight,y=h.compression,_=this.rasterInfo.storageInfo.pyramidScalingFactor,v=this.rasterInfo,g=v.width,x=v.height,b=v.bandCount,w=[],P="none"===y?1:b;u<this._storageIndex.length;)p++,c=Math.ceil(g/d/Math.pow(_,p)),f=Math.ceil(x/m/Math.pow(_,p)),u+=c*f*P*4,w.push({maxRow:f,maxCol:c,minCol:0,minRow:0});return this.rasterInfo.storageInfo.blockBoundary=w,p>0&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=p),[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,o){return void 0===o&&(o={}),i(this,void 0,void 0,(function(){var i,a,s,l,p,f,h,d,m,y,_,v,g,x,b,w,P,T,S,I,E,R,O,M,N,A;return r(this,(function(r){switch(r.label){case 0:if(i=this.rasterInfo.storageInfo,a=i.blockWidth,s=i.blockHeight,l=i.blockBoundary,p=i.compression,!(f=l[e])||f.maxRow<t||f.maxCol<n||f.minRow>t||f.minCol>n)return[2,null];if(h=this.rasterInfo,d=h.bandCount,m=h.pixelType,y=this._getTileLocation(e,t,n),_=y.ranges,v=y.actualTileWidth,g=y.actualTileHeight,!_||0===_.length)return[2,null];if(0===_[0].from&&0===_[0].to)return A=new Uint8Array(a*s),[2,new c({width:a,height:s,pixels:null,mask:A,validPixelCount:0})];for(x=this.ioConfig.bandIds,b="none"===p?1:d,w=[],P=0,P=0;P<b;P++)(!x||x.indexOf[P]>-1)&&w.push(this.request({url:this._files.data,range:{from:_[P].from,to:_[P].to},responseType:"array-buffer"},o.signal));return[4,u.all(w)];case 1:for(T=r.sent(),S=T.map((function(e){return e.byteLength})).reduce((function(e,t){return e+t})),I=new Uint8Array(S),E=0,P=0;P<b;P++)I.set(new Uint8Array(T[P]),E),E+=T[P].byteLength;return R="lerc"===this.rasterInfo.storageInfo.compression?"lerc":"bip",[4,this.decodePixelBlock(I.buffer,{width:a,height:s,format:R,pixelType:m})];case 2:if(O=r.sent(),M=0,N=0,v!==a||g!==s)if(A=O.mask)for(P=0;P<s;P++)if(N=P*a,P<g)for(M=v;M<a;M++)A[N+M]=0;else for(M=0;M<a;M++)A[N+M]=0;else for(A=new Uint8Array(a*s),O.mask=A,P=0;P<g;P++)for(N=P*a,M=0;M<v;M++)A[N+M]=1;return[2,O]}}))}))},t.prototype._parseIndex=function(e){if(e.byteLength%16>0)throw"invalid array buffer must be multiples of 16";var t,r,n,i,o,a;if(v){for(r=new Uint8Array(e),i=new ArrayBuffer(e.byteLength),n=new Uint8Array(i),o=0;o<e.byteLength/4;o++)for(a=0;a<4;a++)n[4*o+a]=r[4*o+3-a];t=new Uint32Array(i)}else t=new Uint32Array(e);return t},t.prototype._getTileLocation=function(e,t,r){var n,i,o,a=this.rasterInfo.storageInfo,s=a.blockWidth,l=a.blockHeight,u=a.pyramidScalingFactor,p=a.compression,c=this.rasterInfo,f=c.width,h=c.height,d=c.bandCount,m="none"===p?1:d,y=0,_=0;for(o=0;o<e;o++)_=Math.pow(u,o),y+=(n=Math.ceil(f/s/_))*(i=Math.ceil(h/l/_));_=Math.pow(u,e),n=Math.ceil(f/s/_),i=Math.ceil(h/l/_),y+=t*n+r,y*=4*m;for(var v=this._storageIndex.subarray(y,y+4*m),g=0,x=0,b=[],w=0;w<m;w++)x=(g=v[4*w+0]*Math.pow(2,32)+v[4*w+1])+v[4*w+2]*Math.pow(2,32)+v[4*w+3],b.push({from:g,to:x});return{ranges:b,actualTileWidth:r<n-1?s:Math.ceil(f/_)-s*(n-1),actualTileHeight:t<i-1?l:Math.ceil(h/_)-l*(i-1)}},t.prototype._parseHeader=function(e){var t=m.getElement(e,"MRF_META/Raster");if(!t)throw new s("mrf:open","not a valid MRF format");var r=m.getElement(t,"Size"),n=parseInt(r.getAttribute("x"),10),i=parseInt(r.getAttribute("y"),10),o=parseInt(r.getAttribute("c"),10),l=(m.getElementValue(t,"Compression")||"none").toLowerCase();if(!l||-1===["none","lerc"].indexOf(l))throw new s("mrf:open","currently does not support compression "+l);var u=m.getElementValue(t,"DataType")||"UInt8",p=g.get(u);if(null==p)throw new s("mrf:open","currently does not support pixel type "+u);var c,d,y=m.getElement(t,"PageSize"),_=parseInt(y.getAttribute("x"),10),v=parseInt(y.getAttribute("y"),10),b=m.getElement(t,"DataValues");if(b&&null!=(d=b.getAttribute("NoData"))&&(c=d.trim().split(" ").map((function(e){return parseFloat(e)}))),m.getElement(e,"MRF_META/CachedSource"))throw new s("mrf:open","currently does not support MRF referencing other data files");var w=m.getElement(e,"MRF_META/GeoTags"),P=m.getElement(w,"BoundingBox");if(null==P)throw new s("mrf:open","missing node MRF_META/GeoTags/BoundingBox");var T,S=parseFloat(P.getAttribute("minx")),I=parseFloat(P.getAttribute("miny")),E=parseFloat(P.getAttribute("maxx")),R=parseFloat(P.getAttribute("maxy")),O=m.getElementValue(w,"Projection"),M=m.getElementValue(e,"datafile"),N=m.getElementValue(e,"IndexFile");"LOCAL_CS[]"!==O&&(T=new a.SpatialReference({wkt:O}));var A=new a.Extent(S,I,E,R);A.spatialReference=T;var C=m.getElement(e,"MRF_META/Rsets"),k=parseInt(C&&C.getAttribute("scale")||"2",10),D=new h({origin:new a.Point({x:A.xmin,y:A.ymax,spatialReference:T}),blockWidth:_,blockHeight:v,pyramidBlockWidth:_,pyramidBlockHeight:v,compression:l,pyramidScalingFactor:k}),F=new a.Point({x:(E-S)/n,y:(R-I)/i,spatialReference:T});return{rasterInfo:new f({width:n,height:i,extent:A,spatialReference:T,bandCount:o,pixelType:p,pixelSize:F,noDataValue:c,storageInfo:D}),files:{mrf:this.url,index:N||this.url.replace(".mrf",".idx"),data:M||this.url.replace(".mrf",x.get(l))}}},n([p.property()],t.prototype,"_files",void 0),n([p.property()],t.prototype,"_storageIndex",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),n([p.subclass("esri.layers.support.rasterIO.MRFRaster")],t)}(p.declared(d))}.apply(null,n))||(e.exports=i)},1998:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){if(!e||!t)return[];var r,i=t;if(t.indexOf("/")>-1?(i=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="",!(r=t?n(e,i).getElementsByTagNameNS("*",t):e.getElementsByTagNameNS("*",i))||0===r.length)return[];for(var o=[],a=0;a<r.length;a++)o.push(r[a]||r.item[a]);return o}function n(e,t){if(!e||!t)return null;var i=t;t.indexOf("/")>-1?(i=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var o=r(e,i);return o.length>0?t?n(o[0],t):o[0]:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getElements=r,t.getElement=n,t.getElementValue=function(e,t){var r,i=n(e,t);return i&&(r=i.textContent||i.nodeValue||i.innerText)?r.trim():null},t.getElementValues=function(e,t){for(var n,i=r(e,t),o=[],a=0;a<i.length;a++)(n=i[a].textContent||i[a].nodeValue||i[a].innerText)&&""!==(n=n.trim())&&o.push(n);return o}}.apply(null,n))||(e.exports=i)},1999:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(0),r(9),r(1),r(5),r(18),r(10),r(13),r(2),r(1161),r(1242),r(1243),r(1406),r(1408)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,h,d,m){var y=function(e,t){var r=e.get(t);return r&&r.values},_=function(e,t){var r=e.get(t);return r&&r.values[0]};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._files=null,t._headerInfo=null,t._bufferSize=1048576,t}return o(t,e),t.prototype.open=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,p,h,m,y,_,v,g,x,b,w,P,T,S,I,E,R,O,M,N,A,C,k,D;return r(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),t=e?u.unwrap(e.signal):null,[4,this.request({url:this.url,range:{from:0,to:this._bufferSize},responseType:"array-buffer"},t)];case 2:if(!(n=r.sent()))throw new l("tiffraster:open","failed to open url "+this.url);return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),i=d.parseSignature(n),o=i.littleEndian,p=i.firstIFD,h=[],[4,this.readIFDs(h,n,o,p,0,4,t)];case 3:if(r.sent(),m=d.getImageInfo(h),y=m.width,_=m.height,v=m.tileWidth,g=m.tileHeight,x=m.planes,b=m.pixelType,w=m.compression,P=m.firstPyramidLevel,T=m.maximumPyramidLevel,S=m.pyramidBlockWidth,I=m.pyramidBlockHeight,E=m.tileBoundary,R=m.metadata,O=s.Extent.fromJSON(m.extent),M=O.spatialReference,N=O?new s.Point({x:O.xmin,y:O.ymax,spatialReference:M}):new s.Point({x:0,y:0}),A=new f({blockWidth:v,blockHeight:g,pyramidBlockWidth:S,pyramidBlockHeight:I,compression:w,origin:N,firstPyramidLevel:P,maximumPyramidLevel:T,blockBoundary:E}),C=new s.Point({x:(O.xmax-O.xmin)/y,y:(O.ymax-O.ymin)/_,spatialReference:M}),k=R?{BandProperties:R.bandProperties,DataType:R.dataType}:null,D=new c({width:y,height:_,bandCount:x,pixelType:b,compression:w,pixelSize:C,storageInfo:A,spatialReference:M,keyProperties:k,extent:O,statistics:R?R.statistics:null}),this._set("rasterInfo",D),this._headerInfo=a({littleEndian:o,ifds:h},m),!this._headerInfo.isSupported)throw new l("tiffraster:open","this tiff is not supported: "+this._headerInfo.message);return[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,o){return void 0===o&&(o={}),i(this,void 0,void 0,(function(){var i,a,s,l,u,p,c,f,h,d,m,y,_,v,g;return r(this,(function(r){switch(r.label){case 0:return!this._headerInfo&&this._headerInfo.isSupported?[2,null]:(i=this.rasterInfo.storageInfo.blockBoundary,a=e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,s=e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight,!(l=i[e])||l.maxRow<t||l.maxCol<n||l.minRow>t||l.minCol>n?[2,null]:(u=this.getTileLocation(e,t,n))?(p=u.range,c=u.actualTileWidth,f=u.actualTileHeight,h=u.ifd,[4,this.request({url:this.url,range:p,responseType:"array-buffer"},o.signal)]):[2,null]);case 1:return d=r.sent(),[4,this.decodePixelBlock(d,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:h,offset:0,size:0},width:a,height:s,planes:null,pixelType:null})];case 2:if(m=r.sent(),c!==a||f!==s)if(g=m.mask)for(y=0;y<s;y++)if(v=y*a,y<f)for(_=c;_<a;_++)g[v+_]=0;else for(_=0;_<a;_++)g[v+_]=0;else for(g=new Uint8Array(a*s),m.mask=g,y=0;y<f;y++)for(v=y*a,_=0;_<c;_++)g[v+_]=1;return[2,m]}}))}))},t.prototype.readIFDs=function(e,t,n,o,a,s,l){return void 0===s&&(s=4),i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return o?o>=t.byteLength||o<0?[4,this.request({url:this.url,range:{from:o+a,to:o+a+this._bufferSize},responseType:"array-buffer"},l)]:[3,2]:[2,null];case 1:t=r.sent(),a=o+a,o=0,r.label=2;case 2:return[4,this.readIFD(t,n,o,a,m.TIFF_TAGS,s,l)];case 3:return i=r.sent(),e.push(i.ifd),i.nextIFD?[4,this.readIFDs(e,t,n,i.nextIFD-a,a,s,l)]:[2,null];case 4:return r.sent(),[2]}}))}))},t.prototype.readIFD=function(e,t,n,o,a,s,l){return void 0===a&&(a=m.TIFF_TAGS),void 0===s&&(s=4),i(this,void 0,void 0,(function(){var i,u,p,c,f,h,y,_;return r(this,(function(r){switch(r.label){case 0:return e?(i=d.parseIFD(e,t,n,o,a,s)).success?(u=[],i.ifd.forEach((function(e){e.values||u.push(e)})),u.length>0?(p=u.map((function(e){return e.offlineOffsetSize})),c=Math.min.apply(null,p.map((function(e){return e[0]}))),Math.min.apply(null,p.map((function(e){return e[0]+e[1]})))-c<=this._bufferSize?[4,this.request({url:this.url,range:{from:c,to:c+this._bufferSize},responseType:"array-buffer"},l)]:[3,2]):[3,2]):[3,5]:[2,null];case 1:e=r.sent(),o=c,u.forEach((function(r){return d.parseFieldValues(e,t,r,o)})),r.label=2;case 2:return i.ifd.has("GEOKEYDIRECTORY")?(f=i.ifd.get("GEOKEYDIRECTORY"),(h=f.values)&&h.length>4?(y=h[0]+"."+h[1]+"."+h[2],[4,this.readIFD(e,t,f.valueOffset+6-o,o,m.GEO_KEYS,2,l)]):[3,4]):[3,4];case 3:_=r.sent(),f.data=_.ifd,f.data&&f.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[y]}),r.label=4;case 4:return[2,i];case 5:return i.requiredBufferSize&&i.requiredBufferSize!==e.byteLength?[4,this.request({url:this.url,range:{from:o,to:o+i.requiredBufferSize+4},responseType:"array-buffer"},l)]:[3,7];case 6:return(e=r.sent()).byteLength<i.requiredBufferSize?[2,null]:[2,this.readIFD(e,t,0,o,m.TIFF_TAGS,4,l)];case 7:return[2]}}))}))},t.prototype.getTileLocation=function(e,t,r){var n=this.rasterInfo.storageInfo,i=n.firstPyramidLevel,o=n.blockBoundary,a=0===e?0:e-(i-1),s=this._headerInfo.ifds[a];if(!s)return null;var l=y(s,"TILEOFFSETS");if(void 0===l)return null;var u=y(s,"TILEBYTECOUNTS"),p=o[a],c=p.minRow,f=p.minCol,h=p.maxRow,d=p.maxCol;if(t>h||r>d||t<c||r<f)return null;var m=_(s,"IMAGEWIDTH"),v=_(s,"IMAGELENGTH"),g=_(s,"TILEWIDTH"),x=_(s,"TILELENGTH"),b=t*(d+1)+r,w=l[b],P=u[b];return null==w||null==P?null:{range:{from:w,to:w+P-1},ifd:s,actualTileWidth:r===d?m%g:g,actualTileHeight:t===h?v%x:x}},n([p.property()],t.prototype,"_files",void 0),n([p.property()],t.prototype,"_headerInfo",void 0),n([p.property()],t.prototype,"_bufferSize",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),n([p.subclass("esri.layers.support.rasterDatasets.TIFFRaster")],t)}(p.declared(h))}.apply(null,n))||(e.exports=i)}}]);