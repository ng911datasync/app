(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/layers/features/processors/BaseProcessor":1337,"esri/views/2d/layers/features/processors/SymbolProcessor":2095,"esri/layers/support/labelFormatUtils":2096})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{1337:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(0),r(8),r(9),r(132),r(2)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initialize=function(){},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null},enumerable:!0,configurable:!0}),n([s.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),n([s.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),n([s.property({constructOnly:!0})],t.prototype,"service",void 0),n([s.property({dependsOn:["tileStore.tileScheme.spatialReference"]})],t.prototype,"spatialReference",null),n([s.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),n([s.property({constructOnly:!0})],t.prototype,"tileStore",void 0),n([s.subclass("esri.views.2d.layers.features.processors.BaseProcessor")],t)}(s.declared(a.HandleOwner));t.default=l}.apply(null,n))||(e.exports=i)},2095:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(0),r(5),r(8),r(9),r(10),r(15),r(6),r(13),r(4),r(2),r(24),r(216),r(2096),r(136),r(320),r(345),r(1264),r(1269),r(1337)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,p,f,d,y,h,v,g,m,b,_,w){Object.defineProperty(t,"__esModule",{value:!0});var O=u.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor"),S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._symbolToMosaicItemMap=new Map,t._visualSetPromises=new Map,t.type="symbol",t}return r(t,e),t.prototype.initialize=function(){this._factory=this._createFactory()},t.prototype.destroy=function(){this._visualSetPromises.clear(),this._symbolToMosaicItemMap.clear(),this.notifyChange("updating")},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelingInfo",{get:function(){return!this.config||c.isNone(this.config.labelingInfo)?null:this.config.labelingInfo.map((function(e){return y.fromJSON(e)}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelClassInfos",{get:function(){var e=this;if(!this.labelingInfo)return p.resolve();var t=function(t){return a(e,void 0,void 0,(function(){var e,r,n;return o(this,(function(i){switch(i.label){case 0:e=null,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,h.createLabelFunction(t,this.service.fields,this.spatialReference)];case 2:return e=i.sent(),[3,4];case 3:return r=i.sent(),n=t.where?"where":"arcade",O.error(new s("mapview-labeling","Failed to evaluate "+n+" expression",{labelClass:t,error:r})),[3,4];case 4:return[2,e]}}))}))};return p.all(this.labelingInfo.map((function(r,n){return a(e,void 0,void 0,(function(){var e;return o(this,(function(i){switch(i.label){case 0:return e=c.andThen,[4,t(r)];case 1:return[2,e.apply(void 0,[i.sent(),function(e){return{index:n,minScale:r.minScale,maxScale:r.maxScale,builder:e,symbol:r.symbol,symbolJSON:r.symbol.toJSON()}}])]}}))}))}))).then((function(e){return e.filter((function(e){return e}))}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hydrate",{get:function(){return m.createHydrateFactory(this.service.geometryType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?v.fromJSON(this.config.renderer):(l("esri-2d-debug"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._visualSetPromises.size>0},enumerable:!0,configurable:!0}),t.prototype.update=function(e){return a(this,void 0,void 0,(function(){var t;return o(this,(function(r){return t=this._getMeshHash(),this._set("config",e),t!==this._getMeshHash()?this._factory=this._createFactory():this._factory.update(this.labelingInfo,this.renderer,this.tileStore.tileScheme.tileInfo),[2]}))}))},t.prototype.onTileData=function(e,t,r){var n=this,i=this._onTileData(e,t,r);return this._visualSetPromises.set(e,i),p.always(i,(function(){return n._cleanPromise(e)})),this.notifyChange("updating"),i},t.prototype.onTileError=function(e,t,r){var n=this,i=r.signal,o={tileKey:e.id,error:t},a=this.remoteClient.invoke("tileRenderer.onTileError",o,{signal:i});return this._visualSetPromises.set(e,a),p.always(a,(function(){return n._cleanPromise(e)})),this.notifyChange("updating"),a},t.prototype._getMeshHash=function(){var e=b.getVVFlags("visualVariables"in this.renderer&&this.renderer.visualVariables||[]);return this.renderer.getMeshHash()+"."+e},t.prototype._createFactory=function(){var e=this,t=this.service,r=t.geometryType,n=t.objectIdField,i={geometryType:r,fields:t.fields,spatialReference:d.fromJSON(this.spatialReference)},o=new g.WGLTemplateStore((function(t,r){return e.remoteClient.invoke("tileRenderer.getMaterialItems",t,r)}),!1),a=this.tileStore.tileScheme.tileInfo;return this._store=o,this._matcher=g.createMatcher(o,i,this.renderer),new g.WGLMeshFactory(r,n,this.renderer,o,this.labelingInfo,a)},t.prototype._cleanPromise=function(e){this._visualSetPromises.delete(e),this.notifyChange("updating")},t.prototype._onTileData=function(e,t,r){return a(this,void 0,void 0,(function(){var n,i,a,s,l,u,p,f,d,y,h;return o(this,(function(o){switch(o.label){case 0:n=t.addOrUpdate,i=t.remove,a=t.clear,s=this._processFeatures(e,n,t.transformParams),l=r.signal,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,s];case 2:return u=o.sent(),p=c.andThen(u,(function(e){return e.message})),f=c.andThen(u,(function(e){return e.transferList}))||[],d={addOrUpdate:p,remove:i,clear:a},y={transferList:c.unwrap(f)||[],signal:l},[2,this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:d},y)];case 3:return h=o.sent(),this._handleError(e,h,r),[3,4];case 4:return[2]}}))}))},t.prototype._processFeatures=function(e,t,r){return a(this,void 0,void 0,(function(){var n,i,a,s,l;return o(this,(function(o){switch(o.label){case 0:return t&&t.length?(n=this._factory,i={viewingMode:"",scale:e.scale},[4,this._matcher]):[2,null];case 1:return a=o.sent(),[4,this._getLabelInfos(e,t,r)];case 2:return s=o.sent(),[4,n.analyze(t,a,r,i)];case 3:return l=o.sent(),[2,this._writeFeatures(e,l,r,s,n)]}}))}))},t.prototype._writeFeatures=function(e,t,r,n,i){for(var o=i.createMeshData(t.length),a={viewingMode:"",scale:e.scale},u=0,p=t;u<p.length;u++){var f=p[u];try{var d=c.isSome(n)?n.get(f.localId):null;i.write(o,f,r,a,e.level,d)}catch(e){l("esri-2d-debug")&&O.error(new s("mapview-mesh-factory","Failed to write feature",{error:e,feature:f}))}}return this._encodeDisplayData(o)},t.prototype._encodeDisplayData=function(e){var t={},r=new Array;return e.encode(t,r),{message:t,transferList:r}},t.prototype._handleError=function(e,t,r){if(!p.isAbortError(t)){var n={tileKey:e.id,error:t.message};return this.remoteClient.invoke("tileRenderer.onTileError",n,{signal:r.signal})}},t.prototype._getLabelClassInfosForScale=function(e){return a(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.labelClassInfos];case 1:return[2,t.sent().filter((function(t){var r=t.minScale,n=t.maxScale;return(!r||r>=e||0===r)&&(!n||n<=e||0===n)}))]}}))}))},t.prototype._shouldDiscard=function(e,t){switch(this.service.geometryType){case"esriGeometryPoint":var r=t.geometry,n=r.x,i=r.y;return e.checkOverlap(n,i);case"esriGeometryPolygon":var o=t.centroid;return n=o.x,i=o.y,e.checkOverlap(n,i);default:return!1}},t.prototype._markUsed=function(e,t){switch(this.service.geometryType){case"esriGeometryPoint":var r=t.geometry,n=r.x,i=r.y;return e.markUsed(n,i);case"esriGeometryPolygon":var o=t.centroid;return n=o.x,i=o.y,e.markUsed(n,i)}},t.prototype._getLabelInfos=function(e,t,r){return a(this,void 0,void 0,(function(){var n,a,s,l,u,p,f,y,h;return o(this,(function(o){switch(o.label){case 0:return this.labelingInfo&&t&&0!==t.length?[4,this._getLabelClassInfosForScale(e.scale)]:[2,null];case 1:if(0===(n=o.sent()).length)return[2,null];for(a=new Map,s=new g.CollisionGrid(g.definitions.COLLISION_EARLY_REJECT_BUCKET_SIZE),l=function(e){var t=e.localId;if(u._shouldDiscard(s,e))return a.set(t,null),"continue";for(var o=function(e,t){for(var r=new Array(e),n=0;n<r.length;n++)r[n]=null;return r}(n.length),l=!1,p=function(t){var a,s=n[t],p=s.index,f=s.builder,y=s.symbolJSON;if(!r)return O.error("mapview-labeling","Tried to evaluate geometry expression but no transformation found"),{value:void 0};var h=r.transform,v=r.hasZ,m=r.hasM,b=u.hydrate(e.geometry,h,v,m),w=i({},e,{geometry:b});b.spatialReference=d.fromJSON(u.spatialReference),a=w;var S=f.evaluate(a);if(c.isNone(S)||""===S)return"continue";var I=g.bidiText(S),P=I[0],T=I[1];l=!0,u._store.getMosaicItem(y,!1,_.codepoints(P)).then((function(e){o[p]={glyphs:e.glyphMosaicItems,rtl:T,classIndex:p}}))},f=0;f<n.length;f++){var y=p(f);if("object"==typeof y)return y}a.set(t,o),l&&u._markUsed(s,e)},u=this,p=0,f=t;p<f.length;p++)if(y=f[p],"object"==typeof(h=l(y)))return[2,h.value];return[2,a]}}))}))},n([f.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),n([f.property()],t.prototype,"config",void 0),n([f.property({dependsOn:["config"]})],t.prototype,"labelingInfo",null),n([f.property({dependsOn:["labelingInfo","service","spatialReference"]})],t.prototype,"labelClassInfos",null),n([f.property({dependsOn:["service"]})],t.prototype,"hydrate",null),n([f.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),n([f.property({readOnly:!0})],t.prototype,"updating",null),n([f.subclass("esri.views.2d.layers.features.processors.SymbolProcessor")],t)}(f.declared(w.default));t.default=S}.apply(null,n))||(e.exports=i)},2096:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(1),r(8),r(9),r(10),r(6),r(4),r(112),r(145),r(328),r(28),r(238),r(67)],void 0===(i=function(e,t,n,i,o,a,s,l,u,c,p,f,d,y,h){Object.defineProperty(t,"__esModule",{value:!0});var v=l.getLogger("esri.layers.support.labelFormatUtils"),g={type:"simple",evaluate:function(){return null}};function m(){return a(this,void 0,void 0,(function(){return o(this,(function(e){return[2,u.create((function(e){r.e(5).then(function(){var t=[r(1002)];e.apply(null,t)}.bind(this)).catch(r.oe)}))]}))}))}function b(e,t,r,n){var i=d.getField(n,e);if(!i)return t;if(null==r[i.name])return"";var o=i.domain;if(o)if("codedValue"===o.type||"coded-value"===o.type)for(var a=r[i.name],s=0,l=o.codedValues;s<l.length;s++){var u=l[s];if(u.code===a)return u.name}else if("range"===o.type){var f=+r[i.name],y="range"in o?o.range[0]:o.minValue,h="range"in o?o.range[1]:o.maxValue;if(y<=f&&f<=h)return o.name}var v=r[i.name];return"date"===i.type||"esriFieldTypeDate"===i.type?v=c.formatDate(v,c.convertDateFormatToIntlOptions("short-date")):d.isNumericField(i)&&(v=p.formatNumber(+v)),v||""}t.createLabelFunction=function(e,t,r){return a(this,void 0,void 0,(function(){var n,i,a,l,u,c,p,d;return o(this,(function(o){switch(o.label){case 0:return e&&e.symbol?(n=e.where,i=e.getLabelExpression(),n?[4,m()]:[3,2]):[2,g];case 1:return l=o.sent(),[3,3];case 2:l=null,o.label=3;case 3:return a=l,"arcade"!==i.type?[3,5]:[4,h.createLabelExpression(i.expression,r,t)];case 4:return c=o.sent(),u={type:"arcade",evaluate:function(e){try{var t=c.evaluate({$feature:c.repurposeFeature(e)});if(null!=t)return t.toString()}catch(t){v.error(new s("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:e,expression:i}))}return null},needsHydrationToEvaluate:function(){return null==y.getSingleFieldArcadeExpression(i.expression)}},[3,6];case 5:u={type:"simple",evaluate:function(e){var r=e&&e.attributes;return r?i.expression.replace(/{[^}]*}/g,(function(e){return b(e.slice(1,-1),e,r,t)})):null}},o.label=6;case 6:if(n){try{p=a.WhereClause.create(n,new f(t))}catch(e){return[2,g]}d=u.evaluate,u.evaluate=function(e){return p.testFeature(e)?d(e):null}}return[2,u]}}))}))},t.formatField=b}.apply(null,n))||(e.exports=i)}}]);