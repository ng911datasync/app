(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/sql/WhereClause":1002,"esri/layers/graphics/data/utils":1081,"esri/layers/graphics/data/attributeSupport":1087,"esri/layers/graphics/data/QueryEngine":1094,"esri/layers/graphics/centroid":1106,"esri/layers/graphics/data/spatialQuerySupport":1107,"esri/layers/graphics/data/timeSupport":1112,"esri/layers/graphics/data/FeatureStore":1123,"esri/core/ItemCache":1124,"esri/core/sql/WhereClauseCache":1141,"esri/layers/graphics/data/QueryEngineCapabilities":1142,"esri/layers/graphics/contains":1143,"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":1144,"esri/layers/graphics/data/executeTileQuery":1159,"esri/layers/graphics/data/BoundsStore":1179,"esri/core/sql/AggregateFunctions":1180,"esri/core/sql/StandardizedFunctions":1181,"esri/core/sql/WhereGrammar":1182,"esri/core/sql/sql92grammar":1183,"esri/layers/graphics/data/QueryEngineResult":1184,"esri/layers/graphics/data/AttributesBuilder":1185,"esri/layers/support/PromiseQueue":1186,"esri/geohash/geohashUtils":1207,"esri/views/2d/layers/features/controllers/BaseController":1333,"esri/views/2d/layers/features/support/ClusterStore":1334,"esri/geohash/GeohashTree":1335,"esri/views/2d/layers/features/support/pixelBuffering":1336,"esri/views/2d/layers/features/controllers/StreamController":2089,"esri/layers/graphics/data/StreamFeatureManager":2090,"esri/layers/graphics/sources/connections/GeoEventConnection":2091,"esri/layers/graphics/sources/connections/StreamConnection":2092,"esri/views/2d/layers/features/controllers/support/DispatchQueue":2093})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[41,5],{1002:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(15),r(99),r(1180),r(1181),r(1182)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,u=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,l=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,c=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,h=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function d(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function f(e,t,r,n,i,o,a,s,u){if(void 0===r&&(r="0"),void 0===n&&(n="0"),void 0===i&&(i="0"),void 0===o&&(o="0"),void 0===a&&(a=""),void 0===s&&(s="0"),void 0===u&&(u="0"),"+"===a||"-"===a){var l=d(parseInt(e,10),4)+"-"+d(parseInt(t,10),2)+"-"+d(parseInt(r,10),2),c="";parseFloat(o)<10&&(c="0");var h=d(parseInt(n,10),2)+":"+d(parseInt(i,10),2)+":"+(c+parseFloat(o).toString()),f=""+a+d(parseInt(s,10),2)+":"+d(parseInt(u,10),2);return new Date(l+"T"+h+f)}return new Date(parseInt(e,10),parseInt(t,10)-1,parseInt(r,10),parseInt(n,10),parseInt(i,10),parseFloat(o))}var p=function(){function e(){}return e.makeBool=function(e){return m(e)},e.featureValue=function(e,t,r,n){return M(e,t,r,n)},e.equalsNull=function(e){return null===e},e.applyLike=function(e,t,r){return w(e,t,r)},e.ensureArray=function(e){return _(e)},e.applyIn=function(e,t){return x(e,t)},e.currentDate=function(){var e=new Date;return e.setHours(0,0,0,0),e},e.makeSqlInterval=function(e,t,r){return o.SqlInterval.createFromValueAndQualifer(e,t,r)},e.convertInterval=function(e){return e instanceof o.SqlInterval?e.valueInMilliseconds():e},e.currentTimestamp=function(){return new Date},e.compare=function(e,t,r){return F(e,t,r)},e.calculate=function(e,t,r){return N(e,t,r)},e.makeComparable=function(e){return T(e)},e.evaluateFunction=function(e,t){return o.evaluateFunction(e,t)},e.lookup=function(e,t){var r=t[e];return void 0===r?null:r},e.between=function(e,t){return null==e||null==t[0]||null==t[1]?null:e>=t[0]&&e<=t[1]},e.notbetween=function(e,t){return null==e||null==t[0]||null==t[1]?null:e<t[0]||e>t[1]},e.ternaryNot=function(e){return b(e)},e.ternaryAnd=function(e,t){return I(e,t)},e.ternaryOr=function(e,t){return S(e,t)},e}(),v=function(){function e(e,t){this.fieldsIndex=t,this.datefields={},this.parameters={},this.parseTree=a.WhereGrammar.parse(e);var r=this.extractExpressionInfo(t),n=r.isStandardized,i=r.isAggregate,o=r.referencedFieldNames;this.referencedFieldNames=o,this.isStandardized=n,this.isAggregate=i}return e.create=function(t,r){return new e(t,r)},Object.defineProperty(e.prototype,"fieldNames",{get:function(){return this.referencedFieldNames},enumerable:!0,configurable:!0}),e.prototype.testSet=function(e,r){void 0===r&&(r=t.defaultAttributeAdapter);for(var n={},i=function(t){n[t]=e.map((function(e){return r.getAttribute(e,t)}))},o=0,a=this.fieldNames;o<a.length;o++)i(a[o]);return!!this.evaluateNode(this.parseTree,{attributes:n},t.defaultAttributeAdapter)},e.prototype.calculateValue=function(e,r){void 0===r&&(r=t.defaultAttributeAdapter);var n=this.evaluateNode(this.parseTree,e,r);return n instanceof o.SqlInterval?n.valueInMilliseconds()/864e5:n},e.prototype.calculateValueCompiled=function(e,n){return void 0===n&&(n=t.defaultAttributeAdapter),null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,n,this.datefields):r("csp-restrictions")?this.calculateValue(e,n):(this.compileMe(),this.parseTree._compiledVersion(e,this.parameters,n,this.datefields))},e.prototype.testFeature=function(e,r){return void 0===r&&(r=t.defaultAttributeAdapter),!!this.evaluateNode(this.parseTree,e,r)},e.prototype.testFeatureCompiled=function(e,n){return void 0===n&&(n=t.defaultAttributeAdapter),null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,n,this.datefields):r("csp-restrictions")?this.testFeature(e,n):(this.compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,n,this.datefields))},e.prototype.getFunctions=function(){var e=[];return this.visitAll(this.parseTree,(function(t){"function"===t.type&&e.push(t.name.toLowerCase())})),E(e)},e.prototype.getExpressions=function(){var e=new Map;return this.visitAll(this.parseTree,(function(t){if("function"===t.type){var r=t.name.toLowerCase(),n=t.args.value[0];if("column_ref"===n.type){var i=n.column,o=r+"-"+i;e.has(o)||e.set(o,{aggregateType:r,field:i})}}})),n.valuesOfMap(e)},e.prototype.getVariables=function(){var e=[];return this.visitAll(this.parseTree,(function(t){"param"===t.type&&e.push(t.value.toLowerCase())})),E(e)},e.prototype.compileMe=function(){var e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",e).bind(p)},e.prototype.extractExpressionInfo=function(e){var t=this,r=[],n=!0,a=!0;return this.visitAll(this.parseTree,(function(s){switch(s.type){case"column_ref":var u=e.get(s.column),l=u&&u.name;!u||"date"!==u.type&&"esriFieldTypeDate"!==u.type||(t.datefields[u.name]=1),void 0!==l?(r.push(l),s.column=l):r.push(s.column);break;case"function":var c=s.name,h=s.args.value.length;n&&(n=o.isStandardized(c,h)),a&&(a=i.isAggregate(c,h))}})),{referencedFieldNames:E(r),isStandardized:n,isAggregate:a}},e.prototype.visitAll=function(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(var r=0,n=e.clauses;r<n.length;r++){var i=n[r];this.visitAll(i,t)}"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(var o=0,a=e.value;o<a.length;o++)i=a[o],this.visitAll(i,t);break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}},e.prototype.evaluateNodeToJavaScript=function(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case_expression":var t="";if("simple"===e.format){var r="this.makeComparable("+this.evaluateNodeToJavaScript(e.operand)+")";t="( ";for(var n=0;n<e.clauses.length;n++)t+=" ("+r+" === this.makeComparable("+this.evaluateNodeToJavaScript(e.clauses[n].operand)+")) ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{for(t="( ",n=0;n<e.clauses.length;n++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[n].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t;case"param":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expr_list":for(var i="[",o=0,a=e.value;o<a.length;o++){var s=a[o];"["!==i&&(i+=","),i+=this.evaluateNodeToJavaScript(s)}return i+"]";case"unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary_expr":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")"}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return JSON.stringify(e.value);case"date":return"(new Date("+g(e.value).getTime().toString()+"))";case"timestamp":return"(new Date("+y(e.value).getTime().toString()+"))";case"current_time":return"date"===e.mode?"this.currentDate()":"this.currentTimestamp()";case"column_ref":return"this.featureValue(feature,"+JSON.stringify(e.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+")"}throw new Error("Unsupported sql syntax "+e.type)},e.prototype.evaluateNode=function(e,t,r){switch(e.type){case"interval":var n=this.evaluateNode(e.value,t,r);return o.SqlInterval.createFromValueAndQualifer(n,e.qualifier,e.op);case"case_expression":if("simple"===e.format){for(var a=T(this.evaluateNode(e.operand,t,r)),s=0;s<e.clauses.length;s++)if(a===T(this.evaluateNode(e.clauses[s].operand,t,r)))return this.evaluateNode(e.clauses[s].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}else{for(s=0;s<e.clauses.length;s++)if(m(this.evaluateNode(e.clauses[s].operand,t,r)))return this.evaluateNode(e.clauses[s].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":for(var u=[],l=0,c=e.value;l<c.length;l++){var h=c[l];u.push(this.evaluateNode(h,t,r))}return u;case"unary_expr":return b(this.evaluateNode(e.expr,t,r));case"binary_expr":switch(e.operator){case"AND":return I(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"OR":return S(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t,r);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t,r);case"IN":var d=_(this.evaluateNode(e.right,t,r));return x(this.evaluateNode(e.left,t,r),d);case"NOT IN":return d=_(this.evaluateNode(e.right,t,r)),b(x(this.evaluateNode(e.left,t,r),d));case"BETWEEN":var f=this.evaluateNode(e.left,t,r),p=this.evaluateNode(e.right,t,r);return null==f||null==p[0]||null==p[1]?null:f>=T(p[0])&&f<=T(p[1]);case"NOTBETWEEN":return f=this.evaluateNode(e.left,t,r),p=this.evaluateNode(e.right,t,r),null==f||null==p[0]||null==p[1]?null:f<T(p[0])||f>T(p[1]);case"LIKE":return w(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape);case"NOT LIKE":return b(w(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return F(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"-":case"+":case"*":case"/":return N(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r))}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return e.value;case"date":return g(e.value);case"timestamp":return y(e.value);case"current_time":var v=new Date;return"date"===e.mode&&v.setHours(0,0,0,0),v;case"column_ref":return M(t,e.column,this.datefields,r);case"function":var E=this.evaluateNode(e.args,t,r);return this.isAggregate?i.aggregateFunction(e.name,E):o.evaluateFunction(e.name,E)}throw new Error("Unsupported sql syntax "+e.type)},e}();function y(e){var t=u.exec(e);if(null!==t)return f(t[1],t[2],t[3],t[4],t[5],t[6]);if(null!==(t=l.exec(e)))return f(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9]);if(null!==(t=c.exec(e)))return f(t[1],t[2],t[3],t[4],t[5],"0",t[6],t[7],t[8]);if(null!==(t=h.exec(e)))return f(t[1],t[2],t[3],t[4],t[5]);if(null!==(t=s.exec(e)))return f(t[1],t[2],t[3]);throw new Error("SQL Invalid Timestamp")}function g(e){var t=s.exec(e);if(null===t)throw new Error("SQL Invalid Date");var r=t[1],n=t[2],i=t[3];return new Date(parseInt(r,10),parseInt(n,10)-1,parseInt(i,10))}function m(e){return!0===e}function _(e){return Array.isArray(e)?e:[e]}function b(e){return null!==e?!0!==e:null}function I(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function S(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function x(e,t){if(null==e)return null;for(var r=!1,n=0,i=t;n<i.length;n++){var o=i[n];if(null==o)r=null;else if(e===o){r=!0;break}}return r}function w(e,t,r){if(null==e)return null;for(var n=t,i=r,o="",a=0,s=0;s<n.length;s++){var u=n.charAt(s);switch(a){case 0:u===i?a=1:"-[]/{}()*+?.\\^$|".indexOf(u)>=0?o+="\\"+u:o+="%"===u?".*":"_"===u?".":u;break;case 1:"-[]/{}()*+?.\\^$|".indexOf(u)>=0?o+="\\"+u:o+=u,a=0}}return new RegExp("^"+o+"$").test(e)}function T(e){return e instanceof Date?e.valueOf():e}function F(e,t,r){if(null==t||null==r)return null;var n=T(t),i=T(r);switch(e){case"<>":return n!==i;case"=":return n===i;case">":return n>i;case"<":return n<i;case">=":return n>=i;case"<=":return n<=i}}function E(e){for(var t=[],r={},n=0,i=e;n<i.length;n++){var o=i[n],a=o.toLowerCase();void 0===r[a]&&(t.push(o),r[a]=1)}return t}function N(e,t,r){if(t instanceof o.SqlInterval)if(r instanceof Date)switch(e){case"+":return new Date(t.valueInMilliseconds()+r.getTime());case"-":return t.valueInMilliseconds()-r.getTime();case"*":return t.valueInMilliseconds()*r.getTime();case"/":return t.valueInMilliseconds()/r.getTime()}else if(r instanceof o.SqlInterval)switch(e){case"+":return o.SqlInterval.createFromMilliseconds(t.valueInMilliseconds()+r.valueInMilliseconds());case"-":return o.SqlInterval.createFromMilliseconds(t.valueInMilliseconds()-r.valueInMilliseconds());case"*":return t.valueInMilliseconds()*r.valueInMilliseconds();case"/":return t.valueInMilliseconds()/r.valueInMilliseconds()}else t=t.valueInMilliseconds();else if(r instanceof o.SqlInterval)if(t instanceof Date)switch(e){case"+":return new Date(r.valueInMilliseconds()+t.getTime());case"-":return new Date(t.getTime()-r.valueInMilliseconds());case"*":return t.getTime()*r.valueInMilliseconds();case"/":return t.getTime()/r.valueInMilliseconds()}else r=r.valueInMilliseconds();else if(t instanceof Date&&"number"==typeof r)switch(r=24*r*60*60*1e3,t=t.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}else if(r instanceof Date&&"number"==typeof t)switch(t=24*t*60*60*1e3,r=r.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r}}function M(e,t,r,n){var i=n.getAttribute(e,t);return null!=i&&1===r[t]?new Date(i):i}t.WhereClause=v,t.defaultAttributeAdapter={getAttribute:function(e,t){var r;return((r=e)&&"object"==typeof r.attributes?e.attributes:e)[t]}}}.apply(null,n))||(e.exports=i)},1081:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(9),r(12),r(13),r(4),r(53),r(201),r(19),r(329),r(37),r(1106),r(322),r(196),r(1070),r(1107)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,h,d,f,p,v,y){Object.defineProperty(t,"__esModule",{value:!0});var g=new i.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});t.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var m=new p.default,_=new p.default,b=new p.default,I={esriGeometryPoint:f.convertToPoint,esriGeometryPolyline:f.convertToPolyline,esriGeometryPolygon:f.convertToPolygon,esriGeometryMultipoint:f.convertToMultipoint};function S(e,t,r,n,i){void 0===n&&(n=e.hasZ),void 0===i&&(i=e.hasM);var o=e.hasZ&&n,a=e.hasM&&i;if(r){var s=f.quantizeOptimizedGeometry(b,t,e.hasZ,e.hasM,"esriGeometryPoint",r,n,i);return f.convertToPoint(s,o,a)}return f.convertToPoint(t,o,a)}function x(e,i,a){return n(this,void 0,void 0,(function(){var n,s,h,d,f,p;return r(this,(function(r){switch(r.label){case 0:return e?(n=e.where,e.where=n=n&&n.trim(),(!n||/^1 *= *1$/.test(n)||i&&i===n)&&(e.where=null),e.geometry?[4,w(e)]:[2,e]):[2,null];case 1:return s=r.sent(),e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel&&(h=e.geometry.spatialReference,(s=u.getGeometryExtent(s)).spatialReference=h),e.geometry=s,[4,v.checkProjectionSupport(s.spatialReference,a)];case 2:return r.sent(),[4,c.normalizeCentralMeridian(l.fromJSON(s))];case 3:if(d=r.sent()[0],o.isNone(d))throw t.QUERY_ENGINE_EMPTY_RESULT;return f=d.toJSON(),[4,v.project(f,f.spatialReference,a)];case 4:if(!(p=r.sent()))throw t.QUERY_ENGINE_EMPTY_RESULT;return p.spatialReference=a,e.geometry=p,[2,e]}}))}))}function w(e){return n(this,void 0,void 0,(function(){var t,n,i,o,u,l,c,d,f;return r(this,(function(r){switch(r.label){case 0:return t=e.geometry,n=e.distance,i=e.units,null==n?[2,a.resolve(t)]:(o=t.spatialReference,u=i&&g.fromJSON(i)||s.getUnitString(o),o&&(h.isGeographic(o)||h.isWebMercator(o))?(c=t,[3,3]):[3,1]);case 1:return[4,v.checkProjectionSupport(o,h.WGS84).then((function(){return v.project(t,h.WGS84)}))];case 2:c=r.sent(),r.label=3;case 3:return l=c,[4,y.getGeodesicBufferOperator()];case 4:return d=r.sent(),[2,(f=d(l,n,u))?f.toJSON():null]}}))}))}t.transformCentroid=S,t.getCentroid=function(e,t,r){return"esriGeometryPolygon"===e.geometryType&&t&&(t.centroid||t.geometry)?(t.centroid||(t.centroid=d.getCentroidOptimizedGeometry(new p.default,t.geometry,e.hasZ,e.hasM)),S(e,t.centroid,r)):null},t.getGeometry=function(e,t,r,n,i,o){void 0===i&&(i=e.hasZ),void 0===o&&(o=e.hasM);var a=e.hasZ&&i,s=e.hasM&&o,u=t?"coords"in t?t:t.geometry:null;if(!u)return null;if(r){var l=f.generalizeOptimizedGeometry(_,u,e.hasZ,e.hasM,e.geometryType,r,i,o);return n&&(l=f.quantizeOptimizedGeometry(b,l,a,s,e.geometryType,n)),I[e.geometryType](l,a,s)}return n?(l=f.quantizeOptimizedGeometry(b,u,e.hasZ,e.hasM,e.geometryType,n,i,o),I[e.geometryType](l,a,s)):(f.removeZMValues(m,u,e.hasZ,e.hasM,i,o),I[e.geometryType](m,a,s))},t.normalizeQuery=function(e,t,i){return n(this,void 0,void 0,(function(){var n,o,a,s,u;return r(this,(function(r){if(n=e.outFields,o=e.orderByFields,a=e.groupByFieldsForStatistics,s=e.outStatistics,n)for(u=0;u<n.length;u++)n[u]=n[u].trim();if(o)for(u=0;u<o.length;u++)o[u]=o[u].trim();if(a)for(u=0;u<a.length;u++)a[u]=a[u].trim();if(s)for(u=0;u<s.length;u++)s[u].onStatisticField&&(s[u].onStatisticField=s[u].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),[2,x(e,t,i)]}))}))},t.normalizeFilter=function(e,t,i){return n(this,void 0,void 0,(function(){return r(this,(function(r){return[2,x(e,t,i)]}))}))},t.normalizeQueryLike=x,t.cleanFromGeometryEngine=function(e){return e&&T in e?JSON.parse(JSON.stringify(e,F)):e};var T="_geVersion",F=function(e,t){return e!==T?t:void 0}}.apply(null,n))||(e.exports=i)},1087:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(10),r(65),r(1141)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=new o.WhereClauseCache(50,500),s="feature-store:unsupported-query",u=i.createSetFromValues(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function l(e,t){return e?a.get(e,t):null}function c(e,t,r,i){void 0===i&&(i=!0);for(var o=[],a=0,u=t;a<u.length;a++){var d=u[a];if("*"!==d&&!e.has(d))if(i){var f=h(d);try{var p=l(f,e);if(!p)throw new n(s,"invalid SQL expression",{where:f});if(!p.isStandardized)throw new n(s,"expression is not standard",{clause:p});c(e,p.fieldNames,"expression contains missing fields")}catch(e){var v=e&&e.details;if(v&&(v.clause||v.where))throw e;v&&v.missingFields?o.push.apply(o,v.missingFields):o.push(d)}}else o.push(d)}if(o.length)throw new n(s,r,{missingFields:o})}function h(e){return e.split(" as ")[0]}t.validateWhere=function(e,t){if(!t)return!0;var r=a.get(t,e);if(!r)throw new n(s,"invalid SQL expression",{where:t});if(!r.isStandardized)throw new n(s,"where clause is not standard",{where:t});return c(e,r.fieldNames,"where clause contains missing fields"),!0},t.validateHaving=function(e,t,r){if(!t)return!0;var i=a.get(t,e);if(!i)throw new n(s,"invalid SQL expression",{having:t});if(!i.isAggregate)throw new n(s,"having does not contain a valid aggregate function",{having:t});var o=i.fieldNames;if(c(e,o,"having contains missing fields"),!i.getExpressions().every((function(t){var n=t.aggregateType,i=t.field,o=e.has(i)&&e.get(i).name;return r.some((function(t){var r=t.onStatisticField,i=t.statisticType;return(e.has(r)&&e.get(r).name)===o&&i.toLowerCase().trim()===n}))})))throw new n(s,"expressions in having should also exist in outStatistics",{having:t});return!0},t.getWhereClause=l,t.validateFields=c,t.getExpressionFromFieldName=h,t.getAliasFromFieldName=function(e){return e.split(" as ")[1]},t.hasInvalidFieldType=function(e,t){var r=t.get(e);return!!r&&!u.has(r.type)}}.apply(null,n))||(e.exports=i)},1094:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(8),r(9),r(10),r(7),r(335),r(4),r(65),r(53),r(332),r(131),r(337),r(19),r(37),r(1087),r(1070),r(1142),r(1184),r(1107),r(1112),r(1081),r(328),r(1186)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,h,d,f,p,v,y,g,m,_,b,I,S,x,w){Object.defineProperty(t,"__esModule",{value:!0});t.Feature=function(e,t,r,n,i){void 0===t&&(t=null),this.attributes=e,this.geometry=r,this.centroid=n,this.filterFlags=i,this.groupId=-1,this.localId=t};var T=new Set,F=new s.MemCacheStorage(2e6),E=0,N=function(){function e(e){var t=this;this.capabilities={query:m.queryCapabilities},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this._changeHandle=this.featureStore.events.on("changed",(function(){return t.clearCache()})),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new s.MemCache(E+++"$$",F)),this.fieldsIndex=new x(e.fields),e.scheduler&&e.task&&(this._frameQueue=new w.default,this._frameTask=e.scheduler.registerTask(e.task,(function(e){return t._update(e)}),(function(){return t._frameQueue.length>0})))}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()},Object.defineProperty(e.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullExtent",{get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:S.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeExtent",{get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=I.getTimeExtent(this.timeInfo,this.featureStore)),this._timeExtent):null},enumerable:!0,configurable:!0}),e.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null},e.prototype.executeQuery=function(e,t){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,r,i,o=this;return n(this,(function(n){switch(n.label){case 0:t=a.clone(e),n.label=1;case 1:return n.trys.push([1,8,,9]),[4,this._schedule((function(){return S.normalizeQuery(t,o.definitionExpression,o.spatialReference)}))];case 2:return t=n.sent(),[4,this._reschedule((function(){return o._checkQuerySupport(t)}))];case 3:return t=n.sent(),[4,this._reschedule((function(){return o._executeGeometryQuery(t)}))];case 4:return r=n.sent(),[4,this._reschedule((function(){return r.executeObjectIdsQuery(t)}))];case 5:return r=n.sent(),[4,this._reschedule((function(){return r.executeTimeQuery(t)}))];case 6:return r=n.sent(),[4,this._reschedule((function(){return r.executeAttributesQuery(t)}))];case 7:return r=n.sent(),[3,9];case 8:if((i=n.sent())!==S.QUERY_ENGINE_EMPTY_RESULT)throw i;return r=new _.default([],null,this),[3,9];case 9:return[2,r.createQueryResponse(t)]}}))}))},e.prototype.executeQueryForCount=function(e,t){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,r,i,o=this;return n(this,(function(n){switch(n.label){case 0:(t=a.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,n.label=1;case 1:return n.trys.push([1,8,,9]),[4,this._schedule((function(){return S.normalizeQuery(t,o.definitionExpression,o.spatialReference)}))];case 2:return t=n.sent(),[4,this._reschedule((function(){return o._checkQuerySupport(t)}))];case 3:return t=n.sent(),[4,this._reschedule((function(){return o._executeGeometryQuery(t)}))];case 4:return r=n.sent(),[4,this._reschedule((function(){return r.executeObjectIdsQuery(t)}))];case 5:return r=n.sent(),[4,this._reschedule((function(){return r.executeTimeQuery(t)}))];case 6:return r=n.sent(),[4,this._reschedule((function(){return r.executeAttributesQuery(t)}))];case 7:return[2,(r=n.sent()).size];case 8:if((i=n.sent())!==S.QUERY_ENGINE_EMPTY_RESULT)throw i;return[2,0];case 9:return[2]}}))}))},e.prototype.executeQueryForExtent=function(e,t){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,r,i,o,s,u,l,d,f=this;return n(this,(function(n){switch(n.label){case 0:t=a.clone(e),i=t.outSR,n.label=1;case 1:return n.trys.push([1,8,,9]),[4,this._schedule((function(){return S.normalizeQuery(t,f.definitionExpression,f.spatialReference)}))];case 2:return t=n.sent(),[4,this._reschedule((function(){return f._checkQuerySupport(t)}))];case 3:return(t=n.sent()).returnGeometry=!0,t.returnCentroid=!1,t.outSR=null,[4,this._reschedule((function(){return f._executeGeometryQuery(t)}))];case 4:return r=n.sent(),[4,this._reschedule((function(){return r.executeObjectIdsQuery(t)}))];case 5:return r=n.sent(),[4,this._reschedule((function(){return r.executeTimeQuery(t)}))];case 6:return r=n.sent(),[4,this._reschedule((function(){return r.executeAttributesQuery(t)}))];case 7:return r=n.sent(),(o=r.size)?(h.set(C,h.NEGATIVE_INFINITY),this.featureStore.forEachBounds(r.items,(function(e){return h.expand(C,e)}),M),s={xmin:C[0],ymin:C[1],xmax:C[3],ymax:C[4],spatialReference:S.cleanFromGeometryEngine(this.spatialReference)},this.hasZ&&isFinite(C[2])&&isFinite(C[5])&&(s.zmin=C[2],s.zmax=C[5]),(u=g.project(s,r.spatialReference,i)).spatialReference=S.cleanFromGeometryEngine(i||this.spatialReference),u.xmax-u.xmin==0&&(l=c.getMetersPerUnitForSR(u.spatialReference),u.xmin-=l,u.xmax+=l),u.ymax-u.ymin==0&&(l=c.getMetersPerUnitForSR(u.spatialReference),u.ymin-=l,u.ymax+=l),this.hasZ&&null!=u.zmin&&null!=u.zmax&&u.zmax-u.zmin==0&&(l=c.getMetersPerUnitForSR(u.spatialReference),u.zmin-=l,u.zmax+=l),[2,{count:o,extent:u}]):[2,{count:o,extent:null}];case 8:if((d=n.sent())===S.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw d;case 9:return[2]}}))}))},e.prototype.executeQueryForIds=function(e,t){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){return n(this,(function(r){return[2,this.executeQueryForIdSet(e,t).then((function(e){return l.valuesOfSet(e)}))]}))}))},e.prototype.executeQueryForIdSet=function(e,t){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,r,i,o,s,u=this;return n(this,(function(n){switch(n.label){case 0:(t=a.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,n.label=1;case 1:return n.trys.push([1,9,,10]),[4,this._schedule((function(){return S.normalizeQuery(t,u.definitionExpression,u.spatialReference)}))];case 2:return t=n.sent(),[4,this._reschedule((function(){return u._checkQuerySupport(t)}))];case 3:return t=n.sent(),[4,this._reschedule((function(){return u._executeGeometryQuery(t)}))];case 4:return r=n.sent(),[4,this._reschedule((function(){return r.executeObjectIdsQuery(t)}))];case 5:return r=n.sent(),[4,this._reschedule((function(){return r.executeTimeQuery(t)}))];case 6:return r=n.sent(),[4,this._reschedule((function(){return r.executeAttributesQuery(t)}))];case 7:return r=n.sent(),i=r.items,o=new Set,[4,this._reschedule((function(){for(var e=0,t=i;e<t.length;e++){var n=t[e];o.add(r.featureAdapter.getObjectId(n))}}))];case 8:return n.sent(),[2,o];case 9:if((s=n.sent())===S.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw s;case 10:return[2]}}))}))},e.prototype.executeQueryForLatestObservations=function(e,t){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,r,i,s=this;return n(this,(function(n){switch(n.label){case 0:if(!this.timeInfo||!this.timeInfo.trackIdField)throw new o("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});t=a.clone(e),n.label=1;case 1:return n.trys.push([1,9,,10]),[4,this._schedule((function(){return S.normalizeQuery(t,s.definitionExpression,s.spatialReference)}))];case 2:return t=n.sent(),[4,this._reschedule((function(){return s._checkQuerySupport(t)}))];case 3:return t=n.sent(),[4,this._reschedule((function(){return s._executeGeometryQuery(t)}))];case 4:return r=n.sent(),[4,this._reschedule((function(){return r.executeObjectIdsQuery(t)}))];case 5:return r=n.sent(),[4,this._reschedule((function(){return r.executeTimeQuery(t)}))];case 6:return r=n.sent(),[4,this._reschedule((function(){return r.executeAttributesQuery(t)}))];case 7:return r=n.sent(),[4,this._reschedule((function(){return r.filterLatest()}))];case 8:return r=n.sent(),[3,10];case 9:if((i=n.sent())!==S.QUERY_ENGINE_EMPTY_RESULT)throw i;return r=new _.default([],null,this),[3,10];case 10:return[2,r.createQueryResponse(t)]}}))}))},e.prototype._schedule=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){return this._frameQueue?[2,this._frameQueue.push(e)]:[2,e()]}))}))},e.prototype._reschedule=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){return this._frameQueue?[2,this._frameQueue.unshift(e)]:[2,e()]}))}))},e.prototype._update=function(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null},e.prototype._getAll=function(){if(!this._allItems){var e=[];this.featureStore.forEach((function(t){return e.push(t)})),this._allItems=new _.default(e,null,this)}return this._allItems},e.prototype._executeGeometryQuery=function(e){return i(this,void 0,void 0,(function(){var t,r,o,a,s,u,l,c,h,d,f,p,y,g,m,I,S,x,w,T=this;return n(this,(function(F){switch(F.label){case 0:if(t=e.geometry,r=e.outSR,o=e.spatialRel,a=v.isValid(r)&&!v.equals(this.spatialReference,r),(s=this._geometryQueryCache?a?JSON.stringify({geometry:t,spatialRelationship:o,outSpatialReference:r}):JSON.stringify({geometry:t,spatialRelationship:o}):null)&&void 0!==(u=this._geometryQueryCache.get(s)))return[2,u];if(l=function(t){return i(T,void 0,void 0,(function(){var i;return n(this,(function(n){switch(n.label){case 0:return a&&(e.returnGeometry||e.returnCentroid)?[4,t.project(r)]:[3,2];case 1:return i=n.sent(),s&&this._geometryQueryCache.put(s,i,i.size||1),[2,i];case 2:return s&&this._geometryQueryCache.put(s,t,t.size||1),[2,t]}}))}))},!t)return[2,l(this._getAll())];if(c=this.featureAdapter,"esriSpatialRelDisjoint"!==o)return[3,3];if(!(h=this._searchFeatures(this._getQueryBBoxes(t))).length)return[2,l(this._getAll())];for(p=new Set,y=0,g=h;y<g.length;y++)m=g[y],p.add(c.getObjectId(m));return[4,this._reschedule((function(){var e=0;d=new Array(p.size),T.featureStore.forEach((function(t){return d[e++]=t})),f=p}))];case 1:return F.sent(),[4,this._reschedule((function(){return i(T,void 0,void 0,(function(){var e,r,i;return n(this,(function(n){switch(n.label){case 0:return[4,b.getSpatialQueryOperator(o,t,this)];case 1:return e=n.sent(),r=function(t){return!f.has(c.getObjectId(t))||e(c.getGeometry(t))},i=_.default.bind,[4,this._runSpatialFilter(d,r)];case 2:return[2,new(i.apply(_.default,[void 0,n.sent(),t,this]))]}}))}))}))];case 2:return S=F.sent(),[2,l(S)];case 3:return(I=this._searchFeatures(this._getQueryBBoxes(t))).length?this._canExecuteSoloPass(t,e)?[2,l(new _.default(I,t,this))]:[4,b.getSpatialQueryOperator(o,t,this)]:(S=new _.default([],t,this),s&&this._geometryQueryCache.put(s,S,S.size||1),[2,S]);case 4:return x=F.sent(),[4,this._runSpatialFilter(I,(function(e){return x(c.getGeometry(e))}))];case 5:return w=F.sent(),[2,l(new _.default(w,t,this))]}}))}))},e.prototype._runSpatialFilter=function(e,t){return i(this,void 0,void 0,(function(){var r,o,a,s=this;return n(this,(function(u){return t?this._budget?(r=0,o=new Array,a=function(){return i(s,void 0,void 0,(function(){var i;return n(this,(function(n){switch(n.label){case 0:return r<e.length?(i=e[r],t(i)&&o.push(i),this._budget.done?[4,this._reschedule((function(){return a()}))]:[3,2]):[3,3];case 1:n.sent(),n.label=2;case 2:return++r,[3,0];case 3:return[2]}}))}))},[2,this._reschedule((function(){return a()})).then((function(){return o}))]):[2,e.filter((function(e){return t(e)}))]:[2,e]}))}))},e.prototype._canExecuteSoloPass=function(e,t){var r=this.geometryType,n=t.spatialRel;return b.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===n||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===n||"esriSpatialRelContains"===n||"esriSpatialRelWithin"===n))},e.prototype._getQueryBBoxes=function(e){if(b.canQueryWithRBush(e)){if(p.isExtent(e))return[d.fromValues(e.xmin,e.ymin,e.xmax,e.ymax)];if(p.isPolygon(e))return e.rings.map((function(e){return d.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[f.getBoundsXY(d.create(),e)]},e.prototype._searchFeatures=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this.featureStore.forEachInBounds(n,(function(e){T.add(e)}))}var i=new Array(T.size),o=0;return T.forEach((function(e){return i[o++]=e})),T.clear(),i},e.prototype._checkQuerySupport=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new o("feature-store:unsupported-query","Unsupported query options",{query:e});return[2,u.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),b.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),g.checkProjectionSupport(this.spatialReference,e.outSR)]).then((function(){return e}))]}))}))},e.prototype._checkAttributesQuerySupport=function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues;if(r&&r.length>0){var i=r.map((function(e){var t=e.toLowerCase();return t.indexOf(" asc")>-1?t.split(" asc")[0]:t.indexOf(" desc")>-1?t.split(" desc")[0]:e}));y.validateFields(this.fieldsIndex,i,"orderByFields contains missing fields")}if(t&&t.length>0)y.validateFields(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new o("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});y.validateWhere(this.fieldsIndex,e.where)},e.prototype._checkStatisticsQuerySupport=function(e){return i(this,void 0,void 0,(function(){var t,r,i,a,s,u,l,c,h,d,f;return n(this,(function(n){if(t=e.outStatistics,r=e.groupByFieldsForStatistics,i=e.having,a=r&&r.length,s=t&&t.length,i){if(!a||!s)throw new o("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});y.validateHaving(this.fieldsIndex,i,t)}if(s){if(t.some((function(e){return"exceedslimit"===e.statisticType})))return[2];for(u=t.map((function(e){return e.onStatisticField})),y.validateFields(this.fieldsIndex,u,"onStatisticFields contains missing fields"),a&&y.validateFields(this.fieldsIndex,r,"groupByFieldsForStatistics contains missing fields"),l=0,c=t;l<c.length;l++)if(h=c[l],d=h.onStatisticField,f=h.statisticType,(!a||"count"!==f)&&d&&y.hasInvalidFieldType(d,this.fieldsIndex))throw new o("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:h,query:e})}return[2]}))}))},e}();t.default=N;var M=h.create(),C=h.create()}.apply(null,n))||(e.exports=i)},1106:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){return e?t?4:3:t?3:2}function n(e,t,n,i,o,a){for(var s=r(o,a),u=n,l=n+s,c=0,h=0,d=0,f=0,p=0,v=0,y=i-1;v<y;v++,u+=s,l+=s){var g=t[u],m=t[u+1],_=t[u+2],b=t[l],I=t[l+1],S=t[l+2],x=g*I-b*m;f+=x,c+=(g+b)*x,h+=(m+I)*x,o&&(d+=(_+S)*(x=g*S-b*_),p+=x),g<e[0]&&(e[0]=g),g>e[1]&&(e[1]=g),m<e[2]&&(e[2]=m),m>e[3]&&(e[3]=m),o&&(_<e[4]&&(e[4]=_),_>e[5]&&(e[5]=_))}if(f>0&&(f*=-1),p>0&&(p*=-1),!f)return null;var w=[c,h,.5*f];return o&&(w[3]=d,w[4]=.5*p),w}function i(e,t,n,i,l){for(var c=r(i,l),h=t,d=t+c,f=0,p=0,v=0,y=0,g=0,m=n-1;g<m;g++,h+=c,d+=c){var _,b=e[h],I=e[h+1],S=e[h+2],x=e[d],w=e[d+1],T=e[d+2],F=i?a(b,I,S,x,w,T):o(b,I,x,w);F&&(f+=F,i?(p+=F*(_=u(b,I,S,x,w,T))[0],v+=F*_[1],y+=F*_[2]):(p+=F*(_=s(b,I,x,w))[0],v+=F*_[1]))}return f>0?i?[p/f,v/f,y/f]:[p/f,v/f]:n>0?i?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function o(e,t,r,n){var i=r-e,o=n-t;return Math.sqrt(i*i+o*o)}function a(e,t,r,n,i,o){var a=n-e,s=i-t,u=o-r;return Math.sqrt(a*a+s*s+u*u)}function s(e,t,r,n){return[e+.5*(r-e),t+.5*(n-t)]}function u(e,t,r,n,i,o){return[e+.5*(n-e),t+.5*(i-t),r+.5*(o-r)]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCentroidOptimizedGeometry=function(e,t,o,a){if(!t||!t.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);for(var s=e.coords,u=[],l=o?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],c=t.lengths,h=t.coords,d=r(o,a),f=0,p=0,v=c;p<v.length;p++){var y=v[p],g=n(l,h,f,y,o,a);g&&u.push(g),f+=y*d}if(u.sort((function(e,t){var r=e[2]-t[2];return 0===r&&o&&(r=e[4]-t[4]),r})),u.length){var m=6*u[0][2];s[0]=u[0][0]/m,s[1]=u[0][1]/m,o&&(m=6*u[0][4],s[2]=0!==m?u[0][3]/m:0),(s[0]<l[0]||s[0]>l[1]||s[1]<l[2]||s[1]>l[3]||o&&(s[2]<l[4]||s[2]>l[5]))&&(s.length=0)}if(!s.length){var _=t.lengths[0]?i(h,0,c[0],o,a):null;if(!_)return null;s[0]=_[0],s[1]=_[1],o&&_.length>2&&(s[2]=_[2])}return e},t.lineCentroid=i}.apply(null,n))||(e.exports=i)},1107:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(9),r(10),r(4),r(103),r(207),r(19),r(37),r(1143),r(322),r(196),r(1070),r(1081)],void 0===(i=function(e,t,n,i,o,a,s,u,l,c,h,d,f,p,v){Object.defineProperty(t,"__esModule",{value:!0});var y={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},g={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},m={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},_={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function b(){return a.create((function(e){return r.e(7).then(function(){var t=[r(1091)];e.apply(null,t)}.bind(this)).catch(r.oe)}))}t.importGeometryEngine=b,t.getGeodesicBufferOperator=function(){return b().then((function(e){return e.geodesicBuffer}))},t.getSpatialQueryOperator=function(e,t,r){if(l.isPolygon(t)&&"esriGeometryPoint"===r.geometryType&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var n=d.convertFromPolygon(new f.default,t,!1,!1);return a.resolve((function(e){return h.polygonContainsPoint(n,!1,!1,e)}))}if(l.isPolygon(t)&&"esriGeometryMultipoint"===r.geometryType){var i=d.convertFromPolygon(new f.default,t,!1,!1);if("esriSpatialRelContains"===e)return a.resolve((function(e){return h.polygonContainsMultipoint(i,!1,!1,e,r.hasZ,r.hasM)}))}if(l.isExtent(t)&&"esriGeometryPoint"===r.geometryType&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return a.resolve((function(e){return s.extentContainsPoint(t,v.getGeometry(r,e))}));if(l.isExtent(t)&&"esriGeometryMultipoint"===r.geometryType&&"esriSpatialRelContains"===e)return a.resolve((function(e){return s.extentContainsMultipoint(t,v.getGeometry(r,e))}));if(l.isExtent(t)&&"esriSpatialRelIntersects"===e){var o=u.getExtentIntersector(r.geometryType);return a.resolve((function(e){return o(t,v.getGeometry(r,e))}))}return b().then((function(n){var i=n[y[e]].bind(null,t);return function(e){return i(v.getGeometry(r,e))}}))},t.checkSpatialQuerySupport=function(e,t,r){return i(this,void 0,void 0,(function(){var i,a;return n(this,(function(n){if(i=e.spatialRel,!(a=e.geometry))return[2];if(!0!==g[i])throw new o("feature-store:unsupported-query","Unsupported query spatial relationship",{query:e});if(!c.isValid(a.spatialReference)||!c.isValid(r))return[2];if(!function(e){return!0===m[l.getJsonType(e)]}(a))throw new o("feature-store:unsupported-query","Unsupported query geometry type",{query:e});if(!function(e){return!0===_[e]}(t))throw new o("feature-store:unsupported-query","Unsupported layer geometry type",{query:e});return e.outSR?[2,p.checkProjectionSupport(e.geometry&&e.geometry.spatialReference,e.outSR)]:[2]}))}))},t.canQueryWithRBush=function(e){if(l.isExtent(e))return!0;if(l.isPolygon(e)){for(var t=0,r=e.rings;t<r.length;t++){var n=r[t];if(5!==n.length)return!1;if(n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1}return!0}return!1}}.apply(null,n))||(e.exports=i)},1112:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getTimeExtent=function(e,t){if(!e)return null;var r=t.featureAdapter,n=e.startTimeField,i=e.endTimeField,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(n&&i)t.forEach((function(e){var t=r.getAttribute(e,n),s=r.getAttribute(e,i);null==t||isNaN(t)||(o=Math.min(o,t)),null==s||isNaN(s)||(a=Math.max(a,s))}));else{var s=n||i;t.forEach((function(e){var t=r.getAttribute(e,s);null==t||isNaN(t)||(o=Math.min(o,t),a=Math.max(a,t))}))}return{start:o,end:a}},t.getTimeOperator=function(e,t,r){if(!t||!e)return null;var n=e.startTimeField,i=e.endTimeField;if(!n&&!i)return null;var o=t.start,a=t.end;return null==o&&null==a?null:n&&i?function(e,t,r,n,i){if(null!=n&&null!=i&&n===i){var o=n;return function(n){return o>=e.getAttribute(n,t)&&o<=e.getAttribute(n,r)}}return null!=n&&null!=i?function(o){return a=n,s=i,u=e.getAttribute(o,t),l=e.getAttribute(o,r),!(u>s||l<a);var a,s,u,l}:null!=n?function(t){return!(e.getAttribute(t,r)<n)}:null!=i?function(r){return!(e.getAttribute(r,t)>i)}:void 0}(r,n,i,o,a):function(e,t,r,n){return null!=r&&null!=n&&r===n?function(n){return e.getAttribute(n,t)===r}:null!=r&&null!=n?function(i){return e.getAttribute(i,t)>=r&&e.getAttribute(i,t)<=n}:null!=r?function(n){return e.getAttribute(n,t)>=r}:null!=n?function(r){return e.getAttribute(r,t)<=n}:void 0}(r,n||i,o,a)}}.apply(null,n))||(e.exports=i)},1123:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(9),r(1),r(0),r(10),r(52),r(6),r(13),r(332),r(131),r(37),r(322),r(1179),r(1159),r(1144)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,h,d,f,p,v,y){Object.defineProperty(t,"__esModule",{value:!0});var g=u.getLogger("esri.layers.graphics.data.FeatureStore"),m=function(){function e(e){this.geometryInfo=e,this._boundsStore=new p.BoundsStore,this._featuresById=new Map,this._markedIds=new Set,this.events=new s,this.featureAdapter=y.optimizedFeatureQueryEngineAdapter}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this.geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this.geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this.geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){var e=this;if(!this.numFeatures)return null;var t=h.create(h.NEGATIVE_INFINITY);return this._featuresById.forEach((function(r){var n=e._boundsStore.get(r.objectId);n&&(t[0]=Math.min(n[0],t[0]),t[1]=Math.min(n[1],t[1]),t[2]=Math.max(n[2],t[2]),t[3]=Math.max(n[3],t[3]))})),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeStatistics",{get:function(){var e=0;return this._featuresById.forEach((function(t){t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._add(e),this._emitChanged()},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this._add(n)}this._emitChanged()},e.prototype.clear=function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()},e.prototype.removeById=function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null},e.prototype.removeManyById=function(e){this._boundsStore.invalidateIndex();for(var t=0,r=e;t<r.length;t++){var n=r[t],i=this._featuresById.get(n);i&&this._remove(i)}this._emitChanged()},e.prototype.forEachBounds=function(e,t,r){for(var n=0,i=e;n<i.length;n++){var o=i[n],a=this._boundsStore.get(o.objectId);a&&t(c.fromRect(r,a))}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach((function(t){return e(t)}))},e.prototype.forEachInBounds=function(e,t){var r=this;this._boundsStore.forEachInBounds(e,(function(e){t(r._featuresById.get(e))}))},e.prototype.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()},e.prototype.sweep=function(){var e=this,t=!1;this._featuresById.forEach((function(r,n){e._markedIds.has(n)||(t=!0,e._remove(r))})),this._markedIds.clear(),t&&this._emitChanged()},e.prototype.executeTileQuery=function(e,t,i){return n(this,void 0,void 0,(function(){var n,o,a,s,u,l,c,f,p,y,g,m,_,b;return r(this,(function(r){return n=i.returnGeometry,o=i.returnCentroid,a=i.returnOutline,s=i.pixelBuffer,u=new Set,l=[],c=s*e.resolution,f=h.pad(e.bounds,c,h.create()),v.createTileFeatures(l,u,this.geometryInfo,this,f,n,o,a,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}),("esriGeometryPoint"===this.geometryType||o)&&(p=d.getInfo(t))&&(y=p.valid,g=y[0],m=y[1],f[0]<g&&(_=h.fromValues(m-c,f[1],m,f[3]),v.createTileFeatures(l,u,this.geometryInfo,this,_,n,o,a,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[m,e.bounds[3]]})),f[2]>m&&(b=h.fromValues(g,f[1],g+c,f[3]),v.createTileFeatures(l,u,this.geometryInfo,this,b,n,o,a,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[g-m+e.bounds[0],e.bounds[3]]}))),l.sort((function(e,t){return e.localId-t.localId})),[2,{features:l,objectIds:u}]}))}))},e.prototype._emitChanged=function(){this.events.emit("changed",void 0)},e.prototype._add=function(e){if(e){var t=e.objectId;if(null!=t){var r,n=this._featuresById.get(t);if(this._markedIds.add(t),n?(e.localId=n.localId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):l.isSome(this.onFeatureAdd)&&this.onFeatureAdd(e),!e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=f.getBoundsOptimizedGeometry(r||h.create(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(t,r),this._featuresById.set(t,e)}else g.error(new a("featurestore:invalid-feature","feature id is missing",{feature:e}))}},e.prototype._remove=function(e){return l.isSome(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e},e}();t.default=m}.apply(null,n))||(e.exports=i)},1124:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(335)],void 0===(i=function(e,t,r){return function(){function e(e,t){this._storage=new r.MemCacheStorage,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}return e.prototype.put=function(e,t){this._storage.put(e,t,1,1)},e.prototype.pop=function(e){return this._storage.pop(e)},e.prototype.get=function(e){return this._storage.get(e)},e.prototype.clear=function(){this._storage.clearAll()},e.prototype.destroy=function(){this._storage.clearAll()},e}()}.apply(null,n))||(e.exports=i)},1141:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1124),r(1002)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this._cache=new r(e),this._invalidCache=new r(t)}return e.prototype.get=function(e,t){var r=t.uid+":"+e,i=this._cache.get(r);if(i)return i;if(void 0!==this._invalidCache.get(r))return null;try{var o=n.WhereClause.create(e,t);return this._cache.put(r,o),o}catch(e){return this._invalidCache.put(r,null),null}},e}();t.WhereClauseCache=i}.apply(null,n))||(e.exports=i)},1142:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!1,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}.apply(null,n))||(e.exports=i)},1143:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){return e?t?4:3:t?3:2}function n(e,t,n,o,a){if(!e)return!1;for(var s=r(t,n),u=e.coords,l=!1,c=0,h=0,d=e.lengths;h<d.length;h++){var f=d[h];l=i(l,u,s,c,f,o,a),c+=f*s}return l}function i(e,t,r,n,i,o,a){for(var s=e,u=n,l=n,c=n+i*r;l<c;l+=r){(u=l+r)===c&&(u=n);var h=t[l],d=t[l+1],f=t[u],p=t[u+1];(d<a&&p>=a||p<a&&d>=a)&&h+(a-d)/(p-d)*(f-h)<o&&(s=!s)}return s}Object.defineProperty(t,"__esModule",{value:!0}),t.polygonContainsPoint=function(e,t,r,i){return n(e,t,r,i.coords[0],i.coords[1])},t.polygonContainsMultipoint=function(e,t,i,o,a,s){var u=r(a,s),l=o.coords,c=o.lengths;if(!c)return!1;for(var h=0,d=0;h<c.length;h++,d+=u)if(!n(e,t,i,l[d],l[d+1]))return!1;return!0},t.polygonContainsCoords=n}.apply(null,n))||(e.exports=i)},1144:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1106),r(205),r(196)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.optimizedFeatureQueryEngineAdapter={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new n.default(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=r.getCentroidOptimizedGeometry(new i.default,e.geometry,t.hasZ,t.hasM)),e.centroid}},t.default=t.optimizedFeatureQueryEngineAdapter}.apply(null,n))||(e.exports=i)},1159:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(8),r(9),r(131),r(322),r(196),r(1094),r(1081)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l){Object.defineProperty(t,"__esModule",{value:!0});var c=new s.default,h={esriGeometryPoint:a.convertToPoint,esriGeometryPolyline:a.convertToPolyline,esriGeometryPolygon:a.convertToPolygon,esriGeometryMultipoint:a.convertToMultipoint};t.executeTileQueryForIds=function(e,t,r){var n=r.pixelBuffer*t.resolution,i=o.pad(t.bounds,n,o.create()),a=[];return e.featureStore.forEachInBounds(i,(function(t){return a.push(e.featureAdapter.getObjectId(t))})),a},t.createTileFeatures=function(e,t,r,n,i,o,a,s,p){var v=h[r.geometryType],y=d[r.geometryType],g="esriGeometryPolygon"===r.geometryType&&!s,m=r.hasZ?r.hasM?4:3:r.hasM?3:2;a&&!o?n.forEachInBounds(i,(function(n){return function(e,t,r,n,i){if(!t.has(r.objectId)){var o=l.getCentroid(n,r,i),a=r.attributes;o&&(t.add(r.objectId),e.push(new u.Feature(a,r.localId,null,o)))}}(e,t,n,r,p)})):o&&!a?n.forEachInBounds(i,(function(r){return function(e,t,r,n,i,o,a,s){if(!t.has(r.objectId)){var l=r.attributes,h=n(f(c,r.geometry,i,o,s,a),!1,!1);h&&(t.add(r.objectId),e.push(new u.Feature(l,r.localId,h,null)))}}(e,t,r,v,m,y,p,g)})):n.forEachInBounds(i,(function(n){return function(e,t,r,n,i,o,a,s,h){if(!t.has(r.objectId)){var d=l.getCentroid(n,r,i),p=r.attributes,v=o(f(c,r.geometry,a,s,h,i),!1,!1);v&&d&&(t.add(r.objectId),e.push(new u.Feature(p,r.localId,v,d)))}}(e,t,n,r,p,v,m,y,g)}))};var d={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0};function f(e,t,r,n,i,o){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;var s,u,l,c,h=t.coords,d=t.lengths;if(!d.length)return e.coords[0]=a.quantizeX(o,h[0]),e.coords[1]=a.quantizeY(o,h[1]),e.coords.length=r,e;for(var f=0,p=0,v=p,y=0,g=d;y<g.length;y++){var m=g[y];if(!(m<n)){p=v,l=s=a.quantizeX(o,h[f]),c=u=a.quantizeY(o,h[f+1]),e.coords[p]=l,e.coords[p+1]=c,f+=r;var _=(l=a.quantizeX(o,h[f]))-s,b=(c=a.quantizeY(o,h[f+1]))-u,I=b/_;p+=2,e.coords[p]=_,e.coords[p+1]=b,s=l,u=c,f+=r;for(var S=2;S<m;S++){if(l=a.quantizeX(o,h[f]),c=a.quantizeY(o,h[f+1]),l!==s||c!==u){var x=l-s,w=c-u,T=w/x;I!==T&&(isFinite(I)||isFinite(T))||!(i||(b>=0&&w>=0||b<=0&&w<=0)&&(_>=0&&x>=0||_<=0&&x<=0))?(_=x,b=w,p+=2):(_+=x,b+=w),e.coords[p]=_,e.coords[p+1]=b,I=T,s=l,u=c}f+=r}var F=(p+2-v)/2;F>=n&&(e.lengths.push(F),v=p+2)}}return e.coords.length>v&&(e.coords.length=v),e.coords.length?e:null}t.quantizeOptimizedGeometryForDisplay=f}.apply(null,n))||(e.exports=i)},1179:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(15),r(1076),r(38)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i={minX:0,minY:0,maxX:0,maxY:0},o=function(){function e(){var e=this;this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=n(9,r("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(e._indexInvalid){var t=new Array(e._idByBounds.size),r=0;e._idByBounds.forEach((function(e,n){t[r++]=n})),e._indexInvalid=!1,e._index.clear(),e._index.load(t)}else e._boundsToLoad.length&&(e._index.load(e._boundsToLoad.filter((function(t){return e._idByBounds.has(t)}))),e._boundsToLoad.length=0)}}return e.prototype.clear=function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()},e.prototype.delete=function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))},e.prototype.forEachInBounds=function(e,t){this._loadIndex();for(var r=0,n=function(e,t){return i.minX=t[0],i.minY=t[1],i.maxX=t[2],i.maxY=t[3],e.search(i)}(this._index,e);r<n.length;r++){var o=n[r];t(this._idByBounds.get(o))}},e.prototype.get=function(e){return this._boundsById.get(e)},e.prototype.has=function(e){return this._boundsById.has(e)},e.prototype.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)},e.prototype.set=function(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))},e}();t.BoundsStore=o}.apply(null,n))||(e.exports=i)},1180:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.aggregateFunction=function(e,t){var n=r[e.toLowerCase()];if(null==n)throw new Error("Function Not Recognised");if(t.length<n.minParams||t.length>n.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return n.evaluate(t)},t.isAggregate=function(e,t){var n=r[e.toLowerCase()];return null!=n&&t>=n.minParams&&t<=n.maxParams};var r={min:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.min.apply(Math,e[0])}},max:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.max.apply(Math,e[0])}},avg:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:n(e[0])}},sum:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}(e[0])}},stddev:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sqrt(i(e[0]))}},count:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].length}},var:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:i(e[0])}}};function n(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function i(e){for(var t=n(e),r=e.length,i=0,o=0,a=e;o<a.length;o++){var s=a[o];i+=Math.pow(s-t,2)}return r>1?i/(r-1):0}}.apply(null,n))||(e.exports=i)},1181:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(46)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0}return e.fixDefaults=function(e){if(null!==e.precision||null!==e.secondary)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")},e.createFromMilliseconds=function(t){var r=new e;return r.second=t/1e3,r},e.createFromValueAndQualifer=function(t,r,n){var i=new e;if(i.op="-"===n?"-":"+","interval-period"===r.type){e.fixDefaults(r);var o=new RegExp("^[0-9]{1,}$");if("year"===r.period||"month"===r.period)throw new Error("Year-Month Intervals not supported");if(!o.test(t))throw new Error("Illegal Interval");i[r.period]=parseFloat(t)}else{if(e.fixDefaults(r.start),e.fixDefaults(r.end),"year"===r.start.period||"month"===r.start.period)throw new Error("Year-Month Intervals not supported");if("year"===r.end.period||"month"===r.end.period)throw new Error("Year-Month Intervals not supported");switch(r.start.period){case"day":switch(r.end.period){case"hour":if(!new RegExp("^[0-9]{1,} [0-9]{1,}$").test(t))throw new Error("Illegal Interval");i[r.start.period]=parseFloat(t.split(" ")[0]),i[r.end.period]=parseFloat(t.split(" ")[1]);break;case"minute":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$").test(t))throw new Error("Illegal Interval");i[r.start.period]=parseFloat(t.split(" ")[0]);var a=t.split(" ")[1].split(":");i.hour=parseFloat(a[0]),i.minute=parseFloat(a[1]);break;case"second":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");i[r.start.period]=parseFloat(t.split(" ")[0]),a=t.split(" ")[1].split(":"),i.hour=parseFloat(a[0]),i.minute=parseFloat(a[1]),i.second=parseFloat(a[2]);break;default:throw"Invalid Interval."}break;case"hour":switch(r.end.period){case"minute":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}$").test(t))throw new Error("Illegal Interval");i.hour=parseFloat(t.split(":")[0]),i.minute=parseFloat(t.split(":")[1]);break;case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");a=t.split(":"),i.hour=parseFloat(a[0]),i.minute=parseFloat(a[1]),i.second=parseFloat(a[2]);break;default:throw"Invalid Interval."}break;case"minute":switch(r.end.period){case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");a=t.split(":"),i.minute=parseFloat(a[0]),i.second=parseFloat(a[1]);break;default:throw"Invalid Interval."}break;default:throw"Invalid Interval."}}return i},e.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)},e}();t.SqlInterval=n,t.evaluateFunction=function(e,t){var r=i[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isStandardized=function(e,t){var r=i[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var i={extract:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];if(null==r)return null;if(r instanceof Date)switch(t.toUpperCase()){case"SECOND":return r.getSeconds();case"MINUTE":return r.getMinutes();case"HOUR":return r.getHours();case"DAY":return r.getDate();case"MONTH":return r.getMonth()+1;case"YEAR":return r.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(e){if(2===e.length){var t=e[0],r=e[1];return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){t=e[0],r=e[1];var n=e[2];return null==t||null==r||null==n?null:n<=0?"":t.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];return null==t||null==r?null:r.indexOf(t)+1}},trim:{minParams:2,maxParams:3,evaluate:function(e){var t=3===e.length,n=t?e[1]:" ",i=t?e[2]:e[1];if(null==n||null==i)return null;var o="("+r.escapeRegExpString(n)+")";switch(e[0]){case"BOTH":return i.replace(new RegExp("^"+o+"*|"+o+"*$","g"),"");case"LEADING":return i.replace(new RegExp("^"+o+"*","g"),"");case"TRAILING":return i.replace(new RegExp(o+"*$","g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.abs(e[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.ceil(e[0])}},floor:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.floor(e[0])}},log:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])}},log10:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sin(e[0])}},cos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.cos(e[0])}},tan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.tan(e[0])}},asin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.asin(e[0])}},acos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.acos(e[0])}},atan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.atan(e[0])}},sign:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0]>0?1:e[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])}},mod:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:e[0]%e[1]}},round:{minParams:1,maxParams:2,evaluate:function(e){var t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:function(e){return null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(e){return"string"==typeof e[0]||e[0]instanceof String?e[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(e){for(var t="",r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toUpperCase()}}}}.apply(null,n))||(e.exports=i)},1182:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1183)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.parse=function(e){return r.parse(e)},e}();t.WhereGrammar=n}.apply(null,n))||(e.exports=i)},1183:function(e,t,r){var n;void 0===(n=function(){"use strict";function e(t,r,n,i){this.message=t,this.expected=r,this.found=n,this.location=i,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?o(e.parts[t][0])+"-"+o(e.parts[t][1]):o(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function o(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}return"Expected "+function(e){var t,n,i,o=new Array(e.length);for(t=0;t<e.length;t++)o[t]=(i=e[t],r[i.type](i));if(o.sort(),o.length>0){for(t=1,n=1;t<o.length;t++)o[t-1]!==o[t]&&(o[n]=o[t],n++);o.length=n}switch(o.length){case 1:return o[0];case 2:return o[0]+" or "+o[1];default:return o.slice(0,-1).join(", ")+", or "+o[o.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var n,i={},o={start:ze},a=ze,s=function(e,t){return Zt(e,t)},u=qe("!",!1),l=qe("=",!1),c=qe(">=",!1),h=qe(">",!1),d=qe("<=",!1),f=qe("<>",!1),p=qe("<",!1),v=qe("!=",!1),y=function(e){return e[0]+" "+e[2]},g=qe("+",!1),m=qe("-",!1),_=qe("*",!1),b=qe("/",!1),I=function(e,t){return e+t.join("")},S=/^[A-Za-z_\x80-\uFFFF]/,x=Qe([["A","Z"],["a","z"],"_",["",""]],!1,!1),w=/^[A-Za-z0-9_]/,T=Qe([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),F=/^[A-Za-z0-9_.\x80-\uFFFF]/,E=Qe([["A","Z"],["a","z"],["0","9"],"_",".",["",""]],!1,!1),N=qe("@",!1),M=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},C=function(e,t){return{type:"interval-period",period:"second",precision:e,secondary:t}},R=function(e){return parseFloat(e)},A=qe("'",!1),O=qe("N'",!1),P=qe("''",!1),j=/^[^']/,G=Qe(["'"],!0,!1),L=function(e,t){return{type:"when_clause",operand:e,value:t}},k=qe(".",!1),q=/^[0-9]/,Q=Qe([["0","9"]],!1,!1),B=/^[eE]/,D=Qe(["e","E"],!1,!1),V=/^[+\-]/,z=Qe(["+","-"],!1,!1),U=qe("NULL",!0),Y=qe("TRUE",!0),J=qe("FALSE",!0),W=qe("IN",!0),Z=qe("IS",!0),X=qe("LIKE",!0),H=qe("ESCAPE",!0),$=qe("NOT",!0),K=qe("AND",!0),ee=qe("OR",!0),te=qe("BETWEEN",!0),re=qe("FROM",!0),ne=qe("FOR",!0),ie=qe("SUBSTRING",!0),oe=qe("EXTRACT",!0),ae=qe("TRIM",!0),se=qe("POSITION",!0),ue=qe("TIMESTAMP",!0),le=qe("DATE",!0),ce=qe("LEADING",!0),he=qe("TRAILING",!0),de=qe("BOTH",!0),fe=qe("TO",!0),pe=qe("INTERVAL",!0),ve=qe("YEAR",!0),ye=qe("MONTH",!0),ge=qe("DAY",!0),me=qe("HOUR",!0),_e=qe("MINUTE",!0),be=qe("SECOND",!0),Ie=qe("CASE",!0),Se=qe("END",!0),xe=qe("WHEN",!0),we=qe("THEN",!0),Te=qe("ELSE",!0),Fe=qe(",",!1),Ee=qe("(",!1),Ne=qe(")",!1),Me=/^[ \t\n\r]/,Ce=Qe([" ","\t","\n","\r"],!1,!1),Re=qe("`",!1),Ae=/^[^`]/,Oe=Qe(["`"],!0,!1),Pe=0,je=[{line:1,column:1}],Ge=0,Le=[],ke=0;if("startRule"in r){if(!(r.startRule in o))throw new Error("Can't start parsing from rule \""+r.startRule+'".');a=o[r.startRule]}function qe(e,t){return{type:"literal",text:e,ignoreCase:t}}function Qe(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Be(e){var r,n=je[e];if(n)return n;for(r=e-1;!je[r];)r--;for(n={line:(n=je[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return je[e]=n,n}function De(e,t){var r=Be(e),n=Be(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function Ve(e){Pe<Ge||(Pe>Ge&&(Ge=Pe,Le=[]),Le.push(e))}function ze(){var e,t;return e=Pe,Yt()!==i&&(t=Ye())!==i&&Yt()!==i?e=t:(Pe=e,e=i),e}function Ue(){var e,t,r,n,o,a,s,u;if(e=Pe,(t=Ye())!==i){for(r=[],n=Pe,(o=Yt())!==i&&(a=Vt())!==i&&(s=Yt())!==i&&(u=Ye())!==i?n=o=[o,a,s,u]:(Pe=n,n=i);n!==i;)r.push(n),n=Pe,(o=Yt())!==i&&(a=Vt())!==i&&(s=Yt())!==i&&(u=Ye())!==i?n=o=[o,a,s,u]:(Pe=n,n=i);r!==i?e=t=function(e,t){var r={type:"expr_list"},n=function(e,t,r){return function(e,t){for(var r=[e],n=0;n<t.length;n++)r.push(t[n][3]);return r}(e,t)}(e,t);return r.value=n,r}(t,r):(Pe=e,e=i)}else Pe=e,e=i;return e}function Ye(){var e,t,r,n,o,a,u,l;if(e=Pe,(t=Je())!==i){for(r=[],n=Pe,(o=Yt())!==i&&(a=Nt())!==i&&(u=Yt())!==i&&(l=Je())!==i?n=o=[o,a,u,l]:(Pe=n,n=i);n!==i;)r.push(n),n=Pe,(o=Yt())!==i&&(a=Nt())!==i&&(u=Yt())!==i&&(l=Je())!==i?n=o=[o,a,u,l]:(Pe=n,n=i);r!==i?e=t=s(t,r):(Pe=e,e=i)}else Pe=e,e=i;return e}function Je(){var e,t,r,n,o,a,u,l;if(e=Pe,(t=We())!==i){for(r=[],n=Pe,(o=Yt())!==i&&(a=Et())!==i&&(u=Yt())!==i&&(l=We())!==i?n=o=[o,a,u,l]:(Pe=n,n=i);n!==i;)r.push(n),n=Pe,(o=Yt())!==i&&(a=Et())!==i&&(u=Yt())!==i&&(l=We())!==i?n=o=[o,a,u,l]:(Pe=n,n=i);r!==i?e=t=s(t,r):(Pe=e,e=i)}else Pe=e,e=i;return e}function We(){var e,r,n,o,a;return e=Pe,(r=Ft())===i&&(r=Pe,33===t.charCodeAt(Pe)?(n="!",Pe++):(n=i,0===ke&&Ve(u)),n!==i?(o=Pe,ke++,61===t.charCodeAt(Pe)?(a="=",Pe++):(a=i,0===ke&&Ve(l)),ke--,a===i?o=void 0:(Pe=o,o=i),o!==i?r=n=[n,o]:(Pe=r,r=i)):(Pe=r,r=i)),r!==i&&(n=Yt())!==i&&(o=We())!==i?e=r={type:"unary_expr",operator:"NOT",expr:o}:(Pe=e,e=i),e===i&&(e=function(){var e,r,n;return e=Pe,(r=$e())!==i&&Yt()!==i?((n=function(){var e;return(e=function(){var e,t,r,n,o,a;if(Pe,e=[],t=Pe,(r=Yt())!==i&&(n=Ze())!==i&&(o=Yt())!==i&&(a=$e())!==i?t=r=[r,n,o,a]:(Pe=t,t=i),t!==i)for(;t!==i;)e.push(t),t=Pe,(r=Yt())!==i&&(n=Ze())!==i&&(o=Yt())!==i&&(a=$e())!==i?t=r=[r,n,o,a]:(Pe=t,t=i);else e=i;return e!==i&&(e={type:"arithmetic",tail:e}),e}())===i&&(e=function(){var e,t,r,n;return e=Pe,(t=He())!==i&&Yt()!==i&&(r=zt())!==i&&Yt()!==i&&(n=Ue())!==i&&Yt()!==i&&Ut()!==i?e=t={op:t,right:n}:(Pe=e,e=i),e===i&&(e=Pe,(t=He())!==i&&Yt()!==i&&(r=zt())!==i&&Yt()!==i&&(n=Ut())!==i?e=t=function(e){return{op:e,right:{type:"expr_list",value:[]}}}(t):(Pe=e,e=i),e===i&&(e=Pe,(t=He())!==i&&Yt()!==i&&(r=st())!==i?e=t=function(e,t){return{op:e,right:t}}(t,r):(Pe=e,e=i))),e}())===i&&(e=function(){var e,t,r,n,o,a;return e=Pe,(t=Ft())!==i&&Yt()!==i&&(r=Mt())!==i&&Yt()!==i&&(n=$e())!==i&&Yt()!==i&&(o=Et())!==i&&Yt()!==i&&(a=$e())!==i?e=t={op:"NOT"+r,right:{type:"expr_list",value:[n,a]}}:(Pe=e,e=i),e===i&&(e=Pe,(t=Mt())!==i&&Yt()!==i&&(r=$e())!==i&&Yt()!==i&&(n=Et())!==i&&Yt()!==i&&(o=$e())!==i?e=t=function(e,t,r){return{op:e,right:{type:"expr_list",value:[t,r]}}}(t,r,o):(Pe=e,e=i)),e}())===i&&(e=function(){var e,t,r,n;return e=Pe,(t=wt())!==i&&Yt()!==i&&(r=Ft())!==i&&Yt()!==i&&(n=$e())!==i?e=t={op:t+"NOT",right:n}:(Pe=e,e=i),e===i&&(e=Pe,(t=wt())!==i&&Yt()!==i&&(r=$e())!==i?e=t=function(e,t){return{op:e,right:t}}(t,r):(Pe=e,e=i)),e}())===i&&(e=function(){var e,r,n,o;return e=Pe,(r=Xe())!==i&&Yt()!==i&&(n=ft())!==i&&Yt()!==i&&function(){var e,r,n,o;return e=Pe,"escape"===t.substr(Pe,6).toLowerCase()?(r=t.substr(Pe,6),Pe+=6):(r=i,0===ke&&Ve(H)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="ESCAPE":(Pe=e,e=i)):(Pe=e,e=i),e}()!==i&&Yt()!==i&&(o=pt())!==i?e=r={op:r,right:n,escape:o.value}:(Pe=e,e=i),e===i&&(e=Pe,(r=Xe())!==i&&Yt()!==i&&(n=ft())!==i?e=r=function(e,t){return{op:e,right:t,escape:""}}(r,n):(Pe=e,e=i)),e}()),e}())===i&&(n=null),n!==i?e=r=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?Zt(e,t.tail):Wt(t.op,e,t.right,t.escape)}(r,n):(Pe=e,e=i)):(Pe=e,e=i),e}()),e}function Ze(){var e;return">="===t.substr(Pe,2)?(e=">=",Pe+=2):(e=i,0===ke&&Ve(c)),e===i&&(62===t.charCodeAt(Pe)?(e=">",Pe++):(e=i,0===ke&&Ve(h)),e===i&&("<="===t.substr(Pe,2)?(e="<=",Pe+=2):(e=i,0===ke&&Ve(d)),e===i&&("<>"===t.substr(Pe,2)?(e="<>",Pe+=2):(e=i,0===ke&&Ve(f)),e===i&&(60===t.charCodeAt(Pe)?(e="<",Pe++):(e=i,0===ke&&Ve(p)),e===i&&(61===t.charCodeAt(Pe)?(e="=",Pe++):(e=i,0===ke&&Ve(l)),e===i&&("!="===t.substr(Pe,2)?(e="!=",Pe+=2):(e=i,0===ke&&Ve(v)))))))),e}function Xe(){var e,t,r,n,o;return e=Pe,t=Pe,(r=Ft())!==i&&(n=Yt())!==i&&(o=Tt())!==i?t=r=[r,n,o]:(Pe=t,t=i),t!==i&&(t=y(t)),(e=t)===i&&(e=Tt()),e}function He(){var e,t,r,n,o;return e=Pe,t=Pe,(r=Ft())!==i&&(n=Yt())!==i&&(o=xt())!==i?t=r=[r,n,o]:(Pe=t,t=i),t!==i&&(t=y(t)),(e=t)===i&&(e=xt()),e}function $e(){var e,t,r,n,o,a,u,l;if(e=Pe,(t=et())!==i){for(r=[],n=Pe,(o=Yt())!==i&&(a=Ke())!==i&&(u=Yt())!==i&&(l=et())!==i?n=o=[o,a,u,l]:(Pe=n,n=i);n!==i;)r.push(n),n=Pe,(o=Yt())!==i&&(a=Ke())!==i&&(u=Yt())!==i&&(l=et())!==i?n=o=[o,a,u,l]:(Pe=n,n=i);r!==i?e=t=s(t,r):(Pe=e,e=i)}else Pe=e,e=i;return e}function Ke(){var e;return 43===t.charCodeAt(Pe)?(e="+",Pe++):(e=i,0===ke&&Ve(g)),e===i&&(45===t.charCodeAt(Pe)?(e="-",Pe++):(e=i,0===ke&&Ve(m))),e}function et(){var e,t,r,n,o,a,s,u;if(e=Pe,(t=rt())!==i){for(r=[],n=Pe,(o=Yt())!==i&&(a=tt())!==i&&(s=Yt())!==i&&(u=rt())!==i?n=o=[o,a,s,u]:(Pe=n,n=i);n!==i;)r.push(n),n=Pe,(o=Yt())!==i&&(a=tt())!==i&&(s=Yt())!==i&&(u=rt())!==i?n=o=[o,a,s,u]:(Pe=n,n=i);r!==i?e=t=Zt(t,r):(Pe=e,e=i)}else Pe=e,e=i;return e}function tt(){var e;return 42===t.charCodeAt(Pe)?(e="*",Pe++):(e=i,0===ke&&Ve(_)),e===i&&(47===t.charCodeAt(Pe)?(e="/",Pe++):(e=i,0===ke&&Ve(b))),e}function rt(){var e,r,n;return(e=function(){var e;return(e=pt())===i&&(e=function(){var e,t,r,n;return e=Pe,(t=function(){var e,t,r,n;return e=Pe,(t=mt())!==i&&(r=_t())!==i&&(n=bt())!==i?e=t=parseFloat(t+r+n):(Pe=e,e=i),e===i&&(e=Pe,(t=mt())!==i&&(r=_t())!==i?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Pe=e,e=i),e===i&&(e=Pe,(t=mt())!==i&&(r=bt())!==i?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Pe=e,e=i),e===i&&(e=Pe,(t=mt())!==i&&(t=function(e){return parseFloat(e)}(t)),e=t))),e}())!==i?(r=Pe,ke++,n=it(),ke--,n===i?r=void 0:(Pe=r,r=i),r!==i?e=t={type:"number",value:t}:(Pe=e,e=i)):(Pe=e,e=i),e}())===i&&(e=function(){var e,r;return e=Pe,(r=function(){var e,r,n,o;return e=Pe,"true"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=i,0===ke&&Ve(Y)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r=[r,n]:(Pe=e,e=i)):(Pe=e,e=i),e}())!==i&&(r={type:"bool",value:!0}),(e=r)===i&&(e=Pe,(r=function(){var e,r,n,o;return e=Pe,"false"===t.substr(Pe,5).toLowerCase()?(r=t.substr(Pe,5),Pe+=5):(r=i,0===ke&&Ve(J)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r=[r,n]:(Pe=e,e=i)):(Pe=e,e=i),e}())!==i&&(r={type:"bool",value:!1}),e=r),e}())===i&&(e=function(){var e;return Pe,(e=function(){var e,r,n,o;return e=Pe,"null"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=i,0===ke&&Ve(U)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r=[r,n]:(Pe=e,e=i)):(Pe=e,e=i),e}())!==i&&(e={type:"null",value:null}),e}())===i&&(e=function(){var e,r;return e=Pe,function(){var e,r,n,o;return e=Pe,"date"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=i,0===ke&&Ve(le)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="DATE":(Pe=e,e=i)):(Pe=e,e=i),e}()!==i&&Yt()!==i&&(r=ft())!==i?e={type:"date",value:r.value}:(Pe=e,e=i),e}())===i&&(e=function(){var e,r;return e=Pe,function(){var e,r,n,o;return e=Pe,"timestamp"===t.substr(Pe,9).toLowerCase()?(r=t.substr(Pe,9),Pe+=9):(r=i,0===ke&&Ve(ue)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="TIMESTAMP":(Pe=e,e=i)):(Pe=e,e=i),e}()!==i&&Yt()!==i&&(r=ft())!==i?e={type:"timestamp",value:r.value}:(Pe=e,e=i),e}())===i&&(e=function(){var e,r,n,o;return e=Pe,At()!==i&&Yt()!==i?(45===t.charCodeAt(Pe)?(r="-",Pe++):(r=i,0===ke&&Ve(m)),r===i&&(43===t.charCodeAt(Pe)?(r="+",Pe++):(r=i,0===ke&&Ve(g))),r!==i&&Yt()!==i&&(n=ft())!==i&&Yt()!==i&&(o=lt())!==i?e={type:"interval",value:n,qualifier:o,op:r}:(Pe=e,e=i)):(Pe=e,e=i),e===i&&(e=Pe,At()!==i&&Yt()!==i&&(r=ft())!==i&&Yt()!==i&&(n=lt())!==i?e=function(e,t){return{type:"interval",value:e,qualifier:t,op:""}}(r,n):(Pe=e,e=i)),e}()),e}())===i&&(e=function(){var e,r,n;return e=Pe,function(){var e,r,n,o;return e=Pe,"extract"===t.substr(Pe,7).toLowerCase()?(r=t.substr(Pe,7),Pe+=7):(r=i,0===ke&&Ve(oe)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="EXTRACT":(Pe=e,e=i)):(Pe=e,e=i),e}()!==i&&Yt()!==i&&zt()!==i&&Yt()!==i&&(r=function(){var e;return(e=Ot())===i&&(e=Pt())===i&&(e=jt())===i&&(e=Gt())===i&&(e=Lt())===i&&(e=kt()),e}())!==i&&Yt()!==i&&Ct()!==i&&Yt()!==i&&(n=Ye())!==i&&Yt()!==i&&Ut()!==i?e={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:r},n]}}:(Pe=e,e=i),e}())===i&&(e=function(){var e,r,n,o,a,s,u,l,c,h,d;return e=Pe,function(){var e,r,n,o;return e=Pe,"substring"===t.substr(Pe,9).toLowerCase()?(r=t.substr(Pe,9),Pe+=9):(r=i,0===ke&&Ve(ie)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="SUBSTRING":(Pe=e,e=i)):(Pe=e,e=i),e}()!==i&&Yt()!==i&&zt()!==i&&Yt()!==i&&(r=Ye())!==i&&Yt()!==i&&Ct()!==i&&Yt()!==i&&(n=Ye())!==i&&Yt()!==i?(o=Pe,(a=function(){var e,r,n,o;return e=Pe,"for"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=i,0===ke&&Ve(ne)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="FOR":(Pe=e,e=i)):(Pe=e,e=i),e}())!==i&&(s=Yt())!==i&&(u=Ye())!==i&&(l=Yt())!==i?o=a=[a,s,u,l]:(Pe=o,o=i),o===i&&(o=null),o!==i&&(a=Ut())!==i?(c=r,h=n,e={type:"function",name:"substring",args:{type:"expr_list",value:(d=o)?[c,h,d[2]]:[c,h]}}):(Pe=e,e=i)):(Pe=e,e=i),e}())===i&&(e=function(){var e,t,r,n,o;return e=Pe,Rt()!==i&&Yt()!==i&&zt()!==i&&Yt()!==i?((t=ut())===i&&(t=null),t!==i&&Yt()!==i&&(r=Ye())!==i&&Yt()!==i&&Ct()!==i&&Yt()!==i&&(n=Ye())!==i&&Yt()!==i&&Ut()!==i?e={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==(o=t)?"BOTH":o},r,n]}}:(Pe=e,e=i)):(Pe=e,e=i),e===i&&(e=Pe,Rt()!==i&&Yt()!==i&&zt()!==i&&Yt()!==i?((t=ut())===i&&(t=null),t!==i&&Yt()!==i&&(r=Ye())!==i&&Yt()!==i&&Ut()!==i?e=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}}(t,r):(Pe=e,e=i)):(Pe=e,e=i)),e}())===i&&(e=function(){var e,r,n;return e=Pe,function(){var e,r,n,o;return e=Pe,"position"===t.substr(Pe,8).toLowerCase()?(r=t.substr(Pe,8),Pe+=8):(r=i,0===ke&&Ve(se)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="POSITION":(Pe=e,e=i)):(Pe=e,e=i),e}()!==i&&Yt()!==i&&zt()!==i&&Yt()!==i&&(r=Ye())!==i&&Yt()!==i&&xt()!==i&&Yt()!==i&&(n=Ye())!==i&&Yt()!==i&&Ut()!==i?e={type:"function",name:"position",args:{type:"expr_list",value:[r,n]}}:(Pe=e,e=i),e}())===i&&(e=function(){var e,r,n;return e=Pe,(r=function(){var e,r,n,o;if(e=Pe,(r=nt())!==i&&(r=r),(e=r)===i)if(e=Pe,96===t.charCodeAt(Pe)?(r="`",Pe++):(r=i,0===ke&&Ve(Re)),r!==i){if(n=[],Ae.test(t.charAt(Pe))?(o=t.charAt(Pe),Pe++):(o=i,0===ke&&Ve(Oe)),o!==i)for(;o!==i;)n.push(o),Ae.test(t.charAt(Pe))?(o=t.charAt(Pe),Pe++):(o=i,0===ke&&Ve(Oe));else n=i;n!==i?(96===t.charCodeAt(Pe)?(o="`",Pe++):(o=i,0===ke&&Ve(Re)),o!==i?e=r=n.join(""):(Pe=e,e=i)):(Pe=e,e=i)}else Pe=e,e=i;return e}())!==i&&Yt()!==i&&zt()!==i&&Yt()!==i?((n=Ue())===i&&(n=null),n!==i&&Yt()!==i&&Ut()!==i?e=r={type:"function",name:r,args:n||{type:"expr_list",value:[]}}:(Pe=e,e=i)):(Pe=e,e=i),e}())===i&&(e=function(){var e;return(e=function(){var e,t,r,n,o;if(e=Pe,qt()!==i)if(Yt()!==i)if((t=Ye())!==i)if(Yt()!==i){for(r=[],n=yt();n!==i;)r.push(n),n=yt();r!==i&&(n=Yt())!==i&&(o=Qt())!==i?e={type:"case_expression",format:"simple",operand:t,clauses:r,else:null}:(Pe=e,e=i)}else Pe=e,e=i;else Pe=e,e=i;else Pe=e,e=i;else Pe=e,e=i;if(e===i)if(e=Pe,qt()!==i)if(Yt()!==i)if((t=Ye())!==i)if(Yt()!==i){for(r=[],n=yt();n!==i;)r.push(n),n=yt();r!==i&&(n=Yt())!==i&&(o=gt())!==i&&Yt()!==i&&Qt()!==i?e=function(e,t,r){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:r.value}}(t,r,o):(Pe=e,e=i)}else Pe=e,e=i;else Pe=e,e=i;else Pe=e,e=i;else Pe=e,e=i;return e}())===i&&(e=function(){var e,t,r,n;if(e=Pe,qt()!==i)if(Yt()!==i){for(t=[],r=vt();r!==i;)t.push(r),r=vt();t!==i&&(r=Yt())!==i&&(n=Qt())!==i?e={type:"case_expression",format:"searched",clauses:t,else:null}:(Pe=e,e=i)}else Pe=e,e=i;else Pe=e,e=i;if(e===i)if(e=Pe,qt()!==i)if(Yt()!==i){for(t=[],r=vt();r!==i;)t.push(r),r=vt();t!==i&&(r=Yt())!==i&&(n=gt())!==i&&Yt()!==i&&Qt()!==i?e=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}}(t,n):(Pe=e,e=i)}else Pe=e,e=i;else Pe=e,e=i;return e}()),e}())===i&&(e=function(){var e,t;return Pe,(e=function(){var e;return Pe,(e=function(){var e,t,r,n;if(e=Pe,(t=it())!==i){for(r=[],n=at();n!==i;)r.push(n),n=at();r!==i?e=t=I(t,r):(Pe=e,e=i)}else Pe=e,e=i;return e}())!==i&&(e=e),e}())!==i&&(e=/^CURRENT_DATE$/i.test(t=e)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(t)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:t}),e}())===i&&(e=st())===i&&(e=Pe,zt()!==i&&Yt()!==i&&(r=Ye())!==i&&Yt()!==i&&Ut()!==i?((n=r).paren=!0,e=n):(Pe=e,e=i)),e}function nt(){var e,t,r,n;if(e=Pe,(t=it())!==i){for(r=[],n=ot();n!==i;)r.push(n),n=ot();r!==i?e=t=I(t,r):(Pe=e,e=i)}else Pe=e,e=i;return e}function it(){var e;return S.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=i,0===ke&&Ve(x)),e}function ot(){var e;return w.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=i,0===ke&&Ve(T)),e}function at(){var e;return F.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=i,0===ke&&Ve(E)),e}function st(){var e,r,n;return Pe,e=Pe,64===t.charCodeAt(Pe)?(r="@",Pe++):(r=i,0===ke&&Ve(N)),r!==i&&(n=nt())!==i?e=r=[r,n]:(Pe=e,e=i),e!==i&&(e={type:"param",value:e[1]}),e}function ut(){var e;return(e=function(){var e,r,n,o;return e=Pe,"leading"===t.substr(Pe,7).toLowerCase()?(r=t.substr(Pe,7),Pe+=7):(r=i,0===ke&&Ve(ce)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="LEADING":(Pe=e,e=i)):(Pe=e,e=i),e}())===i&&(e=function(){var e,r,n,o;return e=Pe,"trailing"===t.substr(Pe,8).toLowerCase()?(r=t.substr(Pe,8),Pe+=8):(r=i,0===ke&&Ve(he)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="TRAILING":(Pe=e,e=i)):(Pe=e,e=i),e}())===i&&(e=function(){var e,r,n,o;return e=Pe,"both"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=i,0===ke&&Ve(de)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="BOTH":(Pe=e,e=i)):(Pe=e,e=i),e}()),e}function lt(){var e,r,n;return e=Pe,(r=function(){var e,t,r,n;return e=Pe,(t=ct())!==i&&Yt()!==i&&zt()!==i&&Yt()!==i&&(r=dt())!==i&&Yt()!==i&&Ut()!==i?(n=r,e=t={type:"interval-period",period:t.value,precision:n,secondary:null}):(Pe=e,e=i),e===i&&(e=Pe,(t=ct())!==i&&(t=M(t)),e=t),e}())!==i&&Yt()!==i&&function(){var e,r,n,o;return e=Pe,"to"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=i,0===ke&&Ve(fe)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="TO":(Pe=e,e=i)):(Pe=e,e=i),e}()!==i&&Yt()!==i&&(n=function(){var e,t,r,n;return e=Pe,(t=ct())!==i&&(t={type:"interval-period",period:t.value,precision:null,secondary:null}),(e=t)===i&&(e=Pe,(t=kt())!==i&&Yt()!==i&&zt()!==i&&Yt()!==i&&(r=dt())!==i&&Yt()!==i&&Vt()!==i&&Yt()!==i&&(n=ht())!==i&&Yt()!==i&&Ut()!==i?e=t=C(r,n):(Pe=e,e=i),e===i&&(e=Pe,(t=kt())!==i&&Yt()!==i&&zt()!==i&&Yt()!==i&&(r=dt())!==i&&Yt()!==i&&Ut()!==i?e=t={type:"interval-period",period:"second",precision:r,secondary:null}:(Pe=e,e=i),e===i&&(e=Pe,(t=kt())!==i&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t))),e}())!==i?e=r={type:"interval-qualifier",start:r,end:n}:(Pe=e,e=i),e===i&&(e=function(){var e,t,r,n,o;return e=Pe,(t=ct())!==i&&Yt()!==i&&zt()!==i&&Yt()!==i&&(r=ht())!==i&&Yt()!==i&&Ut()!==i?(o=r,e=t={type:"interval-period",period:t.value,precision:o,secondary:null}):(Pe=e,e=i),e===i&&(e=Pe,(t=ct())!==i&&(t=M(t)),(e=t)===i&&(e=Pe,(t=kt())!==i&&Yt()!==i&&zt()!==i&&Yt()!==i&&(r=dt())!==i&&Yt()!==i&&Vt()!==i&&Yt()!==i&&(n=ht())!==i&&Yt()!==i&&Ut()!==i?e=t=C(r,n):(Pe=e,e=i),e===i&&(e=Pe,(t=kt())!==i&&Yt()!==i&&zt()!==i&&Yt()!==i&&(r=ht())!==i&&Yt()!==i&&Ut()!==i?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(r):(Pe=e,e=i),e===i&&(e=Pe,(t=kt())!==i&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t)))),e}()),e}function ct(){var e,t;return e=Pe,(t=jt())!==i&&(t={type:"string",value:"day"}),(e=t)===i&&(e=Pe,(t=Gt())!==i&&(t={type:"string",value:"hour"}),(e=t)===i&&(e=Pe,(t=Lt())!==i&&(t={type:"string",value:"minute"}),(e=t)===i&&(e=Pe,(t=Pt())!==i&&(t={type:"string",value:"month"}),(e=t)===i&&(e=Pe,(t=Ot())!==i&&(t={type:"string",value:"year"}),e=t)))),e}function ht(){var e;return Pe,(e=It())!==i&&(e=R(e)),e}function dt(){var e;return Pe,(e=It())!==i&&(e=R(e)),e}function ft(){var e;return(e=pt())===i&&(e=st()),e}function pt(){var e,r,n,o,a;if(e=Pe,39===t.charCodeAt(Pe)?(r="'",Pe++):(r=i,0===ke&&Ve(A)),r===i&&("N'"===t.substr(Pe,2)?(r="N'",Pe+=2):(r=i,0===ke&&Ve(O))),r!==i){for(n=[],o=Pe,"''"===t.substr(Pe,2)?(a="''",Pe+=2):(a=i,0===ke&&Ve(P)),a!==i&&(a="'"),(o=a)===i&&(j.test(t.charAt(Pe))?(o=t.charAt(Pe),Pe++):(o=i,0===ke&&Ve(G)));o!==i;)n.push(o),o=Pe,"''"===t.substr(Pe,2)?(a="''",Pe+=2):(a=i,0===ke&&Ve(P)),a!==i&&(a="'"),(o=a)===i&&(j.test(t.charAt(Pe))?(o=t.charAt(Pe),Pe++):(o=i,0===ke&&Ve(G)));n!==i?(39===t.charCodeAt(Pe)?(o="'",Pe++):(o=i,0===ke&&Ve(A)),o!==i?e=r={type:"string",value:n.join("")}:(Pe=e,e=i)):(Pe=e,e=i)}else Pe=e,e=i;return e}function vt(){var e,t,r;return e=Pe,Bt()!==i&&Yt()!==i&&(t=Ye())!==i&&Yt()!==i&&Dt()!==i&&Yt()!==i&&(r=Ye())!==i?e=L(t,r):(Pe=e,e=i),e}function yt(){var e,t,r;return e=Pe,Bt()!==i&&Yt()!==i&&(t=Ye())!==i&&Yt()!==i&&Dt()!==i&&Yt()!==i&&(r=Ye())!==i?e=L(t,r):(Pe=e,e=i),e}function gt(){var e,r;return e=Pe,function(){var e,r,n,o;return e=Pe,"else"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=i,0===ke&&Ve(Te)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="ELSE":(Pe=e,e=i)):(Pe=e,e=i),e}()!==i&&Yt()!==i&&(r=Ye())!==i?e={type:"else_clause",value:r}:(Pe=e,e=i),e}function mt(){var e,r,n,o;return(e=It())===i&&(e=Pe,45===t.charCodeAt(Pe)?(r="-",Pe++):(r=i,0===ke&&Ve(m)),r===i&&(43===t.charCodeAt(Pe)?(r="+",Pe++):(r=i,0===ke&&Ve(g))),r!==i&&(n=It())!==i?(o=n,e=r=r[0]+o):(Pe=e,e=i)),e}function _t(){var e,r,n,o;return e=Pe,46===t.charCodeAt(Pe)?(r=".",Pe++):(r=i,0===ke&&Ve(k)),r!==i?((n=It())===i&&(n=null),n!==i?e=r="."+(null!=(o=n)?o:""):(Pe=e,e=i)):(Pe=e,e=i),e}function bt(){var e,r,n;return e=Pe,(r=function(){var e,r,n,o;return e=Pe,B.test(t.charAt(Pe))?(r=t.charAt(Pe),Pe++):(r=i,0===ke&&Ve(D)),r!==i?(V.test(t.charAt(Pe))?(n=t.charAt(Pe),Pe++):(n=i,0===ke&&Ve(z)),n===i&&(n=null),n!==i?e=r="e"+(null===(o=n)?"":o):(Pe=e,e=i)):(Pe=e,e=i),e}())!==i&&(n=It())!==i?e=r+=n:(Pe=e,e=i),e}function It(){var e,t;if(Pe,e=[],(t=St())!==i)for(;t!==i;)e.push(t),t=St();else e=i;return e!==i&&(e=e.join("")),e}function St(){var e;return q.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=i,0===ke&&Ve(Q)),e}function xt(){var e,r,n,o;return e=Pe,"in"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=i,0===ke&&Ve(W)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="IN":(Pe=e,e=i)):(Pe=e,e=i),e}function wt(){var e,r,n,o;return e=Pe,"is"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=i,0===ke&&Ve(Z)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="IS":(Pe=e,e=i)):(Pe=e,e=i),e}function Tt(){var e,r,n,o;return e=Pe,"like"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=i,0===ke&&Ve(X)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="LIKE":(Pe=e,e=i)):(Pe=e,e=i),e}function Ft(){var e,r,n,o;return e=Pe,"not"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=i,0===ke&&Ve($)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="NOT":(Pe=e,e=i)):(Pe=e,e=i),e}function Et(){var e,r,n,o;return e=Pe,"and"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=i,0===ke&&Ve(K)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="AND":(Pe=e,e=i)):(Pe=e,e=i),e}function Nt(){var e,r,n,o;return e=Pe,"or"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=i,0===ke&&Ve(ee)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="OR":(Pe=e,e=i)):(Pe=e,e=i),e}function Mt(){var e,r,n,o;return e=Pe,"between"===t.substr(Pe,7).toLowerCase()?(r=t.substr(Pe,7),Pe+=7):(r=i,0===ke&&Ve(te)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="BETWEEN":(Pe=e,e=i)):(Pe=e,e=i),e}function Ct(){var e,r,n,o;return e=Pe,"from"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=i,0===ke&&Ve(re)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="FROM":(Pe=e,e=i)):(Pe=e,e=i),e}function Rt(){var e,r,n,o;return e=Pe,"trim"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=i,0===ke&&Ve(ae)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="TRIM":(Pe=e,e=i)):(Pe=e,e=i),e}function At(){var e,r,n,o;return e=Pe,"interval"===t.substr(Pe,8).toLowerCase()?(r=t.substr(Pe,8),Pe+=8):(r=i,0===ke&&Ve(pe)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="INTERVAL":(Pe=e,e=i)):(Pe=e,e=i),e}function Ot(){var e,r,n,o;return e=Pe,"year"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=i,0===ke&&Ve(ve)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="YEAR":(Pe=e,e=i)):(Pe=e,e=i),e}function Pt(){var e,r,n,o;return e=Pe,"month"===t.substr(Pe,5).toLowerCase()?(r=t.substr(Pe,5),Pe+=5):(r=i,0===ke&&Ve(ye)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="MONTH":(Pe=e,e=i)):(Pe=e,e=i),e}function jt(){var e,r,n,o;return e=Pe,"day"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=i,0===ke&&Ve(ge)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="DAY":(Pe=e,e=i)):(Pe=e,e=i),e}function Gt(){var e,r,n,o;return e=Pe,"hour"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=i,0===ke&&Ve(me)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="HOUR":(Pe=e,e=i)):(Pe=e,e=i),e}function Lt(){var e,r,n,o;return e=Pe,"minute"===t.substr(Pe,6).toLowerCase()?(r=t.substr(Pe,6),Pe+=6):(r=i,0===ke&&Ve(_e)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="MINUTE":(Pe=e,e=i)):(Pe=e,e=i),e}function kt(){var e,r,n,o;return e=Pe,"second"===t.substr(Pe,6).toLowerCase()?(r=t.substr(Pe,6),Pe+=6):(r=i,0===ke&&Ve(be)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="SECOND":(Pe=e,e=i)):(Pe=e,e=i),e}function qt(){var e,r,n,o;return e=Pe,"case"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=i,0===ke&&Ve(Ie)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="CASE":(Pe=e,e=i)):(Pe=e,e=i),e}function Qt(){var e,r,n,o;return e=Pe,"end"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=i,0===ke&&Ve(Se)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="END":(Pe=e,e=i)):(Pe=e,e=i),e}function Bt(){var e,r,n,o;return e=Pe,"when"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=i,0===ke&&Ve(xe)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="WHEN":(Pe=e,e=i)):(Pe=e,e=i),e}function Dt(){var e,r,n,o;return e=Pe,"then"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=i,0===ke&&Ve(we)),r!==i?(n=Pe,ke++,o=ot(),ke--,o===i?n=void 0:(Pe=n,n=i),n!==i?e=r="THEN":(Pe=e,e=i)):(Pe=e,e=i),e}function Vt(){var e;return 44===t.charCodeAt(Pe)?(e=",",Pe++):(e=i,0===ke&&Ve(Fe)),e}function zt(){var e;return 40===t.charCodeAt(Pe)?(e="(",Pe++):(e=i,0===ke&&Ve(Ee)),e}function Ut(){var e;return 41===t.charCodeAt(Pe)?(e=")",Pe++):(e=i,0===ke&&Ve(Ne)),e}function Yt(){var e,t;for(e=[],t=Jt();t!==i;)e.push(t),t=Jt();return e}function Jt(){var e;return Me.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=i,0===ke&&Ve(Ce)),e}function Wt(e,t,r,n){var i={type:"binary_expr",operator:e,left:t,right:r};return void 0!==n&&(i.escape=n),i}function Zt(e,t){for(var r=e,n=0;n<t.length;n++)r=Wt(t[n][1],r,t[n][3]);return r}if((n=a())!==i&&Pe===t.length)return n;throw n!==i&&Pe<t.length&&Ve({type:"end"}),function(t,r,n){return new e(e.buildMessage(t,r),t,r,n)}(Le,Ge<t.length?t.charAt(Ge):null,Ge<t.length?De(Ge,Ge+1):De(Ge,Ge))}}}.apply(null,[]))||(e.exports=n)},1184:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(8),r(9),r(99),r(13),r(4),r(65),r(137),r(37),r(322),r(1185),r(1087),r(1070),r(1112),r(1081)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,h,d,f,p,v,y){Object.defineProperty(t,"__esModule",{value:!0});var g=function(){function e(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter}return Object.defineProperty(e.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),e.prototype.createQueryResponse=function(e){var t;return t=e.outStatistics?e.outStatistics.some((function(e){return"exceedslimit"===e.statisticType}))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(c.isValid(e.outSR)&&!c.equals(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=y.cleanFromGeometryEngine(r({spatialReference:e.outSR},p.project(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=y.cleanFromGeometryEngine(r({spatialReference:e.outSR},this.queryGeometry))),t},e.prototype.executeAttributesQuery=function(t){var r=f.getWhereClause(t.where,this.fieldsIndex);if(!r)return s.resolve(this);if(r.isStandardized){for(var n=0,i=[],o=0,a=this.items;o<a.length;o++){var u=a[o];r.testFeature(u,this.featureAdapter)&&(i[n++]=u)}var l=new e(i,this.queryGeometry,this);return l.definitionExpression=t.where,s.resolve(l)}return s.reject(new TypeError("Where clause is not standardized"))},e.prototype.executeObjectIdsQuery=function(t){if(!t.objectIds||!t.objectIds.length)return s.resolve(this);var r=u.createSetFromValues(t.objectIds),n=this.featureAdapter.getObjectId;return s.resolve(new e(this.items.filter((function(e){return r.has(n(e))})),this.queryGeometry,this))},e.prototype.executeTimeQuery=function(t){var r=v.getTimeOperator(this.timeInfo,t.timeExtent,this.featureAdapter);if(!a.isSome(r))return s.resolve(this);var n=this.items.filter(r);return s.resolve(new e(n,this.queryGeometry,this))},e.prototype.filterLatest=function(){for(var t=this.timeInfo,r=t.trackIdField,n=t.startTimeField,i=t.endTimeField||n,a=new Map,u=this.featureAdapter.getAttribute,l=0,c=this.items;l<c.length;l++){var h=c[l],d=u(h,r),f=u(h,i),p=a.get(d);(!p||f>u(p,i))&&a.set(d,h)}var v=o.valuesOfMap(a);return s.resolve(new e(v,this.queryGeometry,this))},e.prototype.project=function(t){return i(this,void 0,void 0,(function(){var r,i=this;return n(this,(function(n){switch(n.label){case 0:return!t||c.equals(this.spatialReference,t)?[2,this]:(r=this.featureAdapter,[4,p.projectMany(this.items.map((function(e){return y.getGeometry(i,r.getGeometry(e))})),this.spatialReference,t)]);case 1:return[2,new e(n.sent().map((function(e,t){return r.cloneWithGeometry(i.items[t],h.convertFromGeometry(e,i.hasZ,i.hasM))})),this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:t,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}}))}))},e.prototype._createFeatureQueryResponse=function(e){var t=this,r=this.items,n=this,i=n.geometryType,o=n.hasM,a=n.hasZ,s=n.objectIdField,u=n.spatialReference,c=e.outFields,h=e.outSR,d=e.quantizationParameters,f=e.resultRecordCount,p=e.resultOffset,v=e.returnZ,g=e.returnM,m=!1;if(null!=f&&null!=p){var _=p+f;m=r.length>_,r=r.slice(p,Math.min(r.length,_))}var b=c&&(c.indexOf("*")>-1?this.fieldsIndex.fields.slice():c.map((function(e){return t.fieldsIndex.get(e)})));return{exceededTransferLimit:m,features:this._createFeatures(e,r),fields:b,geometryType:i,hasM:o&&g,hasZ:a&&v,objectIdFieldName:s,spatialReference:y.cleanFromGeometryEngine(h||u),transform:d&&l.toQuantizationTransform(d)||null}},e.prototype._createFeatures=function(e,t){var r=new d.default(e,this.featureAdapter,this.fieldsIndex),n=this.hasM,i=this.hasZ,o=e.orderByFields,a=e.quantizationParameters,s=e.returnGeometry,u=e.returnCentroid,c=e.maxAllowableOffset,h=e.returnZ,f=void 0!==h&&h,p=e.returnM,v=i&&f,g=n&&void 0!==p&&p,m=[],_=0;if(t.length&&o&&o.length){var b=o[0].split(" "),I=b[0],S=this.fieldsIndex.get(I),x=b[1]&&"desc"===b[1].toLowerCase();t.sort((function(e,t){var n=r.getFieldValue(e,I,S),i=r.getFieldValue(t,I,S);if("number"==typeof n&&"number"==typeof i)return x?i-n:n-i;if("string"==typeof n&&"string"==typeof i){var o=n.toUpperCase(),a=i.toUpperCase();return(x?o>a:o<a)?-1:(x?o<a:o>a)?1:0}}))}if(s||u){var w=l.toQuantizationTransform(a);if(s&&!u)for(var T=0,F=t;T<F.length;T++)O=F[T],m[_++]={attributes:r.getAttributes(O),geometry:y.getGeometry(this,this.featureAdapter.getGeometry(O),c,w,v,g)};else if(!s&&u)for(var E=0,N=t;E<N.length;E++)O=N[E],m[_++]={attributes:r.getAttributes(O),centroid:y.transformCentroid(this,this.featureAdapter.getCentroid(O,this),w)};else for(var M=0,C=t;M<C.length;M++)O=C[M],m[_++]={attributes:r.getAttributes(O),centroid:y.transformCentroid(this,this.featureAdapter.getCentroid(O,this),w),geometry:y.getGeometry(this,this.featureAdapter.getGeometry(O),c,w,v,g)}}else for(var R=0,A=t;R<A.length;R++){var O=A[R],P=r.getAttributes(O);P&&(m[_++]={attributes:P})}return m},e.prototype._createExceedsLimitQueryResponse=function(e){for(var t=!1,r=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,o=0,a=e.outStatistics;o<a.length;o++){var s=a[o];if("exceedslimit"===s.statisticType){r=null!=s.maxPointCount?s.maxPointCount:Number.POSITIVE_INFINITY,n=null!=s.maxRecordCount?s.maxRecordCount:Number.POSITIVE_INFINITY,i=null!=s.maxVertexCount?s.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>n)t=!0;else{var u=this.hasZ?this.hasM?4:3:this.hasM?3:2,l=this.featureAdapter;t=this.items.reduce((function(e,t){var r=l.getGeometry(t);return e+(r&&r.coords.length||0)}),0)/u>i}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}},e.prototype._createStatisticsQueryResponse=function(e){for(var t=new d.default(e,this.featureAdapter,this.fieldsIndex),r=e.outStatistics,n=[],i=[],o=e.groupByFieldsForStatistics,a=e.having,s=o&&o.length,u=s&&o[0],l=this.fieldsIndex.get(u),c=!l,h={},f={},p={},v={attributes:{}},y=0,g=r;y<g.length;y++){var m=g[y],_=m.outStatisticFieldName,b=m.statisticType,I="exceedslimit"!==b?m.onStatisticField:void 0,S=this.fieldsIndex.get(I),x=s&&(I===u||c)&&"count"===b;if(s){h[I]||(h[I]=this._calculateUniqueValues(t,u,l));var w=h[I];for(var T in w){var F=w[T],E=F.count,N=F.data,M=F.items;if(!a||t.validateItems(M,a)){var C=f[N]||{attributes:{}},R=null;R=x?E:(A=this._calculateStatistics(M,t,I,S))[O="var"===b?"variance":b],C.attributes[_]=R,C.attributes[c?"EXPR_1":u]=N,f[N]=C}}}else{p[I]||(p[I]=this._calculateStatistics(this.items,t,I,S));var A=p[I],O="var"===b?"variance":b;v.attributes[_]=A[O]}i.push({name:_,alias:_,type:"esriFieldTypeDouble"})}if(s)for(var P in f)n.push(f[P]);else n.push(v);return{fields:i,features:n}},e.prototype._calculateStatistics=function(e,t,r,n){for(var i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=null,s=null,u=null,l=null,c=[],h=0,d=0;d<e.length;d++){var f=e[d];"string"==typeof(g=t.getFieldValue(f,r,n))?h++:null==g||isNaN(g)||(a+=g,i=Math.min(i,g),o=Math.max(o,g),c.push(g),h++)}if(h){s=a/h;for(var p=0,v=0,y=c;v<y.length;v++){var g=y[v];p+=Math.pow(g-s,2)}l=h>1?p/(h-1):0,u=Math.sqrt(l)}else i=null,o=null;return{avg:s,count:h,max:o,min:i,stddev:u,sum:a,variance:l}},e.prototype._calculateUniqueValues=function(e,t,r){for(var n={},i=0,o=this.items;i<o.length;i++){var a=o[i],s=e.getFieldValue(a,t,r);(null==s||"string"==typeof s&&""===s.trim())&&(s=null),null==n[s]?n[s]={count:1,data:s,items:[a]}:(n[s].count++,n[s].items.push(a))}return n},e}();t.default=g}.apply(null,n))||(e.exports=i)},1185:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(13),r(1087)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;var i=e.outFields;if(i&&-1===i.indexOf("*")){this.outFields=i;for(var o=0,a=0,s=i;a<s.length;a++){var u=s[a],l=n.getExpressionFromFieldName(u),c=this.fieldsIndex.get(l),h=c?null:n.getWhereClause(l,r),d=c?c.name:n.getAliasFromFieldName(u)||"FIELD_EXP_"+o++;this._fieldDataCache.set(u,{alias:d,clause:h})}}}return e.prototype.getAttributes=function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)},e.prototype.getFieldValue=function(e,t,r){var i=r?r.name:t,o=null;return this._fieldDataCache.has(i)?o=this._fieldDataCache.get(i).clause:r||(o=n.getWhereClause(t,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:o})),r?this.featureAdapter.getAttribute(e,i):o.calculateValue(e,this.featureAdapter)},e.prototype.validateItem=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:n.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)},e.prototype.validateItems=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:n.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)},e.prototype._processAttributesForOutFields=function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);for(var r={},n=0,i=t;n<i.length;n++){var o=i[n],a=this._fieldDataCache.get(o),s=a.alias,u=a.clause;r[s]=u?u.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,s)}return r},e.prototype._processAttributesForDistinctValues=function(e){if(r.isNone(e)||!this.returnDistinctValues)return e;var t=this.outFields,n=[];if(t)for(var i=0,o=t;i<o.length;i++){var a=o[i],s=this._fieldDataCache.get(a).alias;n.push(e[s])}else for(var s in e)n.push(e[s]);var u=(t||["*"]).join(",")+"="+n.join(","),l=this._returnDistinctMap.get(u)||0;return this._returnDistinctMap.set(u,++l),l>1?null:e},e}();t.default=i}.apply(null,n))||(e.exports=i)},1186:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(4)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._tasks=new Array}return Object.defineProperty(e.prototype,"length",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0}),e.prototype.push=function(e){var t=this;return r.create((function(r,n){return t._tasks.push(new i(r,n,e))}))},e.prototype.unshift=function(e){var t=this;return r.create((function(r,n){return t._tasks.unshift(new i(r,n,e))}))},e.prototype.process=function(){if(0===this._tasks.length)return!1;var e=this._tasks.shift();try{var t=e.callback();t&&"then"in t&&"function"==typeof t.then?t.then(e.resolve,e.reject):e.resolve(t)}catch(t){e.reject(t)}return!0},e.prototype.cancelAll=function(){for(var e=r.createAbortError(),t=0,n=this._tasks;t<n.length;t++)n[t].reject(e);this._tasks.length=0},e}();t.default=n;var i=function(e,t,r){this.resolve=e,this.reject=t,this.callback=r}}.apply(null,n))||(e.exports=i)},1207:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Float64Array(2),n=new Float64Array(2);function i(e){return e<=57?e-48:e<=104?e-88:e<=107?e-89:e<=110?e-90:e-91}function o(e){return"0123456789bcdefghjkmnpqrstuvwxyz"[e]}function a(e){return(e[0]+e[1])/2}function s(e,t,r){return e[0]=t,e[1]=r,e}function u(e,t){var r=a(e),n=t,i=!t;e[0]=i*e[0]+n*r,e[1]=i*r+n*e[1]}function l(e,t){var r=t>a(e);return u(e,r),r}function c(e,t){for(var o=s(r,-90,90),l=s(n,-180,180),c=0;c<t.length;c++){var h=i(t.charCodeAt(c));c%2==0?(u(l,!!(16&h)),u(l,!!(4&h)),u(l,!!(1&h)),u(o,!!(8&h)),u(o,!!(2&h))):(u(o,!!(16&h)),u(o,!!(4&h)),u(o,!!(1&h)),u(l,!!(8&h)),u(l,!!(2&h)))}return e[0]=a(o),e[1]=a(l),e}function h(e,t,i){for(var a="",u=s(r,-90,90),c=s(n,-180,180),h=0;h<i;h++){var d=0;h%2?(d|=l(u,e)<<4,d|=l(c,t)<<3,d|=l(u,e)<<2,d|=l(c,t)<<1,d|=l(u,e)<<0):(d|=l(c,t)<<4,d|=l(u,e)<<3,d|=l(c,t)<<2,d|=l(u,e)<<1,d|=l(c,t)<<0),a+=o(d)}return a}function d(e){var t=Math.floor(5*e/2);return 180/Math.pow(2,t)}function f(e){var t=Math.ceil(5*e/2);return 360/Math.pow(2,t)}function p(e,t){return t?1&e|(4&e)>>1|(16&e)>>2:(2&e)>>1|(8&e)>>2}function v(e,t){return t?(2&e)>>1|(8&e)>>2:1&e|(4&e)>>1|(16&e)>>2}function y(e,t,r){var n=!((e.length-1)%2),a=e.substring(0,e.length-1),s=i(e.charCodeAt(e.length-1)),u=0,l=0,c=0,h=0;n?(u=8,l=4,c=1&s|(4&s)>>1|(16&s)>>2,h=(2&s)>>1|(8&s)>>2):(u=4,l=8,h=1&s|(4&s)>>1|(16&s)>>2,c=(2&s)>>1|(8&s)>>2);var d=c+t,f=h+r,p=Math.floor(d/u),v=Math.floor(f/l),g=o(function(e,t,r){return r?1&e|(1&t)<<1|(2&e)<<1|(2&t)<<2|(4&e)<<2:1&t|(1&e)<<1|(2&t)<<1|(2&e)<<2|(4&t)<<2}(d-p*u,f-v*l,n));return e.length>1&&(p||v)?y(a,p,v)+g:a+g}t.decodeBase32Char=i,t.encodeBase32Char=o,t.decodeGeohash=c,t.convertGeohash32ToXY=function(e,t){for(var r=0,n=0,o=30,a=30,s=0;s<t.length;s++){var u=i(t.charCodeAt(s)),l=s%2==0;r|=p(u,l)<<(o-=l?3:2),n|=v(u,l)<<(a-=l?2:3)}return{geohashX:r,geohashY:n}},t.decodeGeohashXY=function(e,t){for(var r=-90,n=90,i=-180,o=180,a=0;a<t;a++){for(var s=Math.ceil((a+1)/2),u=Math.floor((a+1)/2),l=1-a%2,c=30-(3*s+2*u),h=30-(2*s+3*u),d=3*l+2*(1-l),f=2*l+3*(1-l),p=3*l+7*(1-l)<<h,v=(7*l+3*(1-l)<<c&e.geohashX)>>c,y=(p&e.geohashY)>>h,g=d-1;g>=0;g--){var m=(i+o)/2,_=v&1<<g?1:0;i=(1-_)*i+_*m,o=(1-_)*m+_*o}for(g=f-1;g>=0;g--){var b=(r+n)/2,I=y&1<<g?1:0;r=(1-I)*r+I*b,n=(1-I)*b+I*n}}return[i,r,o,n]},t.setGeohashXY=function(e,t,r,n){n%2&&(n+=1);for(var i=0,o=0,a=-90,s=90,u=-180,l=180,c=0;c<n/2;c++){for(var h=0;h<5;h++){var d=(u+l)/2,f=r>d?1:0;i|=f<<29-(h+5*c),u=(1-f)*u+f*d,l=(1-f)*d+f*l}for(h=0;h<5;h++){var p=(a+s)/2,v=t>p?1:0;o|=v<<29-(h+5*c),a=(1-v)*a+v*p,s=(1-v)*p+v*s}}e.geohashX=i,e.geohashY=o},t.encodeGeohash=h,t.latDistPerGeohash=d,t.lonDistPerGeohash=f,t.unpackXBits=p,t.unpackYBits=v,t.getRelativeGeohash=y,t.getIntersectingGeohashes=function(e,t,r,n,i){for(var o=Math.abs(r-e),a=Math.abs(n-t),s=d(i),u=f(i),l=Math.ceil(a/u),c=Math.ceil(o/s),p=h(e,t,i),v=new Array,g=0;g<l;g++)for(var m=0;m<c;m++)v.push(y(p,g,m));return v},t.forEachIntersectingGeohash=function(e,t,r,n,i,o){for(var a=Math.abs(r-e),s=Math.abs(n-t),u=d(i),l=f(i),p=Math.ceil(s/l),v=Math.ceil(a/u),g=h(e,t,i),m=0;m<p;m++)for(var _=0;_<v;_++){var b=y(g,m,_),I=c([0,0],b),S=I[0],x=I[1],w=S-u/2,T=x-l/2,F=S+u/2,E=x+l/2,N=u*l,M=Math.max(e,w),C=Math.max(t,T),R=Math.min(r,F)-M,A=Math.min(n,E)-C;o(b,Math.abs(R*A)/N)}}}.apply(null,n))||(e.exports=i)},1333:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(8),r(9),r(1),r(5),r(10),r(132),r(15),r(6),r(13),r(4),r(2),r(1087),r(1094),r(328),r(136),r(101),r(320),r(1133),r(1334),r(1336)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,h,d,f,p,v,y,g,m,_,b,I,S){Object.defineProperty(t,"__esModule",{value:!0});var x=c.getLogger("esri.views.2d.layers.features.controllers.BaseController"),w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._availableFields=[],t._pixelBuffer=0,t.config=null,t.filters=new Array(_.definitions.MAX_FILTERS),t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t}return o(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._initAttributeStore()},t.prototype.startup=function(){return i(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this._initAttributeStore(),[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 1:return e.sent(),[4,d.all([this.attributeStore.updateFilters(this),this.updatePixelBuffer()])];case 2:return e.sent(),[2]}}))}))},t.prototype.destroy=function(){this.attributeStore&&this.attributeStore.destroy()},Object.defineProperty(t.prototype,"arcadeInfo",{get:function(){return{geometryType:this.service.geometryType,fields:this.service.fields,spatialReference:this.spatialReference}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureReduction",{get:function(){return this.config.featureReduction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new y(this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryInfo",{get:function(){return{geometryType:this.service.geometryType,hasZ:!1,hasM:!1}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnCentroid",{get:function(){return this._get("returnCentroid")||function(e,t,r){if("esriGeometryPolygon"===t&&e.labelingInfo)return!0;if("esriGeometryPolygon"!==t)return!1;function n(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t||"web-style"===t||"cim"===t}switch(r.type){case"simple":return n(r.symbol);case"unique-value":return n(r.defaultSymbol)||r.uniqueValueInfos.some((function(e){return n(e.symbol)}));case"class-breaks":return n(r.defaultSymbol)||r.classBreakInfos.some((function(e){return n(e.symbol)}));case"dot-density":return!1;default:return!0}}(this.config,this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnOutline",{get:function(){return function(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return"backgroundFillSymbol"in e&&null!=e.backgroundFillSymbol&&"outline"in e.backgroundFillSymbol&&null!=e.backgroundFillSymbol.outline||t.some((function(e){return"outline"in e&&null!=e.outline}))}(t)}}(this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){return{returnCentroid:this.returnCentroid,returnGeometry:!0,outFields:this.availableFields,definitionExpression:this.config.definitionExpression,gdbVersion:this.config.gdbVersion,historicMoment:this.config.historicMoment}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?g.fromJSON(this.config.renderer):(x.error("mapview-controller","Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this,t=this.config.availableFields.filter((function(t){return-1===e._availableFields.indexOf(t)}));return this._availableFields=this._availableFields.concat(t),this._availableFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewParams",{get:function(){return{viewingMode:"",scale:this.viewState&&this.viewState.scale||1}},enumerable:!0,configurable:!0}),t.prototype.getObjectId=function(e){return this.attributeStore.getFeatureId(e)},t.prototype.getAggregate=function(e){return null},t.prototype.getAggregateValueRanges=function(){return{}},t.prototype.getLocalId=function(e){return this.attributeStore.getLocalId(e)},t.prototype.mapValidLocalIds=function(e){var t=this;return e.map((function(e){return t.attributeStore.getLocalId(e)})).filter((function(e){return null!=e}))},t.prototype.setViewState=function(e){this._set("viewState",e)},t.prototype.updatePixelBuffer=function(){return i(this,void 0,void 0,(function(){var e;return n(this,(function(t){switch(t.label){case 0:return[4,S.computePxBuffer(this.renderer,this.service.geometryType)];case 1:return e=t.sent(),this._pixelBuffer=Math.max(this._pixelBuffer,e),[2]}}))}))},t.prototype.setHighlight=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){return[2,this.attributeStore.setHighlight(e)]}))}))},t.prototype.validateConfig=function(e){for(var t=0,r=e.filters;t<r.length;t++){var n=r[t];if(h.isSome(n)&&n.where)try{p.validateWhere(this.fieldsIndex,n.where)}catch(e){throw new s("mapview-bad-filter",e.message,{filter:n,missingFields:e.details})}}},t.prototype.onFeatureAdd=function(e){e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype.onFeatureRemove=function(e){!e.localId&&l("esri-2d-debug"),this.attributeStore.freeLocalId(e.objectId)},t.prototype.enableEvent=function(e){},t.prototype._initAttributeStore=function(){var e=this;this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new b.default({type:"remote",initialize:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",t,{signal:r})},update:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",t,{signal:r})},render:function(){return e.remoteClient.invoke("tileRenderer.featuresView.requestRender")}})},t.prototype._createQueryEngine=function(e){return new v.default({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:e,timeInfo:this.service.timeInfo})},t.prototype._createTempQueryEngine=function(e){return void 0===e&&(e=this._createFeatureStore()),this._createQueryEngine(e)},t.prototype._createFeatureStore=function(){var e={geometryType:this.service.geometryType,hasM:!1,hasZ:!1};return new I.ClusterStore(e,this.spatialReference,this.attributeStore,this.featureReduction)},t.prototype._createDefaultQuery=function(e){var t=new m,r=e.outFields,n=this.config,i=n.gdbVersion,o=n.historicMoment,a=n.definitionExpression;return r=r.length/this.service.fields.length>=.75?["*"]:r,t.gdbVersion=i,t.historicMoment=null!=o?new Date(o):null,t.num=e.num,t.outFields=r,t.outSpatialReference=this.spatialReference,t.returnGeometry=e.returnGeometry,t.returnCentroid=e.returnCentroid,t.start=e.resultOffset,t.where=a||"1=1",t},t.prototype.hasGeometryFilter=function(){return this.filters.some((function(e){return h.isSome(e)&&!!e.geometry}))},r([f.property({readOnly:!0,dependsOn:["config","service","spatialReference"]})],t.prototype,"arcadeInfo",null),r([f.property()],t.prototype,"config",void 0),r([f.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"featureReduction",null),r([f.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"fieldsIndex",null),r([f.property()],t.prototype,"filters",void 0),r([f.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"geometryInfo",null),r([f.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"returnCentroid",null),r([f.property({readOnly:!0,dependsOn:["service","config"]})],t.prototype,"returnOutline",null),r([f.property({readOnly:!0,dependsOn:["config","availableFields"]})],t.prototype,"queryInfo",null),r([f.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),r([f.property()],t.prototype,"processor",void 0),r([f.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"availableFields",null),r([f.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r([f.property({constructOnly:!0})],t.prototype,"service",void 0),r([f.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r([f.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r([f.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r([f.property({readOnly:!0})],t.prototype,"viewState",void 0),r([f.property({readOnly:!0,dependsOn:["viewState"]})],t.prototype,"viewParams",null),r([f.subclass("esri.views.2d.layers.features.controllers.BaseController")],t)}(f.declared(u.HandleOwner));t.default=w}.apply(null,n))||(e.exports=i)},1334:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(17),r(5),r(8),r(9),r(18),r(15),r(13),r(4),r(21),r(1335),r(1207),r(37),r(35),r(205),r(196),r(1123),r(1070),r(1094),r(1081),r(67),r(345),r(1066)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,h,d,f,p,v,y,g,m,_,b,I,S,x){Object.defineProperty(t,"__esModule",{value:!0});var w=function(e){return u.andThen(e,(function(e){return"cluster"!==e.type?null:n({},e,{clusterRadius:c.pt2px(e.clusterRadius/2)})}))};function T(e,t,r){return o(this,void 0,void 0,(function(){var n,o,a,s;return i(this,(function(i){for(n=[],o=0,a=e;o<a.length;o++)s=a[o],n.push(F(s,t,r));return[2,l.all(n)]}))}))}function F(e,t,r){return o(this,void 0,void 0,(function(){var n,o,a;return i(this,(function(i){switch(i.label){case 0:return"onStatisticValueExpression"in e.outStatistic?(o=(n=e).outStatistic.onStatisticValueExpression,a=n,[4,I.createRendererExpression(o,t,r)]):[3,2];case 1:return a.expression=i.sent(),[2,n];case 2:return[2,e]}}))}))}var E=function(e){function t(t,r,n,i,o){var a=this,s=new y.default([],[r,n]);return(a=e.call(this,s,i,null,t)||this).invalid=!1,a.canDelete=!1,a.geohashBoundsInfo=o,a}return r(t,e),Object.defineProperty(t.prototype,"count",{get:function(){return this.attributes.cluster_count},enumerable:!0,configurable:!0}),t.create=function(e,r,n,i,o,a,s){var u=new t(r,n,i,a,s);return u.localId=e.createLocalId(u.objectId,!0),u.tileLevel=o,u},t.prototype.update=function(e,t,r,n,i){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=n,this.geohashBoundsInfo=i,this.referenceId=null,this.invalid=!1,this},t.prototype.toJSON=function(){return{objectId:this.objectId,referenceId:this.referenceId,attributes:n({},this.attributes,{clusterId:this.objectId}),geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}},t}(v.default),N=function(e){function t(t,r,n,i){var o=e.call(this,t)||this;return o._deferredDeletionQueue=[],o._invalidated=!1,o._aggregateFieldsHash=null,o._geohashLevel=0,o._aggregateValueRanges={},o._aggregateValueRangesChanged=!1,o._aggregateFields=[],o._hasAggregateValueExpression=!1,o._hasViewExpression=!1,o._$view={scale:0,viewingMode:"none"},o._clusters=new Map,o._tiles=new Map,o._spatialReference=r,o._attributeStore=n,o._featureReduction=w(i),o._projectionSupportCheck=m.checkProjectionSupport(r,a.SpatialReference.WGS84),o}return r(t,e),t.prototype.setScale=function(e){var t=e!==this._$view.scale&&this._hasViewExpression,r=this._featureReduction;this._$view.scale=e,u.isSome(r)&&t&&(this._tree=new h.GeohashTree(this._aggregateFields),this._unindexFeatures(),this._reindexFeatures(!0))},t.prototype.update=function(e,t,r){return o(this,void 0,void 0,(function(){var n,o,a,s,l,c,d,f,p,v,y,g=this;return i(this,(function(i){switch(i.label){case 0:return n=this._featureReduction,o=u.andThen(t.featureReduction,w),a=t.aggregateFields.reduce((function(e,t){return e+JSON.stringify(t)}),""),s=null===n&&t.featureReduction,l=a!==this._aggregateFieldsHash,c=s||l,l?(d=this,[4,T(t.aggregateFields,this._spatialReference,r)]):[3,2];case 1:for(d._aggregateFields=i.sent(),this._hasViewExpression=!1,f=0,p=this._aggregateFields;f<p.length;f++)"onStatisticValueExpression"in(v=p[f]).outStatistic&&(y=v,this._hasAggregateValueExpression=!0,this._hasViewExpression=this._hasViewExpression||y.expression.referencesScale());i.label=2;case 2:return[4,this._projectionSupportCheck];case 3:return i.sent(),this._featureReduction=o,this._aggregateFieldsHash=a,this._aggregateValueRanges={},this._invalidated=!0,u.isNone(o)?(this._tree=null,[2]):(u.isSome(n)&&n.clusterRadius!==o.clusterRadius&&this._clusters.forEach((function(e){return e.canDelete=!0})),c&&(this._tree=new h.GeohashTree(t.aggregateFields),this._unindexFeatures()),(c||e)&&this._reindexFeatures(l),this._handleClusterUpdates(),this._tiles.forEach((function(e){return g._getClustersForTile(e,0,o.clusterRadius,null,!1)})),[2])}}))}))},t.prototype._ensureAggregateFields=function(e){if(this._hasAggregateValueExpression)for(var t=this._$view,r=0,n=this._aggregateFields;r<n.length;r++){var i=n[r];if("onStatisticValueExpression"in i.outStatistic){var o=i,a=o.expression,s=o.outStatistic.onStatisticField;e.attributes[s]=S.callWithOptimizedFeature(a,e,{$view:t},this.geometryInfo)}}},t.prototype._unindexFeatures=function(){this._featuresById.forEach((function(e){e.geohashIndexed=!1}))},t.prototype._reindexFeatures=function(e){var t=this;this._featuresById.forEach((function(r){r.geohashX||r.geohashY||t._setGeohash(r),e&&t._ensureAggregateFields(r),t._attributeStore.isVisible(r)?t._insertIntoIndex(r):t._removeFromIndex(r)}))},t.prototype.onTileUpdate=function(e){var t=this,r=e.added,n=e.removed;if(r.length){var i=Math.max.apply(Math,r.map((function(e){return e.level})));this._setGeohashLevel(i),r.forEach((function(e){return t._tiles.set(e.key.id,e)}))}if(!u.isNone(this._featureReduction)){var o=this._featureReduction.clusterRadius;n.forEach((function(e){t._tiles.delete(e.key.id),t._markTileClustersForDeletion(e,o)}))}},t.prototype.sweepClusters=function(){var e=this;this._clusters.forEach((function(t,r){t.canDelete&&(e._attributeStore.freeLocalId(t.objectId),e._clusters.delete(r))}));for(var t=0,r=this._deferredDeletionQueue;t<r.length;t++){var n=r[t];this._attributeStore.addLocalId(n)}this._deferredDeletionQueue=[]},t.prototype.executeTileQuery=function(t,r,n){return o(this,void 0,void 0,(function(){var o,a,s;return i(this,(function(i){switch(i.label){case 0:return u.isNone(this._featureReduction)?[2,e.prototype.executeTileQuery.call(this,t,r,n)]:[4,this._projectionSupportCheck];case 1:return i.sent(),this._handleClusterUpdates(),o=this._featureReduction.clusterRadius,a=this._getTransforms(t,r),s=this._getClustersForTile(t,n.pixelBuffer,o,a),this._aggregateValueRangesChanged&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),[2,s]}}))}))},t.prototype.getAggregate=function(e){var t=null;return this._clusters.forEach((function(r){r.localId===e&&(t=r.toJSON())})),t},t.prototype.getAggregateValueRanges=function(){return this._aggregateValueRanges},t.prototype._getClustersForTile=function(e,t,r,i,o){var l=this;void 0===o&&(o=!0),t=Math.max(t,50);for(var c=2*r,h=new Set,d=this._getGeohashLevel(e.key.level),f=Math.pow(2,e.key.level)*Math.ceil(x.TILE_SIZE/c),v=Math.ceil(t/c)+2,y=Math.ceil(x.TILE_SIZE/c)+2*v,g=e.key,I=g.row,S=g.col*x.TILE_SIZE,w=I*x.TILE_SIZE,T=Math.floor(S/c)-v,F=Math.floor(w/c)-v,E=T+y,N=F+y,M=new Array,C=e.tileInfoView.getLODInfoAt(e.key.level),R=T;R<=E;R++)for(var A=function(t){var r,c,v=R;C.wrap&&(v=R<0?R+f:R%f);var y=C.wrap&&R<0,g=C.wrap&&R%f!==R,I=O._lookupCluster(C,e.key.level,v,t,d);if(u.isSome(I)){var S=u.andThen(i,(function(e){return y?e.left:g?e.right:e.tile}));if(o&&u.isNone(S))return"continue";if(!I.count)return"continue";if(o&&1===I.count){var x=I.geohashBoundsInfo,w=x.xLL,T=x.yLL,F=x.xTR,E=x.yTR,N=x.level,A=u.expect(O._tree).findSingleOccupancyNode(w,T,F,E,N),P=u.unwrap(A).getLngLatBounds(),j={x:P[0],y:P[1]},G={x:P[2],y:P[3]},L=0,k=0,q=0,Q=0;if(O._spatialReference.isWebMercator)L=(r=p.lngLatToXY(j.x,j.y))[0],k=r[1],q=(c=p.lngLatToXY(G.x,G.y))[0],Q=c[1];else{var B=m.project(j,a.SpatialReference.WGS84,O._spatialReference),D=m.project(G,a.SpatialReference.WGS84,O._spatialReference);if(!B||!D)return s("esri-2d-debug"),"continue";L=B.x,k=B.y,q=D.x,Q=D.y}var V=[L,k,q,Q],z=null;if(O.forEachInBounds(V,(function(e){l._attributeStore.isVisible(e)&&(z&&s("esri-2d-debug"),z=e)})),!z)return s("esri-2d-debug"),"continue";var U=b.getGeometry(O.geometryInfo,z.geometry,0,u.expect(S)),Y=n({},z.attributes,I.attributes);I.referenceId=z.localId,h.add(I.objectId),M.push(new _.Feature(Y,I.localId,U))}else o&&(h.add(I.objectId),U=b.getGeometry(O.geometryInfo,I.geometry,0,u.expect(S)),M.push(new _.Feature(I.attributes,I.localId,U)))}},O=this,P=F;P<=N;P++)A(P);return{features:M,objectIds:h}},t.prototype._getGeohashLevel=function(e){return Math.min(Math.ceil(e/2+2),12)},t.prototype._setGeohashLevel=function(e){var t=this,r=this._geohashLevel,n=this._getGeohashLevel(e),i=2*(Math.floor(n/2)+1)-1,o=this._tree;this._geohashLevel=i,u.isNone(o)||(i>r?this._featuresById.forEach((function(e){e.geohashIndexed&&(o.insert(e,t._geohashLevel,r+1),e.geohashIndexed=!0)})):i<r&&o.dropLevels(this._geohashLevel))},t.prototype._insertIntoIndex=function(e){e.geohashIndexed||(this._invalidated=!0,e.geohashIndexed=!0,u.expect(this._tree).insert(e,this._geohashLevel))},t.prototype._removeFromIndex=function(e){e.geohashIndexed&&(this._invalidated=!0,u.expect(this._tree).remove(e,this._geohashLevel),e.geohashIndexed=!1)},t.prototype._handleClusterUpdates=function(){var e=this;this._invalidated&&this._clusters.size&&this._clusters.forEach((function(t){u.isSome(t)&&(t.invalid=t.invalid||e._invalidated)})),this._invalidated=!1},t.prototype._getTransforms=function(e,t){var r={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},i=f.getInfo(t);if(!i)return{tile:r,left:null,right:null};var o=i.valid,a=o[0],s=o[1];return{tile:r,left:n({},r,{translate:[s,e.bounds[3]]}),right:n({},r,{translate:[a-s+e.bounds[0],e.bounds[3]]})}},t.prototype._getClusterId=function(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r},t.prototype._markForDeletion=function(e,t,r){var n=this._getClusterId(e,t,r);if(this._clusters.has(n)){var i=this._clusters.get(n);u.isSome(i)?i.canDelete=!0:this._clusters.delete(n)}},t.prototype._getClusterBounds=function(e,t,r){if(u.isNone(this._featureReduction))return null;var n=this._featureReduction.clusterRadius,i=2*n,o=r%2?t*i:t*i+n,a=r*i,s=o/x.TILE_SIZE,l=a/x.TILE_SIZE,c=(o+i)/x.TILE_SIZE,h=(a-i)/x.TILE_SIZE;return[e.getXForColumn(s),e.getYForRow(l),e.getXForColumn(c),e.getYForRow(h)]},t.prototype._lookupCluster=function(e,t,r,i,o){var s,l;if(u.isNone(this._featureReduction)||u.isNone(this._tree))return null;var c=this._getClusterId(t,r,i),h=this._clusters.get(c);if(h&&u.isSome(h)&&!h.invalid&&!h.canDelete)return h;var f=this._getClusterBounds(e,r,i),v=f[0],y=f[1],g=f[2],_=f[3],b={x:v,y:y},I={x:g,y:_},S=0,x=0,w=0,T=0;if(this._spatialReference.isWebMercator)S=(s=p.xyToLngLat(b.x,b.y))[0],x=s[1],w=(l=p.xyToLngLat(I.x,I.y))[0],T=l[1];else{var F=m.project(b,this._spatialReference,a.SpatialReference.WGS84),N=m.project(I,this._spatialReference,a.SpatialReference.WGS84);if(!F||!N)return null;S=F.x,x=F.y,w=N.x,T=N.y}var M={geohashX:0,geohashY:0},C={geohashX:0,geohashY:0};d.setGeohashXY(M,x,S,o),d.setGeohashXY(C,T,w,o);var R=M.geohashX,A=M.geohashY,O=C.geohashX,P=C.geohashY,j={xLL:R,yLL:A,xTR:O,yTR:P,level:o},G=this._tree.getRegionStatistics(R,A,O,P,o),L=G.count,k=G.xTotal,q=G.yTotal,Q=L?k/L:0,B=L?q/L:0;if(u.isSome(h)&&h.canDelete){var D=this._attributeStore.removeLocalId(h.objectId);this._deferredDeletionQueue.push(D)}var V=u.isSome(h)&&!h.canDelete&&h.invalid,z=n({cluster_count:L},G.attributes),U=this._attributeStore,Y=V?h.update(Q,B,t,z,j):E.create(U,c,Q,B,t,z,j);return 0===L&&(Y.geometry.coords[0]=(v+g)/2,Y.geometry.coords[1]=(y+_)/2),this._attributeStore.setAttributeData(Y.localId,Y,this.geometryInfo,null),this._clusters.set(c,Y),this._updateAggregateValueRangeForCluster(Y,Y.tileLevel),Y},t.prototype._updateAggregateValueRangeForCluster=function(e,t){var r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},n=r.minValue,i=r.maxValue;r.minValue=Math.min(n,e.count),r.maxValue=Math.max(i,e.count),this._aggregateValueRanges[t]=r,n===r.minValue&&i===r.maxValue||(this._aggregateValueRangesChanged=!0)},t.prototype._markTileClustersForDeletion=function(e,t){for(var r=2*t,n=Math.ceil(x.TILE_SIZE/r),i=e.key,o=i.row,a=i.col*x.TILE_SIZE,s=o*x.TILE_SIZE,u=Math.floor(a/r),l=Math.floor(s/r),c=u;c<u+n;c++)for(var h=l;h<l+n;h++)this._markForDeletion(e.key.level,c,h)},t.prototype._setGeohash=function(e){var t=e.geometry;if(t&&t.coords.length){var r={x:t.coords[0],y:t.coords[1]},n=m.project(r,this._spatialReference,a.SpatialReference.WGS84);n?d.setGeohashXY(e,n.y,n.x,12):s("esri-2d-debug")}},t.prototype._add=function(t){var r=this._featuresById.get(t.objectId);e.prototype._add.call(this,t),this._ensureAggregateFields(t),u.isSome(this._featureReduction)&&u.isSome(this._tree)&&(r?(t.geohashIndexed=r.geohashIndexed,t.geohashX=r.geohashX,t.geohashY=r.geohashY):this._setGeohash(t),!t.geohashIndexed&&this._attributeStore.isVisible(t)&&this._insertIntoIndex(t))},t.prototype._remove=function(t){return u.isSome(this._featureReduction)&&u.isSome(this._tree)&&this._removeFromIndex(t),e.prototype._remove.call(this,t)},t}(g.default);t.ClusterStore=N}.apply(null,n))||(e.exports=i)},1335:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1213),r(13),r(1207)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this._pool=new r.default(8024),this._nodes=0,this._root=new a(0,0,0),this._fields=e}return e.prototype._acquire=function(e,t,r){var i=this._pool.dequeue();return this._nodes++,n.isSome(i)?i.realloc(e,t,r):new a(e,t,r)},e.prototype._release=function(e){this._nodes--,this._pool.enqueue(e)},Object.defineProperty(e.prototype,"count",{get:function(){return this._root.count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"poolSize",{get:function(){return this._pool.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){var e=0;return this._forEachNode((function(t){return e=Math.max(e,t.depth)})),e},enumerable:!0,configurable:!0}),e.prototype.dropLevels=function(e){var t=this;this._forEachNode((function(r){if(r.depth>=e)for(var n=0;n<r.children.length;n++){var i=r.children[n];r.children[n]=null,i&&t._release(i)}}))},e.prototype.insert=function(e,t,r){void 0===r&&(r=0);for(var n=this._root,i=0,o=0,a=0;null!==n;){if(n.depth>=r&&(n.count+=1,n.xTotal+=e.geometry.coords[0],n.yTotal+=e.geometry.coords[1],n.xGeohashTotal+=e.geohashX,n.yGeohashTotal+=e.geohashY,this._updateStatistics(e,n,1)),i>=t)return;var s=Math.ceil((i+1)/2),u=Math.floor((i+1)/2),l=1-i%2,c=30-(3*s+2*u),h=30-(2*s+3*u),d=7*l+3*(1-l)<<c,f=3*l+7*(1-l)<<h,p=8*l+4*(1-l),v=(e.geohashX&d)>>c,y=(e.geohashY&f)>>h,g=v+y*p;o=o<<3*l+2*(1-l)|v,a=a<<2*l+3*(1-l)|y,null==n.children[g]&&(n.children[g]=this._acquire(o,a,i+1)),i+=1,n=n.children[g]}},e.prototype.remove=function(e,t){for(var r=this._root,n=0;null!==r;){if(r.count-=1,r.xTotal-=e.geometry.coords[0],r.yTotal-=e.geometry.coords[1],r.xGeohashTotal-=e.geohashX,r.yGeohashTotal-=e.geohashY,this._updateStatistics(e,r,-1),n>=t)return;var i=Math.ceil((n+1)/2),o=Math.floor((n+1)/2),a=1-n%2,s=30-(3*i+2*o),u=30-(2*i+3*o),l=7*a+3*(1-a)<<s,c=3*a+7*(1-a)<<u,h=8*a+4*(1-a),d=((e.geohashX&l)>>s)+((e.geohashY&c)>>u)*h,f=r.children[d];1===f.count&&(this._release(f),r.children[d]=null),n+=1,r=f}},e.prototype.find=function(e,t,r){return this._root.find(e,t,r,0,0,0)},e.prototype.findSingleOccupancyNode=function(e,t,r,n,i){for(var o=this._root;null!==o;){var a=o.depth,s=o.xNode,u=o.yNode,l=1-a%2,c=o.xGeohashTotal/o.count,h=o.yGeohashTotal/o.count;if(1===o.count&&e<c&&c<=r&&t<h&&h<=n)return o;if(a>=i)o=o.next;else{for(var d=Math.ceil((a+1)/2),f=Math.floor((a+1)/2),p=30-(3*d+2*f),v=30-(2*d+3*f),y=~((1<<p)-1),g=~((1<<v)-1),m=(e&y)>>p,_=(t&g)>>v,b=(r&y)>>p,I=(n&g)>>v,S=s<<3*l+2*(1-l),x=u<<2*l+3*(1-l),w=S+8*l+4*(1-l),T=x+4*l+8*(1-l),F=Math.max(S,m),E=Math.max(x,_),N=Math.min(w,b),M=Math.min(T,I),C=null,R=null,A=E;A<=M;A++)for(var O=F;O<=N;O++){var P=O-S+(A-x)*(8*l+4*(1-l)),j=o.children[P];j&&(C||((C=j).next=o.next),R&&(R.next=j),R=j,j.next=o.next)}o=C||o.next}}return null},e.prototype.getRegionStatistics=function(e,t,r,n,i){for(var o=this._root,a=0,s=0,u=0,l={};null!==o;){var c=o.depth,h=o.xNode,d=o.yNode;if(c>=i){var f=o.xGeohashTotal/o.count,p=o.yGeohashTotal/o.count;e<f&&f<=r&&t<p&&p<=n&&(a+=o.count,s+=o.xTotal,u+=o.yTotal,this._aggregateStatistics(l,o.statistics)),o=o.next}else{for(var v=Math.ceil((c+1)/2),y=Math.floor((c+1)/2),g=1-c%2,m=30-(3*v+2*y),_=30-(2*v+3*y),b=~((1<<m)-1),I=~((1<<_)-1),S=(e&b)>>m,x=(t&I)>>_,w=(r&b)>>m,T=(n&I)>>_,F=h<<3*g+2*(1-g),E=d<<2*g+3*(1-g),N=F+8*g+4*(1-g),M=E+4*g+8*(1-g),C=Math.max(F,S),R=Math.max(E,x),A=Math.min(N,w),O=Math.min(M,T),P=null,j=null,G=R;G<=O;G++)for(var L=C;L<=A;L++){var k=L-F+(G-E)*(8*g+4*(1-g)),q=o.children[k];if(q){if(G!==R&&G!==O&&L!==C&&L!==A){f=q.xGeohashTotal/q.count,p=q.yGeohashTotal/q.count,e<f&&f<=r&&t<p&&p<=n&&(a+=q.count,s+=q.xTotal,u+=q.yTotal,this._aggregateStatistics(l,q.statistics));continue}P||((P=q).next=o.next),j&&(j.next=q),j=q,q.next=o.next}}o=P||o.next}}return{count:a,attributes:this._normalizeStatistics(l,a),xTotal:s,yTotal:u}},e.prototype._forEachNode=function(e){for(var t=this._root;null!==t;){var r=this._linkChildren(t)||t.next;e(t),t=r}},e.prototype._linkChildren=function(e){for(var t=null,r=null,n=0;n<=e.children.length;n++){var i=e.children[n];i&&(t||((t=i).next=e.next),r&&(r.next=i),r=i,i.next=e.next)}return t},e.prototype._updateStatistics=function(e,t,r){for(var n=0,i=this._fields;n<i.length;n++){var o=i[n],a=o.name,s=o.outStatistic.onStatisticField,u=e.attributes[s];switch(o.outStatistic.statisticType){case"norm":t.statistics[a]||(t.statistics[a]={});var l=o.outStatistic.onStatisticNormalizationField,c=e.attributes[l],h=t.statistics[a].onStatisticField||0,d=t.statistics[a].onStatisticNormalizationField||0;null==u||isNaN(u)||null==c||0===c||isNaN(c)||(t.statistics[a].onStatisticField=h+r*u,t.statistics[a].onStatisticNormalizationField=d+r*c);break;case"avg":t.statistics[a]||(t.statistics[a]={value:0,nanCount:0});var f=t.statistics[a].value,p=t.statistics[a].nanCount;null==u||isNaN(u)?t.statistics[a].nanCount=p+r:t.statistics[a].value=f+r*u;break;case"avg_angle":t.statistics[a]||(t.statistics[a]={x:0,y:0,nanCount:0});var v=t.statistics[a].x,y=t.statistics[a].y,g=(p=t.statistics[a].nanCount,Math.PI/180);null==u||isNaN(u)?t.statistics[a].nanCount=p+r:(t.statistics[a].x=v+r*Math.cos(u*g),t.statistics[a].y=y+r*Math.sin(u*g));break;case"mode":t.statistics[a]||(t.statistics[a]={}),f=t.statistics[a][u]||0,t.statistics[a][u]=f+r}}},e.prototype._aggregateStatistics=function(e,t){for(var r=0,n=this._fields;r<n.length;r++){var i=n[r],o=i.name;switch(i.outStatistic.statisticType){case"avg":case"avg_angle":case"mode":case"norm":for(var a in e[o]||(e[o]={}),t[o]){var s=e[o][a]||0;e[o][a]=s+t[o][a]}}}},e.prototype._normalizeStatistics=function(e,t){for(var r={},n=0,i=this._fields;n<i.length;n++){var o=i[n],a=o.name;switch(o.outStatistic.statisticType){case"norm":var s=e[a];if(t&&null==s.onStatisticNormalizationField)break;if(t&&s.onStatisticNormalizationField){r[a]=s.onStatisticField/s.onStatisticNormalizationField;break}r[a]=0;break;case"avg":if(!t)break;var u=e[a],l=u.value;if(!(t-(c=u.nanCount)))break;r[a]=l/(t-c);break;case"avg_angle":if(!t)break;var c,h=e[a],d=h.x,f=h.y;if(!(t-(c=h.nanCount)))break;var p=d/(t-c),v=f/(t-c),y=180/Math.PI,g=Math.atan2(v,p)*y;r[a]=g;break;case"mode":var m=e[a],_=0,b=null;for(var I in m){var S=m[I];S>_&&(_=S,b=I)}r[a]="null"===b?null:b}}return r},e}();t.GeohashTree=o;var a=function(){function e(e,t,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(var n=0;n<this.children.length;n++)this.children[n]=null;this.xNode=e,this.yNode=t,this.depth=r}return e.prototype.realloc=function(e,t,r){for(var n=0;n<this.children.length;n++)this.children[n]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this},e.prototype.getLngLatBounds=function(){var e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),n=30-(3*t+2*r),o=30-(2*t+3*r),a=this.xNode<<n,s=this.yNode<<o;return i.decodeGeohashXY({geohashX:a,geohashY:s},this.depth)},e.prototype.find=function(e,t,r,n,i,o){if(n>=r)return this;var a=1-n%2,s=3*a+2*(1-a),u=2*a+3*(1-a),l=30-i-s,c=30-o-u,h=((e&7*a+3*(1-a)<<l)>>l)+((t&3*a+7*(1-a)<<c)>>c)*(8*a+4*(1-a)),d=this.children[h];return null==d?null:d.find(e,t,r,n+1,i+s,o+u)},e}()}.apply(null,n))||(e.exports=i)},1336:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(9),r(5),r(4),r(21),r(220),r(320),r(1066),r(1079)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c){Object.defineProperty(t,"__esModule",{value:!0});var h={"simple-marker":1,"picture-marker":1,text:1,"simple-line":1,"simple-fill":1,"picture-fill":1,cim:1,"web-style":1};t.computePxBuffer=function(e,t){return n(this,void 0,void 0,(function(){var n,i,s,u,l,c,h;return r(this,(function(r){switch(r.label){case 0:if("heatmap"===e.type)return[2,Math.round(3*e.blurRadius)];if("dot-density"===e.type)return[2,0];if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?[2,100]:[2,50];for(n=e.getSymbols(),i=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map((function(e){return e.size})).reduce(_,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((function(e){return e.size})).reduce(_,0):"real-world-size"===r.transformationType?30:void 0}(e),s=[],u=0,l=n;u<l.length;u++)c=l[u],s.push(g(c,i));return[4,o.all(s)];case 1:return h=r.sent(),[2,a.pt2px(h.reduce(_,0))]}}))}))};var d=[0,0,0,0];function f(e,t){return null==e?t:e}function p(e,t){return null==e.outline?t:f(e.outline.width,t)}var v={sdf:!0,code:99,metrics:l.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new s.default(0,0,24,24),page:0,textureBinding:2};function y(e,t){return n(this,void 0,void 0,(function(){var n,o,a,s,l,h,g,_,b,I,S,x;return r(this,(function(r){switch(r.label){case 0:return"simple-marker"===e.type?(n=Math.max(f(e.size,12),t),[2,m(e)+.707*n]):"picture-marker"===e.type?(o=Math.max(f(e.height,12),t),a=f(e.width,12)*(o/f(e.height,12)),s=a/2,l=o/2,[2,m(e)+Math.sqrt(s*s+l*l)]):"text"===e.type?(h=function(e){var t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[v]};for(var r=[],n=0;n<t;n++)r.push(i({},v,{code:e.text.charCodeAt(n)}));return{glyphMosaicItems:r}}(e),c.getTextSymbolSize(d,e,h),g=Math.abs(d[0]),_=Math.abs(d[1]),b=d[2],I=d[3],[2,Math.max(g,_)+Math.max(b,I)]):"simple-line"===e.type?[2,Math.max(f(e.width,.75),t)/2]:"simple-fill"===e.type||"picture-fill"===e.type?[2,Math.max(p(e,0),t)/2]:"cim"===e.type?(S=u.CIMSymbolHelper.getEnvelope(e.data))?[2,Math.sqrt(S.width*S.width+S.height*S.height)]:[2,0]:"web-style"!==e.type?[3,2]:(x=y,[4,e.fetchCIMSymbol()]);case 1:return[2,x.apply(void 0,[r.sent(),t])];case 2:return[2,0]}}))}))}function g(e,t){return n(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:return function(e){return e.type in h}(e)?(i=(n=Math).min,[4,y(e,t)]):[2,0];case 1:return[2,i.apply(n,[r.sent(),75])]}}))}))}function m(e){var t=f(e.xoffset,0),r=f(e.yoffset,0);return Math.sqrt(t*t+r*r)}function _(e,t){return Math.max(e,t)}}.apply(null,n))||(e.exports=i)},2089:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(0),r(5),r(8),r(9),r(10),r(15),r(99),r(13),r(4),r(2),r(322),r(1159),r(1123),r(2090),r(2091),r(1333),r(2093)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,h,d,f,p,v,y,g,m,_){Object.defineProperty(t,"__esModule",{value:!0});var b=function(){function e(e,t){this.store=e,this.onUpdate=t}return e.prototype.add=function(e){this.store.add(e)},e.prototype.forEach=function(e){this.store.forEach(e)},e.prototype.removeById=function(e){return this.store.removeById(e)},e.prototype.update=function(e,t){this.onUpdate(e,t)},Object.defineProperty(e.prototype,"size",{get:function(){return this.store.numFeatures},enumerable:!0,configurable:!0}),e}(),I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="stream",t._tileDispatchMap=new Map,t._updateIntervalId=0,t}return r(t,e),t.prototype.initialize=function(){var e=this,t=this.service,r=t.source,n=t.objectIdField,i=t.timeInfo,o=t.purgeOptions,a=t.serviceFilter,s=t.geometryType,u=t.spatialReference;this.connection=new g.default(r,u,this.spatialReference,s,a),this._set("store",new v.default(this.geometryInfo)),this._set("streamFeatureManager",new y.default(new b(this.store,(function(t,r){return e._onUpdate(t,r)})),n,i,o)),this.connection.on("feature",(function(t){return e._onFeature(t)})),["connectionStatus","errorString"].forEach((function(t){e.watch("connection."+t,(function(r){return e.remoteClient.invoke("setProperty",{propertyName:t,value:r})}))})),this._updateIntervalId=setInterval((function(){return e.streamFeatureManager.checkForUpdates()}),64),this._shouldPushDataReceived=this.service.enableDataReceived},t.prototype.destroy=function(){clearInterval(this._updateIntervalId),this.connection.destroy(),this.queryEngine.destroy(),this._tileDispatchMap.forEach((function(e){return e.destroy()}))},Object.defineProperty(t.prototype,"queryEngine",{get:function(){return this._createQueryEngine(this.store)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._tempQueryEngine&&!!this._tempQueryEngine.featureStore.numFeatures||this._anyUpdatesQueued()},enumerable:!0,configurable:!0}),t.prototype.update=function(e){return a(this,void 0,void 0,(function(){var t,r,n=this;return o(this,(function(i){switch(i.label){case 0:return this.validateConfig(e),JSON.stringify(this.service.serviceFilter),t=this.renderer.getAttributeHash(),this._set("config",e),[4,this.updatePixelBuffer()];case 1:return i.sent(),JSON.stringify(this.service.serviceFilter),"heatmap"===this.renderer.type?[2]:t===this.renderer.getAttributeHash()?[3,3]:(r=this.queryEngine.featureStore,[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]);case 2:i.sent(),r.forEach((function(e){return n.attributeStore.setAttributeData(e.localId,e,n.geometryInfo,n.viewParams)})),i.label=3;case 3:return[4,this.attributeStore.updateFilters(this)];case 4:return i.sent(),[4,this.attributeStore.sendUpdates()];case 5:return i.sent(),[2]}}))}))},t.prototype.invalidate=function(){this._repushActiveTiles()},t.prototype.onEdits=function(){},t.prototype.queryFeatures=function(e){return this.queryEngine.executeQuery(e)},t.prototype.queryFeatureCount=function(e){return this.queryEngine.executeQueryForCount(e)},t.prototype.queryObjectIds=function(e){return this.queryEngine.executeQueryForIds(e)},t.prototype.queryExtent=function(e){return this.queryEngine.executeQueryForExtent(e)},t.prototype.queryLatestObservations=function(e){return a(this,void 0,void 0,(function(){return o(this,(function(t){if(!this.service.timeInfo.trackIdField)throw new s("mapview-no-trackIdField","queryLatestObservation can only be used with services that define a TrackIdField");return[2,this.queryEngine.executeQueryForLatestObservations(e)]}))}))},t.prototype.queryStatistics=function(){throw new s("Method not implemented.")},t.prototype.refresh=function(){},t.prototype.setViewState=function(){var e=this,t=this.viewState&&this.viewState.scale;this.inherited(arguments),t!==this.viewState.scale&&this.attributeStore.hasScaleExpr&&(this.queryEngine.featureStore.forEach((function(t){return e.attributeStore.setAttributeData(t.localId,t,e.geometryInfo,e.viewParams)})),this.attributeStore.sendUpdates())},t.prototype.onTileUpdate=function(e){var t=this,r=e.added;e.removed.forEach((function(e){return t._handleTileRemove(e)})),r.forEach((function(e){return t._handleTileAdd(e)}))},t.prototype.enableEvent=function(e){"data-received"===e.name&&(this._shouldPushDataReceived=e.value)},t.prototype._onFeature=function(e){this._shouldPushDataReceived&&this.remoteClient.invoke("emitEvent",{name:"data-received",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}});try{var t=this.geometryInfo,r=t.geometryType,n=t.hasM,i=t.hasZ,o=f.convertFromFeature(e,r,i,n,this.service.objectIdField);this.streamFeatureManager.add(o)}catch(e){u("esri-2d-debug")}},t.prototype._createStoreWithFeatures=function(e){if(c.isNone(e))return null;var t=this._createFeatureStore();return t.addMany(e),t},t.prototype._onUpdate=function(e,t){return a(this,void 0,void 0,(function(){var r,n,i=this;return o(this,(function(o){switch(o.label){case 0:return c.isSome(e)&&e.forEach((function(e){return i.onFeatureAdd(e)})),r=this._createStoreWithFeatures(e),n=this._createStoreWithFeatures(t),this.attributeStore.sendUpdates(),this.processor.supportsTileUpdates?[4,this._updateActiveTiles(r,n)]:[3,2];case 1:return o.sent(),[3,3];case 2:this._repushActiveTiles(),o.label=3;case 3:return c.isSome(t)&&t.forEach((function(e){return i.onFeatureRemove(e)})),[2]}}))}))},t.prototype._handleTileAdd=function(e){if(this._tileDispatchMap.has(e.id))(t=this._tileDispatchMap.get(e.id)).up();else{var t=new _.default;this._tileDispatchMap.set(e.id,t)}this._queryTileFeatures(e,!0,this.queryEngine)},t.prototype._handleTileRemove=function(e){var t=this._tileDispatchMap.get(e.id);t&&(t.destroy(),this._tileDispatchMap.delete(e.id))},t.prototype._anyUpdatesQueued=function(){return l.valuesOfMap(this._tileDispatchMap).some((function(e){return e.hasAction()}))},t.prototype._updateActiveTiles=function(e,t){return a(this,void 0,void 0,(function(){var r,n,i=this;return o(this,(function(o){switch(o.label){case 0:return r=c.applySome(e,(function(e){return i._createQueryEngine(e)})),n=c.applySome(t,(function(e){return i._createQueryEngine(e)})),[4,h.all(this.tileStore.tiles.map((function(e){return i._queryTileFeatures(e,!1,r,n)})))];case 1:return o.sent(),[2]}}))}))},t.prototype._repushActiveTiles=function(){for(var e=0,t=this.tileStore.tiles;e<t.length;e++){var r=t[e];this._queryTileFeatures(r,!0,this.queryEngine)}},t.prototype._queryTileFeatures=function(e,t,r,n){return a(this,void 0,void 0,(function(){var i,s,u,l,d,f,v,y,g,m,_,b,I=this;return o(this,(function(S){switch(S.label){case 0:return i={hasZ:!1,hasM:!1,transform:{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}},s=this.queryInfo,u=s.returnCentroid,l=s.returnGeometry,d=this._pixelBuffer,f={returnCentroid:u,returnGeometry:l,pixelBuffer:d,returnOutline:this.returnOutline},this._tileDispatchMap.has(e.id)?(v=this._tileDispatchMap.get(e.id),[4,c.applySome(r,(function(t){return t.featureStore.executeTileQuery(e,I.spatialReference,f)}))]):[2];case 1:return y=S.sent(),g=c.mapOr(y,[],(function(e){return e.features})),m=c.mapOr(n,[],(function(t){return p.executeTileQueryForIds(t,e,f)})).map((function(e){return I.attributeStore.getLocalId(e)})),_=h.createResolver(),b=function(r){return a(I,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.processor.onTileData(e,{addOrUpdate:g,remove:m,clear:t,transformParams:i},{signal:r})];case 1:return o.sent(),[3,3];case 2:return n=o.sent(),h.throwIfNotAbortError(n),[3,3];case 3:return _.resolve(),[2]}}))}))},v.enqueue(b),[2,_.promise]}}))}))},n([d.property()],t.prototype,"connection",void 0),n([d.property()],t.prototype,"service",void 0),n([d.property({readOnly:!0})],t.prototype,"store",void 0),n([d.property({readOnly:!0})],t.prototype,"streamFeatureManager",void 0),n([d.property({readOnly:!0,dependsOn:["store","service","config"]})],t.prototype,"queryEngine",null),n([d.property()],t.prototype,"updating",null),n([d.subclass("esri.views.2d.layers.features.controllers.StreamController")],t)}(d.declared(m.default));t.default=I}.apply(null,n))||(e.exports=i)},2090:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(17),r(1213),r(59),r(13)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_STREAM_ID_FIELD="__esri_stream_id__";var s=function(){function e(e,r,n,i,o){void 0===o&&(o=128),this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=Date.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=n,this._purgeOptions=i,this.store=e,this.objectIdField=r,this.purgeInterval=o,this._useGeneratedIds=this.objectIdField===t.DEFAULT_STREAM_ID_FIELD}return e.prototype.add=function(e){if(this._useGeneratedIds&&(e.attributes[this.objectIdField]=this._nextId()),e.objectId=e.attributes[this.objectIdField],this.store.add(e),this._addOrUpdated.set(e.objectId,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),this._timeInfo.trackIdField){var t=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(t)){var r=a.isSome(this._purgeOptions)&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:1e3,n=o.clamp(r,0,1e3);this._trackIdToObservations.set(t,new i.default(n))}var s=this._trackIdToObservations.get(t),u=e.attributes[this.objectIdField],l=s.enqueue(u);if(a.isSome(l)){var c=this.store.removeById(l);a.isSome(c)&&(this._addOrUpdated.has(l)?this._addOrUpdated.delete(l):this._removed.push(c))}}},e.prototype.checkForUpdates=function(){var e=this._getToAdd(),t=this._getToRemove(),r=Date.now();r-this._lastPurge>=this.purgeInterval&&(this._purge(),this._lastPurge=r),(e||t)&&this.store.update(e,t)},e.prototype._getToAdd=function(){if(!this._addOrUpdated.size)return null;var e=new Array(this._addOrUpdated.size),t=0;return this._addOrUpdated.forEach((function(r){return e[t++]=r})),this._addOrUpdated.clear(),e},e.prototype._getToRemove=function(){var e=this._removed;return this._removed.length?(this._removed=[],e):null},e.prototype._nextId=function(){var e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e},e.prototype._purge=function(){var e=this._purgeOptions;a.isSome(e)&&(this._purgeSomeByDisplayCount(e),this._purgeByAge(e),this._purgeTracks())},e.prototype._purgeSomeByDisplayCount=function(e){var t=this;if(e.displayCount){var r=this.store.size;r>e.displayCount&&this._trackIdToObservations.forEach((function(n){if(r>e.displayCount&&n.size){var i=t.store.removeById(a.unwrap(n.dequeue()));a.isSome(i)&&t._removed.push(i),r--}}))}},e.prototype._purgeByAge=function(e){var t=this;if(e.age){var r=60*e.age*1e3,n=this._maxAge-r,i=this._timeInfo.startTimeField;this.store.forEach((function(e){e.attributes[i]<n&&(t.store.removeById(e.objectId),t._removed.push(e))}))}},e.prototype._purgeTracks=function(){var e=this;this._trackIdToObservations.forEach((function(t,r){0===t.size&&e._trackIdToObservations.delete(r)}))},e}();t.default=s}.apply(null,n))||(e.exports=i)},2091:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(0),r(9),r(1),r(18),r(31),r(10),r(6),r(13),r(4),r(2),r(199),r(2092),r(355),r(148),r(101)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,h,d,f,p,v,y,g){Object.defineProperty(t,"__esModule",{value:!0});var m,_=l.getLogger("esri.layers.graphics.sources.connections.GeoEventConnection");!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(m=t.ReadyState||(t.ReadyState={}));var b=function(e){function t(t,r,n,i,o,a,s,u){void 0===a&&(a=5),void 0===s&&(s=3);var l=e.call(this)||this;return l._destroyed=!1,l.errorString=null,l._source=t,l._sourceSpatialReference=r,l._spatialReference=n,l._filter=o,l._outFields=u,l._maxQueryDepth=a,l._maxRecordCountFactor=s,l._featureZScaler=y.getGeometryZScaler(i,r,n),l._open(),l}return o(t,e),t.prototype._open=function(){return i(this,void 0,void 0,(function(){var e,t,n,i;return r(this,(function(r){switch(r.label){case 0:return[4,this._fetchServiceDefinition(this._source)];case 1:return(e=r.sent()).timeInfo.trackIdField||_.warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect."),[4,this._fetchWebSocketUrl(e.streamUrls,this._spatialReference)];case 2:return t=r.sent(),this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),[4,this._buddyServicesQuery];case 3:return r.sent(),[4,this._tryCreateWebSocket(t)];case 4:return r.sent(),n=this._filter,i=this._outFields,this._destroyed||this._setFilter(n,i),[2]}}))}))},t.prototype.destroy=function(){this._destroyed=!0,c.isSome(this._websocket)&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null},Object.defineProperty(t.prototype,"connectionStatus",{get:function(){if(c.isNone(this._websocket))return"disconnected";switch(this._websocket.readyState){case m.CONNECTING:case m.OPEN:return"connected";case m.CLOSING:case m.CLOSED:return"disconnected"}},enumerable:!0,configurable:!0}),t.prototype._tryCreateWebSocket=function(e,t){return void 0===t&&(t=1e3),i(this,void 0,void 0,(function(){var n,i,o;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,4]),this._destroyed?[2]:(n=this,[4,this._createWebSocket(e)]);case 1:return n._websocket=r.sent(),this.notifyChange("connectionStatus"),[3,4];case 2:return i=r.sent(),o=t/1e3,_.error(new u("geoevent-connection","Failed to connect. Attempting to reconnect in "+o+"s",i)),[4,h.after(t)];case 3:return r.sent(),[2,this._tryCreateWebSocket(e,1.5*t)];case 4:return[2]}}))}))},t.prototype._createWebSocket=function(e){var t=this,r=new WebSocket(e),n=h.create((function(e,t){r.onopen=function(){return e(r)},r.onclose=function(e){return t(e)}}));return n.then((function(){if(t._destroyed)return r.onclose=function(){},void r.close();r.onclose=function(e){return t._onClose(e)},r.onerror=function(e){return t._onError(e)},r.onmessage=function(e){return t._onMessage(e)}})),n},t.prototype._onMessage=function(e){var t;try{t=this._enrich(JSON.parse(e.data)),this._featureZScaler&&this._featureZScaler(t.geometry)}catch(e){return void _.error(new u("geoevent-connection","Failed to parse message",e))}this.onFeature(t)},t.prototype._onError=function(e){var t="Encountered an error over WebSocket connection";this._set("errorString",t),_.error("geoevent-connection",t)},t.prototype._onClose=function(e){this._websocket=null,this.notifyChange("connectionStatus"),1e3!==e.code&&_.error("geoevent-connection","WebSocket closed unexpectedly with error code "+e.code),this._destroyed||this._open()},t.prototype._fetchServiceDefinition=function(e){return i(this,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return[4,s(e,{query:{f:"json"},responseType:"json"})];case 1:return t=r.sent(),n=t.data,this._serviceDefinition=n,[2,n]}}))}))},t.prototype._fetchWebSocketUrl=function(e,t){return i(this,void 0,void 0,(function(){var n,i,o;return r(this,(function(r){return n=e[0],i=n.urls,o=n.token,[2,this._inferWebSocketBaseUrl(i)+"/subscribe?outSR="+t.wkid+(o?"&token="+o:"")]}))}))},t.prototype._inferWebSocketBaseUrl=function(e){if(1===e.length)return e[0];for(var t=0,r=e;t<r.length;t++){var n=r[t];if(-1!==n.indexOf("wss"))return n}return _.error(new u("geoevent-connection","Unable to infer WebSocket url",e)),null},t.prototype._setFilter=function(e,t){return i(this,void 0,void 0,(function(){var n,i,o,a,s,l,d=this;return r(this,(function(r){return n=this._websocket,this._filter=e,this._outFields=t,c.isNone(n)||c.isNone(e)&&c.isNone(t)?[2]:(i=JSON.stringify({filter:this._serializeFilter(e,t)}),o=!1,a=h.createResolver(),s=function(){o||(d._destroyed||d._websocket!==n||_.error(new u("geoevent-connection","Server timed out when setting filter")),a.reject())},l=function(e){var t=JSON.parse(e.data);t.filter&&(t.error&&(_.error(new u("geoevent-connection","Failed to set service filter",t.error)),d._set("errorString","Could not set service filter - "+t.error),a.reject(t.error)),n.onmessage=d._onMessage.bind(d),o=!0,a.resolve())},n.onmessage=l,n.send(i),setTimeout(s,1e4),[2,a.promise])}))}))},t.prototype._serializeFilter=function(e,t){var r={};if(c.isNone(e)&&c.isNone(t))return r;if(c.isSome(e)&&e.geometry)try{var n=a.fromJSON(e.geometry);if("extent"!==n.type)throw new u("Expected extent but found type "+n.type);r.geometry=JSON.stringify(n.shiftCentralMeridian())}catch(e){_.error(new u("geoevent-connection","Encountered an error when setting connection geometryDefinition",e))}return c.isSome(e)&&e.where&&"1 = 1"!==e.where&&(r.where=e.where),c.isSome(t)&&(r.outFields=t.join(",")),r},t.prototype._enrich=function(e){if(!this._relatedFeatures)return e;var t=this._serviceDefinition.relatedFeatures.joinField,r=e.attributes[t];if(!this._relatedFeatures.has(r))return _.warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",e),e;var n=this._relatedFeatures.get(r),i=n.attributes,o=n.geometry;for(var a in i)e.attributes[a]=i[a];return o&&(e.geometry=o),e.geometry||e.centroid||_.error(new u("geoevent-connection","Found malformed feature - no geometry found",e)),e},t.prototype._queryBuddyServices=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,o,a,s,l,c,h;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=this._serviceDefinition,t=e.relatedFeatures,n=e.keepLatestArchive,i=this._queryRelatedFeatures(t),o=this._queryArchive(n),[4,i];case 1:return r.sent(),[4,o];case 2:if(!(a=r.sent()))return[2];for(s=0,l=a.features;s<l.length;s++)c=l[s],this.onFeature(this._enrich(c));return[3,4];case 3:return h=r.sent(),_.error(new u("geoevent-connection","Encountered an error when querying buddy services",{error:h})),[3,4];case 4:return[2]}}))}))},t.prototype._queryRelatedFeatures=function(e){return i(this,void 0,void 0,(function(){var t;return r(this,(function(r){switch(r.label){case 0:return e?[4,this._queryBuddy(e.featuresUrl)]:[2];case 1:return t=r.sent(),this._addRelatedFeatures(t),[2]}}))}))},t.prototype._queryArchive=function(e){return i(this,void 0,void 0,(function(){return r(this,(function(t){return e?[2,this._queryBuddy(e.featuresUrl)]:[2,void 0]}))}))},t.prototype._queryBuddy=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,s,u,l,h,d;return r(this,(function(r){switch(r.label){case 0:return[4,(t=new f({url:e})).load()];case 1:return n=r.sent().capabilities,i=n.query.supportsMaxRecordCountFactor,o=n.query.supportsPagination,a=n.query.supportsCentroid,s=this._maxRecordCountFactor,u=t.capabilities.query.maxRecordCount,l=i?u*s:u,(h=new g).outFields=c.unwrapOr(this._outFields,["*"]),h.where=c.unwrapOr(c.get(this._filter,"where"),"1=1"),h.returnGeometry=!0,h.returnExceededLimitFeatures=!0,h.outSpatialReference=this._spatialReference,a&&(h.returnCentroid=!0),i&&(h.maxRecordCountFactor=s),o?(h.num=l,t.destroy(),[2,this._queryPages(e,h)]):[4,v.executeQuery(e,h,this._sourceSpatialReference)];case 2:return d=r.sent(),t.destroy(),[2,d.data]}}))}))},t.prototype._queryPages=function(e,t,n,o){return void 0===n&&(n=[]),void 0===o&&(o=0),i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return t.start=o*t.num,[4,v.executeQuery(e,t,this._sourceSpatialReference)];case 1:return(i=r.sent().data).exceededTransferLimit&&o<this._maxQueryDepth?(i.features.forEach((function(e){return n.push(e)})),[2,this._queryPages(e,t,n,o+1)]):(n.forEach((function(e){return i.features.push(e)})),[2,i])}}))}))},t.prototype._addRelatedFeatures=function(e){for(var t=new Map,r=e.features,n=this._serviceDefinition.relatedFeatures.joinField,i=0,o=r;i<o.length;i++){var a=o[i],s=a.attributes[n];t.set(s,a)}this._relatedFeatures=t},n([d.property()],t.prototype,"connectionStatus",null),n([d.property()],t.prototype,"errorString",void 0),n([d.subclass("esri.layers.graphics.sources.connections.GeoEventConnection")],t)}(d.declared(p.default));t.default=b}.apply(null,n))||(e.exports=i)},2092:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(1),r(52),r(132),r(2)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onFeature=function(e){this.emit("feature",e)},r([a.subclass("esri.layers.graphics.sources.connections.StreamConnection")],t)}(a.declared(i.EventedMixin(o.HandleOwner)));t.default=s}.apply(null,n))||(e.exports=i)},2093:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(9),r(4)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this._action=null,this._queue=[],this._abortController=i.createAbortController(),this._refs=1}return e.prototype.up=function(){this._refs++},e.prototype.down=function(){return this._refs--,0===this._refs},e.prototype.clear=function(){this._abortController.abort(),this._abortController=i.createAbortController()},e.prototype.destroy=function(){this._queue.length=0,this._action&&(this._action=null)},e.prototype.enqueue=function(e){this._action?this._queue.push(e):this._setAction(e)},e.prototype.flush=function(){return n(this,void 0,void 0,(function(){var e,t,n;return r(this,(function(r){return(e=this._action)?(t=this._abortController.signal,n=this._queue.reduce((function(e,r){return e.then((function(){return r(t)}))}),e).catch(i.throwIfNotAbortError),this._action=n.then(this._handleNext.bind(this)).catch(i.throwIfNotAbortError),this._queue.length=0,[2,n]):[2]}))}))},e.prototype.hasAction=function(){return!!this._action},e.prototype._setAction=function(e){var t=this._abortController.signal;this._action=e(t).then(this._handleNext.bind(this)).catch(i.throwIfNotAbortError)},e.prototype._handleNext=function(){this._queue.length?this._setAction(this._queue.shift()):this._action=null},e}();t.default=o}.apply(null,n))||(e.exports=i)}}]);