(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/mapViewDeps":1032,"esri/core/libs/rbush/rbush":1076,"esri/core/libs/quickselect/quickselect":1083,"esri/views/2d/layers/features/support/Tile":1086,"esri/views/2d/layers/features/support/TileStore":1089,"esri/views/2d/engine/FeatureContainer":1090,"esri/views/2d/layers/graphics/GraphicsView2D":1098,"esri/core/MapPool":1099,"esri/views/2d/layers/graphics/GraphicContainer":1101,"esri/views/2d/layers/graphics/GraphicProcessingQueue":1102,"esri/views/2d/layers/graphics/GraphicStore":1103,"esri/views/2d/layers/graphics/GraphicStoreItem":1104,"esri/views/layers/GraphicsView":1105,"esri/views/navigation/Momentum":1273,"esri/views/navigation/FilteredFiniteDifference":1396,"esri/views/navigation/MomentumEstimator":1397,"esri/views/2d/LabelManager":1616,"esri/views/2d/navigation/MapViewNavigation":1704,"esri/views/2d/navigation/ZoomBox":1705,"esri/views/2d/navigation/actions/Pan":1706,"esri/views/navigation/PanPlanarMomentumEstimator":1707,"esri/views/2d/navigation/actions/Pinch":1708,"esri/views/navigation/RotationMomentumEstimator":1709,"esri/views/navigation/ZoomMomentumEstimator":1710,"esri/views/2d/navigation/actions/Rotate":1711,"esri/views/2d/magnifier/MagnifierView2D":1712})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{1032:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(1616),i(1098),i(1704),i(1712)],void 0===(r=function(t,e,i,n,r,o){Object.defineProperty(e,"__esModule",{value:!0}),e.LabelManager=i.default,e.GraphicsView2D=n.default,e.MapViewNavigation=r.default,e.MagnifierView2D=o.default}.apply(null,n))||(t.exports=r)},1076:function(t,e,i){var n,r;n=[i(1083)],void 0===(r=function(t){"use strict";function e(t,i){if(!(this instanceof e))return new e(t,i);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&("function"==typeof i?this.toBBox=i:this._initFormat(i)),this.clear()}function i(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function n(t,e){r(t,0,t.children.length,e,t)}function r(t,e,i,n,r){r||(r=c(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var a,s=e;s<i;s++)a=t.children[s],o(r,t.leaf?n(a):a);return r}function o(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function a(t,e){return t.minX-e.minX}function s(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function h(t){return t.maxX-t.minX+(t.maxY-t.minY)}function l(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function p(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function c(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(e,i,n,r,o){for(var a,s=[i,n];s.length;)(n=s.pop())-(i=s.pop())<=r||(a=i+Math.ceil((n-i)/r/2)*r,t(e,a,i,n,o),s.push(i,a,a,n))}return e.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],n=this.toBBox;if(!p(t,e))return i;for(var r,o,a,s,u=[];e;){for(r=0,o=e.children.length;r<o;r++)a=e.children[r],p(t,s=e.leaf?n(a):a)&&(e.leaf?i.push(a):l(t,s)?this._all(a,i):u.push(a));e=u.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!p(t,e))return!1;for(var n,r,o,a,s=[];e;){for(n=0,r=e.children.length;n<r;n++)if(o=e.children[n],p(t,a=e.leaf?i(o):o)){if(e.leaf||l(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=c([]),this},remove:function(t,e){if(!t)return this;for(var n,r,o,a,s=this.data,u=this.toBBox(t),h=[],p=[];s||h.length;){if(s||(s=h.pop(),r=h[h.length-1],n=p.pop(),a=!0),s.leaf&&-1!==(o=i(t,s.children,e)))return s.children.splice(o,1),h.push(s),this._condense(h),this;a||s.leaf||!l(s,u)?r?(n++,s=r.children[n],a=!1):s=null:(h.push(s),p.push(n),n=0,r=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:a,compareMinY:s,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,r){var o,a=i-e+1,s=this._maxEntries;if(a<=s)return n(o=c(t.slice(e,i+1)),this.toBBox),o;r||(r=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,r-1))),(o=c([])).leaf=!1,o.height=r;var u,h,l,p,m=Math.ceil(a/s),f=m*Math.ceil(Math.sqrt(s));for(d(t,e,i,f,this.compareMinX),u=e;u<=i;u+=f)for(d(t,u,l=Math.min(u+f-1,i),m,this.compareMinY),h=u;h<=l;h+=m)p=Math.min(h+m-1,l),o.children.push(this._build(t,h,p,r-1));return n(o,this.toBBox),o},_chooseSubtree:function(t,e,i,n){for(var r,o,a,s,h,l,p,c,d,m;n.push(e),!e.leaf&&n.length-1!==i;){for(p=c=1/0,r=0,o=e.children.length;r<o;r++)h=u(a=e.children[r]),d=t,m=a,(l=(Math.max(m.maxX,d.maxX)-Math.min(m.minX,d.minX))*(Math.max(m.maxY,d.maxY)-Math.min(m.minY,d.minY))-h)<c?(c=l,p=h<p?h:p,s=a):l===c&&h<p&&(p=h,s=a);e=s||e.children[0]}return e},_insert:function(t,e,i){var n=this.toBBox,r=i?t:n(t),a=[],s=this._chooseSubtree(r,this.data,e,a);for(s.children.push(t),o(s,r);e>=0&&a[e].children.length>this._maxEntries;)this._split(a,e),e--;this._adjustParentBBoxes(r,a,e)},_split:function(t,e){var i=t[e],r=i.children.length,o=this._minEntries;this._chooseSplitAxis(i,o,r);var a=this._chooseSplitIndex(i,o,r),s=c(i.children.splice(a,i.children.length-a));s.height=i.height,s.leaf=i.leaf,n(i,this.toBBox),n(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(i,s)},_splitRoot:function(t,e){this.data=c([t,e]),this.data.height=t.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var n,o,a,s,h,l,p,c,d,m,f,v,g,y;for(l=p=1/0,n=e;n<=i-e;n++)d=o=r(t,0,n,this.toBBox),m=a=r(t,n,i,this.toBBox),void 0,void 0,void 0,void 0,f=Math.max(d.minX,m.minX),v=Math.max(d.minY,m.minY),g=Math.min(d.maxX,m.maxX),y=Math.min(d.maxY,m.maxY),s=Math.max(0,g-f)*Math.max(0,y-v),h=u(o)+u(a),s<l?(l=s,c=n,p=h<p?h:p):s===l&&h<p&&(p=h,c=n);return c},_chooseSplitAxis:function(t,e,i){var n=t.leaf?this.compareMinX:a,r=t.leaf?this.compareMinY:s;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)},_allDistMargin:function(t,e,i,n){t.children.sort(n);var a,s,u=this.toBBox,l=r(t,0,e,u),p=r(t,i-e,i,u),c=h(l)+h(p);for(a=e;a<i-e;a++)s=t.children[a],o(l,t.leaf?u(s):s),c+=h(l);for(a=i-e-1;a>=e;a--)s=t.children[a],o(p,t.leaf?u(s):s),c+=h(p);return c},_adjustParentBBoxes:function(t,e,i){for(var n=i;n>=0;n--)o(e[n],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():n(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}},e}.apply(null,n))||(t.exports=r)},1083:function(t,e,i){var n;void 0===(n=function(){"use strict";function t(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function e(t,e){return t<e?-1:t>e?1:0}return function(i,n,r,o,a){!function e(i,n,r,o,a){for(;o>r;){if(o-r>600){var s=o-r+1,u=n-r+1,h=Math.log(s),l=.5*Math.exp(2*h/3),p=.5*Math.sqrt(h*l*(s-l)/s)*(u-s/2<0?-1:1);e(i,n,Math.max(r,Math.floor(n-u*l/s+p)),Math.min(o,Math.floor(n+(s-u)*l/s+p)),a)}var c=i[n],d=r,m=o;for(t(i,r,n),a(i[o],c)>0&&t(i,r,o);d<m;){for(t(i,d,m),d++,m--;a(i[d],c)<0;)d++;for(;a(i[m],c)>0;)m--}0===a(i[r],c)?t(i,r,m):t(i,++m,o),m<=n&&(r=m+1),n<=m&&(o=m-1)}}(i,n,r||0,o||i.length-1,a||e)}}.apply(null,[]))||(t.exports=n)},1086:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(104),i(36),i(131),i(206),i(96)],void 0===(r=function(t,e,i,n,r,o,a){function s(t,e){var i=t.bounds,n=e.bounds;return t.key.id!==e.key.id&&t.key.world===e.key.world&&i[0]<=n[0]&&i[1]<=n[1]&&i[2]>=n[2]&&i[3]>=n[3]}Object.defineProperty(e,"__esModule",{value:!0}),e.isParentOf=s,e.isChildOf=function(t,e){return s(e,t)};var u=function(){function t(t,e){this.bounds=r.create(),this.key=new a(0,0,0,0),this.objectIds=new Set,this.key.set(e);var i=t.getLODInfoAt(this.key);this.tileInfoView=t,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=i.resolution,this.scale=i.scale,this.level=i.level,this.needsClear=!0}return Object.defineProperty(t.prototype,"id",{get:function(){return this.key.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return n.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.tileInfoView,this.id)},t.prototype.createChildTiles=function(){for(var e=this.key.getChildKeys(),n=i.acquire(),r=0;r<e.length;r++)n[r]=new t(this.tileInfoView,e[r]);return n},t.prototype.getQuantizationParameters=function(){return o.default.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})},t}();e.Tile=u,e.default=u}.apply(null,n))||(t.exports=r)},1089:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(17),i(0),i(52),i(15),i(1076),i(1086),i(202),i(96)],void 0===(r=function(t,e,i,n,r,o,a,s,u,h){Object.defineProperty(e,"__esModule",{value:!0});var l={added:[],removed:[]},p=new Set,c=new h(0,0,0,0),d=function(t){function e(e){var i=t.call(this)||this;return i._tiles=new Map,i._index=a(9,o("csp-restrictions")?function(t){return{minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),i.tiles=[],i.tileScheme=e,i}return i(e,t),e.prototype.destroy=function(){this._tiles.clear()},e.prototype.clear=function(){this._tiles.clear(),this._index.clear()},e.prototype.has=function(t){return this._tiles.has(t)},e.prototype.get=function(t){return this._tiles.get(t)},e.prototype.findByKey=function(t){return this._tiles.get(t.id)},e.prototype.intersections=function(t,e){var i="string"==typeof t?this.get(t):t;if(!i)return[];for(var n=e*i.resolution,r=i.bounds[0]-n,o=i.bounds[1]-n,a=i.bounds[2]+n,s=i.bounds[3]+n,u=[],h=0,l=this._index.search({minX:r,minY:o,maxX:a,maxY:s});h<l.length;h++){var p=l[h],c=p.bounds.slice();c[0]=Math.max(c[0],r),c[1]=Math.max(c[1],o),c[2]=Math.min(c[2],a),c[3]=Math.min(c[3],s),c[2]-c[0]>0&&c[3]-c[1]>0&&u.push({bounds:c,tile:p})}return u},e.prototype.boundsIntersections=function(t){return this._index.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]})},e.prototype.setViewState=function(t){var e=this.tileScheme.getTileCoverage(t,0);if(e){var i=e.spans,n=e.lodInfo,r=n.level;if(i.length>0)for(var o=0,a=i;o<a.length;o++)for(var h=a[o],d=h.row,m=h.colFrom,f=h.colTo,v=m;v<=f;v++){var g=c.set(r,d,n.normalizeCol(v),n.getWorldForColumn(v)).id;if(p.add(g),!this.has(g)){var y=new s.default(this.tileScheme,g);this._tiles.set(g,y),this._index.insert(y),this.tiles.push(y),l.added.push(y)}}for(var _=this.tiles.length-1;_>=0;_--)y=this.tiles[_],p.has(y.id)||(this._tiles.delete(y.id),this.tiles.splice(_,1),this._index.remove(y),l.removed.push(y));(l.added.length||l.removed.length)&&this.emit("update",l),u.pool.release(e),p.clear(),l.added.length=0,l.removed.length=0}},e}(r);e.default=d}.apply(null,n))||(t.exports=r)},1090:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(8),i(9),i(17),i(5),i(4),i(4),i(131),i(320)],void 0===(r=function(t,e,i,n,r,o,a,s,u,h){Object.defineProperty(e,"__esModule",{value:!0});var l=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._rendererInfo=new h.WGLRendererInfo,n.attributeView=new h.AttributeStoreView,n}return r(e,t),e.prototype.destroy=function(){this.removeAllChildren(),this.children.forEach((function(t){return t.destroy()})),this.attributeView.destroy()},e.prototype.whenAttached=function(){var t=this;return this.attached?a.resolve():a.create((function(e){return t.once("attached",(function(){return e()}))}))},e.prototype.setRendererInfo=function(t,e,i){this._rendererInfo.setInfo(t,e,i),this.requestRender()},e.prototype.getMaterialItems=function(t,e){return n(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return t&&0!==t.length?[4,this.whenAttached()]:[2,null];case 1:return i.sent(),n=this.stage.painter.textureManager,r=t.map((function(t){return n.rasterizeItem(t.symbol,t.glyphIds,e)})),[4,s.all(r)];case 2:return[2,i.sent().map((function(e,i){return{id:t[i].id,mosaicItem:e}}))]}}))}))},e.prototype.onTileData=function(t,e){if(e.addOrUpdate&&"tileDisplayData"in e.addOrUpdate)t.setData(e,this.hasLabels,this.labelsVisible);else{var i=e.addOrUpdate&&h.TileData.decode(e.addOrUpdate),n=o({},e,{addOrUpdate:i});t.setData(n,this.hasLabels,this.labelsVisible)}this.contains(t)||this.addChild(t),this.requestRender()},e.prototype.onTileError=function(t){t.clear(),this.contains(t)||this.addChild(t)},e.prototype.renderChildren=function(e){this._rendererInfo.update(e.state),this.attributeView.bindTextures(this.stage.context),t.prototype.renderChildren.call(this,e)},e.prototype.createTile=function(t){var e=this._tileInfoView.getTileBounds(u.create(),t);return new h.WGLTile(t,e)},e.prototype.destroyTile=function(t){this.removeChild(t),t.destroy()},e.prototype.attach=function(){return this._initializeExtensions(),t.prototype.attach.call(this)},e.prototype.createRenderParams=function(e){return o({},t.prototype.createRenderParams.call(this,e),{rendererInfo:this._rendererInfo,attributeView:this.attributeView})},e.prototype._initializeExtensions=function(){var t=this.stage.context.capabilities;t.textureFloat,t.vao},e}(h.TileContainer);e.FeatureContainer=l}.apply(null,n))||(t.exports=r)},1098:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(1),i(0),i(5),i(8),i(9),i(11),i(132),i(133),i(1099),i(99),i(13),i(4),i(4),i(21),i(2),i(134),i(24),i(131),i(203),i(19),i(37),i(1070),i(338),i(339),i(320),i(1066),i(1133),i(1089),i(1101),i(1102),i(1103),i(1079),i(1105)],void 0===(r=function(t,e,i,n,r,o,a,s,u,h,l,p,c,d,m,f,v,g,y,_,b,w,x,M,T,P,S,G,I,O,D,z,C,V,A){function B(t,e,i){if(i.has(t))return i.get(t);var n={tile:e,addedOrModified:[],removed:[]};return i.set(t,n),n}Object.defineProperty(e,"__esModule",{value:!0});var R=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.apply(this,e)||this;return n._tiles=new Map,n._graphicStoreUpdate=!1,n._graphicsSet=new Set,n._matcher=d.resolve(null),n._tileUpdateSet=new Set,n._tilesToUpdate=new Map,n._graphicIdToAbortController=new Map,n._attached=!1,n._highlightIds=new Map,n._updatingGraphicsTimer=null,n.lastUpdateId=-1,n.updateRequested=!1,n.graphicUpdateHandler=n.graphicUpdateHandler.bind(n),n.addOrUpdateGraphic=n.addOrUpdateGraphic.bind(n),n._processAnalyzedGraphics=n._processAnalyzedGraphics.bind(n),n._graphicsChangeHandler=n._graphicsChangeHandler.bind(n),n}return i(e,t),e.prototype.initialize=function(){var t=this;this._tileStore=new O.default(this.view.featuresTilingScheme),this.container=new D.default(this.view.featuresTilingScheme,null),this._attributeStore=new I.default({type:"local",initialize:function(e){return d.resolve(t.container.attributeView.initialize(e))},update:function(e){return t.container.attributeView.requestUpdate(e)},render:function(){return t.container.requestRender()}}),this._graphicStore=new C.default(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,(function(e){t._attributeStore.createLocalId(e.uid),t._setFilterState(e.uid,e.visible)}),(function(e){t._attributeStore.freeLocalId(e.uid)})),this._graphicProcessingQueue=new z.default({process:this.addOrUpdateGraphic});var e=new S.WGLTemplateStore(this.container.getMaterialItems.bind(this.container),!0),i=this._tileStore.tileScheme.tileInfo;this._matcher=this.renderer?S.createMatcher(e,null,this.renderer):S.createMatcher(e,null),this._meshFactory=new S.WGLMeshFactory(null,this.uid,null,e,null,i),this._templateStore=e,this.watch("renderer",(function(i){i&&(t._matcher=t.renderer?S.createMatcher(e,null,t.renderer):S.createMatcher(e,null))})),this._tileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",(function(){t.graphics.items.length>0&&t._graphicsChangeHandler({target:t.graphics,added:t.graphics.items,removed:[],moved:[]}),t.handles.add(t.graphics.on("change",t._graphicsChangeHandler),"graphics"),t._attached=!0,t.notifyChange("updating")})),this.container.on("detach",(function(){t._graphicProcessingQueue&&t._graphicProcessingQueue.clear()}))},e.prototype.destroy=function(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=null,this.notifyChange("updating")),this.container.dispose(),this._set("graphics",null),this._graphicProcessingQueue&&(this._graphicProcessingQueue.destroy(),this._graphicProcessingQueue=null),this._graphicStore.clear(),this._tileStore.destroy(),this._attributeStore=null},Object.defineProperty(e.prototype,"updating",{get:function(){return!this._attached||null!==this._updatingGraphicsTimer||this._graphicProcessingQueue.updating||this._tileUpdateSet.size>0||this._tilesToUpdate.size>0},enumerable:!0,configurable:!0}),e.prototype.install=function(t){t.addChild(this.container)},e.prototype.uninstall=function(t){t.removeChild(this.container)},e.prototype.hitTest=function(t,e){if(!this.view||!this.view.position)return d.resolve();var i=this.view.toMap(f.createScreenPoint(t,e));return this.searchFeatures(i).then((function(t){return t&&t.length?t[0]:null}))},e.prototype.searchFeatures=function(t,e){var i=this;return void 0===e&&(e=2),d.create((function(n){n(i._graphicStore.hitTest(t.x,t.y,e,i.view.state.resolution,i.view.state.rotation))}))},e.prototype.update=function(t){var e=t.state,i=this.view.featuresTilingScheme.getClosestInfoForScale(e.scale).level;this._graphicStore.updateLevel(i),this._tileStore.setViewState(e),this._graphicStoreUpdate=!0,this.updateRequested=!1},e.prototype.viewChange=function(){this.requestUpdate()},e.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate(this))},e.prototype.processUpdate=function(t){this.updateRequested&&(this.updateRequested=!1,this.update(t))},e.prototype.graphicUpdateHandler=function(t){var e=t.graphic,i=t.property,n=t.newValue,r=e;switch(i){case"attributes":break;case"geometry":case"symbol":this._graphicProcessingQueue.push(r,"update");break;case"visible":this._setFilterState(r.uid,n),this._attributeStore.sendUpdates()}},e.prototype.addHighlight=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];if(this._highlightIds.has(n)){var r=this._highlightIds.get(n);this._highlightIds.set(n,r+1)}else this._highlightIds.set(n,1)}this._updateHighlight()},e.prototype.removeHighlight=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];if(this._highlightIds.has(n)){var r=this._highlightIds.get(n)-1;0===r?this._highlightIds.delete(n):this._highlightIds.set(n,r)}}this._updateHighlight()},e.prototype._updateHighlight=function(){this._attributeStore.setHighlight(p.keysOfMap(this._highlightIds))},e.prototype._getIntersectingTiles=function(t){var e=this._graphicStore.getBounds(t);return e&&0!==_.width(e)&&0!==_.height(e)?this._tileStore.boundsIntersections(e):[]},e.prototype._updateTile=function(t){var e=this,i=t.tile,n=this._getGraphicsData(this._templateStore,i,t.addedOrModified);return this._processGraphics(i.key,n).then((function(n){return e._patchTile(i.key,{addOrUpdate:n,remove:t.removed}),n}))},e.prototype._patchTile=function(t,e){if(this._tiles.has(t)){var i=this._tiles.get(t);this.container.onTileData(i,e),this.container.requestRender()}},e.prototype._graphicsChangeHandler=function(t){var e=this;if(!this._graphicStoreUpdate){var i=this.view.state,n=this.view.featuresTilingScheme.getClosestInfoForScale(i.scale).level;this._graphicStore.updateLevel(n),this._tileStore.setViewState(i)}for(var r=t.added,o=t.removed,a=t.moved,s=this._tilesToUpdate,u=[],h=new Array(r.length),l=0;l<r.length;l++){var p=r[l];h[l]=p,this._graphicsSet.add(p),u.push(this.addGraphic(p))}for(var c=0,m=o;c<m.length;c++){var f=m[c];this._abortProcessingGraphic(f.uid);for(var v=0,g=this._getIntersectingTiles(f);v<g.length;v++){var y=g[v];B(y.key.id,y,s).removed.push(this._attributeStore.getLocalId(f.uid))}this._graphicsSet.delete(f),this._graphicStore.remove(f)}for(var _=0,b=a;_<b.length;_++)for(var w=b[_],x=0,M=this._getIntersectingTiles(w);x<M.length;x++)B((y=M[x]).key.id,y,s).addedOrModified.push(w);this._flipUpdatingGraphics(),d.all(u).then((function(){for(var t,i=0;i<h.length;i++){t=h[i];for(var n=0,r=e._getIntersectingTiles(t);n<r.length;n++){var o=r[n];B(o.key.id,o,s).addedOrModified.push(t)}}e._graphicStore.updateZ();var a=[];return s.forEach((function(t){return a.push(e._updateTile(t))})),d.all(a).then((function(){s.clear(),e.notifyChange("updating")}))})).catch((function(){s.clear(),e.notifyChange("updating")}))},e.prototype._getArcadeInfo=function(t){var e=(t.attributes?Object.keys(t.attributes):[]).map((function(e){return{name:e,alias:e,type:"string"==typeof t.attributes[e]?"esriFieldTypeString":"esriFieldTypeDouble"}}));return c.isNone(t.geometry)?null:{geometryType:w.getJsonType(t.geometry),spatialReference:y.fromJSON(t.geometry.spatialReference),fields:e}},e.prototype._getSymbolForGraphic=function(t,e){return a(this,void 0,void 0,(function(){return o(this,(function(i){return c.isSome(t.symbol)?[2,t.symbol]:this.renderer?[2,this.renderer.getSymbolAsync(t,{scale:this.view.scale,abortOptions:e})]:[2,this._getNullSymbol(t)]}))}))},e.prototype._getSymbolResources=function(t,e){return a(this,void 0,void 0,(function(){var i,n,r,a,s,u,h,l,p;return o(this,(function(o){switch(o.label){case 0:return this.container.attached?(i=this._getArcadeInfo(t),r=T.expandSymbol,[4,this._getSymbolForGraphic(t,e)]):[2,d.resolve(null)];case 1:return[4,r.apply(void 0,[o.sent(),null,i,e])];case 2:if("text"!==(n=o.sent()).type)return[3,4];for(a=[],s=n,u=S.bidiText(s.text)[0],h=0;h<u.length;h++)a.push(u.charCodeAt(h));return l={symbol:n.toJSON(),id:0,glyphIds:a},[4,this.container.getMaterialItems([l])];case 3:return p=o.sent()[0].mosaicItem,[2,{symbol:n,mosaicItem:p}];case 4:return[2,{symbol:n,mosaicItem:null}]}}))}))},e.prototype._projectAndNormalizeGeometry=function(t){return a(this,void 0,void 0,(function(){var e,i,n,r=this;return o(this,(function(o){return c.isNone(t.geometry)?[2,d.resolve(null)]:(e=t.geometry,w.isPolygon(e)?(i=e.rings,e.rings=i):w.isPolyline(e)?(n=e.paths,e.paths=n):w.isExtent(e)&&(e=g.fromExtent(e)),[2,M.checkProjectionSupport(e.spatialReference,this.view.spatialReference).then((function(){var t=V.normalizeCentralMeridian(e),i=M.project(t,e.spatialReference,r.view.spatialReference);return b.closeRingsAndFixWinding(i),i}))])}))}))},e.prototype._onTileUpdate=function(t){var e=x.getInfo(this.view.spatialReference);if(t.added&&t.added.length>0)for(var i=0,n=t.added;i<n.length;i++){var r=n[i];this._addNewTile(r,e)}if(t.removed&&t.removed.length>0)for(var o=0,a=t.removed;o<a.length;o++){var s=a[o];this._removeTile(s.key)}},e.prototype.addOrUpdateGraphic=function(t,e,i){return this._addOrUpdateGraphic(t,e,i)},e.prototype.addGraphic=function(t){var e=this;this._abortProcessingGraphic(t.uid);var i=m.createAbortController();this._graphicIdToAbortController.set(t.uid,i);var n={signal:i.signal};return this._addOrUpdateGraphic(t,"add",n).then((function(){e._graphicIdToAbortController.delete(t.uid)})).catch((function(i){if(e._graphicIdToAbortController.delete(t.uid),!d.isAbortError(i))throw i}))},e.prototype._addOrUpdateGraphic=function(t,e,i){var n=this,r=this._projectAndNormalizeGeometry(t),o=this._getSymbolResources(t,i);return d.all([r,o]).then((function(r){var o=r[0],a=r[1];return"add"===e?n._addProjectedGraphic(t,a,o):n._updateGraphic(t,a,o,i)}))},e.prototype._addProjectedGraphic=function(t,e,i){this._graphicsSet.has(t)&&this._graphicStore.add(t,e,i)},e.prototype._updateGraphic=function(t,e,i,n){var r=this;if(!this._graphicStore.has(t)||d.isAborted(n))return d.resolve();for(var o=this._graphicStore.update(t,e,i),a=o.oldBounds,s=o.newBounds,u=0===_.width(a)&&0===_.height(a),h=0===_.width(s)&&0===_.height(s),p=u?[]:this._tileStore.boundsIntersections(a),c=h?[]:this._tileStore.boundsIntersections(s),m=l.acquire(),f=0,v=p;f<v.length;f++){var g=v[f];m.set(g.key,{addOrUpdate:null,remove:[this._attributeStore.getLocalId(t.uid)]})}for(var y=0,b=c;y<b.length;y++){g=b[y];var w=this._getGraphicData(this._templateStore,g,t);if(m.has(g.key)){var x=m.get(g.key);x.remove.length=0,x.addOrUpdate=w}else m.set(g.key,{addOrUpdate:w,remove:null})}var M=[];return m.forEach((function(t,e){var i=r._processGraphics(e,t.addOrUpdate,n).then((function(i){r._patchTile(e,{addOrUpdate:i,remove:t.remove})}));M.push(i)})),l.release(m),d.all(M).then((function(){}))},e.prototype._addTile=function(t,e){var i=_.create();this.view.featuresTilingScheme.getTileBounds(i,t);var n=new S.WGLTile(t,i,!0),r={clear:!0,addOrUpdate:e,remove:[]};this._tiles.set(t,n),this.container.addChild(n),n.setData(r,!1,!1)},e.prototype._addNewTile=function(t,e){var i=this,n=this._graphicStore.queryTileData(this._templateStore,t);if(e)for(var r=Math.round((e.valid[1]-e.valid[0])/t.resolution),o=0,a=n;o<a.length;o++){var s=a[o];s.geometry&&w.isPoint(s.geometry)&&this._wrapPoints(s,r)}var u=t.key;this._tileUpdateSet.add(t.key),this.notifyChange("updating"),this._processGraphics(u,n).then((function(t){i._addTile(u,t),i._tileUpdateSet.delete(u),i.notifyChange("updating")})).catch((function(t){if(i._tileUpdateSet.delete(u),i.notifyChange("updating"),!d.isAbortError(t))throw t}))},e.prototype._removeTile=function(t){if(this._tiles.has(t)){var e=this._tiles.get(t);this.container.removeChild(e),e.destroy(),this._tiles.delete(t)}},e.prototype._setFilterState=function(t,e){var i=this._attributeStore.getLocalId(t),n=this._attributeStore.getHighlightFlag(t);this._attributeStore.setData(i,0,0,n|(e?G.FILTER_FLAG_0:0))},e.prototype._getGraphicsData=function(t,e,i){var n=x.getInfo(this.view.spatialReference),r=this._graphicStore.getGraphicsData(t,e,i);if(n)for(var o=Math.round((n.valid[1]-n.valid[0])/e.resolution),a=0,s=r;a<s.length;a++){var u=s[a];u.geometry&&w.isPoint(u.geometry)&&this._wrapPoints(u,o)}return r.sort((function(t,e){return t.insertAfter-e.insertAfter})),r},e.prototype._getGraphicData=function(t,e,i){var n=this._graphicStore.getGraphicData(t,e,i),r=[n],o=x.getInfo(this.view.spatialReference);if(o){var a=Math.round((o.valid[1]-o.valid[0])/e.resolution);n.geometry&&w.isPoint(n.geometry)&&this._wrapPoints(n,a)}return r},e.prototype._wrapPoints=function(t,e){var i=t.geometry;512===e?i.x<20?t.geometry={points:[[i.x,i.y],[e,0]]}:i.x>492&&(t.geometry={points:[[i.x,i.y],[-e,0]]}):i.x<-20?t.geometry={points:[[i.x,i.y],[e,0]]}:i.x>532&&(t.geometry={points:[[i.x,i.y],[-e,0]]})},e.prototype._processGraphics=function(t,e,i){return a(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return e&&e.length&&this._meshFactory?(n=this._meshFactory,[4,this._matcher.then((function(t){return n.analyze(e,t,null,null,i)}))]):[2,null];case 1:return r=o.sent(),this._attributeStore.sendUpdates(),[2,this._processAnalyzedGraphics(t,r)]}}))}))},e.prototype._processAnalyzedGraphics=function(t,e){for(var i=this._meshFactory,n=i.createMeshData(e.length),r=this._attributeStore,o=0,a=e;o<a.length;o++){var s=a[o];s.insertAfter=-1===s.insertAfter?-1:r.getLocalId(s.insertAfter),s.localId=r.getLocalId(s.attributes[this.uid]),i.write(n,s,null,null,t.level,null)}return S.TileData.fromMeshData(n)},e.prototype._abortProcessingGraphic=function(t){this._graphicIdToAbortController.has(t)&&this._graphicIdToAbortController.get(t).abort()},e.prototype._getNullSymbol=function(t){var e=t.geometry;return w.isPolyline(e)?P.errorPolylineSymbol2D:w.isPolygon(e)||w.isExtent(e)?P.errorPolygonSymbol2D:P.errorPointSymbol2D},e.prototype._flipUpdatingGraphics=function(){var t=this;this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=setTimeout((function(){t._updatingGraphicsTimer=null,t.notifyChange("updating")}),160),this.notifyChange("updating")},n([v.property()],e.prototype,"_graphicProcessingQueue",void 0),n([v.property({constructOnly:!0})],e.prototype,"graphics",void 0),n([v.property({dependsOn:["_graphicProcessingQueue.updating"]})],e.prototype,"updating",null),n([v.property()],e.prototype,"view",void 0),n([v.property()],e.prototype,"updateRequested",void 0),n([v.subclass("esri.views.2d.layers.support.GraphicsView2D")],e)}(v.declared(A.GraphicsView(u.HandleOwnerMixin(h.IdentifiableMixin(s)))));e.default=R}.apply(null,n))||(t.exports=r)},1099:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(62)],void 0===(r=function(t,e,i){var n=function(){function t(t,e){void 0===t&&(t=50),void 0===e&&(e=50),this._pool=new i(Map,!1,(function(t){return t.clear()}),e,t)}return t.prototype.acquire=function(){return this._pool.acquire()},t.prototype.release=function(t){this._pool.release(t)},t.acquire=function(){return r.acquire()},t.release=function(t){return r.release(t)},t}(),r=new n(100);return n}.apply(null,n))||(t.exports=r)},1101:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(5),i(17),i(8),i(9),i(1090)],void 0===(r=function(t,e,i,n,r,o,a){Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"hasLabels",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"labelsVisible",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype._renderGraphics=function(t,e){for(var i=0,n=this.children;i<n.length;i++){var r=n[i];r.isReady&&r.hasData&&(r.commitChanges(),t.context.setStencilFunction(514,r.stencilRef,255),r._displayList.replay(t,r,e))}},e.prototype.renderChildren=function(e){var i=e.painter;if(this.children.some((function(t){return t.hasData}))){t.prototype.renderChildren.call(this,e),this._renderGraphics(e);var n=i.effects.highlight;n.bind(e),this._renderGraphics(e,n.defines),n.draw(e),n.unbind()}},e}(a.FeatureContainer);e.default=s}.apply(null,n))||(t.exports=r)},1102:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(1),i(0),i(11),i(4),i(39),i(2)],void 0===(r=function(t,e,i,n,r,o,a,s){Object.defineProperty(e,"__esModule",{value:!0});var u=function(t){function e(e){var i=t.call(this,e)||this;return i._queue=new Map,i._queueArray=[],i._onGoingGraphic=null,i._onGoingPromise=null,i._scheduledNextHandle=null,i._next=i._next.bind(i),i._finalize=i._finalize.bind(i),i}return i(e,t),Object.defineProperty(e.prototype,"length",{get:function(){return this._queueArray.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updating",{get:function(){return this._queueArray.length>0||null!==this._onGoingPromise},enumerable:!0,configurable:!0}),e.prototype.cancel=function(t){if(this._onGoingGraphic&&this._onGoingGraphic.graphic===t&&(this._ongoingAbortController.abort(),this._onGoingGraphic=this._onGoingPromise=null),this._queue.has(t)){var e=this._queue.get(t);this._queue.delete(t);var i=this._queueArray.indexOf(e);this._queueArray.slice(i,1)}this._scheduleNext(),this.notifyChange("updating")},e.prototype.clear=function(){this._queue.clear(),this._queueArray.length=0,this._onGoingPromise&&(this._ongoingAbortController.abort(),this._onGoingGraphic=this._onGoingPromise=null),this._cancelNext(),this.notifyChange("updating")},e.prototype.has=function(t){return this._queue.has(t)},e.prototype.isOngoing=function(t){return this._onGoingGraphic&&this._onGoingGraphic.graphic===t},e.prototype.push=function(t,e){if(!this._queue.has(t)){var i={graphic:t,addOrUpdate:e};this._queueArray.push(i),this._queue.set(t,i),this._scheduleNext(),this.notifyChange("updating")}},e.prototype.refresh=function(){this.reset()},e.prototype.reset=function(){var t=this._onGoingGraphic;if(t){var e=t.graphic,i=t.addOrUpdate;this.push(e,i)}},e.prototype._finalize=function(){this._onGoingGraphic=null,this._ongoingAbortController=null,this._onGoingPromise=null,this.notifyChange("updating"),this._scheduleNext()},e.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},e.prototype._scheduleNext=function(){this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingGraphic||(this._scheduledNextHandle=a.schedule(this._next))},e.prototype._next=function(){if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingGraphic)this._scheduledNextHandle=null;else{this._scheduledNextHandle=null;var t=this._peek(),e=t.graphic,i=t.addOrUpdate,n=o.createAbortController();this._queue.delete(e),this._onGoingGraphic=t,this._onGoingPromise=this.process(e,i,{signal:n.signal}),this._ongoingAbortController=n,this._onGoingPromise.then(this._finalize,this._finalize),this.notifyChange("updating")}},e.prototype._peek=function(){return 0===this._queueArray.length?null:this._queueArray.pop()},n([s.property({readOnly:!0})],e.prototype,"length",null),n([s.property({readOnly:!0})],e.prototype,"updating",null),n([s.property({constructOnly:!0})],e.prototype,"process",void 0),n([s.subclass("esri.views.2d.layers.graphics.GraphicProcessingQueue")],e)}(s.declared(r));e.default=u}.apply(null,n))||(t.exports=r)},1103:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(5),i(15),i(21),i(53),i(1076),i(131),i(103),i(201),i(19),i(329),i(1104),i(1079)],void 0===(r=function(t,e,i,n,r,o,a,s,u,h,l,p,c,d){Object.defineProperty(e,"__esModule",{value:!0});var m={minX:0,minY:0,maxX:0,maxY:0},f=s.create(),v=[];function g(t,e,i,n,r){return m.minX=e,m.minY=i,m.maxX=n,m.maxY=r,t.search(m)}var y=function(){function t(t,e,i,r,s,u){this._graphics=r,this._onAdd=s,this._onRemove=u,this._index=a(9,n("csp-restrictions")?function(t){return{minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this._itemByGraphic=new Map,this._currentLevel=-1/0,this._tileInfoView=t,this._uidFieldName=i;var h=t.getClosestInfoForScale(e);h&&(this._currentLevel=h.level,this._resolution=this._tileInfoView.getTileResolution(h.level)),this._metersPerUnit=o.getMetersPerUnit(t.spatialReference)}return t.prototype.hitTest=function(t,e,i,n,o){t=p.normalizeMapX(t,this._tileInfoView.spatialReference);var a=.5*n*i;f[0]=t-a,f[1]=e-a,f[2]=t+a,f[3]=e+a;var c=.5*n*(i+50),m=g(this._index,t-c,e-c,t+c,e+c);if(!m||0===m.length)return[];for(var v,y={x:t,y:e},_=[],b=0,w=m;b<w.length;b++){var x=w[b];if(x.graphic.visible)switch(l.getJsonType(x.geometry)){case"esriGeometryPoint":var M=x.symbol;if(!M)continue;var T=x.geometry,P=void 0;switch(M.type){case"text":P=d.getTextSymbolBounds(T.x,T.y,M,x.size,n,o);break;case"cim":case"expanded-cim":P=d.getCIMMarkerBounds(T.x,T.y,M,n,n*this._metersPerUnit,o);break;default:P=d.getMarkerSymbolBounds(T.x,T.y,M,n,n*this._metersPerUnit,o)}u.polygonContainsPoint(P,y)&&_.push(x);break;case"esriGeometryPolyline":var S=x.symbol;if(!S)continue;v=1.5*n*window.devicePixelRatio*r.pt2px(S.width),d.isPointOnPolyline(x.geometry,t,e,v)&&_.push(x);break;case"esriGeometryEnvelope":var G=x.geometry,I=s.fromValues(G.xmin,G.ymin,G.xmax,G.ymax);s.intersects(I,f)&&_.push(x);break;case"esriGeometryPolygon":if(u.polygonContainsPoint(x.geometry,y)){_.push(x);break}var O=h.getPolygonExtent(x.geometry);if(Math.abs(O.ymax-O.ymin)<5*n||Math.abs(O.xmax-O.xmin)<5*n){var D=s.fromValues(O.xmin,O.ymin,O.xmax,O.ymax);s.intersects(D,f)&&_.push(x)}break;case"esriGeometryMultipoint":var z=x.symbol;if(!z)continue;for(var C=x.geometry.points,V=void 0,A=0;A<C.length;A++){if("text"===z.type){var B=z;V=d.getTextSymbolBounds(C[A][0],C[A][1],B,x.size,n,o)}else V=d.getMarkerSymbolBounds(C[A][0],C[A][1],z,n,n*this._metersPerUnit,o);if(u.polygonContainsPoint(V,y)){_.push(x);break}}}}return _.sort((function(t,e){var i=d.graphicGeometryToNumber(t.graphic),n=d.graphicGeometryToNumber(e.graphic);return i===n?e.zorder-t.zorder:i-n})),_.map((function(t){return t.graphic}))},t.prototype.getGraphicsData=function(t,e,n){var r=g(this._index,e.bounds[0],e.bounds[1],e.bounds[2],e.bounds[3]);if(0===r.length||0===n.length)return[];r.sort((function(t,e){return t.zorder-e.zorder})),r[0].insertAfter=-1;for(var o=1;o<r.length;o++)r[o].insertAfter=r[o-1].graphic.uid;r.sort((function(t,e){return t.graphic.uid-e.graphic.uid})),n.sort((function(t,e){return t.uid-e.uid}));for(var a,s=0,u=0,h=[],l={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},p=0,d=n;p<d.length;p++){var m=d[p];for(u=-2;s<r.length;)if(a=r[s],s++,m.uid===a.graphic.uid){u=a.insertAfter;break}if(a.geometry&&-2!==u){var f=a.getGeometryQuantized(l),v=i({},a.graphic.attributes);v[this._uidFieldName]=m.uid,null==a.groupId&&(a.groupId=t.createTemplateGroup(a.symbol,null,null)),h.push({centroid:c.default.getCentroidQuantized(a,l),geometry:f,attributes:v,symbol:a.symbol,groupId:a.groupId,insertAfter:u})}}return h},t.prototype.getGraphicData=function(t,e,n){var r=this._itemByGraphic.get(n);if(!r)return null;var o=g(this._index,e.bounds[0],e.bounds[1],e.bounds[2],e.bounds[3]);o.sort((function(t,e){return t.zorder-e.zorder}));var a=o.indexOf(r),s=0===a||-1===a?-1:o[a-1].graphic.uid,u={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},h=r.getGeometryQuantized(u),l=i({},r.graphic.attributes);return l[this._uidFieldName]=n.uid,null==r.groupId&&(r.groupId=t.createTemplateGroup(r.symbol,null,null)),{centroid:c.default.getCentroidQuantized(r,u),geometry:h,attributes:l,symbol:r.symbol,groupId:r.groupId,insertAfter:s}},t.prototype.queryTileData=function(t,e){var i=50*e.resolution,n=s.pad(e.bounds,i,s.create()),r=g(this._index,n[0],n[1],n[2],n[3]),o=[];return this._createTileGraphics(o,t,r,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}),o},t.prototype.has=function(t){return this._itemByGraphic.has(t)},t.prototype.getBounds=function(t){return this._itemByGraphic.has(t)?this._itemByGraphic.get(t).bounds:null},t.prototype.add=function(t,e,i){if(t){this._onAdd(t);var n=c.default.acquire(t,e,i,this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference);return this._itemByGraphic.set(t,n),i&&this._index.insert(n),n.bounds}},t.prototype.remove=function(t){if(this._itemByGraphic.has(t)){this._onRemove(t);var e=this._itemByGraphic.get(t);this._index.remove(e),this._itemByGraphic.delete(t)}},t.prototype.updateZ=function(){for(var t,e,i=this._graphics.items,n=0;n<i.length;n++)e=i[n],(t=this._itemByGraphic.get(e))&&(t.zorder=n)},t.prototype.update=function(t,e,i){var n=this._itemByGraphic.get(t);n.groupId=null;var r=s.clone(n.bounds);return n.size[0]=n.size[1]=0,this._index.remove(n),n.set(t,e,i,this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference),i&&this._index.insert(n),{oldBounds:r,newBounds:n.bounds}},t.prototype.updateLevel=function(t){var e=this;if(this._currentLevel!==t){this._currentLevel=t;var i=this._tileInfoView.getTileResolution(t);this._resolution=i,this._index.clear(),v.length=0,this._itemByGraphic.forEach((function(t){t.updateBounds(e._resolution,e._resolution*e._metersPerUnit,e._tileInfoView.spatialReference),t.geometry&&v.push(t)})),this._index.load(v)}},t.prototype.clear=function(){this._itemByGraphic.clear(),this._index.clear()},t.prototype._createTileGraphics=function(t,e,n,r){var o,a,s,u,h=this._uidFieldName;n.sort((function(t,e){return t.zorder-e.zorder}));for(var l=0;l<n.length;l++){o=(s=n[l]).graphic,a=s.getGeometryQuantized(r),u=0===l?-1:n[l-1].graphic.uid;var p=i({},s.graphic.attributes);p[h]=o.uid,null==s.groupId&&(s.groupId=e.createTemplateGroup(s.symbol,null,null)),t.push({centroid:c.default.getCentroidQuantized(s,r),geometry:a,attributes:p,symbol:s.symbol,groupId:s.groupId,insertAfter:u})}},t}();e.default=y}.apply(null,n))||(t.exports=r)},1104:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(13),i(131),i(341),i(19),i(137),i(322),i(196),i(1079)],void 0===(r=function(t,e,i,n,r,o,a,s,u,h){Object.defineProperty(e,"__esModule",{value:!0});var l=new u.default,p=new u.default;function c(t){t.coords.length=0,t.lengths.length=0}var d=function(){function t(){this.bounds=n.create(),this.graphic=null,this.size=[0,0,0,0]}return t.acquire=function(e,i,n,r,o,a){var s;return void 0===e&&(e=null),0===t._pool.length?s=new t:(s=t._pool.pop(),this._set.delete(s)),s.acquire(e,i,n,r,o,a),s},t.release=function(t){t&&!this._set.has(t)&&(t.release(),this._pool.push(t),this._set.add(t))},t.getCentroidQuantized=function(t,e){if(o.isPolygon(t.geometry)){var n=t.symbol;if(i.isNone(n))return null;if(h.isMarkerSymbol(n.type)){var s=r.polygonCentroid(t.geometry);return a.quantizePoint(e,{},{x:s[0],y:s[1]},!1,!1)}}return null},t.prototype.acquire=function(t,e,i,n,r,o){void 0===t&&(t=null),t&&this.set(t,e,i,n,r,o)},t.prototype.release=function(){this.graphic=null,this.symbolResource=null,this.geometry=null},Object.defineProperty(t.prototype,"symbol",{get:function(){return this.symbolResource.symbol},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e,i,n,r,o){this.graphic=t,this.geometry=i,this.symbolResource=e,this.updateBounds(n,r,o)},t.prototype.updateBounds=function(t,e,i){h.getBounds(this.bounds,this.size,this.symbolResource,this.geometry,t,e,i)},t.prototype.getGeometryQuantized=function(t){if(o.isPolygon(this.geometry)){var e=this.geometry.rings;if(1===e.length&&2===e[0].length)return a.quantizeGeometry(t,{paths:[[e[0][0],e[0][1]]]})}else if(o.isPolyline(this.geometry))return c(l),c(p),s.convertFromPolyline(l,this.geometry),s.generalizeOptimizedGeometry(p,l,this.geometry.hasZ,this.geometry.hasM,"esriGeometryPolyline",t.scale[0]),s.quantizeOptimizedGeometry(l,p,this.geometry.hasZ,this.geometry.hasM,"esriGeometryPolyline",t),s.convertToPolyline(l,this.geometry.hasZ,this.geometry.hasM);return a.quantizeGeometry(t,this.geometry)},t._pool=[],t._set=new Set,t}();e.default=d}.apply(null,n))||(t.exports=r)},1105:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(1),i(0),i(2)],void 0===(r=function(t,e,i,n,r){Object.defineProperty(e,"__esModule",{value:!0}),e.GraphicsView=function(t){return function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.graphics=null,e.renderer=null,e.view=null,e}return i(e,t),n([r.property()],e.prototype,"graphics",void 0),n([r.property()],e.prototype,"renderer",void 0),n([r.property()],e.prototype,"updating",void 0),n([r.property()],e.prototype,"view",void 0),n([r.subclass("esri.views.layers.GraphicsView")],e)}(r.declared(t))}}.apply(null,n))||(t.exports=r)},1273:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(17)],void 0===(r=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,i){this._initialVelocity=t,this._stopVelocity=e,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}return Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),t.prototype.isFinished=function(t){return t>this.duration},Object.defineProperty(t.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0}),t.prototype.value=function(t){return this.valueFromInitialVelocity(this._initialVelocity,t)},t.prototype.valueDelta=function(t,e){var i=this.value(t);return this.value(t+e)-i},t.prototype.valueFromInitialVelocity=function(t,e){e=Math.min(e,this.duration);var i=1-this.friction;return t*(Math.pow(i,e)-1)/Math.log(i)},t}();e.Momentum=n}.apply(null,n))||(t.exports=r)},1396:function(t,e,i){var n,r;n=[i.dj.c(t.i),e],void 0===(r=function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.gain=t}return t.prototype.update=function(t){if(this.hasLastValue){var e=this.computeDelta(t);this.updateDelta(e)}this.lastValue=t},t.prototype.reset=function(){this.lastValue=void 0,this.filteredDelta=void 0},Object.defineProperty(t.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0}),t.prototype.computeDelta=function(t){return t-this.lastValue},t.prototype.updateDelta=function(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t},t}();e.FilteredFiniteDifference=i}.apply(null,n))||(t.exports=r)},1397:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(17),i(59),i(1396),i(1273)],void 0===(r=function(t,e,i,n,r,o){Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e,i,n){void 0===t&&(t=2.5),void 0===e&&(e=.01),void 0===i&&(i=.95),void 0===n&&(n=12),this.minimumInitialVelocity=t,this.stopVelocity=e,this.friction=i,this.maxVelocity=n,this.enabled=!0,this.value=new r.FilteredFiniteDifference(.8),this.time=new r.FilteredFiniteDifference(.3)}return t.prototype.add=function(t,e){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(e)<.01)return;if(this.value.hasFilteredDelta){var i=this.value.computeDelta(t);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(e),this.value.update(t)}},t.prototype.reset=function(){this.value.reset(),this.time.reset()},t.prototype.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;var t=this.value.filteredDelta/this.time.filteredDelta;return t=n.clamp(t,-this.maxVelocity,this.maxVelocity),Math.abs(t)<this.minimumInitialVelocity?null:this.createMomentum(t,this.stopVelocity,this.friction)},t.prototype.createMomentum=function(t,e,i){return new o.Momentum(t,e,i)},t}();e.MomentumEstimator=a}.apply(null,n))||(t.exports=r)},1616:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(1),i(0),i(11),i(10),i(132),i(6),i(359),i(2),i(320)],void 0===(r=function(t,e,i,n,r,o,a,s,u,h,l){Object.defineProperty(e,"__esModule",{value:!0});var p=s.getLogger("esri.views.2d.layers.labels.LabelManager"),c=function(t){function e(e){var i=t.call(this,e)||this;return i._applyVisibilityPassThrottled=u.throttle(i._applyVisibilityPass,64,i),i.lastUpdateId=-1,i.updateRequested=!1,i.view=null,i}return i(e,t),e.prototype.initialize=function(){var t=this;this.collisionEngine=new l.CollisionEngine(this.view.featuresTilingScheme),this._layerViewSorter=new l.LayerViewSorter((function(e,i){t.collisionEngine.registerLayerView(e,i);var n=e.tileRenderer;n&&n.forEachTile((function(i){i.isDirty=!0,t.addTile(e,i)})),t.requestUpdate()}),(function(e){t.collisionEngine.unregisterLayerView(e),t.requestUpdate()})),this.handles.add(this.view.allLayerViews.on("change",(function(e){t._layerViewSorter.update(e)})))},e.prototype.destroy=function(){this._layerViewSorter.destroy(),this._layerViewSorter=null,this.collisionEngine=null,this._applyVisibilityPassThrottled.remove()},Object.defineProperty(e.prototype,"updating",{get:function(){return this.updateRequested},enumerable:!0,configurable:!0}),e.prototype.update=function(t){this._applyVisibilityPassThrottled(t)},e.prototype.viewChange=function(){this.requestUpdate()},e.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate(this))},e.prototype.processUpdate=function(t){this._set("updateParameters",t),this.updateRequested&&(this.update(t),this.updateRequested=!1)},e.prototype.addTile=function(t,e){this.collisionEngine.addTile(t,e)},e.prototype.removeTile=function(t,e){this.collisionEngine.removeTile(t,e)},e.prototype._applyVisibilityPass=function(t){try{var e=this.view.featuresTilingScheme.getClosestInfoForScale(t.state.scale).level;this.collisionEngine.run(t,e)}catch(t){p.error(new o("mapview-labeling","Encountered an error during label decluttering",t))}},n([h.property()],e.prototype,"updateRequested",void 0),n([h.property({readOnly:!0})],e.prototype,"updateParameters",void 0),n([h.property({dependsOn:["updateRequested"]})],e.prototype,"updating",null),n([h.property()],e.prototype,"view",void 0),n([h.subclass("esri.views.2d.layers.labels.LabelManager")],e)}(h.declared(a.HandleOwnerMixin(r)));e.default=c}.apply(null,n))||(t.exports=r)},1704:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(1),i(0),i(8),i(9),i(110),i(11),i(81),i(2),i(44),i(83),i(1705),i(1706),i(1708),i(1711)],void 0===(r=function(t,e,i,n,r,o,a,s,u,h,l,p,c,d,m,f){Object.defineProperty(e,"__esModule",{value:!0});var v=new a({targetGeometry:new l}),g=[0,0],y=function(t){function e(e){var i=t.call(this,e)||this;return i._endTimer=null,i.animationManager=null,i}return i(e,t),e.prototype.initialize=function(){this.pan=new d({navigation:this}),this.rotate=new f({navigation:this}),this.pinch=new m({navigation:this}),this.zoomBox=new c({view:this.view,navigation:this})},e.prototype.destroy=function(){this.zoomBox.destroy(),this.zoomBox=null,this.animationManager=null},e.prototype.begin=function(){this._set("interacting",!0)},e.prototype.end=function(){this._lastEventTimestamp=u(),this._startTimer(250)},e.prototype.zoom=function(t,e){return void 0===e&&(e=this._getDefaultAnchor()),o(this,void 0,void 0,(function(){return r(this,(function(i){return this.stop(),this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs?t<1?[2,this.zoomIn(e)]:[2,this.zoomOut(e)]:(this.setViewpoint(e,t,0,[0,0]),[2])}))}))},e.prototype.zoomIn=function(t){return o(this,void 0,void 0,(function(){var e,i;return r(this,(function(n){return e=this.view,i=e.constraints.snapToNextScale(e.scale),[2,this._zoomToScale(i,t)]}))}))},e.prototype.zoomOut=function(t){return o(this,void 0,void 0,(function(){var e,i;return r(this,(function(n){return e=this.view,i=e.constraints.snapToPreviousScale(e.scale),[2,this._zoomToScale(i,t)]}))}))},e.prototype.setViewpoint=function(t,e,i,n){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,e,i,n),this.end()},e.prototype.setViewpointImmediate=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=[0,0]),void 0===n&&(n=this._getDefaultAnchor()),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,n,t,e,i)},e.prototype.continousRotateClockwise=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){p.rotateBy(t,t,-1)}))},e.prototype.continousRotateCounterclockwise=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){p.rotateBy(t,t,1)}))},e.prototype.resetRotation=function(){this.view.rotation=0},e.prototype.continousPanLeft=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){p.translateBy(t,t,[-10,0])}))},e.prototype.continousPanRight=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){p.translateBy(t,t,[10,0])}))},e.prototype.continousPanUp=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){p.translateBy(t,t,[0,10])}))},e.prototype.continousPanDown=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){p.translateBy(t,t,[0,-10])}))},e.prototype.stop=function(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))},e.prototype._startTimer=function(t){var e=this;return null!==this._endTimer||(this._endTimer=setTimeout((function(){e._endTimer=null;var t=u()-e._lastEventTimestamp;t<250?e._endTimer=e._startTimer(t):e._set("interacting",!1)}),t)),this._endTimer},e.prototype._getDefaultAnchor=function(){var t=this.view,e=t.size,i=t.padding,n=i.left,r=i.right,o=i.top,a=i.bottom;return g[0]=.5*(e[0]-r+n),g[1]=.5*(e[1]-a+o),g},e.prototype._zoomToScale=function(t,e){return void 0===e&&(e=this._getDefaultAnchor()),o(this,void 0,void 0,(function(){var i,n,o,a,s,u,h,l;return r(this,(function(r){return i=this.view,n=i.constraints,o=i.scale,a=i.viewpoint,s=i.size,u=i.padding,h=n.canZoomInTo(t),l=n.canZoomOutTo(t),t<o&&!h||t>o&&!l?[2]:[2,i.goTo(p.padAndScaleAndRotateBy(v,a,t/o,0,e,s,u),{animate:!0})]}))}))},e.prototype._scaleRotateTranslateViewpoint=function(t,e,i,n,r){var o=this.view,a=o.size,s=o.padding,u=o.constraints,h=o.scale,l=o.viewpoint,c=h*i,d=u.canZoomInTo(c),m=u.canZoomOutTo(c);return(i<1&&!d||i>1&&!m)&&(i=1),p.translateBy(l,l,r),p.padAndScaleAndRotateBy(t,l,i,n,e,a,s)},n([h.property()],e.prototype,"animationManager",void 0),n([h.property({type:Boolean,readOnly:!0})],e.prototype,"interacting",void 0),n([h.property()],e.prototype,"pan",void 0),n([h.property()],e.prototype,"pinch",void 0),n([h.property()],e.prototype,"rotate",void 0),n([h.property()],e.prototype,"view",void 0),n([h.property()],e.prototype,"zoomBox",void 0),n([h.subclass("esri.views.2d.navigation.MapViewNavigation")],e)}(h.declared(s));e.default=y}.apply(null,n))||(t.exports=r)},1705:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(1),i(0),i(11),i(21),i(2)],void 0===(r=function(t,e,i,n,r,o,a){var s="Shift";return function(t){function e(e){var i=t.call(this,e)||this;return i._container=null,i._overlay=null,i._backgroundShape=null,i._boxShape=null,i._box={x:0,y:0,width:0,height:0},i._redraw=i._redraw.bind(i),i}return i(e,t),e.prototype.destroy=function(){this.view=null},Object.defineProperty(e.prototype,"view",{set:function(t){var e=this;this._handles&&this._handles.forEach((function(t){t.remove()})),this._handles=null,this._destroyOverlay(),this._set("view",t),t&&(t.on("drag",[s],(function(t){return e._handleDrag(t,1)})),t.on("drag",[s,"Ctrl"],(function(t){return e._handleDrag(t,-1)})))},enumerable:!0,configurable:!0}),e.prototype._start=function(){this._createContainer(),this._createOverlay(),this.navigation.begin()},e.prototype._update=function(t,e,i,n){this._box.x=t,this._box.y=e,this._box.width=i,this._box.height=n,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))},e.prototype._end=function(t,e,i,n,r){var a=this.view,s=a.toMap(o.createScreenPoint(t+.5*i,e+.5*n)),u=Math.max(i/a.width,n/a.height);-1===r&&(u=1/u),this._destroyOverlay(),this.navigation.end(),a.goTo({center:s,scale:a.scale*u})},e.prototype._updateBox=function(t,e,i,n){var r=this._boxShape;r.setAttributeNS(null,"x",""+t),r.setAttributeNS(null,"y",""+e),r.setAttributeNS(null,"width",""+i),r.setAttributeNS(null,"height",""+n),r.setAttributeNS(null,"class","esri-zoom-box__outline")},e.prototype._updateBackground=function(t,e,i,n){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,i,n,this.view.width,this.view.height))},e.prototype._createContainer=function(){var t=document.createElement("div");t.className="esri-zoom-box__container",this.view.root.appendChild(t),this._container=t},e.prototype._createOverlay=function(){var t=this.view.width,e=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),i.setAttributeNS(null,"class","esri-zoom-box__overlay-background");var n=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttributeNS(null,"class","esri-zoom-box__overlay"),r.appendChild(i),r.appendChild(n),this._container.appendChild(r),this._backgroundShape=i,this._boxShape=n,this._overlay=r},e.prototype._destroyOverlay=function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null},e.prototype._toSVGPath=function(t,e,i,n,r,o){var a=t+i,s=e+n;return"M 0 0 L "+r+" 0 L "+r+" "+o+" L 0 "+o+" ZM "+t+" "+e+" L "+t+" "+s+" L "+a+" "+s+" L "+a+" "+e+" Z"},e.prototype._handleDrag=function(t,e){var i,n,r,o,a=t.x,s=t.y,u=t.origin.x,h=t.origin.y;switch(a>u?(i=u,r=a-u):(i=a,r=u-a),s>h?(n=h,o=s-h):(n=s,o=h-s),t.action){case"start":this._start();break;case"update":this._update(i,n,r,o);break;case"end":this._end(i,n,r,o,e)}t.stopPropagation()},e.prototype._redraw=function(){if(this._rafId&&(this._rafId=null,this._overlay)){var t=this._box,e=t.x,i=t.y,n=t.width,r=t.height;this._updateBox(e,i,n,r),this._updateBackground(e,i,n,r),this._rafId=requestAnimationFrame(this._redraw)}},n([a.property()],e.prototype,"navigation",void 0),n([a.property()],e.prototype,"view",null),n([a.subclass("esri.views.2d.navigation.ZoomBox")],e)}(a.declared(r))}.apply(null,n))||(t.exports=r)},1706:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(1),i(0),i(18),i(110),i(11),i(21),i(2),i(195),i(326),i(83),i(1707)],void 0===(r=function(t,e,i,n,r,o,a,s,u,h,l,p,c){return function(t){function e(e){var i=t.call(this,e)||this;return i.animationTime=0,i.momentumEstimator=new c.PanPlanarMomentumEstimator(500,6,.92),i.momentum=null,i.tmpMomentum=l.vec3f64.create(),i.momentumFinished=!1,i.viewpoint=new o({targetGeometry:new r.Point,scale:0,rotation:0}),i.watch("momentumFinished",(function(t){t&&i.navigation.stop()})),i}return i(e,t),e.prototype.begin=function(t,e){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(e),this.previousDrag=e},e.prototype.update=function(t,e){this.addToEstimator(e);var i=e.center.x,n=e.center.y,r=this.previousDrag;i=r?r.center.x-i:-i,n=r?n-r.center.y:n,t.viewpoint=p.translateBy(this.viewpoint,t.viewpoint,[i||0,n||0]),this.previousDrag=e},e.prototype.end=function(t,e){this.addToEstimator(e);var i=t.navigation.momentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this.previousDrag=null,this.navigation.end()},e.prototype.addToEstimator=function(t){var e=t.center.x,i=t.center.y,n=s.createScreenPointArray(-e,i),r=l.vec3f64.fromValues(-e,i,0);this.momentumEstimator.add(n,r,.001*t.timestamp)},e.prototype.onAnimationUpdate=function(t){var e=this;this.navigation.animationManager.animateContinous(t.viewpoint,(function(i,n){e.momentumFinished=!e.momentum||e.momentum.isFinished(e.animationTime);var r=.001*n;if(!e.momentumFinished){var o=e.momentum.valueDelta(e.animationTime,r);h.vec3.scale(e.tmpMomentum,e.momentum.direction,o),t.viewpoint=p.translateBy(i,i,e.tmpMomentum)}e.animationTime+=r}))},e.prototype.stopMomentumNavigation=function(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())},n([u.property()],e.prototype,"momentumFinished",void 0),n([u.property()],e.prototype,"viewpoint",void 0),n([u.property()],e.prototype,"navigation",void 0),n([u.subclass("esri.views.2d.navigation.actions.Pan")],e)}(u.declared(a))}.apply(null,n))||(t.exports=r)},1707:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(17),i(195),i(326),i(1396),i(1273)],void 0===(r=function(t,e,i,n,r,o,a){Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(e,i,n,r,o){var a=t.call(this,e,i,n)||this;return a.sceneVelocity=r,a.direction=o,a}return i(e,t),e.prototype.value=function(e){return t.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,e)},e}(a.Momentum);e.PanPlanarMomentum=s;var u=function(){function t(t,e,i){void 0===t&&(t=300),void 0===e&&(e=12),void 0===i&&(i=.84),this.minimumInitialVelocity=t,this.stopVelocity=e,this.friction=i,this.enabled=!0,this.time=new o.FilteredFiniteDifference(.6),this.screen=[new o.FilteredFiniteDifference(.4),new o.FilteredFiniteDifference(.4)],this.scene=[new o.FilteredFiniteDifference(.6),new o.FilteredFiniteDifference(.6),new o.FilteredFiniteDifference(.6)],this.tmpDirection=r.vec3f64.create()}return t.prototype.add=function(t,e,i){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(i)<.015)return;this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.scene[0].update(e[0]),this.scene[1].update(e[1]),this.scene[2].update(e[2]),this.time.update(i)}},t.prototype.reset=function(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()},t.prototype.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var t=this.screen[0].filteredDelta,e=this.screen[1].filteredDelta,i=Math.sqrt(t*t+e*e)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)},t.prototype.createMomentum=function(t,e,i){n.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var r=n.vec3.length(this.tmpDirection);r>0&&n.vec3.scale(this.tmpDirection,this.tmpDirection,1/r);var o=r/this.time.filteredDelta;return new s(t,e,i,o,this.tmpDirection)},t}();e.PanPlanarMomentumEstimator=u}.apply(null,n))||(t.exports=r)},1708:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(1),i(0),i(18),i(110),i(11),i(2),i(78),i(139),i(83),i(1709),i(1710)],void 0===(r=function(t,e,i,n,r,o,a,s,u,h,l,p,c){return function(t){function e(e){var i=t.call(this,e)||this;return i._animationTime=0,i._momentumFinished=!1,i._rotationMomentumEstimator=new p.RotationMomentumEstimator(.6,.15,.95),i._rotationDirection=1,i._zoomDirection=1,i._zoomMomentumEstimator=new c.ZoomMomentumEstimator,i._zoomOnly=null,i.zoomMomentum=null,i.rotateMomentum=null,i.viewpoint=new o({targetGeometry:new r.Point,scale:0,rotation:0}),i.watch("_momentumFinished",(function(t){t&&i.navigation.stop()})),i}return i(e,t),e.prototype.begin=function(t,e){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=e.angle,this._previousRadius=this._startRadius=e.radius,this._previousCenter=e.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,e.timestamp),this.addToZoomEstimator(e,1)},e.prototype.update=function(t,e){null===this._updateTimestamp&&(this._updateTimestamp=e.timestamp);var i=e.angle,n=e.radius,r=e.center,o=Math.abs(180*(i-this._startAngle)/Math.PI),a=Math.abs(n-this._startRadius),s=this._startRadius/n;if(this._previousRadius){var u=n/this._previousRadius,h=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=h>=0?1:-1,this._zoomDirection=u>=1?1:-1,t.constraints.rotationEnabled?(null===this._zoomOnly&&e.timestamp-this._updateTimestamp>200&&(this._zoomOnly=a-o>0),null===this._zoomOnly||this._zoomOnly?h=0:this.addToRotateEstimator(i-this._startAngle,e.timestamp)):h=0,this.addToZoomEstimator(e,s),this.navigation.setViewpoint([r.x,r.y],1/u,h,[this._previousCenter.x-r.x,r.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=n,this._previousCenter=r},e.prototype.end=function(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()},e.prototype.addToRotateEstimator=function(t,e){this._rotationMomentumEstimator.add(t,.001*e)},e.prototype.addToZoomEstimator=function(t,e){this._zoomMomentumEstimator.add(e,.001*t.timestamp)},e.prototype.canZoomIn=function(t){var e=t.scale,i=t.constraints.effectiveMaxScale;return 0===i||e>i},e.prototype.canZoomOut=function(t){var e=t.scale,i=t.constraints.effectiveMinScale;return 0===i||e<i},e.prototype.onAnimationUpdate=function(t){var e=this;this.navigation.animationManager.animateContinous(t.viewpoint,(function(i,n){var r=!e.canZoomIn(t)&&e._zoomDirection>1||!e.canZoomOut(t)&&e._zoomDirection<1,o=!e.rotateMomentum||e.rotateMomentum.isFinished(e._animationTime),a=r||!e.zoomMomentum||e.zoomMomentum.isFinished(e._animationTime),s=.001*n;if(e._momentumFinished=o&&a,!e._momentumFinished){var p=e.rotateMomentum?Math.abs(e.rotateMomentum.valueDelta(e._animationTime,s))*e._rotationDirection*180/Math.PI:0,c=e.zoomMomentum?Math.abs(e.zoomMomentum.valueDelta(e._animationTime,s)):1,d=h.vec2f64.create(),m=h.vec2f64.create();if(e._previousCenter){u.vec2.set(d,e._previousCenter.x,e._previousCenter.y),l.getPaddingScreenTranslation(m,t.size,t.padding),u.vec2.add(d,d,m);var f=t.constraints,v=t.scale,g=v*c;c<1&&!f.canZoomInTo(g)?(c=v/f.effectiveMaxScale,e.zoomMomentum=null,e.rotateMomentum=null):c>1&&!f.canZoomOutTo(g)&&(c=v/f.effectiveMinScale,e.zoomMomentum=null,e.rotateMomentum=null),l.scaleAndRotateBy(i,t.viewpoint,c,p,d,t.size)}}e._animationTime+=s}))},e.prototype.stopMomentumNavigation=function(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())},n([s.property()],e.prototype,"_momentumFinished",void 0),n([s.property()],e.prototype,"viewpoint",void 0),n([s.property()],e.prototype,"navigation",void 0),n([s.subclass("esri.views.2d.navigation.actions.Pinch")],e)}(s.declared(a))}.apply(null,n))||(t.exports=r)},1709:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(17),i(1397)],void 0===(r=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(e,i,n,r){return void 0===e&&(e=3),void 0===i&&(i=.01),void 0===n&&(n=.95),void 0===r&&(r=12),t.call(this,e,i,n,r)||this}return i(e,t),e.prototype.add=function(e,i){if(this.value.hasLastValue){for(var n=this.value.lastValue,r=e-n;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;e=n+r}t.prototype.add.call(this,e,i)},e}(n.MomentumEstimator);e.RotationMomentumEstimator=r}.apply(null,n))||(t.exports=r)},1710:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(17),i(1273),i(1397)],void 0===(r=function(t,e,i,n,r){Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,i,n){return t.call(this,e,i,n)||this}return i(e,t),e.prototype.value=function(e){var i=t.prototype.value.call(this,e);return Math.exp(i)},e.prototype.valueDelta=function(e,i){var n=t.prototype.value.call(this,e),r=t.prototype.value.call(this,e+i)-n;return Math.exp(r)},e}(n.Momentum);e.ZoomMomentum=o;var a=function(t){function e(e,i,n,r){return void 0===e&&(e=2.5),void 0===i&&(i=.01),void 0===n&&(n=.95),void 0===r&&(r=12),t.call(this,e,i,n,r)||this}return i(e,t),e.prototype.add=function(e,i){t.prototype.add.call(this,Math.log(e),i)},e.prototype.createMomentum=function(t,e,i){return new o(t,e,i)},e}(r.MomentumEstimator);e.ZoomMomentumEstimator=a}.apply(null,n))||(t.exports=r)},1711:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(1),i(0),i(18),i(110),i(11),i(2),i(78),i(139),i(83)],void 0===(r=function(t,e,i,n,r,o,a,s,u,h,l){var p=h.vec2f64.create(),c=h.vec2f64.create();return function(t){function e(e){var i=t.call(this,e)||this;return i._previousCenter=h.vec2f64.create(),i.viewpoint=new o({targetGeometry:new r.Point,scale:0,rotation:0}),i}return i(e,t),e.prototype.begin=function(t,e){this.navigation.begin(),u.vec2.set(this._previousCenter,e.center.x,e.center.y)},e.prototype.update=function(t,e){var i=t.state,n=i.size,r=i.padding;u.vec2.set(p,e.center.x,e.center.y),l.getAnchor(c,n,r),t.viewpoint=l.rotateBy(this.viewpoint,t.state.paddedViewState.viewpoint,l.angleBetween(c,this._previousCenter,p)),u.vec2.copy(this._previousCenter,p)},e.prototype.end=function(){this.navigation.end()},n([s.property()],e.prototype,"viewpoint",void 0),n([s.property()],e.prototype,"navigation",void 0),n([s.subclass("esri.views.2d.actions.Rotate")],e)}(s.declared(a))}.apply(null,n))||(t.exports=r)},1712:function(t,e,i){var n,r;n=[i.dj.c(t.i),e,i(17),i(9),i(8),i(31),i(4),i(321),i(320)],void 0===(r=function(t,e,i,n,r,o,a,s,u){Object.defineProperty(e,"__esModule",{value:!0}),s.enums.DataType,s.enums.Usage,s.enums.TextureSamplingMode,s.enums.TextureType,s.enums.TextureWrapMode,s.enums.PrimitiveType,s.enums.PixelFormat,s.enums.PixelType;var h=u.enums.WGLDrawPhase,l=function(e){function l(){var t=e.call(this)||this;return t.visible=!1,t}return i(l,e),l.prototype.destroy=function(){this._readbackTexture&&(this._readbackTexture.dispose(),this._readbackTexture=null,this._maskTexture.dispose(),this._maskTexture=null,this._overlayTexture.dispose(),this._overlayTexture=null,this._vertexArrayObject.dispose(),this._vertexArrayObject=null,this._program.dispose(),this._program=null,this._resourcesPromise=null)},Object.defineProperty(l.prototype,"magnifier",{get:function(){return this._magnifier},set:function(t){var e=this;this._magnifier=t,this._handle&&this._handle.remove(),this._handle=t.watch("version",(function(){e.visible=t.visible})),this.visible=t.visible},enumerable:!0,configurable:!0}),l.prototype.doRender=function(e){var i=this.stage.context;if(this._resourcesPromise){if(e.drawPhase===h.MAP&&this._canRender()){this._updateResources(i);var n=this._magnifier,r=1/n.factor,o=Math.ceil(r*this.overlay.width),a=Math.ceil(r*this.overlay.height),s=e.state.size,u=e.pixelRatio,l=u*s[0],p=u*s[1],c=n.position||{x:.5*s[0],y:.5*s[1]},d=u*c.x,m=p-u*c.y,f=.5*o,v=.5*a;f>d?d=f:d>=l-f&&(d=l-f-1),v>m?m=v:m>=p-v&&(m=p-v-1);var g=d-f,y=m-v,_=this._readbackTexture;i.bindTexture(_,0),i.gl.copyTexImage2D(_.descriptor.target,0,_.descriptor.pixelFormat,g,y,o,a,0);var b=this.stage.background&&this.stage.background.color,w=b?[b.a*b.r/255,b.a*b.g/255,b.a*b.b/255,b.a]:[1,1,1,1],x=(d+n.offsetX)/l*2-1,M=(m-n.offsetY)/p*2-1,T=this.overlay.width/l*2,P=this.overlay.height/p*2,S=this._program;i.bindVAO(this._vertexArrayObject),i.bindTexture(this._overlayTexture,6),i.bindTexture(this._maskTexture,7),i.bindProgram(S),S.setUniform4fv("u_background",w),S.setUniform1i("u_readbackTexture",0),S.setUniform1i("u_overlyTexture",6),S.setUniform1i("u_maskTexture",7),S.setUniform2f("u_drawPos",x,M),S.setUniform1f("u_width",T),S.setUniform1f("u_height",P),i.setStencilTestEnabled(!1),i.drawArrays(5,0,4),i.bindVAO()}}else this._resourcesPromise=this._loadResources(t.toUrl("../../../images/magnifier/mask.png"),t.toUrl("../../../images/magnifier/overlay.png"))},l.prototype._canRender=function(){return this.mask&&this.overlay&&null!=this._magnifier},l.prototype._loadResources=function(t,e){return n(this,void 0,void 0,(function(){var i,n,s;return r(this,(function(r){switch(r.label){case 0:return[4,a.all([o(t,{responseType:"image"}),o(e,{responseType:"image"})])];case 1:return i=r.sent(),n=i[0].data,s=i[1].data,this.mask=n,this.overlay=s,this.requestRender(),[2]}}))}))},l.prototype._updateResources=function(t){if(!this._readbackTexture){var e=1/this._magnifier.factor,i=Math.ceil(e*this.overlay.width),n=Math.ceil(e*this.overlay.height);this._program=u.createMagnifierProgram(t);var r=new Uint16Array([0,1,0,0,1,1,1,0]),o=u.magnifier.attributes;this._vertexArrayObject=new s.VertexArrayObject(t,o,{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:s.BufferObject.createVertex(t,35044,r)}),this._overlayTexture=new s.Texture(t,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.overlay),this._maskTexture=new s.Texture(t,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.mask),this._readbackTexture=new s.Texture(t,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:i,height:n})}},l}(u.DisplayObject);e.default=l}.apply(null,n))||(t.exports=r)}}]);